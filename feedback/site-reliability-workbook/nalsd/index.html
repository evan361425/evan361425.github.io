
<!DOCTYPE html>

<html class="no-js" lang="zh-TW">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="各種紀錄和心得" name="description"/>
<link href="https://evan361425.github.io/feedback/site-reliability-workbook/nalsd/" rel="canonical"/>
<link href="../managing-load/" rel="prev"/>
<link href="../data-pipelines/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.3" name="generator"/>
<meta content="COb7MqeOYLfRXXUOsXWaQvnr1_Xb33a0aP_Y8UC3U5Y" name="google-site-verification">
<meta content="非抽象大型系統設計" property="og:title">
<title>非抽象大型系統設計 - 心得與記錄</title>
<link href="../../../assets/stylesheets/main.d7758b05.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=-apple-system,+BlinkMacSystemFont,+" rel="stylesheet" segoe+ui",+"helvetica+neue",+helvetica,+roboto,+arial,+"pingfang+tc",+"microsoft+jhenghei",+"微軟正黑",+sans-serif,+"apple+color+emoji",+"segoe+ui+emoji",+"segoe+ui+symbol":300,300i,400,400i,700,700i%7croboto+mono:400,400i,700,700i&display='fallback"'/>
<style>:root{--md-text-font:"-apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Helvetica, Roboto, Arial, "PingFang TC", "Microsoft JhengHei", "微軟正黑", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"";--md-code-font:"Roboto Mono"}</style>
<link href="../../../stylesheets/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-P67FD9XP83"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-P67FD9XP83",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-P67FD9XP83",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</meta></meta></head>
<body data-md-color-accent="light-blue" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#非抽象大型系統設計">
          跳轉到
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="頁首" class="md-header__inner md-grid">
<a aria-label="心得與記錄" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="心得與記錄">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            心得與記錄
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              非抽象大型系統設計
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="黑夜降臨" class="md-option" data-md-color-accent="light-blue" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="黑夜降臨">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="白日昇起" class="md-option" data-md-color-accent="deep-orange" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="白日昇起">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜尋" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜尋" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="搜尋" class="md-search__options">
<button aria-label="清除" class="md-search__icon md-icon" tabindex="-1" title="清除" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/evan361425/evan361425.github.io" title="前往倉庫">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="標籤" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
    
  
  自我介紹

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
    
  
  心得

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../review/">
          
  
    
  
  年度回顧

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../essay/">
          
  
    
  
  隨筆

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="導覽列" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="心得與記錄" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="心得與記錄">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    心得與記錄
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/evan361425/evan361425.github.io" title="前往倉庫">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    自我介紹
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    心得
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            心得
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../designing-data-intensive-applications/">
<span class="md-ellipsis">
    Designing Data-intensive Applications
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            Designing Data-intensive Applications
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/foundation-model/">
<span class="md-ellipsis">
    基礎—模型和語法
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/foundation-index/">
<span class="md-ellipsis">
    基礎—索引
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/foundation-dw/">
<span class="md-ellipsis">
    基礎—資料倉儲
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/foundation-encode/">
<span class="md-ellipsis">
    基礎—編碼和進程
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/foundation-ft/">
<span class="md-ellipsis">
    基礎—容錯
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/distributed-replication/">
<span class="md-ellipsis">
    分散式—複製
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/distributed-partition/">
<span class="md-ellipsis">
    分散式—分區
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/distributed-env/">
<span class="md-ellipsis">
    分散式—環境
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/distributed-ft/">
<span class="md-ellipsis">
    分散式—容錯
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/derived-batch/">
<span class="md-ellipsis">
    衍生—批次處理
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/derived-stream/">
<span class="md-ellipsis">
    衍生—串流處理
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/farewell/">
<span class="md-ellipsis">
    總結和整合
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../designing-data-intensive-applications/glossary/">
<span class="md-ellipsis">
    詞彙表
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/">
<span class="md-ellipsis">
    Distributed Systems with Node.js
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Distributed Systems with Node.js
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/protocol/">
<span class="md-ellipsis">
    協定
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/sla-and-load-testing/">
<span class="md-ellipsis">
    SLA 和負載測試
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/observability/">
<span class="md-ellipsis">
    可觀測性
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/container/">
<span class="md-ellipsis">
    容器化
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/container-orchestration-and-misc/">
<span class="md-ellipsis">
    容器調度工具和其他
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../future-of-fusion-energy/">
<span class="md-ellipsis">
    （WIP）Future Of Fusion Energy
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            （WIP）Future Of Fusion Energy
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../future-of-fusion-energy/energy/">
<span class="md-ellipsis">
    能源
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../future-of-fusion-energy/fusion/">
<span class="md-ellipsis">
    核融合
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    （WIP）SRE Workbook
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
            （WIP）SRE Workbook
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../toil/">
<span class="md-ellipsis">
    勞動力
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../simplicity/">
<span class="md-ellipsis">
    簡化系統
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../on-call/">
<span class="md-ellipsis">
    待命小組
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../incident-response/">
<span class="md-ellipsis">
    災難管理
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../postmortem-culture/">
<span class="md-ellipsis">
    事後析誤文化
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../managing-load/">
<span class="md-ellipsis">
    負載管理
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    非抽象大型系統設計
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    非抽象大型系統設計
    
  </span>
</a>
<nav aria-label="目錄" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目錄
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#練習流程">
<span class="md-ellipsis">
      練習流程
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#練習adwords">
<span class="md-ellipsis">
      練習：AdWords
    </span>
</a>
<nav aria-label="練習：AdWords" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#定義需求的-slo">
<span class="md-ellipsis">
      定義需求的 SLO
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#評估需求的資源">
<span class="md-ellipsis">
      評估需求的資源
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#設計可行架構">
<span class="md-ellipsis">
      設計可行架構
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#延伸架構去滿足-slo">
<span class="md-ellipsis">
      延伸架構去滿足 SLO
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#總結">
<span class="md-ellipsis">
      總結
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../data-pipelines/">
<span class="md-ellipsis">
    資料管線設計
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configuration-best-practice/">
<span class="md-ellipsis">
    設定檔的最佳實踐
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../canary-release/">
<span class="md-ellipsis">
    金絲雀部署
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-it/">
<span class="md-ellipsis">
    Release It!
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adaptive-concurrency/">
<span class="md-ellipsis">
    Adaptive Concurrency
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../physics/">
<span class="md-ellipsis">
    Physics
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
            Physics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../physics/astronomy/">
<span class="md-ellipsis">
    天文學
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../physics/special-relativity/">
<span class="md-ellipsis">
    （WIP）狹義相對論
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../review/">
<span class="md-ellipsis">
    年度回顧
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            年度回顧
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../review/2022-ai/">
<span class="md-ellipsis">
    2022 AI 回顧
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../review/2023/">
<span class="md-ellipsis">
    2023 回顧
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../review/2024/">
<span class="md-ellipsis">
    2024 回顧
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../essay/">
<span class="md-ellipsis">
    隨筆
    
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            隨筆
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-ellipsis">
    系統架構類
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            系統架構類
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/made-container/">
<span class="md-ellipsis">
    如何製作 Docker Container
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/pki-checklist/">
<span class="md-ellipsis">
    建置 PKI 注意事項
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/replace-docker-desktop/">
<span class="md-ellipsis">
    取代 Docker Desktop
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/tomcat-max-packet-size/">
<span class="md-ellipsis">
    Tomcat 的 max_packet_size
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/tcp-socket-loss-after-dhcp/">
<span class="md-ellipsis">
    TCP socket 連線被清除的錯誤排查
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
<span class="md-ellipsis">
    程式語言類
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            程式語言類
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/code/node.js-best-practice/">
<span class="md-ellipsis">
    Node.js 最佳實作
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/code/node.js-error/">
<span class="md-ellipsis">
    Node.js 的錯誤有哪些
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/code/object-oriented-terms/">
<span class="md-ellipsis">
    物件導向名詞
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/code/handle-legacy-system/">
<span class="md-ellipsis">
    處理舊有系統
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
<span class="md-ellipsis">
    網路相關
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            網路相關
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/network-routing/">
<span class="md-ellipsis">
    網路怎麼傳
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/network-details/">
<span class="md-ellipsis">
    網路傳了什麼
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/network-books/">
<span class="md-ellipsis">
    網路推薦書籍
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/tcp/">
<span class="md-ellipsis">
    TCP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/ntp/">
<span class="md-ellipsis">
    NTP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/http/">
<span class="md-ellipsis">
    HTTP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/retry-strategy/">
<span class="md-ellipsis">
    Retry 的策略
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/certificate-transparency/">
<span class="md-ellipsis">
    Certificate Transparency
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/url-structure/">
<span class="md-ellipsis">
    URL 長什麼樣子
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/maglev/">
<span class="md-ellipsis">
    Maglev
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
<span class="md-ellipsis">
    網路安全
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
            網路安全
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/cross-origin-resources-sharing/">
<span class="md-ellipsis">
    CORS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/mixed-content/">
<span class="md-ellipsis">
    Mixed Content
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/owasp-api-top10/">
<span class="md-ellipsis">
    OWASP API Top 10
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/owasp-authentication-best-practice/">
<span class="md-ellipsis">
    OWASP 驗證機制最佳指南
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/owasp-mobile-risk-top10/">
<span class="md-ellipsis">
    OWASP 行動裝置風險
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
<span class="md-ellipsis">
    其他
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            其他
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/gpl-check/">
<span class="md-ellipsis">
    GPL 的檢查
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/nginx-changelog/">
<span class="md-ellipsis">
    Nginx 1.18 到 1.22 的差異
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/node-changelog-14-18/">
<span class="md-ellipsis">
    Node.js 14 到 18 的差異
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/questionnaire-principal/">
<span class="md-ellipsis">
    問卷設計指南
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/devex-in-action/">
<span class="md-ellipsis">
    開發體驗的改進
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/interview-questions/">
<span class="md-ellipsis">
    面試時的殺手級問題
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/pls-sem/">
<span class="md-ellipsis">
    PLS-SEM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/confidential-computing/">
<span class="md-ellipsis">
    機密運算
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目錄" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目錄
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#練習流程">
<span class="md-ellipsis">
      練習流程
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#練習adwords">
<span class="md-ellipsis">
      練習：AdWords
    </span>
</a>
<nav aria-label="練習：AdWords" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#定義需求的-slo">
<span class="md-ellipsis">
      定義需求的 SLO
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#評估需求的資源">
<span class="md-ellipsis">
      評估需求的資源
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#設計可行架構">
<span class="md-ellipsis">
      設計可行架構
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#延伸架構去滿足-slo">
<span class="md-ellipsis">
      延伸架構去滿足 SLO
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#總結">
<span class="md-ellipsis">
      總結
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/evan361425/evan361425.github.io/blob/master/src/feedback/site-reliability-workbook/nalsd.md" title="編輯此頁">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5m-7.86-1.75L8.85 19l.29-.74C10.43 15.06 13.5 13 17 13c1.05 0 2.06.21 3 .56V8l-6-6H6c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h4.5c-.55-.66-1-1.42-1.36-2.25M13 3.5 18.5 9H13z"></path></svg>
</a>
<h1 id="非抽象大型系統設計">非抽象大型系統設計<a class="headerlink" href="#非抽象大型系統設計" title="Permanent link">¶</a></h1>
<p>非抽象大型系統設計（Non Abstract Large System Design, NALSD）的目的在於讓開發者設計系統架構時，
能夠有個依據來建立穩健而又高擴充的系統。</p>
<p>本文先透過定義問題，收集需求並反覆審視、循序改善架構的設計，最終得到一個可靠的系統設計解方。
目標是讓開發者能設計出一個在初期便擁有高穩健性且同時擁有未來調整的環境，
而這個過程，就是把抽象的需求，落地成實際可被分析的數字。
這些分析包括：</p>
<ul>
<li>容量（capacity）預估</li>
<li>功能獨立性（類似艙壁原則，bulkheads），避免單一功能的損壞影響全部的服務。</li>
<li>允許服務降能（degradation）</li>
</ul>
<p>這些實踐讓 SRE 有能力在面對系統設計時，
思考系統的擴充性和可能的瓶頸，並專注在這些點上。
在接下來的練習中，每一次設計的迭代，都可以反覆問自己這四個問題：</p>
<ul>
<li><em>這個設計可能嗎？</em> 假設不去管資源議題，這個設計可以滿足需求嗎？</li>
<li><em>有沒有更好的方法？</em> 可以讓他更快、更輕便、更有效率嗎？</li>
<li><em>這方法可以在有限的設備數量、時間和金錢內達成嗎？</em></li>
<li><em>這個架構允許降能嗎？</em> 當某組建壞掉會發生什麼事？當資料中心壞掉會發生什麼事？</li>
</ul>
<div class="admonition success">
<p class="admonition-title">練習的目的</p>
<p>所有的系統最終都要實際跑在真實的資料中心和真實的設備上，
我們需要反覆練習將白板上的架構圖，轉化成實際要使用的設備數量、網路通量等等。
聽起來很瑣碎，但是不去練習和規劃，當我們實際上線時，可能會付出更慘痛的代價。</p>
<p>練習中的假設和推估會比最終實際結果重要。
早期的假設會很大程度影響最終的成果，但是在 NALSD 中，
我們並不是要練習出完美的假設，而是在多個<strong>不完美但是合理的假設</strong>中導出一個更好被詮釋的結果</p>
</div>
<h2 id="練習流程">練習流程<a class="headerlink" href="#練習流程" title="Permanent link">¶</a></h2>
<p>開始前，先簡述一下流程。
我們將使用反覆迭代的方式去設計系統，每次迭代都會定義出相關的設計並找出它的優勢和弱點。
而每次迭代的分析，都會幫助我們找出優點在下一次的迭代中設計出更好的系統。
在初始階段我們會根據以下兩個問題來設計系統：</p>
<ul>
<li>這個設計可能嗎？</li>
<li>有沒有更好的方法？</li>
</ul>
<p>接著我們會去思考針對<strong>初始設計的擴充性</strong>，這時就會再去回應以下三個問題：</p>
<ul>
<li>這方法可以在有限的設備數量、時間和金錢內達成嗎？</li>
<li>這個架構允許降能嗎？</li>
<li>有沒有更好的方法？</li>
</ul>
<p>雖然這裡列出順序，但實際練習時這些問題可能是反覆詰問的。
例如在初始階段，我們可能就會先考慮它的可擴充性。
如果這個設計在後面的問題無法得到好的回答，我們就會修正或替換某個組件，接著重頭開始。</p>
<h2 id="練習adwords">練習：AdWords<a class="headerlink" href="#練習adwords" title="Permanent link">¶</a></h2>
<p>AdWords 是 Google 一項產品，用來在使用者透過 Google 搜尋時，推出純文字的廣告。
這次練習，是要設計出一個系統，可以觀測並回報正確的 <em>click-through rate</em>
（CTR，<em>使用者點擊廣告次數</em> 除以 <em>廣告推播數</em>）。</p>
<p>對於使用者來說，會想要知道推播的廣告是 <em>因為哪些關鍵字被投放廣告</em> 以及 <em>哪些關鍵字讓廣告更容易被點擊</em>，
進而去改變廣告關鍵字的組合然後調整廣告價錢。
這些資訊也就是需要組合 <em>關鍵字對廣告投放率</em> 以及 <em>關鍵字對廣告點擊率</em>。</p>
<h3 id="定義需求的-slo">定義需求的 SLO<a class="headerlink" href="#定義需求的-slo" title="Permanent link">¶</a></h3>
<p>首先我們站在使用者的角度去思考，對我們來說最關心的是什麼？
假設最關心的是 <strong>面板中的請求是否快速</strong> 以及 <strong>資料是否即時</strong>，由此訂定出 SLO：</p>
<ul>
<li>99.9% 的請求都要在 1 秒內完成；</li>
<li>99.9% 的 CTR 資訊都要顯示 5 分鐘內的資料。</li>
</ul>
<h3 id="評估需求的資源">評估需求的資源<a class="headerlink" href="#評估需求的資源" title="Permanent link">¶</a></h3>
<p>系統中已經存在機制把使用者的每個 <em>搜尋</em> 和 <em>廣告點擊</em> 記錄下來，以下是這些日誌的內容：</p>
<table><caption>搜尋的日誌內容</caption>
<thead>
<tr>
<th>名稱</th>
<th>變數名稱</th>
<th>型別</th>
<th>佔位（bytes）</th>
</tr>
</thead>
<tbody>
<tr>
<td>時間</td>
<td><code>time</code></td>
<td>64-bit integer</td>
<td>8</td>
</tr>
<tr>
<td>ID</td>
<td><code>query_id</code></td>
<td>64-bit integer</td>
<td>8</td>
</tr>
<tr>
<td>ADs</td>
<td><code>ad_ids</code></td>
<td>array of 64-bit integers</td>
<td>8~24（每次搜尋最多放 3 個廣告）</td>
</tr>
<tr>
<td>關鍵字</td>
<td><code>search_terms</code></td>
<td>array of char</td>
<td>≈500</td>
</tr>
<tr>
<td>元資料</td>
<td><code>metadata</code></td>
<td>array of char</td>
<td>500~1000（使用語言、哪台機器服務的等等）</td>
</tr>
</tbody>
</table>

<table><caption>廣告點擊的日誌內容</caption>
<thead>
<tr>
<th>名稱</th>
<th>變數名稱</th>
<th>型別</th>
<th>佔位（bytes）</th>
</tr>
</thead>
<tbody>
<tr>
<td>時間</td>
<td><code>time</code></td>
<td>64-bit integer</td>
<td>8</td>
</tr>
<tr>
<td>ID</td>
<td><code>query_id</code></td>
<td>64-bit integer</td>
<td>8</td>
</tr>
<tr>
<td>AD</td>
<td><code>ad_id</code></td>
<td>64-bit integer</td>
<td>8</td>
</tr>
</tbody>
</table>

<details class="question">
<summary>為什麼不把 search_term 放進廣告點擊的日誌</summary>
<p>如果我們直接把 <code>search_term</code> 放進廣告點擊的日誌中，
我們就可以直接透過該日誌找到我們想要的指標 <em>關鍵字對廣告點擊率</em>。</p>
<p>但現實是這些點擊紀錄是透過 HTTP URL 傳遞，換句話說這個 URL 是有長度限制的，
除此之外，Google 需要提供的指標不只是 CTR，為了資源使用率和資料一致性的考量，
不會把 <code>search_term</code> 到處丟。</p>
</details>
<p>假設：</p>
<ul>
<li>服務每秒會有 500K 的搜尋（Google search）和 10K 的廣告點擊；</li>
<li>搜尋每筆日誌大小為 2KB，這是高估，但是為了避免非預期大流量，高估是可被接受的。</li>
</ul>
<h3 id="設計可行架構">設計可行架構<a class="headerlink" href="#設計可行架構" title="Permanent link">¶</a></h3>
<p>我們針對三種架構討論：</p>
<ul>
<li><a href="#mysql">MySQL</a>；</li>
<li><a href="#mapreduce">MapReduce</a>；</li>
<li><a href="#logjoiner">LogJoiner</a>。</li>
</ul>
<h4 id="mysql">MySQL<a class="headerlink" href="#mysql" title="Permanent link">¶</a></h4>
<p>問題：<em>這個設計可能嗎？</em></p>
<p>如果把資料放進 MySQL 裡面，我們可以透過以下的 SQL 找出「某個廣告，針對某個關鍵字的點擊率」。</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- 把 Query Log 分成：query_ads、query_terms 和 query_metadata 三個資料表。</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">search_term</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">click_count</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">query_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">click_count</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">click_history</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">query_terms</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">query_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">query_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">search_term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ad_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">query_count</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">query_ads</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">query_terms</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">query_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">query_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">search_term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">ad_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">)</span><span class="w"> </span><span class="n">b</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">search_term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">search_term</span>
</code></pre></div>
<p>問題：<em>這方法可以在有限的設備數量、時間和金錢內達成嗎？</em></p>
<p>為了放進這些資料，我們需要多大的資料庫？
根據前面估計的量，1 天的搜尋日誌大小約為 86.4TB：</p>
<div class="arithmatex">\[\begin{flalign}
\left( 5 \times 10^5 \mathrm{\ queries/second} \right)
\times \left( 2 \times 10^3 \mathrm{\ bytes} \right)
\times \left( 8.64 \times 10^4 \mathrm{\ seconds/day} \right) \\
=86.4 \mathrm{\ TB/day}
\end{flalign}\]</div>
<p>保守估計需要約 100TB 容量，假設我們使用 4TB 的 HDD（硬碟），而每個硬碟又受限於 200 IOPS，
然後根據前面的 MySQL，我們需要把資料存進 4 個資料表，此時我們就會需要約 10,000 個硬碟：</p>
<div class="arithmatex">\[\begin{align*}
\left( 5 \times 10^5 \mathrm{\ queries/second} \right)
\times \left( 4 \mathrm{\ IO/query} \right)
/ \left( 200 \mathrm{\ IOPS/disk} \right) \\
= 1 \times 10^4 \mathrm{\ disks}
\end{align*}\]</div>
<p>單純的計算點擊率，搜尋日誌就使用 10,000 個硬碟，
為了不因 IOPS 而去選擇大量硬體，我們決定直接評估一下 RAM 的可行性，而放棄其他儲存類型，例如 SSD。
假設一台 16C/64G/1G（16 core CPU、64 GB RAM、1G 網路通量）的電腦，我們就會需要 1563 台電腦：</p>
<div class="arithmatex">\[\begin{align*}
\left\lceil
  \left( 100 \mathrm{\ TB} \right)
  / \left( 64 \mathrm{\ GB\ RAM/machine} \right)
\right\rceil \\
= 1,563 \mathrm{\ machines}
\end{align*}\]</div>
<p>這麼多台的 MySQL 叢集，如果對他做上述的搜尋指令，
這些叢集就會開始進行大量跨節點的運算，其中還要考量資源的備援、冗余，顯然不太實際。</p>
<h4 id="mapreduce">MapReduce<a class="headerlink" href="#mapreduce" title="Permanent link">¶</a></h4>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>在閱讀下文前，建議先理解
<a href="../../designing-data-intensive-applications/derived-batch/#mapreduce">MapReduce</a>。</p>
</div>
<p>問題：<em>這個設計可能嗎？</em></p>
<p>把搜尋日誌和點擊日誌的 <code>ad_id</code> <em>剖析</em>（map）出來，之後 <em>合併</em>（reduce）進每個 <code>search_term</code> 的點擊次數。
雖然 MapReduce 可以輕易做到分散式的計算，當需要更多設備時也可以輕易補上，但是我們還要考量我們的 SLO。</p>
<p>SLO：<em>99.9% 的 CTR 資訊都要顯示 5 分鐘內的資料</em>。</p>
<p>為了滿足即時資料的需求，我們必須要把批次處理的級距變得很小，例如，每分鐘批次計算一次。
但是在進行合併計算時，如果相同搜尋和點擊的日誌並沒有放在同一個批次裡
（搜尋和廣告點擊根據使用者的行為，可能沒辦法在一分鐘內完成），
就沒辦法組出 <code>search_term</code> 和點擊次數。</p>
<p>如果要處理這種跨批次的運算對於 MapReduce 來說很耗資源，同時也不是他原生適合處理的事情。
面對這個困境，我們選擇往其他可能的架構來討論。</p>
<h4 id="logjoiner">LogJoiner<a class="headerlink" href="#logjoiner" title="Permanent link">¶</a></h4>
<p>問題：<em>這個設計可能嗎？</em></p>
<p>比起讓搜尋日誌存進 MySQL，
我們使用 BigTable
或<a href="../../designing-data-intensive-applications/foundation-index/#排序字串表">排序字串表</a>，
這種好做<a href="../../designing-data-intensive-applications/distributed-partition/">分區</a>的資料庫，
然後根據特定欄位做索引後，接著單純寫入即可，不需支援 SQL 的跨節點搜尋。</p>
<pre class="mermaid"><code>---
title: LogJoiner 架構
---
flowchart TD
  ql[Query Logs] --All query&lt;br&gt;log records--&gt;qm[(QueryMap&lt;br&gt;key: ad_id,&lt;br&gt;search_term&lt;br&gt;value: query_ids)]
  ql --All query&lt;br&gt;log records--&gt;qs[(QueryStore&lt;br&gt;key: query_id&lt;br&gt;value: Query&lt;br&gt;Log record)]
  cl[Click Logs]--All click log&lt;br&gt;records--&gt;lj([LogJoiner])
  lj&lt;--Look up&lt;br&gt;query_id--&gt;qs
  lj --&gt; cm[(ClickMap&lt;br&gt;key: ad_id,&lt;br&gt;search_term&lt;br&gt;value: query_ids)]</code></pre>
<p>透過 ClickMap 和 QueryMap 存放我們需要的 <code>ad_id</code> 和 <code>search_term</code> 對應的點擊數和搜尋數。
就可以快速取得需要的廣告點擊率，接著我們計算下各自需要的儲存空間，以此來推算能否使用記憶體來存取。</p>
<details class="example">
<summary>上面流程怎麼走的？</summary>
<p>首先，搜尋紀錄會同時發送給 QueryStore 和 QueryMap，
QueryStore 會根據 <code>query_id</code> 為鍵、搜尋資料為值存放這些紀錄；
而 QueryMap 則是會根據 <code>ad_id</code> 和 <code>search_term</code> 為鍵，<code>query_id</code> 的集合為值存放。</p>
<p>當我們想知道某個廣告曝光了幾次，就可以透過 QueryMap 快速存取。</p>
<p>點擊紀錄則是會發送給 LogJoiner，它會再去跟 QueryStore 取得搜尋的細節資料後，
再把點擊的 <code>ad_id</code> 和 <code>query_id</code> 送去給 ClickMap，
並同樣依據 <code>ad_id</code> 和 <code>search_term</code> 為鍵，<code>query_id</code> 的集合為值存放。</p>
<p>當我們想知道某個廣告被點擊了幾次，就可以透過 ClickMap 快速存取。</p>
</details>
<p>我們一樣需要一個存放 100TB 的搜尋日誌，<em>QueryStore</em> 不像前面提到的 MySQL，
QueryStore 只需要以 <code>query_id</code> 作為鍵，然後存放該筆搜尋的資料即可，
這樣就可以輕易做到擴展性。</p>
<p>每次廣告點擊的日誌進來，<em>LogJoiner</em> 就會透過 <code>query_id</code> 去取得該筆的搜尋資料，
每筆資料如前述為 2KB，此時的網路通量為 160Mbps：</p>
<div class="arithmatex">\[\begin{align*}
\left( 10^4 \mathrm{\ clicks/sec} \right)
\times \left( 2\times 10^3 \mathrm{\ bytes} \right) \\
= 20 \mathrm{\ MB/sec} = 160 \mathrm{\ Mbps}
\end{align*}\]</div>
<p>接著 LogJoiner 再把 <code>query_id</code>、<code>time</code>、<code>ad_id</code> 和 <code>search_term</code> 存進 ClickMap 中，
假設總共使用 1KB，此時的網路通量為 80Mbps：</p>
<div class="arithmatex">\[\begin{align*}
\left( 10^4 \mathrm{\ clicks/sec} \right)
\times \left( 10^3 \mathrm{\ bytes} \right) \\
= 80 \mathrm{\ Mbps}
\end{align*}\]</div>
<p>對於 ClickMap，他需要存放以 <code>ad_id</code> 和 <code>search_term</code> 為鍵，
多筆 <code>time</code> 和 <code>query_id</code> 的集合為值的資料。
這樣一整天 ClickMap 中值（也就是 <code>time</code> 和 <code>query_id</code>）的大小就會是 14GB：</p>
<div class="arithmatex">\[\begin{align*}
\left( 10^4 \mathrm{\ clicks/sec} \right)
\times \left( 8.64 \times 10^4 \mathrm{\ seconds/day} \right)
\times \left( 8 \mathrm{\ bytes} + 8 \mathrm{\ bytes} \right) \\
= 14 \mathrm{\ GB/day}
\end{align*}\]</div>
<p>而鍵的大小則是根據廣告數和廣告關鍵字組合的數量決定，假設有 1 億個廣告和關鍵字的組合，
這樣也僅是使用約 800MB 的大小。
最後，我們大方的估計 ClickMap 每天需要 20GB 的儲存空間，這完全可以存放在一台設備的記憶體中。</p>
<p>最後我們來計算下 QueryMap 的大小，假設每個搜尋都會配上 3 個廣告，我們就會需要約 2TB 的大小：</p>
<div class="arithmatex">\[\begin{align*}
3 \times \left(5 \times 10^5 \mathrm{\ clicks/sec} \right)
\times \left( 8.64 \times 10^4 \mathrm{\ seconds/day} \right)
\times \left( 8 \mathrm{\ bytes} + 8 \mathrm{\ bytes} \right) \\
= 2 \mathrm{\ TB/day}
\end{align*}\]</div>
<p>問題：<em>有沒有更好的方法？</em></p>
<p>雖然可以用一台機器的磁碟來存放 2TB 的資料，但是前面我們也看到他容易受到 IOPS 的限制，
所以我們勢必需要設計一個可以進行<a href="../../designing-data-intensive-applications/distributed-partition/">分區</a>的資料叢集，接著我們就往下討論此架構。</p>
<h4 id="分區的-logjoiner">分區的 LogJoiner<a class="headerlink" href="#分區的-logjoiner" title="Permanent link">¶</a></h4>
<p>根據不同的 <code>ad_id</code>，我們可以把這些資料分配在不同的 QueryMap 和 ClickMap 節點中，藉此達到：</p>
<ul>
<li>擴展性：透過把計算和儲存分配到不同節點中，可以避免單一機器的 IO 瓶頸；</li>
<li>高可用：不只分區，也可以把資料<a href="../../designing-data-intensive-applications/distributed-replication/">複製</a>到多台節點，以達到高可用性；</li>
<li>效率性：當資料夠小時，就可以使用記憶體來儲存，加快整個流程。</li>
</ul>
<p>問題：<em>這個設計可能嗎？</em></p>
<p>相關做法就是對 <code>ad_id</code> 做雜湊得到一個數字後，根據該數字的位置分配給指定的節點，
例如假設有 N 個節點，把流量分配給雜湊結果模除（modulo）N 得到的數字。
當廣告商想要找特定廣告的點擊率時，就用一樣的方法去做搜尋。
同樣的做法也可以套用在 LogJoiner，只是會根據 <code>query_id</code> 進行分配。</p>
<p>問題：<em>這個架構允許降能嗎？</em></p>
<p>最後，為了達到高可用，我們可以使用<a href="../../designing-data-intensive-applications/distributed-replication/">複製</a>，
把請求同時分配給多個不同的 LogJoiner、QueryMap 或 ClickMap 節點，
以避免有特定節點失能時，該區段的資料都會丟失，導致輕易超過我們的錯誤預算。</p>
<p>最終的架構就會是：</p>
<pre class="mermaid"><code>---
title: 分區的 LogJoiner 架構
---
flowchart TD
  ql[Query Logs] --&gt; qls[Query Log Sharder&lt;br&gt;hash:ad_id % N] --&gt; qm2 &amp; qm1
  cl[Click Logs] --&gt; cls[Click Log Sharder&lt;br&gt;hash:query_id % M] --&gt; lj2 &amp; lj1
  subgraph qms [QueryMap Shards]
    qm1[(QueryMap Shard 1)]
    qm2[(QueryMap Shard N)]
  end
  subgraph ljs [LogJoiner Shards]
    lj1[(LogJoiner Shard 1)]
    lj2[(LogJoiner Shard M)]
  end
  subgraph cms [ClickMap Shards]
    cm1[(ClickMap Shard 1)]
    cm2[(ClickMap Shard K)]
  end
  ljs --&gt; cm2 &amp; cm1
  ql --&gt; qs[(QueryStore)]
  qs &lt;--&gt; ljs</code></pre>
<details class="question">
<summary>為什麼要用 query_id 做分區的鍵</summary>
<p>可以看到不同的日誌使用不同的鍵，點擊日誌使用 <code>query_id</code> 分區，而搜尋日誌使用 <code>ad_id</code>，
為什麼這樣選擇？</p>
<p>對於 QueryMap 來說，它會使用 <code>ad_id</code> 作為鍵，所以搜尋日誌透過 <code>ad_id</code> 來分區很合理。
但是對點擊日誌來說，它會需要使用 <code>query_id</code> 來和 QueryStore 拿取搜尋資訊，
透過 <code>query_id</code> 來分區可以和它後續動作匹配，最後再根據 <code>ad_id</code> 分發給不同的 ClickMap。
當然，請用數字說話，實作時可以根據相關數據來進行分析，怎麼樣做效率會更好。</p>
</details>
<h3 id="延伸架構去滿足-slo">延伸架構去滿足 SLO<a class="headerlink" href="#延伸架構去滿足-slo" title="Permanent link">¶</a></h3>
<p>如果我們要盡可能讓他高可用，單一叢集的多節點之外，我們也要做到多叢集。
換句話說，什麼樣的架構可以滿足多資料中心的高可用呢？</p>
<p>問題：<em>這個架構允許更高強度的降能嗎？</em></p>
<p>為了避免單一叢集的風險，我們需要在收到點擊或搜尋日誌時，同時送給其他叢集。
但是在分發的同時，要怎麼避免彼此狀態不同步，導致使用者得到的 CTR 會不一樣？
這個問題是經典的分散式容錯。</p>
<div class="admonition info">
<p class="admonition-title">分散式容錯</p>
<p>這裡不展開什麼是分散式容錯，或者說共識演算法，因為這個東西如果用兩三行來解釋，很容易造成誤會。
不過之前有寫過一些<a href="../../designing-data-intensive-applications/distributed-ft/">相關介紹</a>，歡迎指教。</p>
</div>
<p>根據評估，每次資料的同步需要約 25ms，這個時間會因為兩個資料中心的距離遠近而有所改變，
換句話說，單一連線每秒最多只能進行 40 次的同步。</p>
<p>為了滿足共識演算法的最低要求，我們需要把資料分派給另外兩個資料中心，達到總共三個節點的高可用性。
原本每秒 500K 個搜尋日誌會輸入，將會需要每秒 1M 的輸出請求，而點擊同樣如此（每秒共 1.02M 個日誌）。
最終，我們可以得到每次同步會需要處理 25.5K 個日誌，或者說，
我們同時要有 25.5K 個連線（或稱任務）來傳遞資料：</p>
<div class="arithmatex">\[\begin{align*}
\left(1.02 \times 10^6 \mathrm{\ logs/sec} \right)
/ \left( 40 \mathrm{\ operations/sec} \right) \\
= 2.55 \times 10^4 \mathrm{\ connections}
\end{align*}\]</div>
<p>因為要把 QueryMap 的資料傳給其他兩個資料中心，原本 2TB 的資料將會變成 4TB，
再加上 28GB 的點擊日誌，所以每個連線大約要承載 158MB 的資料：</p>
<div class="arithmatex">\[\begin{align*}
\left(4 \times 10^{12} \mathrm{\ bytes} \right)
/ \left( 2.55 \times 10^4 \mathrm{\ connections} \right) \\
≈ 158 \mathrm{\ MB/connection}
\end{align*}\]</div>
<p>假設一台設備的記憶體只有 64GB，換句話說，每台設備只能承載約 405 個連線：</p>
<div class="arithmatex">\[\begin{align*}
\left(6.4 \times 10^{10} \mathrm{\ bytes/machine} \right)
/ \left( 1.58 \times 10^8 \mathrm{\ bytes/connection} \right) \\
≈ 405 \mathrm{\ connection/machine}
\end{align*}\]</div>
<p>另外兩個資料中心總共就會需要 63 台設備，平均分配的話一個資料中心要有 32 台設備來處理這些量：</p>
<div class="arithmatex">\[\begin{align*}
\left(2.55 \times 10^4 \mathrm{\ connections} \right)
/ \left( 405 \mathrm{\ connection/machine} \right) \\
≈ 63 \mathrm{\ machine}
\end{align*}\]</div>
<p>現在，我們來算算每台設備的網路通量是多少。假設每個日誌佔用 2KB 的大小，
且每台設備只能處理 405 個連線，這樣每台設備的網路通量為 260Mbps：</p>
<div class="arithmatex">\[\begin{align*}
\left(1.02 \times 10^6 \mathrm{\ logs/sec} \right)
\times \left( 2 \times 10^3 \mathrm{\ bytes} \right)
\times \frac{405 \mathrm{\ connection/machine}}
  {2.55 \times 10^4 \mathrm{\ connections}} \\
≈ 260 \mathrm{\ Mbps}
\end{align*}\]</div>
<p>這樣的數量大約只佔用一台 1Gbps 通量的設備的四分之一，綽綽有餘。
最終，我們的架構就會成為：</p>
<pre class="mermaid"><code>---
title: 分資料中心的 LogJoiner 架構
---
flowchart TD
  ql[Query Logs] --&gt; ls[Log Sharder]
  ql --&gt; qs[(QueryStore)]
  cl[Click Logs] --&gt; ls
  ls --&gt; lj[LogJoiner]
  lj &lt;--&gt; qs
  ls --&gt; qm[(QueryMap)]
  lj --&gt; cm[(ClickMap)]
  subgraph dc1 [DataCenter-1]
    qm
    cm
    cnM[共識領袖]
  end
  subgraph dc2 [DataCenter-2]
    cnS[共識附隨]
    qm2[(QueryMap)]
    cm2[(ClickMap)]
  end
  cnM --&gt; dc2
  cnM --&gt; dc3[DataCenter-3]</code></pre>
<p>這樣的架構透過以下分析，我們認為可以滿足相關的 SLO：</p>
<ul>
<li>99.9% 的請求都要在 1 秒內完成，
  因為直接透過記憶體的鍵（<code>ad_id</code>）值（<code>click count</code> 和 <code>search count</code>）對去尋找相關紀錄；</li>
<li>99.9% 的 CTR 資訊都能顯示 5 分鐘內的資料，這個架構並不會失去準確性；</li>
<li>高可用性，因為每個組件都是獨立的，當發現某個瓶頸時，可以輕易做到水平擴充。</li>
</ul>
<h2 id="總結">總結<a class="headerlink" href="#總結" title="Permanent link">¶</a></h2>
<p>NALSD 是一個設計系統時反覆迭代的過程，首先把架構拆成對應的邏輯元件，並想像其置入線上環境的資源需求。
在這之中 SLO 的訂定變得尤為重要，因為 SLO 會驅動架構設計的進化，並在設計過程中不會迷航。</p>
<p>之所以說反覆迭代，就是在設計過程中每一次結束都要反覆問自己還能更好嗎？
讓設計者除了能依據 SLO 這個準繩之外，還能透過前一次的架構或前幾次的架構，最終產出更好的架構。</p>
<p>根據 Google 的經驗，<strong>把抽象的需求轉化成實際的資源</strong>，
例如 CPU、記憶體、Network throughput 等等，
對於架構最終的穩定性非常重要。</p>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="最後更新">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月9日</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="建立日期">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2023年8月22日</span>
</span>
</aside>
<script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDOFv6ffs4ClO-b" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-TW" data-loading="lazy" data-mapping="og:title" data-reactions-enabled="1" data-repo="evan361425/evan361425.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzODU3ODU3MjY=" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js">
</script>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到頂端
</button>
</main>
<footer class="md-footer">
<nav aria-label="頁腳" class="md-footer__inner md-grid">
<a aria-label="上一頁: 負載管理" class="md-footer__link md-footer__link--prev" href="../managing-load/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                上一頁
              </span>
<div class="md-ellipsis">
                負載管理
              </div>
</div>
</a>
<a aria-label="下一頁: 資料管線設計" class="md-footer__link md-footer__link--next" href="../data-pipelines/">
<div class="md-footer__title">
<span class="md-footer__direction">
                下一頁
              </span>
<div class="md-ellipsis">
                資料管線設計
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.top", "navigation.tabs", "navigation.indexes", "navigation.footer", "content.code.annotate", "content.code.copy", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
<script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
<script src="../../../javascripts/custom.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js"></script>
</body>
</html>