
<!DOCTYPE html>

<html class="no-js" lang="zh-TW">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="各種紀錄和心得" name="description"/>
<link href="https://evan361425.github.io/feedback/designing-data-intensive-applications/distributed-replication/" rel="canonical"/>
<link href="../foundation-ft/" rel="prev"/>
<link href="../distributed-partition/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.47" name="generator"/>
<meta content="COb7MqeOYLfRXXUOsXWaQvnr1_Xb33a0aP_Y8UC3U5Y" name="google-site-verification"/>
<meta content="分散式—複製" property="og:title"/>
<title>分散式—複製 - 心得與記錄</title>
<link href="../../../assets/stylesheets/main.6f8fc17f.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<style>
  /**
    * Center the table
    */
  .md-typeset__table {
    margin-left: auto;
    margin-right: auto;
    display: table;
  }

  /**
    * Center the image
    */
  figure img {
    margin-left: auto;
    margin-right: auto;
  }

  .md-typeset :is(.admonition, details) {
    font-size: .8rem;
  }

  /**
    * It will wider than mjx-math and cause screen broken.
    * This element is for screen-reader, see detailed in
    * https://docs.mathjax.org/en/latest/basic/accessibility.html#screen-reader-support
    */
  .MathJax mjx-assistive-mml {
    display: none !important;
  }

  /**
    * Keep zoomed-in image on the top of palette
    */
  .medium-zoom-image--opened {
    z-index: 10;
  }
</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=-apple-system,+BlinkMacSystemFont,+" rel="stylesheet" segoe+ui",+"helvetica+neue",+helvetica,+roboto,+arial,+"pingfang+tc",+"microsoft+jhenghei",+"微軟正黑",+sans-serif,+"apple+color+emoji",+"segoe+ui+emoji",+"segoe+ui+symbol":300,300i,400,400i,700,700i%7croboto+mono:400,400i,700,700i&display='fallback"'/>
<style>:root{--md-text-font:"-apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Helvetica, Roboto, Arial, "PingFang TC", "Microsoft JhengHei", "微軟正黑", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"";--md-code-font:"Roboto Mono"}</style>
<link href="../../../stylesheets/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-P67FD9XP83"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-P67FD9XP83",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-P67FD9XP83",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="light-blue" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#分散式資料庫複製">
          跳轉到
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="頁首" class="md-header__inner md-grid">
<a aria-label="心得與記錄" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="心得與記錄">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            心得與記錄
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              分散式—複製
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="黑夜降臨" class="md-option" data-md-color-accent="light-blue" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="黑夜降臨">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="白日昇起" class="md-option" data-md-color-accent="deep-orange" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="白日昇起">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜尋" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜尋" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="搜尋" class="md-search__options">
<button aria-label="清除" class="md-search__icon md-icon" tabindex="-1" title="清除" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/evan361425/evan361425.github.io" title="前往倉庫">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="標籤" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
    
  
  自我介紹

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
    
  
  心得

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../review/">
          
  
    
  
  年度回顧

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../essay/">
          
  
    
  
  隨筆

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="導覽列" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="心得與記錄" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="心得與記錄">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    心得與記錄
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/evan361425/evan361425.github.io" title="前往倉庫">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    自我介紹
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    心得
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            心得
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Designing Data-intensive Applications
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            Designing Data-intensive Applications
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../foundation-model/">
<span class="md-ellipsis">
    基礎—模型和語法
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../foundation-index/">
<span class="md-ellipsis">
    基礎—索引
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../foundation-dw/">
<span class="md-ellipsis">
    基礎—資料倉儲
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../foundation-encode/">
<span class="md-ellipsis">
    基礎—編碼和進程
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../foundation-ft/">
<span class="md-ellipsis">
    基礎—容錯
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    分散式—複製
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    分散式—複製
  </span>
</a>
<nav aria-label="目錄" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目錄
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#為什麼">
<span class="md-ellipsis">
      為什麼
    </span>
</a>
<nav aria-label="為什麼" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#單台機器">
<span class="md-ellipsis">
      單台機器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#無共享架構">
<span class="md-ellipsis">
      無共享架構
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#分散式資料庫">
<span class="md-ellipsis">
      分散式資料庫
    </span>
</a>
<nav aria-label="分散式資料庫" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#概略圖">
<span class="md-ellipsis">
      概略圖
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#怎麼複製">
<span class="md-ellipsis">
      怎麼複製？
    </span>
</a>
<nav aria-label="怎麼複製？" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#三種方式的比較">
<span class="md-ellipsis">
      三種方式的比較
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#單一領袖">
<span class="md-ellipsis">
      單一領袖
    </span>
</a>
<nav aria-label="單一領袖" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#趕工">
<span class="md-ellipsis">
      趕工
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#同異步">
<span class="md-ellipsis">
      同異步
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#複製日誌">
<span class="md-ellipsis">
      複製日誌
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#適合單一資料中心">
<span class="md-ellipsis">
      適合單一資料中心
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#多領袖">
<span class="md-ellipsis">
      多領袖
    </span>
</a>
<nav aria-label="多領袖" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#多領袖的好處">
<span class="md-ellipsis">
      多領袖的好處
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#多領袖的壞處">
<span class="md-ellipsis">
      多領袖的壞處
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#多領袖其實很常發生">
<span class="md-ellipsis">
      多領袖其實很常發生
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#拓撲">
<span class="md-ellipsis">
      拓撲
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#處理衝突">
<span class="md-ellipsis">
      處理衝突
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#梳理因果">
<span class="md-ellipsis">
      梳理因果
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#無領袖">
<span class="md-ellipsis">
      無領袖
    </span>
</a>
<nav aria-label="無領袖" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#需要全部送成功嗎">
<span class="md-ellipsis">
      需要全部送成功嗎？
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#維持資料庫的一致性">
<span class="md-ellipsis">
      維持資料庫的一致性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#無領袖的優缺點">
<span class="md-ellipsis">
      無領袖的優缺點
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#其他">
<span class="md-ellipsis">
      其他
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#總結">
<span class="md-ellipsis">
      總結
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../distributed-partition/">
<span class="md-ellipsis">
    分散式—分區
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../distributed-env/">
<span class="md-ellipsis">
    分散式—環境
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../distributed-ft/">
<span class="md-ellipsis">
    分散式—容錯
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../derived-batch/">
<span class="md-ellipsis">
    衍生—批次處理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../derived-stream/">
<span class="md-ellipsis">
    衍生—串流處理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../farewell/">
<span class="md-ellipsis">
    總結和整合
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../glossary/">
<span class="md-ellipsis">
    詞彙表
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/">
<span class="md-ellipsis">
    Distributed Systems with Node.js
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Distributed Systems with Node.js
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/protocol/">
<span class="md-ellipsis">
    協定
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/sla-and-load-testing/">
<span class="md-ellipsis">
    SLA 和負載測試
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/observability/">
<span class="md-ellipsis">
    可觀測性
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/container/">
<span class="md-ellipsis">
    容器化
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../distributed-systems-with-node.js/container-orchestration-and-misc/">
<span class="md-ellipsis">
    容器調度工具和其他
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../future-of-fusion-energy/">
<span class="md-ellipsis">
    （WIP）Future Of Fusion Energy
  </span>
</a>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            （WIP）Future Of Fusion Energy
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../future-of-fusion-energy/energy/">
<span class="md-ellipsis">
    能源
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../future-of-fusion-energy/fusion/">
<span class="md-ellipsis">
    核融合
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../site-reliability-workbook/">
<span class="md-ellipsis">
    （WIP）SRE Workbook
  </span>
</a>
<label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
            （WIP）SRE Workbook
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/toil/">
<span class="md-ellipsis">
    勞動力
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/simplicity/">
<span class="md-ellipsis">
    簡化系統
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/on-call/">
<span class="md-ellipsis">
    待命小組
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/incident-response/">
<span class="md-ellipsis">
    災難管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/postmortem-culture/">
<span class="md-ellipsis">
    事後析誤文化
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/managing-load/">
<span class="md-ellipsis">
    負載管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/nalsd/">
<span class="md-ellipsis">
    非抽象大型系統設計
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/data-pipelines/">
<span class="md-ellipsis">
    資料管線設計
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/configuration-best-practice/">
<span class="md-ellipsis">
    設定檔的最佳實踐
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../site-reliability-workbook/canary-release/">
<span class="md-ellipsis">
    金絲雀部署
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-it/">
<span class="md-ellipsis">
    Release It!
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adaptive-concurrency/">
<span class="md-ellipsis">
    Adaptive Concurrency
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../physics/">
<span class="md-ellipsis">
    Physics
  </span>
</a>
<label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
            Physics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../physics/astronomy/">
<span class="md-ellipsis">
    天文學
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../physics/special-relativity/">
<span class="md-ellipsis">
    （WIP）狹義相對論
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../review/">
<span class="md-ellipsis">
    年度回顧
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            年度回顧
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../review/2022-ai/">
<span class="md-ellipsis">
    2022 AI 回顧
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../review/2023/">
<span class="md-ellipsis">
    2023 回顧
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../essay/">
<span class="md-ellipsis">
    隨筆
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            隨筆
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-ellipsis">
    系統架構類
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            系統架構類
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/made-container/">
<span class="md-ellipsis">
    如何製作 Docker Container
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/pki-checklist/">
<span class="md-ellipsis">
    建置 PKI 注意事項
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/replace-docker-desktop/">
<span class="md-ellipsis">
    取代 Docker Desktop
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/tomcat-max-packet-size/">
<span class="md-ellipsis">
    Tomcat 的 max_packet_size
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/architecture/tcp-socket-loss-after-dhcp/">
<span class="md-ellipsis">
    TCP socket 連線被清除的錯誤排查
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
<span class="md-ellipsis">
    程式語言類
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            程式語言類
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/code/node.js-best-practice/">
<span class="md-ellipsis">
    Node.js 最佳實作
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/code/node.js-error/">
<span class="md-ellipsis">
    Node.js 的錯誤有哪些
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/code/object-oriented-terms/">
<span class="md-ellipsis">
    物件導向名詞
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/code/handle-legacy-system/">
<span class="md-ellipsis">
    處理舊有系統
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
<span class="md-ellipsis">
    網路相關
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            網路相關
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/network-routing/">
<span class="md-ellipsis">
    網路怎麼傳
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/network-details/">
<span class="md-ellipsis">
    網路傳了什麼
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/network-books/">
<span class="md-ellipsis">
    網路推薦書籍
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/tcp/">
<span class="md-ellipsis">
    TCP
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/ntp/">
<span class="md-ellipsis">
    NTP
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/http/">
<span class="md-ellipsis">
    HTTP
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/retry-strategy/">
<span class="md-ellipsis">
    Retry 的策略
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/certificate-transparency/">
<span class="md-ellipsis">
    Certificate Transparency
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/url-structure/">
<span class="md-ellipsis">
    URL 長什麼樣子
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web/maglev/">
<span class="md-ellipsis">
    Maglev
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
<span class="md-ellipsis">
    網路安全
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
            網路安全
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/cross-origin-resources-sharing/">
<span class="md-ellipsis">
    CORS
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/mixed-content/">
<span class="md-ellipsis">
    Mixed Content
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/owasp-api-top10/">
<span class="md-ellipsis">
    OWASP API Top 10
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/owasp-authentication-best-practice/">
<span class="md-ellipsis">
    OWASP 驗證機制最佳指南
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/web-security/owasp-mobile-risk-top10/">
<span class="md-ellipsis">
    OWASP 行動裝置風險
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
<span class="md-ellipsis">
    其他
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            其他
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/gpl-check/">
<span class="md-ellipsis">
    GPL 的檢查
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/nginx-changelog/">
<span class="md-ellipsis">
    Nginx 1.18 到 1.22 的差異
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/node-changelog-14-18/">
<span class="md-ellipsis">
    Node.js 14 到 18 的差異
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/questionnaire-principal/">
<span class="md-ellipsis">
    問卷設計指南
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/devex-in-action/">
<span class="md-ellipsis">
    開發體驗的改進
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/interview-questions/">
<span class="md-ellipsis">
    面試時的殺手級問題
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/pls-sem/">
<span class="md-ellipsis">
    PLS-SEM
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../essay/confidential-computing/">
<span class="md-ellipsis">
    機密運算
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目錄" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目錄
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#為什麼">
<span class="md-ellipsis">
      為什麼
    </span>
</a>
<nav aria-label="為什麼" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#單台機器">
<span class="md-ellipsis">
      單台機器
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#無共享架構">
<span class="md-ellipsis">
      無共享架構
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#分散式資料庫">
<span class="md-ellipsis">
      分散式資料庫
    </span>
</a>
<nav aria-label="分散式資料庫" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#概略圖">
<span class="md-ellipsis">
      概略圖
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#怎麼複製">
<span class="md-ellipsis">
      怎麼複製？
    </span>
</a>
<nav aria-label="怎麼複製？" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#三種方式的比較">
<span class="md-ellipsis">
      三種方式的比較
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#單一領袖">
<span class="md-ellipsis">
      單一領袖
    </span>
</a>
<nav aria-label="單一領袖" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#趕工">
<span class="md-ellipsis">
      趕工
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#同異步">
<span class="md-ellipsis">
      同異步
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#複製日誌">
<span class="md-ellipsis">
      複製日誌
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#適合單一資料中心">
<span class="md-ellipsis">
      適合單一資料中心
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#多領袖">
<span class="md-ellipsis">
      多領袖
    </span>
</a>
<nav aria-label="多領袖" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#多領袖的好處">
<span class="md-ellipsis">
      多領袖的好處
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#多領袖的壞處">
<span class="md-ellipsis">
      多領袖的壞處
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#多領袖其實很常發生">
<span class="md-ellipsis">
      多領袖其實很常發生
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#拓撲">
<span class="md-ellipsis">
      拓撲
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#處理衝突">
<span class="md-ellipsis">
      處理衝突
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#梳理因果">
<span class="md-ellipsis">
      梳理因果
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#無領袖">
<span class="md-ellipsis">
      無領袖
    </span>
</a>
<nav aria-label="無領袖" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#需要全部送成功嗎">
<span class="md-ellipsis">
      需要全部送成功嗎？
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#維持資料庫的一致性">
<span class="md-ellipsis">
      維持資料庫的一致性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#無領袖的優缺點">
<span class="md-ellipsis">
      無領袖的優缺點
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#其他">
<span class="md-ellipsis">
      其他
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#總結">
<span class="md-ellipsis">
      總結
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/evan361425/evan361425.github.io/blob/master/src/feedback/designing-data-intensive-applications/distributed-replication.md" title="編輯此頁">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5m-7.86-1.75L8.85 19l.29-.74C10.43 15.06 13.5 13 17 13c1.05 0 2.06.21 3 .56V8l-6-6H6c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h4.5c-.55-.66-1-1.42-1.36-2.25M13 3.5 18.5 9H13z"></path></svg>
</a>
<h1 id="分散式資料庫複製">分散式資料庫—<abbr title="replication； 在幾個節點（或稱 replica）上保留相同資料的副本，以便在某些節點無法訪問時，資料仍可訪問。">複製</abbr><a class="headerlink" href="#分散式資料庫複製" title="Permanent link">¶</a></h1>
<p>為了讓資料庫備份、高可用性、低潛時。</p>
<p><a href="https://hackmd.io/@Lu-Shueh-Chou/rkr4mum0t">HackMD 報告</a></p>
<h2 id="為什麼">為什麼<a class="headerlink" href="#為什麼" title="Permanent link">¶</a></h2>
<p>為什麼要讓資料庫進行複製？主要是三個原因：</p>
<ul>
<li>擴增性。單台機器能執行的運算有限，讓資料庫進行複製代表可以用兩台機器的運算能力取代一台兩倍運算能力的機器，進而降低成本（其成本的成長曲線分別是線性和曲線）。</li>
<li>高可用性。當機器壞了，服務仍能運行，除此之外有時為了維運（軟體升版）必須要先停止一台機器的服務，等他完成維運再讓他繼續對外服務。</li>
<li>低潛時。分散機器於世界各地，讓不同地方的使用者可以就近使用服務，降低潛時。</li>
</ul>
<h3 id="單台機器">單台機器<a class="headerlink" href="#單台機器" title="Permanent link">¶</a></h3>
<p>單台機器其實在其成長過程也是有一樣的問題。</p>
<ul>
<li>擴增性：隨著一台機器的原始設備沒辦法滿足運算時，我們可以增加他的 CPU/Memory/Disk。</li>
<li>容錯性：當部分 CPU 壞了，一些高階電腦甚至允許不關機的情況下置換設備。</li>
<li>低潛時：共享磁碟（shared-disk）的架構，雖然單台機器不能分散各地，但是可以在有限區域內透過一些機制<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup><sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>達到多個機器共享同一個儲存空間。</li>
</ul>
<h3 id="無共享架構">無共享架構<a class="headerlink" href="#無共享架構" title="Permanent link">¶</a></h3>
<p>這次談的資料庫間的複製都是建立在無共享架構之上，也就是兩台機器是彼此獨立的：一台機器被燒得精光之後，另一台機器仍能正常運行。</p>
<p>但是他們仍然共享某種協定，例如溝通方式都是透過網際網路或者都是在同一個機房使用同一個電力來源。</p>
<p>會採用無共享架構的原因就是因為幾乎沒有限制的擴增性和其帶來的成本僅僅只是線性成長而已。</p>
<h2 id="分散式資料庫">分散式資料庫<a class="headerlink" href="#分散式資料庫" title="Permanent link">¶</a></h2>
<p>分散式資料庫，就是多台資料庫進行對資料的處理。</p>
<p>要讓多台資料庫合作完成應用程式的指令，就需要共同遵守某一個處理機制。這機制可能是</p>
<ul>
<li>有一個 <em>協調者</em> 在幫忙</li>
<li>資料庫裡面有一個領袖決定資料怎麼存</li>
<li>資料庫各自為政，再共同決定</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>因為資料是持續變動的 (<abbr title="Online Transaction Processing； 線上異動處理。其模式為快速查詢，讀取或寫入少量或特定的資料，這些資料通常透過鍵索引。">OLTP</abbr>)，所以難。</p>
</div>
<p>其中在做分散式資料庫的時候，主要會需要處理兩個東西：</p>
<ul>
<li><abbr title="replication； 在幾個節點（或稱 replica）上保留相同資料的副本，以便在某些節點無法訪問時，資料仍可訪問。">複製</abbr>：資料庫間的資料同步</li>
<li><abbr title="partitioning, sharding； 將單機上的大型資料集或計算結果拆分為較小部分，並將其分佈到多臺機器上。">分區</abbr>：把資料分裝</li>
</ul>
<p>複製需要做同步，而其中的取捨就好像前面在<a href="../foundation-ft/">討論競賽問題</a>時資料一致性的取捨，要求越高的同步率就會面臨較低的效能。然而待會我們可以看到，透過協調者，在資料滿足特定條件下，可以做到兩全其美？</p>
<p>分區會把資料放在不同的資料庫，例如：<em>使用者 1-50</em> 放在 <em>資料庫 1</em>，<em>使用者 51-100</em> 放在 <em>資料庫 2</em>。其注重的是如何做到索引、資料量的平衡和彼此間的協作。</p>
<p>這裡要注意的是兩者所使用的演算法是可以獨立區分的。一般來說任一複製的演算法可以搭配任一分區的演算法。</p>
<h3 id="概略圖">概略圖<a class="headerlink" href="#概略圖" title="Permanent link">¶</a></h3>
<p><figure><img alt="分散式資料庫長什麼樣子" src="https://github.com/Vonng/ddia/raw/master/img/fig6-1.png"/><figcaption>分散式資料庫長什麼樣子</figcaption></figure></p>
<p>複製和分區通常是同時存在的，所以我們會同時利用複製和分區，達成分散式資料庫。他們兩個方式分別要處理的東西都不太一樣：</p>
<ul>
<li><abbr title="replication； 在幾個節點（或稱 replica）上保留相同資料的副本，以便在某些節點無法訪問時，資料仍可訪問。">複製</abbr>：高可用性、備份</li>
<li><abbr title="partitioning, sharding； 將單機上的大型資料集或計算結果拆分為較小部分，並將其分佈到多臺機器上。">分區</abbr>：一台機器不夠裝</li>
</ul>
<p>不過我們這次會先介紹複製，之後再介紹分區。所以以下的討論都是假設現有的資料量可以用一台機器來容納。</p>
<h2 id="怎麼複製">怎麼複製？<a class="headerlink" href="#怎麼複製" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th>中文</th>
<th>統一</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>單一領袖</td>
<td>leader/follower</td>
<td>master/slave(standby), active/passive, primary/secondary</td>
</tr>
<tr>
<td>多領袖</td>
<td>multi-leader</td>
<td>master/master, active/active</td>
</tr>
<tr>
<td>無領袖</td>
<td>leaderless</td>
<td>dynamo-style</td>
</tr>
</tbody>
</table>
<p>三種方法對應前面提的：領袖、各自為政、協調者。以下都會統一說法為單一領袖、多領袖、無領袖。</p>
<h3 id="三種方式的比較">三種方式的比較<a class="headerlink" href="#三種方式的比較" title="Permanent link">¶</a></h3>
<p><figure><img alt="單一領袖、多領袖、無領袖的比較" src="https://i.imgur.com/VVxjA7L.png"/><figcaption>單一領袖、多領袖、無領袖的比較</figcaption></figure></p>
<p>這三種方式都有其帶來的缺點和優點，接下來我們就是要來談談各自需要考慮的權衡。</p>
<p>然而，不論任何一種複製方式都要面對趕工和同步延遲。</p>
<p>趕工（<em>catch up</em>）就是當資料庫停止運作時（用來維修或意外的壞掉），如何讓資料跟上（不管是從舊的狀態或者從完全空白的狀態）最新的狀態。其作法：</p>
<ul>
<li>有領袖的方式就是透過傳播複製日誌</li>
<li>無領袖的方式就是定期整併</li>
</ul>
<p>至於延遲，我們會統一在下一章的分區討論。</p>
<blockquote>
<p>雖然無領袖沒有把同異步放進去，但實際上，他也是需要被考慮的，只是大部分資料庫實作都是同時存在，異於有領袖時的複製大部分都是純異步。</p>
</blockquote>
<h2 id="單一領袖">單一領袖<a class="headerlink" href="#單一領袖" title="Permanent link">¶</a></h2>
<p><figure><img alt="單一領袖的運作邏輯" src="https://github.com/Vonng/ddia/raw/master/img/fig5-1.png"/><figcaption>單一領袖的運作邏輯</figcaption></figure></p>
<p>單一領袖就是一台資料庫（leader）負責寫入資料，剩下的資料庫（follower）負責同步資料並提供使用者讀取資料。</p>
<p>上圖中的 Replication streams 即是在領袖得到資料後，把相關資訊傳遞給追隨者，
至於「相關資訊」是什麼，<a href="#複製日誌">後面會提</a>。</p>
<p><figure><img alt="單一領袖的討論" src="https://i.imgur.com/0nlQzUG.png"/><figcaption>單一領袖的討論</figcaption></figure></p>
<p>接下來我們就來看看單一領袖有哪些權衡。</p>
<p>順序會是：</p>
<ul>
<li>如何處理趕工問題</li>
<li>趕工造成的複權（split brain）</li>
<li>再看看單一領袖和多領袖共通的<ul>
<li><em>同異步</em> 問題</li>
<li>如何複製日誌</li>
</ul>
</li>
<li>最後討論一下為什麼不好擴增和為什麼擁有高一致性</li>
</ul>
<h3 id="趕工">趕工<a class="headerlink" href="#趕工" title="Permanent link">¶</a></h3>
<p>前面提的趕工問題，這邊討論三種狀況。分別是</p>
<ul>
<li>當有新的資料庫要進來一起分擔工作時</li>
<li>有一台資料庫暫時壞掉，需要從舊的狀態趕工至最新狀態<ul>
<li>若該資料庫是追隨者時</li>
<li>若該資料庫是領袖時</li>
</ul>
</li>
</ul>
<h4 id="新的追隨者">新的追隨者<a class="headerlink" href="#新的追隨者" title="Permanent link">¶</a></h4>
<p>基本上不管哪種複製方式（單一領袖、多領袖、無領袖）都是這樣的順序。若有領袖則把領袖的資料複製到追隨者身上，反之則挑一個最新的資料庫複製。</p>
<p>由於資料是一直持續的（<abbr title="Online Transaction Processing； 線上異動處理。其模式為快速查詢，讀取或寫入少量或特定的資料，這些資料通常透過鍵索引。">OLTP</abbr>），當複製過去後，需要有機制讓他把最新資料補上。</p>
<p>機制大致如下：</p>
<ul>
<li>建立、使用快照。大部分資料庫都內建建立快照功能，有些需要外部套件，例如 MySQL 的 <a href="https://www.percona.com/doc/percona-xtrabackup/2.1/index.html">innobackupex</a></li>
<li>補上最新資料。補上最新資料前，需要知道快照在整個歷程中的位置（PostgreSQL 的 <em>log sequence</em> 和 MySQL 的 <em>binlog coordinates</em>），並從這之後使用我們後面會提的_複製日誌_來補齊。</li>
<li>晉升追隨者。準備晉升前的狀態我們稱其為 <em>catch-up</em></li>
</ul>
<h4 id="追隨者重啟">追隨者重啟<a class="headerlink" href="#追隨者重啟" title="Permanent link">¶</a></h4>
<p>和前面的很像，就是執行後面兩動：補上最新資料、晉升追隨者。</p>
<h4 id="領袖重啟">領袖重啟<a class="headerlink" href="#領袖重啟" title="Permanent link">¶</a></h4>
<p>當領袖失能時，我們需要執行 <em><abbr title="failover； 在具有單一領導者的系統中，故障切換是將領導角色從一個節點轉移到另一個節點的過程。">故障切換</abbr></em>（failover）的動作。其順序如下：</p>
<ul>
<li>定期探測其是否存活，若時間內沒回應，就判定其失能。</li>
<li>透過選舉，或者直接使用前次選舉所得出來的副領袖。不過通常都是選擇擁有最新資料的追隨者。這一類的選舉，若沒寫好就會出現複權問題，因此通常需要讓 <em><abbr title="node； 一個執行中的程序的單位，透過網路與其他節點通訊以完成某項任務。">節點</abbr></em> 有「<em><abbr title="consensus； 分散式系統的一個基本問題：該怎麼讓幾個節點同意某些結果（例如，哪個節點應該是資料庫叢集的領導者）。問題比乍看起來要困難得多。">共識</abbr></em>」，之後會提。</li>
<li>讓大家都知道誰是新的領袖（包括舊領袖重啟後也要通知他）。</li>
</ul>
<h4 id="領袖失能造成的問題">領袖失能造成的問題<a class="headerlink" href="#領袖失能造成的問題" title="Permanent link">¶</a></h4>
<ul>
<li>尚未同步的資料如果完全捨棄，會造成下面的問題。</li>
<li>多個領袖稱為複權（split-brain）狀況，這時若沒遇到一些邊際狀況你很可能會同時關閉兩個領袖，導致資料庫提供的服務完全中斷。所以即使有些資料庫叢集提供自動重啟領袖的機制，很多維運人員仍然採用<a href="https://kb.synology.com/zh-tw/DSM/help/HighAvailability/split_brain?version=6">手動調整</a>的方式。後面提的共識問題就會詳細討論什麼邊際情況會造成錯誤判定。</li>
<li>太小的時間區間可能會因為網路延遲導致輕易的重啟領袖，增加機器的負擔。</li>
</ul>
<p>以下是 <a href="https://github.com/blog/1261-github-availability-this-week">GitHub 遇到領袖重啟後，捨棄尚未同步的資料所造成的狀況</a></p>
<p><figure><img alt="領袖失能時所遺失的資料可能導致永久性的狀態錯誤" src="https://i.imgur.com/z6gUixm.png"/><figcaption>領袖失能時所遺失的資料可能導致永久性的狀態錯誤</figcaption></figure></p>
<p>其主要原因是因為主鍵有遞增的模式，但是資料庫重啟後，其遞增後的資料遺失了，導致資料不同步。</p>
<h3 id="同異步">同異步<a class="headerlink" href="#同異步" title="Permanent link">¶</a></h3>
<p>同異步是需要做權衡的。</p>
<p><figure><img alt="半同步的單一領袖資料庫叢集" src="https://github.com/Vonng/ddia/raw/master/img/fig5-2.png"/><figcaption>半同步的單一領袖資料庫叢集</figcaption></figure></p>
<p>完全的同步會讓潛時變得很不穩，同時單台資料庫若壞掉了，就會導致全部資料無法寫入，這就違背了當初建立多台資料庫以提升可用性的原則。</p>
<p>完全的異步又會讓資料的一致性變得很不穩，這也會破壞我們上一次討論的單台資料庫辛苦建立的一致性，讓前面提到的競賽狀況都可能發生。</p>
<p>有些資料庫的做法是取其平衡使用半同步（semi-synchronous），如圖上所示。不過大部分單一領袖的資料叢集都採用完全的異步，以追求高可用性。</p>
<hr/>
<h3 id="複製日誌">複製日誌<a class="headerlink" href="#複製日誌" title="Permanent link">¶</a></h3>
<p><figure><img alt="複製日誌的類型比較" src="https://i.imgur.com/lsRgEzw.png"/><figcaption>複製日誌的類型比較</figcaption></figure></p>
<p>前面提了很多領袖把資料轉到追隨者時會遇到的問題和權衡。但是都沒提他怎麼把資料轉到追隨者的。基本上有三種：</p>
<ul>
<li>透過輸入的語法（SQL、MapReduce 等等）直接複製到其他資料庫。好處是這種方式通常很簡單實作而且傳遞的資料通常很小。5.1 版前的 MySQL 和特定情況下的 VoltDB 都會使用這方式。其帶來的問題：<ul>
<li>非常數的資料的傳遞，例如 <code>NOW()</code>、<code>RAND()</code>、<code>AUTO_INCR()</code> 等等。</li>
<li>若資料是有限制條件的，例如 <code>WHERE &lt;some condition&gt;</code>，則會要求所有資料庫狀態都是一致的，否則很容易因為狀態不一致導致執行結果不一樣。</li>
<li>資料庫在更新資料時會有很多其他被影響的資料，例如觸發器（trigger）、<abbr title="stored procedure； 一種把交易邏輯進行編碼後放進資料庫中，它可以完全在資料庫上執行，交易執行期間無需與客戶端通訊。">貯存程序</abbr>（stored procedure）、參考鍵（reference key）。導致執行結果可能一樣但是資料庫的整體狀態卻不一致</li>
</ul>
</li>
<li>第二種方式是直接使用 WAL。前面在討論<a href="../foundation-index/"><abbr title="index； 一種資料結構。透過索引，你可以根據特定欄位的值，在所有資料記錄中進行高效檢索。">索引</abbr></a>的時候有提到兩種儲存方式：日誌結構和頁導向。日誌結構本來就有在維持日誌並持續在背景執行整合壓縮，頁導向則是利用 WAL 保證資料不會被遺失。我們就可以透過這些日誌的資料進行傳遞。PostgreSQL 和 Oracle 等多個資料庫都使用這方式。不過會有些問題：<ul>
<li>通常日誌的資料都很細，甚至細到哪個磁碟的哪個 byte 會塞哪些資料。這導致複製日誌的資料不能在不同版本的資料格式間使用，進而增加維運的困難度。</li>
</ul>
</li>
<li>邏輯日誌介於上述兩種方式的中間，不會像語法那樣抽象，但又不會細到像 WAL 那樣。例如語法是 <code>UPDATE users SET age = age + 10 WHERE age &lt; 10</code> 則可能傳遞更新的使用者 ID 和其更新後的資料。使用這方式的有 MySQL 的 binlog。除此之外，他也方便透過 <abbr title="Extract-Transform-Load； 萃取、變換及載入，從源資料庫中提取資料，將其轉換為更適合分析查詢的形式，並將其載入到資料倉儲或批次處理系統中的過程。">ETL</abbr> 等方式製作其他 <em><abbr title="derived data； 一種資料，透過可重複執行的運算把原始資料專成衍生資料。必要時，你可以執行該運算並再次建立衍生資料。衍生資料通常用於提高特定資料的讀取速度。常見的衍生資料有索引、快取和物化視圖。">衍生資料</abbr></em> 。</li>
<li>額外補充一種，有可能在傳遞資料時會希望有個中介器幫助我們加上一些客制的商務邏輯修正，例如加密、特定資料的修正和處理衝突等等。這時可以使用 Oracle 的 <a href="http://www.oracle.com/us/products/middleware/data-integration/oracle-goldengate-realtime-access-2031152.pdf">GoldenGate</a>。你也可以透過觸發器和貯存程序把資料匯進其他表格（table）中來達成一樣的事情。例如 Oracle 的 <a href="http://www.socc2012.org/s18-das.pdf">Databus</a> 和 Postgres 的 <a href="http://blog.endpoint.com/2014/06/bucardo-5-multimaster-postgres-released.html">Bucardo</a>。這些方法雖然可以增加很多彈性，但是因為涉及到應用程式邏輯和資料庫邏輯間的轉換所以通常容易有錯而且會增加資料庫的負擔。</li>
</ul>
<h3 id="適合單一資料中心">適合單一資料中心<a class="headerlink" href="#適合單一資料中心" title="Permanent link">¶</a></h3>
<p>因為單一資料中心（data center）資料庫彼此之間不會相距太遠，所以適合這種方式。但是如果有任一台在相距遙遠的地方，則會讓這個資料庫叢集的同步性變得很不穩定。</p>
<p>由於資料都是從領袖寫入，所以前面提的單一資料庫下的交易機制可以運行的很順利。但是仍有資料叢集內的多資料庫一致性問題。</p>
<h2 id="多領袖">多領袖<a class="headerlink" href="#多領袖" title="Permanent link">¶</a></h2>
<p><figure><img alt="多領袖的運作模式" src="https://github.com/Vonng/ddia/raw/master/img/fig5-6.png"/><figcaption>多領袖的運作模式</figcaption></figure></p>
<p>如果單一領袖失能，會有一段時間不能運行，直覺上就是讓領袖變成多個。但是實際上，很少資料庫採用這方式，因為他會帶來很多衝突和錯誤。</p>
<p>如果你的環境只有一個資料中心，那可能就不需要這麼複雜的機制，相對而言當有多個資料中心時，我們就可以用這方式，但是請小心使用。</p>
<p>有些資料庫預設支援多領袖的叢集，有些需要外部工具支援，例如 MySQL 的 <a href="https://github.com/holys/tungsten-replicator">Tungsten Replicator</a>、PostgreSQL 的 <a href="http://bdr-project.org/docs/next/index.html">BDR</a>、Oracle 的 <a href="http://www.oracle.com/us/products/middleware/data-integration/oracle-goldengate-realtime-access-2031152.pdf">GoldenGate</a></p>
<p><figure><img alt="多領袖的注意事項" src="https://i.imgur.com/ALvwAr3.png"/><figcaption>多領袖的注意事項</figcaption></figure></p>
<p>前面已經討論完有領袖時需要注意的_複製日誌_和_同異步_。接下來會著重在多領袖需要注意的處理衝突和梳理因果。</p>
<p>順序會是：</p>
<ul>
<li>了解多領袖帶來哪些好、壞處。</li>
<li>多領袖的狀況其實滿常見的？</li>
<li>介紹不同拓撲（topology）下的情況。</li>
<li>因為同時有多個資料庫在寫入，如何處理衝突？</li>
<li>如何梳理因果關係。</li>
</ul>
<h3 id="多領袖的好處">多領袖的好處<a class="headerlink" href="#多領袖的好處" title="Permanent link">¶</a></h3>
<p>在效能上，不只是寫入的資料庫變多，可以分擔，更重要的是可以放置在多個資料中心，這時就可以根據使用者把請求送到比較近的資料中心。</p>
<p>在容錯上，因為放在多台資料中心，任一個資料中心的基礎設施損害並不會造成全面性的停擺。也可以避免單一領袖因為領袖失能導致服務終止的狀況，因為其他領袖會幫忙分擔請求，並等待失能領袖被替換。</p>
<h3 id="多領袖的壞處">多領袖的壞處<a class="headerlink" href="#多領袖的壞處" title="Permanent link">¶</a></h3>
<p>他會破壞很多資料庫原有的功能，例如，自動增加的 ID、資料限制（constraints）等等。除此之外，當多台資料庫同時寫入時勢必就需要處理兩個寫入的衝突。就像前面提的，有時候衝突不那麼明顯，例如訂票問題。</p>
<h3 id="多領袖其實很常發生">多領袖其實很常發生<a class="headerlink" href="#多領袖其實很常發生" title="Permanent link">¶</a></h3>
<p>例如手機中的日曆應用程式，你的手機即使沒有網路，仍要可以紀錄行程於日曆中，並且在重新上線之後，和資料庫的資料整合再一起。但是整合的資料可能會因為你同一時間又在其他裝置（例如筆電）更新資料導致有衝突。</p>
<p>這情況就好像多領袖的資料叢集，這時同步的延遲可能就不是好幾秒而是好幾天。<a href="https://docs.couchdb.org/en/stable/replication/conflicts.html#replication-conflicts">CouchDB</a> 就是專門設計處理這種狀況的資料庫。</p>
<p>第二種狀況就是編輯線上文件，例如 Google Doc/HackMD。直得注意的是，當我們在編輯時，通常該線上文件會標示哪個人正在哪個地方編輯，這麼做其實就能大大降低同時編輯相同地方造成的衝突。</p>
<h3 id="拓撲">拓撲<a class="headerlink" href="#拓撲" title="Permanent link">¶</a></h3>
<p><figure><img alt="多領袖會有很多種拓撲" src="https://github.com/Vonng/ddia/raw/master/img/fig5-8.png"/><figcaption>多領袖會有很多種拓撲</figcaption></figure></p>
<p>當領袖超過兩個的時候，彼此間溝通的路徑就會有很多種，上面提的是常見的三種。</p>
<p>MySQL 預設僅支援環狀拓撲，而環狀拓撲和星狀（或稱樹狀）拓撲會賦予每個節點一個 ID，並在複製過程中，在複製日誌中加上各自的 ID，用來代表他已經跑過這個資料。避免該資料一直被丟進複製的輪迴中。</p>
<p>不過環狀拓撲和星狀拓撲都會有個缺點就是當其中一個拓撲斷線了，很可能會導致複製的連結中斷，然後大家必須等他復原。</p>
<p>最常見的是第三種，all-to-all。不過他容易會需要梳理因果，我們待會再來看這問題。</p>
<p>不過重點是前面提的問題都是可以被處理的，但是身為應用程式開發人員，我們需要在該資料庫文件中查找相關說明，然後明確知道沒有這些處理機制時，我們會遇到哪些問題。並實際做過一些測試確保這些保證是符合我們預期的。</p>
<h4 id="單一領袖也有拓撲">單一領袖也有拓撲<a class="headerlink" href="#單一領袖也有拓撲" title="Permanent link">¶</a></h4>
<p><figure><img alt="Replication Chain" src="https://miro.medium.com/max/4800/1*TL6frkbEMlLOwuo6VTL5TA.png"/><figcaption>Replication Chain</figcaption></figure></p>
<p>除了多領袖之外，單一領袖也是有拓撲的。以圖為例就是 <a href="https://medium.com/coinmonks/chain-replication-how-to-build-an-effective-kv-storage-part-1-2-b0ce10d5afc3">Replication Chain</a>（RC）。</p>
<h3 id="處理衝突">處理衝突<a class="headerlink" href="#處理衝突" title="Permanent link">¶</a></h3>
<p>我們一直有提到多領袖需要處理衝突，現在我們就來看看怎麼處理衝突。</p>
<ul>
<li>避免衝突。如果可以，把相同的資料的編輯丟給同一個領袖，例如使用者編輯個人資料，就把該使用者的所有寫入請求丟到同一個領袖（也許是離他最近的 DC）。但如果同一時間地球另一邊有人也在編輯相同使用者的資訊時，還是無可避免的有衝突。</li>
<li>給予各寫入請求一個時間戳。只讓最新的資訊寫入（Last Write Win，LWW），雖然這很常見，但卻很容易出現資料的遺失。如果又考慮到機器的時鐘是不准的這個議題時，很可能新資料會被舊資料覆蓋，時鐘問題會留到別篇討論。<ul>
<li>Cassandra 只支援<a href="http://www.datastax.com/dev/blog/why-cassandra-doesnt-need-vector-clocks">這方式</a></li>
<li>Riak 可以選擇使用<a href="https://riak.com/clocks-are-bad-or-welcome-to-distributed-systems/">這方式</a></li>
</ul>
</li>
<li>高階領袖可以複寫低階領袖的寫入請求。基本跟 LWW 很像。</li>
<li>把所有衝突記錄起來並在<ul>
<li>下次請求時，要求應用程式（或使用者）整併衝突</li>
<li>發生衝突時，要求應用程式（或使用者）整併衝突</li>
</ul>
</li>
</ul>
<h4 id="其他處理衝突的領域">其他處理衝突的領域<a class="headerlink" href="#其他處理衝突的領域" title="Permanent link">¶</a></h4>
<ul>
<li>特殊的資料型別（<a href="https://speakerdeck.com/lenary/crdts-an-update-or-just-a-put">Conflict-free Replicated DataTypes</a>，CRDTs），例如 Map、counter 等等，天生容許衝突</li>
<li>特殊的資料架構（<a href="http://gazagnaire.org/pub/FGM15.pdf">Mergeable persistent data structures</a>），類似版本控制系統（如，Git），會把衝突記錄起來並依照設定整併起來</li>
<li>文字整合（<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.53.933&amp;rep=rep1&amp;type=pdf">Operational transformation</a>），實作於 Google Docs 中，把字串當成陣列並允許同時插入新值。</li>
</ul>
<p>上述方式都算新的方式，並且現有的資料庫通常對於衝突並沒有很好的支援，一樣，細看文件，並做測試。</p>
<p>例如亞馬遜以前在<a href="http://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf">處理購物車的衝突</a>時，他們考慮了添加產品時的衝突，卻沒有考慮刪除時的衝突，導致明明刪除的產品，刷新頁面後又出現在購物車之中。</p>
<h3 id="梳理因果">梳理因果<a class="headerlink" href="#梳理因果" title="Permanent link">¶</a></h3>
<p><figure><img alt="因果混亂並不是衝突" src="https://github.com/Vonng/ddia/raw/master/img/fig5-9.png"/><figcaption>因果混亂並不是衝突</figcaption></figure></p>
<p>因果混亂並不是衝突，以上圖為例，兩個請求並不是並行處理，而是有相依關係的，這時造成錯誤的便是衝突的混亂。</p>
<p>我們可以有的做法就是替各個請求添加 ID，也就是版本向量。</p>
<h4 id="版本向量">版本向量<a class="headerlink" href="#版本向量" title="Permanent link">¶</a></h4>
<p><figure><img alt="版本向量允許讓應用程式處理衝突和因果混亂" src="https://github.com/Vonng/ddia/raw/master/img/fig5-13.png"/><figcaption>版本向量允許讓應用程式處理衝突和因果混亂</figcaption></figure></p>
<p>為了讓事情變簡單，我們先想像只有一個資料庫，了解原理後，再擴展到多台資料庫時就不難了。</p>
<ol>
<li>Client1 請求寫入 <code>[milk]</code>，定其為版本一</li>
<li>Client2 請求寫入 <code>[eggs]</code>，得到版本一的資料 <code>[milk]</code>，並在應用程式中整合兩者成為 <code>[eggs, milk]</code></li>
<li>Client1 請求寫入 <code>[milk, flour]</code>，得到版本二的資料 <code>[eggs]</code>，並在應用程式中整合兩者成為 <code>[milk, flour, eggs]</code></li>
<li>Client2 請求寫入 <code>[eggs, milk, ham]</code> 得到版本三的資料 <code>[milk, flour]</code>，並整合成 <code>[eggs, milk, ham, flour]</code></li>
<li>Client1 整合成 <code>[milk, flour, eggs, bacon, ham]</code></li>
</ol>
<p>透過賦予各個寫入請求一個版本，並在每次送出請求時，夾帶現有的版本，來讓應用程式整併（或設置資料庫讓他自己整併）。這不僅可以處理衝突，當發生因果混亂時，我們也可以透過版本去整合衝突。</p>
<p>現在把資料庫擴增到多版本，這時就會得到版本向量（version vector），而非單一版本。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>版本向量和時鐘向量（vector clocks）是兩種不同的東西，時鐘向量是用來讓 <em>分散式系統</em> 獲得一個統一的遞增順序。之後會再詳細介紹，若有興趣可以看一下<a href="https://haslab.wordpress.com/2011/07/08/version-vectors-are-not-vector-clocks/">文章</a>。</p>
</div>
<h2 id="無領袖">無領袖<a class="headerlink" href="#無領袖" title="Permanent link">¶</a></h2>
<p><figure><img alt="無領袖的運作架構" src="https://i.imgur.com/y8qZWDH.png"/><figcaption>無領袖的運作架構</figcaption></figure></p>
<p>前面兩種方式都是讓使用者送出請求到特定資料庫，但是無領袖的方式是讓使用者（透過協調者）送請求到全部（或大部分）的資料庫。</p>
<p>其實無領袖的概念並不新，但是這概念在早期的效用並不明顯，尤其當時一台關連式資料庫就可以做到很多事情的時候。隨著 Amazon 開始推出 Dynamo 系統時，有越來越多資料庫也支援這類方式的複製。</p>
<p>支援的資料庫有</p>
<ul>
<li>Raik</li>
<li>Cassandra</li>
<li>Voldemort</li>
</ul>
<p>有些資料庫叢集內會提供協調者負責送這些請求到各個資料庫，有些則是讓使用者直接呼叫（透過 SDK 等方式）。</p>
<p><figure><img alt="無領袖的討論" src="https://i.imgur.com/ITEkFRL.png"/><figcaption>無領袖的討論</figcaption></figure></p>
<p>和多領袖一樣，無領袖因為每個資料庫節點都會做寫入的動作，所以很可能會造成兩個資料庫的狀態不一致，例如資料庫 1 先寫 A 再寫 B，資料庫 2 先寫 B 再寫 A。</p>
<p>這時就需要處理兩個資料庫間的衝突，還要梳理相關因果。不過大致邏輯是差不多的。</p>
<p>主要差別在於無領袖他需要在各個資料庫間定期整併，所以這段的順序會是</p>
<ul>
<li>如同前面提到的，同異步的選擇，如果單一資料庫損壞，我需要等他復原才能完成請求嗎？</li>
<li>如何做到多台資料庫的資料一致性</li>
<li>為什麼無領袖可以做到高可用性</li>
</ul>
<h3 id="需要全部送成功嗎">需要全部送成功嗎？<a class="headerlink" href="#需要全部送成功嗎" title="Permanent link">¶</a></h3>
<p><figure><img alt="只需要部分請求成功就可以視為成功" src="https://github.com/Vonng/ddia/raw/master/img/fig5-11.png"/><figcaption>只需要部分請求成功就可以視為成功</figcaption></figure></p>
<p>同時寫入多個資料庫後，如果其中幾個資料庫因為任何原因（網路延遲、資料庫重啟）無法送出成功，就會導致運行終止。為了維持高可用性和資料的一致性，我們要怎麼選擇允許失敗的請求數量？</p>
<p>以圖片為例，五個資料庫，我只要成功寫入和讀取各三個資料庫，就能確保拿到最新的資料回傳給使用者。</p>
<p>也就是 <span class="arithmatex">\(w+r&gt;n\)</span>，這裡的 <span class="arithmatex">\(n\)</span> 代表資料庫總數。</p>
<p>不過有些邊際情況會讓這種保重失效：</p>
<ul>
<li>並行的讀取和寫入</li>
<li>並行的衝突寫入</li>
<li>成功寫入的資料庫壞掉，導致新的資料庫使用舊資料「趕上」</li>
<li>時鐘不準導致的問題</li>
</ul>
<h4 id="鴿巢原理">鴿巢原理<a class="headerlink" href="#鴿巢原理" title="Permanent link">¶</a></h4>
<p><figure><img alt="CC BY-SA 3.0" src="https://upload.wikimedia.org/wikipedia/commons/5/5c/TooManyPigeons.jpg" title="鴿巢原理"/><figcaption>CC BY-SA 3.0</figcaption></figure></p>
<p>這理論英文稱為 qourum，有些人會翻譯為法定人數，但是法定人數這名詞是用在法律領域的。事實上，這個理論是基於<a href="https://zh.wikipedia.org/zh-tw/鴿巢原理">鴿巢原理</a>。也就是當我有十隻鴿子，九個鴿巢，我就能保證有一個鴿巢有兩隻以上的鴿子。</p>
<p>有些資料庫為了高可用性，不會滿足鴿巢原理，例如在五個資料庫中僅成功送給兩個資料庫就完成該次請求。</p>
<p>除此之外，有些資料庫當發現沒辦法滿足預定的數量時，會把請求送到原本 <span class="arithmatex">\(n\)</span> 之外的資料庫（或者放進協調者本身），這種我們稱為稀薄的鴿巢（sloppy quorum）。當原本無法送出的資料庫恢復原狀之後，再讓這些備援的資料庫把資料送回給這些資料庫，這過程稱為提示移交（hinted handoff）。</p>
<p>當資料叢集越來越大，你要送出的請求很多，這代表越來越容易出現無法正確送出的狀況，這時資料庫會越來越難維持一致性。所以需要有一個方法來處理這件事，我們下面就是在討論這件事。</p>
<h3 id="維持資料庫的一致性">維持資料庫的一致性<a class="headerlink" href="#維持資料庫的一致性" title="Permanent link">¶</a></h3>
<p><figure><img alt="讀取時復原" src="https://github.com/Vonng/ddia/raw/master/img/fig5-10.png"/><figcaption>讀取時復原</figcaption></figure></p>
<p>當不能寫入的資料庫隔了一段時間恢復原狀了，我們會在下次讀取的時候，把這個資料庫的資料合成到最新的資料。這個動作我們稱為讀取時復原（read repair）。</p>
<p>但是這代表，如果資料沒被讀取，他永遠不會原持最新資料，該怎麼背景處理？</p>
<h4 id="定期整併">定期整併<a class="headerlink" href="#定期整併" title="Permanent link">¶</a></h4>
<p><figure><img alt="透過 merkle tree 讓他定期整併" src="https://i.imgur.com/D6Q1VfT.png"/><figcaption>透過 merkle tree 讓他定期整併</figcaption></figure></p>
<p>dynamo-style 資料庫會使用<a href="https://slidetodoc.com/dynamo-bayou-101119-adapted-from-andrew-ors-a/">反熵</a>（anti-entropy process）定期讓兩個資料庫的資料達成一致性。透過 Merkle tree，可以快速找到兩個資料庫間的差異，並傳遞彼此的差異來達成同步。</p>
<p>不過並不是所有資料庫有實作這個行為（例如 Voldemort），除此之外反熵並不保住資料寫入的順序，所以很可能會造成資料的衝突。</p>
<h3 id="無領袖的優缺點">無領袖的優缺點<a class="headerlink" href="#無領袖的優缺點" title="Permanent link">¶</a></h3>
<p>因為有鴿巢原理，可以保證資料的一致性，並允許部分的異步來達成高可用性。</p>
<p>除此之外，因為鴿巢原理讓他不需要強制等到所有請求送出成功，所以資料庫可以透過異步的方式把請求送到別的資料中心。</p>
<p>然而寫入的請求很可能會在滿足一致性的過程中導致順序被重置，這就代表資料不能過於複雜（dyanmo-style 的資料同常都是 k-v pair），才能讓即使資料寫入順序被打亂，仍能有效運作。</p>
<h2 id="其他">其他<a class="headerlink" href="#其他" title="Permanent link">¶</a></h2>
<p>當多個資料庫進行複製時，肯定會出現延遲導致資料的不一致。就好像我們上次提的競賽狀況一樣，有哪些狀況跟哪些處理上？複製延遲我們會在下一次的<a href="../distributed-partition/"><abbr title="partitioning, sharding； 將單機上的大型資料集或計算結果拆分為較小部分，並將其分佈到多臺機器上。">分區</abbr></a>討論！</p>
<p>除此之外，有些資料庫會提供接口，讓維運人員知道現在資料庫的一致性狀況。通常領袖類型的複製方式很好做，透過領袖和跟隨者都比較來找出差異。但是在無領袖的分散式資料庫中，因為資料的寫入是非順序性的，做法就會滿困難的。這領域仍在<a href="http://www.bailis.org/papers/pbs-cacm2014.pdf">研究中</a>，而且實作的比例較低。</p>
<p>大部分維運機器的成本都是在電量上，若有一個不需要傳送大量資料且傳送的頻率不高的<a href="https://www.cs.cmu.edu/~fawnproj/papers/fawn-sosp2009.pdf">演算法</a>，就可以省很多錢！</p>
<h2 id="總結">總結<a class="headerlink" href="#總結" title="Permanent link">¶</a></h2>
<ul>
<li>分散式資料庫<ul>
<li>擴增性</li>
<li>高可用性（高容錯性）</li>
<li>低潛時</li>
</ul>
</li>
<li><abbr title="replication； 在幾個節點（或稱 replica）上保留相同資料的副本，以便在某些節點無法訪問時，資料仍可訪問。">複製</abbr>、<abbr title="partitioning, sharding； 將單機上的大型資料集或計算結果拆分為較小部分，並將其分佈到多臺機器上。">分區</abbr></li>
</ul>
<p>我們開頭談了分散式資料庫的好處。並區分了兩種處理方式—<abbr title="replication； 在幾個節點（或稱 replica）上保留相同資料的副本，以便在某些節點無法訪問時，資料仍可訪問。">複製</abbr>、<abbr title="partitioning, sharding； 將單機上的大型資料集或計算結果拆分為較小部分，並將其分佈到多臺機器上。">分區</abbr>。這次集中討論如何做到多資料庫的複製。</p>
<p><figure><img alt="複製的總結" src="https://i.imgur.com/VVxjA7L.png"/><figcaption>複製的總結</figcaption></figure></p>
<p>各個複製方式彼此都有權衡，如果你的資料並不複雜，就可以考慮使用無領袖的方式。如果你只需要在單一資料中心建立資料叢集，就可以考慮單一領袖的複製方式。</p>
<!-- prettier-ignore-start -->
<!-- prettier-ignore-end -->
<div class="footnote">
<hr/>
<ol>
<li id="fn:1">
<p>Network Attached Storage(NAS) <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:2">
<p>Storage Area Network(SAN) <a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="最後更新">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年5月7日</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="建立日期">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2022年2月7日</span>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到頂端
</button>
</main>
<footer class="md-footer">
<nav aria-label="頁腳" class="md-footer__inner md-grid">
<a aria-label="上一頁: 基礎—容錯" class="md-footer__link md-footer__link--prev" href="../foundation-ft/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                上一頁
              </span>
<div class="md-ellipsis">
                基礎—容錯
              </div>
</div>
</a>
<a aria-label="下一頁: 分散式—分區" class="md-footer__link md-footer__link--next" href="../distributed-partition/">
<div class="md-footer__title">
<span class="md-footer__direction">
                下一頁
              </span>
<div class="md-ellipsis">
                分散式—分區
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.top", "navigation.tabs", "navigation.indexes", "navigation.footer", "content.code.annotate", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
<script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
<script src="../../../javascripts/custom.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js"></script>
</body>
</html>