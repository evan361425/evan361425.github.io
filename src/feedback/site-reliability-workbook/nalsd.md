---
tags: SRE-workbook
---

# 非抽象大型系統設計

非抽象大型系統設計的目的在於讓開發者設計系統架構時，有個依據建立穩健而又高擴充的系統。

本文先透過定義問題，收集需求並反覆審視、循序改善架構的設計，最終得到一個可靠的系統設計解方。
目標是讓開發者能設計出一個在初期便擁有高穩健性且同時擁有未來調整的環境，
而這個過程，就是把抽象的需求，降成實際可被估量的實踐。
這些實踐包括：

- 容量（capacity）預估
- 功能獨立性（類似艙壁原則，bulkheads），避免單一功能的損壞影響全部的服務。
- 允許服務降能（degradation）

這些實踐讓 SRE 有能力在面對系統設計時，
思考系統的擴充性和可能的瓶頸，並專注在這些點上。
在接下來的練習中，每一次設計的迭代，都可以反覆問自己這四個問題：

- 這個設計可能嗎？假設不去管資源議題，這個設計可以滿足需求嗎？
- 有沒有更好的方法？可以讓他更快、更輕便、更有效率嗎？
- 這方法可以在有限的設備數量、時間和金錢內達成嗎？
- 這個架構允許降能嗎？當某組建壞掉會發生什麼事？當資料中心壞掉會發生什麼事？

!!! success "練習的目的"
    所有的系統最終都要實際跑在真實的資料中心和真實的設備上，
    我們需要反覆練習將白板上的架構圖，轉化成實際要使用的設備數量等等。
    聽起來很瑣碎，但是不去練習和規劃，當我們實際上線時，可能會付出更慘痛的代價。

    練習中的假設和推估會比最終實際結果重要。
    早期的假設會很大程度影響最終的成果，但是在非抽象大型系統設計中，
    我們並不是要練習出完美的假設，而是在多個**不完美但是合理的假設**中導出一個更好被詮釋的結果

## 練習一：AdWords

AdWords 是 Google 一項產品，用來在使用者透過 Google 搜尋時，推出純文字的廣告。
這次練習，是要設計出一個系統，可以觀測並回報正確的 *click-through rate*
（CTR，*使用者點擊廣告次數* 除以 *廣告推播數*）。
搜尋系統的日誌會紀錄每次搜尋有放哪些廣告，而廣告被點擊的紀錄則是放在廣告系統的日誌中。

開始前，先簡述一下流程。
我們將使用反覆迭代的方式去設計系統，每次迭代都會定義出相關的設計並找出它的優勢和弱點。
而每次迭代的分析，都會幫助我們找出優點在下一次的迭代中設計出更好的系統。
在初始階段我們會根據以下兩個問題來設計系統：

- 這個設計可能嗎？
- 有沒有更好的方法？

接著我們會去思考針對**初始設計的擴充性**，這時就會再去回應以下三個問題：

- 這方法可以在有限的設備數量、時間和金錢內達成嗎？
- 這個架構允許降能嗎？
- 有沒有更好的方法？

雖然這裡列出順序，但實際練習時這些問題可能是反覆詰問的。
例如在初始階段，我們可能就會先考慮它的可擴充性。
如果這個設計在後面的問題無法得到好的回答，我們就會修正或替換某個組件，接著重頭開始。
