{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u4f60\u597d\uff0c\u6211\u53eb\u5442\u5b78\u6d32\u3002\u6211\u5728 104 \u8cc7\u8a0a\u79d1\u6280\u5de5\u4f5c\uff0c\u6b61\u8fce\u767c PR \u505a\u4efb\u4f55\u4fee\u6539\u3002 \u6211\u6709\u4e00\u4e9b \u958b\u6e90\u5c08\u6848 \uff0c\u9084\u6709\u4e00\u4e9b \u8b80\u66f8\u5fc3\u5f97 \u8ddf \u96a8\u7b46 \u3002 \u9019\u88e1\u65b9\u4fbf\u6211\u505a\u6574\u7406\uff0c\u548c\u505a issues \u4f86\u63d0\u9192\u81ea\u5df1\u5f85\u505a\u4e8b\u9805\u3002","title":"Home"},{"location":"blogs/","text":"\u90e8\u843d\u683c \u9019\u88e1\u653e\u4e00\u4e9b\u5fc3\u5f97\u3002","title":"\u9996\u9801"},{"location":"blogs/#_1","text":"\u9019\u88e1\u653e\u4e00\u4e9b\u5fc3\u5f97\u3002","title":"\u90e8\u843d\u683c"},{"location":"blogs/scrum/","text":"Scrum \u7684\u7f3a\u9ede Scrum \u662f\u4e00\u7a2e\u654f\u6377\u958b\u767c\u7684\u6846\u67b6\uff0c\u628a\u5de5\u4f5c\u62c6\u6210\u90e8\u5206\u7d30\u9805\uff0c\u518d\u5728\u6bcf\u500b\u6642\u9593\u5340\u9593\u53bb\u5b8c\u6210\u5b83\u3002\u4e26\u96a8\u8457\u6642\u9593\u5340\u9593\u7d50\u675f\uff0c\u53cd\u8986\u8abf\u6574\u4e0b\u4e00\u500b\u6642\u9593\u5340\u9593\u8981\u505a\u7684\u4e8b\u3002 \u4f46\u662f\uff0c\u6211\u5011\u8a72\u600e\u9ebc\u53bb\u770b\u5f85\u4ed6\uff1f\u6211\u6703\u4ee5\u5169\u500b\u554f\u984c\u70ba\u6838\u5fc3\u53bb\u8a0e\u8ad6\uff1a Scrum \u7684\u7f3a\u9ede\u662f\u4ec0\u9ebc\uff1f \u4ee5\u4e3b\u89c0\u4f86\u8aaa\uff0cScrum \u6703\u662f\u5728\u5e02\u5834\u4e0a\u5927\u90e8\u5206\u5718\u968a\u7684\u6700\u7d42\u958b\u767c\u6846\u67b6\u55ce\uff1f Scrum \u9069\u5408\u4ec0\u9ebc Scrum \u5728\u8a2d\u8a08\u6642\u5c31\u662f\u4ee5\u63d0 \u9ad8\u5546\u696d \u65b0\u7522\u54c1\u958b\u767c \u7684\u901f\u5ea6\u548c\u9748\u6d3b\u6027 \u70ba\u8003\u91cf\u3002 \u65b0\u7522\u54c1\u5728\u6700\u7d42\u6210\u578b\u6642\uff0c\u5f88\u96e3\u548c\u6700\u521d\u8a2d\u8a08\u6642\u76f8\u7b26\uff0c\u6642\u5e38\u6703\u9700\u8981\u52a0\u9ede\u4ec0\u9ebc\uff0c\u5c11\u9ede\u4ec0\u9ebc\u3002\u6b63\u662f\u9019\u7a2e\u9ad8\u8fed\u4ee3\u7684\u7279\u6027\uff0c\u8b93\u6a44\u6b16\u7403\u8853\u8a9e scrum \u88ab\u5f15\u7528\u9032\u4f86\u3002","title":"Scrum \u7684\u7f3a\u9ede"},{"location":"blogs/scrum/#scrum","text":"Scrum \u662f\u4e00\u7a2e\u654f\u6377\u958b\u767c\u7684\u6846\u67b6\uff0c\u628a\u5de5\u4f5c\u62c6\u6210\u90e8\u5206\u7d30\u9805\uff0c\u518d\u5728\u6bcf\u500b\u6642\u9593\u5340\u9593\u53bb\u5b8c\u6210\u5b83\u3002\u4e26\u96a8\u8457\u6642\u9593\u5340\u9593\u7d50\u675f\uff0c\u53cd\u8986\u8abf\u6574\u4e0b\u4e00\u500b\u6642\u9593\u5340\u9593\u8981\u505a\u7684\u4e8b\u3002 \u4f46\u662f\uff0c\u6211\u5011\u8a72\u600e\u9ebc\u53bb\u770b\u5f85\u4ed6\uff1f\u6211\u6703\u4ee5\u5169\u500b\u554f\u984c\u70ba\u6838\u5fc3\u53bb\u8a0e\u8ad6\uff1a Scrum \u7684\u7f3a\u9ede\u662f\u4ec0\u9ebc\uff1f \u4ee5\u4e3b\u89c0\u4f86\u8aaa\uff0cScrum \u6703\u662f\u5728\u5e02\u5834\u4e0a\u5927\u90e8\u5206\u5718\u968a\u7684\u6700\u7d42\u958b\u767c\u6846\u67b6\u55ce\uff1f","title":"Scrum \u7684\u7f3a\u9ede"},{"location":"blogs/scrum/#scrum_1","text":"Scrum \u5728\u8a2d\u8a08\u6642\u5c31\u662f\u4ee5\u63d0 \u9ad8\u5546\u696d \u65b0\u7522\u54c1\u958b\u767c \u7684\u901f\u5ea6\u548c\u9748\u6d3b\u6027 \u70ba\u8003\u91cf\u3002 \u65b0\u7522\u54c1\u5728\u6700\u7d42\u6210\u578b\u6642\uff0c\u5f88\u96e3\u548c\u6700\u521d\u8a2d\u8a08\u6642\u76f8\u7b26\uff0c\u6642\u5e38\u6703\u9700\u8981\u52a0\u9ede\u4ec0\u9ebc\uff0c\u5c11\u9ede\u4ec0\u9ebc\u3002\u6b63\u662f\u9019\u7a2e\u9ad8\u8fed\u4ee3\u7684\u7279\u6027\uff0c\u8b93\u6a44\u6b16\u7403\u8853\u8a9e scrum \u88ab\u5f15\u7528\u9032\u4f86\u3002","title":"Scrum \u9069\u5408\u4ec0\u9ebc"},{"location":"essay/","text":"\u9019\u88e1\u662f\u96a8\u7b46\uff0c\u7d00\u9304\u5404\u7a2e\u6771\u897f\u3002\u6709\u932f\u6b61\u8fce\u4f86\u4fee\u6b63\u3002","title":"\u7c21\u4ecb"},{"location":"essay/questionnaire-principal/","text":"\u554f\u5377\u8a2d\u8a08\u6307\u5357 \u984c\u9805\u8a2d\u8a08\u7684\u539f\u5247 \u554f\u904e\u53bb\u7d93\u9a57\u8207\u4e8b\u5be6\uff0c\u907f\u514d\u5047\u8a2d\u6027\u554f\u984c \u9810\u8a2d\u689d\u4ef6\u5beb\u6e05\u695a \u5982\u679c\u672a\u4f86\u9080\u8acb\u60a8\u4f7f\u7528\uff0c\u60a8\u6703\u4f7f\u7528\u54ea\u4e9b\u529f\u80fd\u3002A. \u8077\u7f3a\u6392\u5e8f \u5047\u8a2d\u672a\u4f86\u6b63\u8981\u958b\u59cb\u627e\u5de5\u4f5c\uff0c\u60a8\u6703\u60f3\u4f7f\u7528\u54ea\u4e9b\u529f\u80fd\u3002A. \u8077\u7f3a\u6392\u5e8f\uff1a\u53ef\u4ee5\u5c07\u60a8\u611f\u8208\u8da3\u7684\u8077\u7f3a\u7f6e\u9802 \u554f\u884c\u70ba\uff0c\u907f\u514d\u554f\u601d\u8003 \u9078\u64c7\u984c \u5716\u6848 \u8b93\u5176\u53ef\u4ee5\u300c\u99ac\u4e0a\u60f3\u51fa\u4f86\u300d \u554f\u984c\u8981\u8db3\u5920\u660e\u78ba\uff0c\u76e1\u53ef\u80fd\u964d\u4f4e\u6a21\u7cca\u7a7a\u9593 \u8acb\u554f\u60a8\u591a\u5e38\u4f7f\u7528\u6211\u5011\u7684\u670d\u52d9\uff1f \u8acb\u554f\u60a8\u6709\u591a\u5e38\u4f7f\u7528 104 \u4eba\u529b\u9280\u884c\uff1f \u8acb\u554f\u60a8\u6700\u8fd1\u4e00\u500b\u6708\u5167\uff0c\u591a\u5e38\u4f7f\u7528 104 \u5de5\u4f5c\u5feb\u627e APP \u4f86\u61c9\u5fb5\u5de5\u4f5c \u9583\u907f\u4e0d\u826f\u554f\u984c \u5f15\u5c0e\u5f0f\u554f\u984c\uff1a\u66ff\u586b\u7b54\u8005\u9810\u8a2d\uff08\u6697\u793a\uff09\u7acb\u5834 \u8a98\u5c0e\u662f\u554f\u984c\uff1a\u64cd\u63a7\u3001\u9650\u5236\u56de\u7b54\u8cbb\u70ba \u4e0d\u660e\u78ba\u554f\u984c\uff1a\u5982\u4e0a\u8ff0\u7b2c\u4e09\u9805 \u884c\u8a71\u554f\u984c\uff1a\u554f\u53e5\u4e2d\u5305\u542b\u884c\u8a71\u3001\u5c08\u696d\u8853\u8a9e \u8907\u5408\u554f\u984c \u591a\u91cd\u908f\u8f2f\u554f\u984c \u5c01\u9589\u578b\u9078\u9805\u8a2d\u8a08\u539f\u5247 ME: \u5f7c\u6b64\u4e4b\u9593 \u5b8c\u5168\u7368\u7acb \u3001 \u6beb\u7121\u91cd\u758a \uff0c\u55ae\u9078 CE: \u6574\u9ad4\u800c\u8a00 \u5b8c\u5168\u7aae\u76e1\u53ef\u80fd \u3001 \u6beb\u7121\u907a\u6f0f \uff0c\u591a\u9078 \u5408\u7406\u7684\u9078\u9805\u6578\u91cf \u8996\u5de5\u5177\u800c\u5b9a SurveyCake \u53ef\u4ee5\u96d9\u6b04 Hotjar \u55ae\u6b04 20 \u500b\u4ee5\u5167 \u7e2e\u6e1b\u9078\u9805 \u5176\u4ed6 \u77e9\u9663\u984c \u4e00\u984c\u591a\u554f \u674e\u7279\u514b\u91cf\u5c3a 1 \u5206\u30012 \u5206\u30013 \u5206\u30014 \u5206\u30015 \u5206 5 \u5206\u30017 \u5206\u300111 \u5206\uff08NPS\uff09 \u5947\u6578\u9ede\uff1a\u6709\u4e2d\u9593\u9078\u9805 \u70ba\u6578\u5b57\u52a0\u4e0a\u6587\u5b57\u6a19\u7c64 \u65e2\u6709\u7684\u554f\u5377\u984c\u578b\u53ef\u4ee5\u52a0\u901f\u88fd\u4f5c \u554f\u5377\u8cc7\u6599\u5eab \u554f\u984c\u7684\u985e\u578b \u63cf\u7e6a\u51fa\u76ee\u6a19\u65cf\u7fa4\u9577\u76f8 \u884c\u70ba\u3001\u614b\u5ea6\u3001\u8a8d\u77e5 Net-Promoter-Score-NPS \u7f3a\u9ede \u6ce8\u610f \u670d\u52d9\u6eff\u610f\u5ea6 \u8cc7\u5b89 \u63cf\u7e6a\u51fa\u76ee\u6a19\u65cf\u7fa4\u9577\u76f8 \u6027\u5225 \u5e74\u9f61 \u6559\u80b2\u7a0b\u5ea6 \u5c45\u4f4f\u5730 \u884c\u70ba\u3001\u614b\u5ea6\u3001\u8a8d\u77e5 \u6700\u8fd1\u4e00\u500b\u6708\u505a\u4e86\u54ea\u4e9b\u670d\u52d9\uff1a\u662f\u5426\u53d7\u904e\u53bb\u7d93\u9a57\u5f71\u97ff \u6eff\u610f\u5ea6\u3001\u7a4d\u6975\u5ea6\uff1a\u662f\u5426\u6709\u7279\u5b9a\u52d5\u6a5f \uff08\u4e0d\uff09\u4f7f\u7528\u539f\u56e0 Net Promoter Score (NPS) \u4f60\u6709\u591a\u5927\u7684\u610f\u9858\u5c07\u7522\u54c1\u63a8\u85a6\u7d66\u89aa\u670b\u597d\u53cb\uff1f 0~10 \u5206\uff1a 0~6 \u6279\u8a55\u8005 7~8 \u88ab\u52d5\u8005 9~10 \u63a8\u5ee3\u8005 NPS = \u63a8\u5ee3\u8005\u6bd4\u4f8b - \u6279\u8a55\u8005\u6bd4\u4f8b \u7f3a\u9ede \u4ec0\u9ebc\u6a23\u7684\u5206\u6578\u662f\u597d\u7684\uff1f \u6ce2\u52d5\u5927\uff1a\u53d7\u884c\u92b7\u7b49\u5f71\u97ff \u7db2\u8def\u4e0a\u7684\u6a19\u6e96\u7121\u6cd5\u76e1\u4fe1 \u8ddf\u81ea\u5df1\u8cfd\u8dd1 \u6ce8\u610f \u554f\u7684\u662f\u9084\u6c92\u767c\u751f\u7684\u4e8b\u60c5 \u88dc\u554f\uff1a\u662f\u5426\u4f7f\u7528\u904e\u7522\u54c1 \u5207\u5206\u65b9\u5f0f\u592a\u6b66\u65b7 \u8ffd\u554f\u8a55\u5206\u539f\u56e0 \u670d\u52d9\u6eff\u610f\u5ea6 5 \u5206\u30017 \u5206\u300111 \u5206 \u8981\u6709\u4e2d\u9593\u9078\u9805\uff0c\u907f\u514d\u9078\u908a\u7ad9 \u6bd4\u8f03\uff1a\u6bd4\u4ee5\u524d\u597d\u5c31\u662f\u597d \u8cc7\u5b89 \u7528\u4e0d\u5230\u5c31\u5225\u641c\u96c6 \u59a5\u5584\u4fdd\u5b58 \u554f\u5377\u4f48\u5c40 graph LR subgraph one [\u8d77] \u6a19\u984c --> \u7c21\u55ae\u554f\u984c end \u7c21\u55ae\u554f\u984c -- \u627f --> \u771f\u6b63\u95dc\u5fc3\u7684\u554f\u984c \u771f\u6b63\u95dc\u5fc3\u7684\u554f\u984c -- \u8f49 --> \u884c\u52d5\u53ec\u559a \u884c\u52d5\u53ec\u559a -- \u5408 --> \u611f\u8b1d\u8a9e \u8d77 \u57fa\u672c\u8cc7\u6599 \u904e\u53bb\u7d93\u9a57 \u627f \u6700\u95dc\u5fc3\u7684\u8b70\u984c\uff0c\u53ef\u80fd\u9700\u8981\u8cbb\u529b\u601d\u8003 \u89ba\u5f97\u597d\u7528\u7684\u529f\u80fd \u671f\u5f85\u7684\u529f\u80fd \u8f49 \u5e0c\u671b\u586b\u7b54\u8005\u9032\u4e00\u6b65\u63a1\u53d6\u7684\u884c\u52d5 \u9858\u610f\u8cfc\u8cb7\u91d1\u984d\u3001\u9858\u610f\u63a8\u85a6\u5c0d\u8c61 \u8996\u9700\u6c42\u800c\u5b9a\uff0c\u4e0d\u4e00\u5b9a\u9700\u8981\u6709 \u5408 \u611f\u8b1d\u8a9e \u901a\u5e38\u654f\u611f\u500b\u8cc7\u6703\u5728\u9019\u6bb5\uff08\u56e0\u70ba\u4f7f\u7528\u8005\u5df2\u7d93\u586b\u5b8c\u5f88\u591a\u554f\u984c\uff0c\u6703\u60f3\u5b8c\u6210\u9019\u500b\u554f\u5377\uff09 \u9700\u8981\u653e\u591a\u5c11\u984c\u76ee \u8996\u76ee\u7684\u800c\u5b9a\uff0c\u62bd\u734e\u3001\u79ae\u54c1\u53ef\u6709\u6548\u63d0\u5347\u586b\u7b54\u8005\u610f\u9858\u3002 Hotjar \u5efa\u8b70\u6975\u77ed\u554f\u5377 \u7528\u65bc\u6eff\u610f\u5ea6 4 \u984c\u5167 1 \u5206\u9418 \u77ed\u554f\u5377 \u57fa\u672c\u8abf\u67e5 10 \u984c\u5167 3 \u5206\u9418 \u4e2d\u554f\u5377 \u9a57\u8b49\u5047\u8aaa 10~25 10 \u5206\u9418 \u9577\u554f\u5377 \u591a\u7a2e\u4ea4\u53c9\u5206\u6790 \u554f\u5377\u5de5\u5177 Microsoft Form O365 \u9644\u9001 \u6709 NPS \u9810\u8a2d\u554f\u984c \u582a\u7528 \u548c O365 \u6574\u5408 \u7f3a\u9ede \u7121\u6cd5\u4f7f\u7528\u5716\u7247\u4f5c\u70ba\u9078\u9805 \u4e0d\u5bb9\u6613\u908f\u8f2f\u8df3\u8f49 Google Form \u514d\u8cbb \u6700\u5ee3\u6cdb \u582a\u7528 \u548c Google Doc \u6574\u5408 \u7f3a\u9ede \u8907\u9078\u984c\u539f\u59cb\u8cc7\u6599\u4e0d\u597d\u5206\u6790 Survey Cake \u6709\u514d\u8cbb\u7248 \u53f0\u7063\u516c\u53f8 \u529f\u80fd\u5b8c\u6574\u3001\u6559\u5b78\u6587\u4ef6\u8c50\u5bcc \u53ef\u5728\u5f8c\u53f0\u5b8c\u6210\u90e8\u5206\u5206\u6790 \u4f7f\u7528\u5834\u666f \u8ffd\u6c42\u826f\u597d\u9ad4\u9a57 \u6700\u9ad8\u5ea6\u7684\u5ba2\u5236\u9ad4\u9a57 \u554f\u5377\u7d50\u679c\u9032\u884c\u62bd\u734e \u7f3a\u9ede \u904b\u884c\u901f\u5ea6\u6162 Hotjar \u6709\u514d\u8cbb\u7248 \u63d2\u5165\u7db2\u9801 \u5f62\u5f0f\u5c0e\u81f4\u984c\u6578\u6709\u56b4\u683c\u9650\u5236 \u4f7f\u7528\u5834\u666f \u7b2c\u4e00\u5370\u8c61\u3001\u5230\u7ad9\u539f\u56e0 \u907f\u514d\u8a55\u4f30\u529f\u80fd\u984c \u7f3a\u9ede \u5c0d\u7528\u6236\u5e72\u64fe\u7387\u9ad8 \u53ea\u80fd\u6975\u77ed\u554f\u5377 \u53ea\u80fd\u9472\u5d4c\u5728\u7db2\u9801\u800c\u975e APP \u5728\u53f0\u7063\u975e\u4e3b\u6d41 Typeform \u826f\u597d\u4f7f\u7528\u8005\u9ad4\u9a57 \u6709\u904e\u500b\u8cc7\u5916\u6d29\u7684\u7d93\u9a57 SurveyMonkey \u50c5\u6b21\u65bc Google \u7684\u5927\u578b\u554f\u5377\u670d\u52d9 \u8a08\u7b97\u6a5f Qualtrics \u586b\u7b54\u9ad4\u9a57\u4f73 \u5f8c\u53f0\u50c5\u6709\u82f1\u6587 \u88fd\u4f5c\u6d41\u7a0b graph LR subgraph one[\u521d\u6b65\u968e\u6bb5] \u8a0e\u8ad6 --> \u8349\u7a3f \u8349\u7a3f --> \u8a0e\u8ad6 end \u8a0e\u8ad6 --> \u7dda\u4e0a\u7248\u672c \u7dda\u4e0a\u7248\u672c --> \u767c\u9001 \u8349\u7a3f\u5de5\u5177 \u5229\u7528 spreadsheet \u3001 excel \u7b49\u5de5\u5177\u505a\u8349\u7a3f\uff0c\u65b9\u4fbf\u8a18\u9304\u4fee\u6539\u904e\u7a0b\u548c\u505a\u7559\u8a00\u3002 \u8a18\u9304\u4fdd\u5b58 \u628a\u6b77\u4f86\u7684\u984c\u76ee\u3001\u9078\u9805\u5404\u4e00\u9801\uff0c\u65b9\u4fbf\u8a2d\u8a08\u65b0\u7684\u554f\u5377 \u6587\u6848 \u6587\u6848\u5beb\u4f5c\uff0c\u6309\u7167\u65cf\u7fa4\u6027\u8cea\u8abf\u6574\u3002 \u554f\u5377\u5206\u6790 \u4e0d\u50c5\u8981\u8ffd\u8e64\u554f\u5377\u767c\u9001\u6578\u91cf\uff0c\u4e5f\u8981\u770b\u8f49\u63db\u7387 \u907f\u514d\u53ef\u4ee5\u900f\u904e\u8cc7\u6599\u4ea4\u53c9\u6bd4\u5c0d\u51fa\u4e00\u500b\u4eba\uff0c\u4fdd\u8b77\u586b\u7b54\u8005\u7684\u96b1\u79c1 \u82e5\u586b\u7b54\u8005\u4e0d\u5e0c\u671b\u7559\u4e0b\u500b\u8cc7\uff0c\u8981\u53ef\u4ee5\u522a\u9664\u8a72\u7d00\u9304 \u4ea4\u53c9\u5206\u6790 \u5169\u500b\u8b8a\u9805\u5f7c\u6b64\u4ea4\u53c9\uff0c\u89c0\u5bdf\u8da8\u52e2\u548c\u5dee\u7570 Excel \u7684 \u6a1e\u7d10\u5206\u6790 \u5831\u544a\u65b9\u5f0f \u7528\u6236\u6a23\u8c8c Profile \u5713\u9905\u5716 \u9577\u689d\u5716 \u8981\u6ce8\u610f\u62bd\u6a23\u8aa4\u5dee Margin of Error https://cyber-edge.com/determining-minimum-survey-sample-sizes-based-on-survey-margin-of-error/","title":"\u554f\u5377\u8a2d\u8a08\u6307\u5357"},{"location":"essay/questionnaire-principal/#_1","text":"","title":"\u554f\u5377\u8a2d\u8a08\u6307\u5357"},{"location":"essay/questionnaire-principal/#_2","text":"\u554f\u904e\u53bb\u7d93\u9a57\u8207\u4e8b\u5be6\uff0c\u907f\u514d\u5047\u8a2d\u6027\u554f\u984c \u9810\u8a2d\u689d\u4ef6\u5beb\u6e05\u695a \u5982\u679c\u672a\u4f86\u9080\u8acb\u60a8\u4f7f\u7528\uff0c\u60a8\u6703\u4f7f\u7528\u54ea\u4e9b\u529f\u80fd\u3002A. \u8077\u7f3a\u6392\u5e8f \u5047\u8a2d\u672a\u4f86\u6b63\u8981\u958b\u59cb\u627e\u5de5\u4f5c\uff0c\u60a8\u6703\u60f3\u4f7f\u7528\u54ea\u4e9b\u529f\u80fd\u3002A. \u8077\u7f3a\u6392\u5e8f\uff1a\u53ef\u4ee5\u5c07\u60a8\u611f\u8208\u8da3\u7684\u8077\u7f3a\u7f6e\u9802 \u554f\u884c\u70ba\uff0c\u907f\u514d\u554f\u601d\u8003 \u9078\u64c7\u984c \u5716\u6848 \u8b93\u5176\u53ef\u4ee5\u300c\u99ac\u4e0a\u60f3\u51fa\u4f86\u300d \u554f\u984c\u8981\u8db3\u5920\u660e\u78ba\uff0c\u76e1\u53ef\u80fd\u964d\u4f4e\u6a21\u7cca\u7a7a\u9593 \u8acb\u554f\u60a8\u591a\u5e38\u4f7f\u7528\u6211\u5011\u7684\u670d\u52d9\uff1f \u8acb\u554f\u60a8\u6709\u591a\u5e38\u4f7f\u7528 104 \u4eba\u529b\u9280\u884c\uff1f \u8acb\u554f\u60a8\u6700\u8fd1\u4e00\u500b\u6708\u5167\uff0c\u591a\u5e38\u4f7f\u7528 104 \u5de5\u4f5c\u5feb\u627e APP \u4f86\u61c9\u5fb5\u5de5\u4f5c \u9583\u907f\u4e0d\u826f\u554f\u984c \u5f15\u5c0e\u5f0f\u554f\u984c\uff1a\u66ff\u586b\u7b54\u8005\u9810\u8a2d\uff08\u6697\u793a\uff09\u7acb\u5834 \u8a98\u5c0e\u662f\u554f\u984c\uff1a\u64cd\u63a7\u3001\u9650\u5236\u56de\u7b54\u8cbb\u70ba \u4e0d\u660e\u78ba\u554f\u984c\uff1a\u5982\u4e0a\u8ff0\u7b2c\u4e09\u9805 \u884c\u8a71\u554f\u984c\uff1a\u554f\u53e5\u4e2d\u5305\u542b\u884c\u8a71\u3001\u5c08\u696d\u8853\u8a9e \u8907\u5408\u554f\u984c \u591a\u91cd\u908f\u8f2f\u554f\u984c","title":"\u984c\u9805\u8a2d\u8a08\u7684\u539f\u5247"},{"location":"essay/questionnaire-principal/#_3","text":"ME: \u5f7c\u6b64\u4e4b\u9593 \u5b8c\u5168\u7368\u7acb \u3001 \u6beb\u7121\u91cd\u758a \uff0c\u55ae\u9078 CE: \u6574\u9ad4\u800c\u8a00 \u5b8c\u5168\u7aae\u76e1\u53ef\u80fd \u3001 \u6beb\u7121\u907a\u6f0f \uff0c\u591a\u9078","title":"\u5c01\u9589\u578b\u9078\u9805\u8a2d\u8a08\u539f\u5247"},{"location":"essay/questionnaire-principal/#_4","text":"\u8996\u5de5\u5177\u800c\u5b9a SurveyCake \u53ef\u4ee5\u96d9\u6b04 Hotjar \u55ae\u6b04 20 \u500b\u4ee5\u5167 \u7e2e\u6e1b\u9078\u9805 \u5176\u4ed6","title":"\u5408\u7406\u7684\u9078\u9805\u6578\u91cf"},{"location":"essay/questionnaire-principal/#_5","text":"\u4e00\u984c\u591a\u554f","title":"\u77e9\u9663\u984c"},{"location":"essay/questionnaire-principal/#_6","text":"1 \u5206\u30012 \u5206\u30013 \u5206\u30014 \u5206\u30015 \u5206 5 \u5206\u30017 \u5206\u300111 \u5206\uff08NPS\uff09 \u5947\u6578\u9ede\uff1a\u6709\u4e2d\u9593\u9078\u9805 \u70ba\u6578\u5b57\u52a0\u4e0a\u6587\u5b57\u6a19\u7c64","title":"\u674e\u7279\u514b\u91cf\u5c3a"},{"location":"essay/questionnaire-principal/#_7","text":"\u554f\u5377\u8cc7\u6599\u5eab","title":"\u65e2\u6709\u7684\u554f\u5377\u984c\u578b\u53ef\u4ee5\u52a0\u901f\u88fd\u4f5c"},{"location":"essay/questionnaire-principal/#_8","text":"\u63cf\u7e6a\u51fa\u76ee\u6a19\u65cf\u7fa4\u9577\u76f8 \u884c\u70ba\u3001\u614b\u5ea6\u3001\u8a8d\u77e5 Net-Promoter-Score-NPS \u7f3a\u9ede \u6ce8\u610f \u670d\u52d9\u6eff\u610f\u5ea6 \u8cc7\u5b89","title":"\u554f\u984c\u7684\u985e\u578b"},{"location":"essay/questionnaire-principal/#_9","text":"\u6027\u5225 \u5e74\u9f61 \u6559\u80b2\u7a0b\u5ea6 \u5c45\u4f4f\u5730","title":"\u63cf\u7e6a\u51fa\u76ee\u6a19\u65cf\u7fa4\u9577\u76f8"},{"location":"essay/questionnaire-principal/#_10","text":"\u6700\u8fd1\u4e00\u500b\u6708\u505a\u4e86\u54ea\u4e9b\u670d\u52d9\uff1a\u662f\u5426\u53d7\u904e\u53bb\u7d93\u9a57\u5f71\u97ff \u6eff\u610f\u5ea6\u3001\u7a4d\u6975\u5ea6\uff1a\u662f\u5426\u6709\u7279\u5b9a\u52d5\u6a5f \uff08\u4e0d\uff09\u4f7f\u7528\u539f\u56e0","title":"\u884c\u70ba\u3001\u614b\u5ea6\u3001\u8a8d\u77e5"},{"location":"essay/questionnaire-principal/#net-promoter-score-nps","text":"\u4f60\u6709\u591a\u5927\u7684\u610f\u9858\u5c07\u7522\u54c1\u63a8\u85a6\u7d66\u89aa\u670b\u597d\u53cb\uff1f 0~10 \u5206\uff1a 0~6 \u6279\u8a55\u8005 7~8 \u88ab\u52d5\u8005 9~10 \u63a8\u5ee3\u8005 NPS = \u63a8\u5ee3\u8005\u6bd4\u4f8b - \u6279\u8a55\u8005\u6bd4\u4f8b","title":"Net Promoter Score (NPS)"},{"location":"essay/questionnaire-principal/#_11","text":"\u4ec0\u9ebc\u6a23\u7684\u5206\u6578\u662f\u597d\u7684\uff1f \u6ce2\u52d5\u5927\uff1a\u53d7\u884c\u92b7\u7b49\u5f71\u97ff \u7db2\u8def\u4e0a\u7684\u6a19\u6e96\u7121\u6cd5\u76e1\u4fe1 \u8ddf\u81ea\u5df1\u8cfd\u8dd1","title":"\u7f3a\u9ede"},{"location":"essay/questionnaire-principal/#_12","text":"\u554f\u7684\u662f\u9084\u6c92\u767c\u751f\u7684\u4e8b\u60c5 \u88dc\u554f\uff1a\u662f\u5426\u4f7f\u7528\u904e\u7522\u54c1 \u5207\u5206\u65b9\u5f0f\u592a\u6b66\u65b7 \u8ffd\u554f\u8a55\u5206\u539f\u56e0","title":"\u6ce8\u610f"},{"location":"essay/questionnaire-principal/#_13","text":"5 \u5206\u30017 \u5206\u300111 \u5206 \u8981\u6709\u4e2d\u9593\u9078\u9805\uff0c\u907f\u514d\u9078\u908a\u7ad9 \u6bd4\u8f03\uff1a\u6bd4\u4ee5\u524d\u597d\u5c31\u662f\u597d","title":"\u670d\u52d9\u6eff\u610f\u5ea6"},{"location":"essay/questionnaire-principal/#_14","text":"\u7528\u4e0d\u5230\u5c31\u5225\u641c\u96c6 \u59a5\u5584\u4fdd\u5b58","title":"\u8cc7\u5b89"},{"location":"essay/questionnaire-principal/#_15","text":"graph LR subgraph one [\u8d77] \u6a19\u984c --> \u7c21\u55ae\u554f\u984c end \u7c21\u55ae\u554f\u984c -- \u627f --> \u771f\u6b63\u95dc\u5fc3\u7684\u554f\u984c \u771f\u6b63\u95dc\u5fc3\u7684\u554f\u984c -- \u8f49 --> \u884c\u52d5\u53ec\u559a \u884c\u52d5\u53ec\u559a -- \u5408 --> \u611f\u8b1d\u8a9e","title":"\u554f\u5377\u4f48\u5c40"},{"location":"essay/questionnaire-principal/#_16","text":"\u57fa\u672c\u8cc7\u6599 \u904e\u53bb\u7d93\u9a57","title":"\u8d77"},{"location":"essay/questionnaire-principal/#_17","text":"\u6700\u95dc\u5fc3\u7684\u8b70\u984c\uff0c\u53ef\u80fd\u9700\u8981\u8cbb\u529b\u601d\u8003 \u89ba\u5f97\u597d\u7528\u7684\u529f\u80fd \u671f\u5f85\u7684\u529f\u80fd","title":"\u627f"},{"location":"essay/questionnaire-principal/#_18","text":"\u5e0c\u671b\u586b\u7b54\u8005\u9032\u4e00\u6b65\u63a1\u53d6\u7684\u884c\u52d5 \u9858\u610f\u8cfc\u8cb7\u91d1\u984d\u3001\u9858\u610f\u63a8\u85a6\u5c0d\u8c61 \u8996\u9700\u6c42\u800c\u5b9a\uff0c\u4e0d\u4e00\u5b9a\u9700\u8981\u6709","title":"\u8f49"},{"location":"essay/questionnaire-principal/#_19","text":"\u611f\u8b1d\u8a9e \u901a\u5e38\u654f\u611f\u500b\u8cc7\u6703\u5728\u9019\u6bb5\uff08\u56e0\u70ba\u4f7f\u7528\u8005\u5df2\u7d93\u586b\u5b8c\u5f88\u591a\u554f\u984c\uff0c\u6703\u60f3\u5b8c\u6210\u9019\u500b\u554f\u5377\uff09","title":"\u5408"},{"location":"essay/questionnaire-principal/#_20","text":"\u8996\u76ee\u7684\u800c\u5b9a\uff0c\u62bd\u734e\u3001\u79ae\u54c1\u53ef\u6709\u6548\u63d0\u5347\u586b\u7b54\u8005\u610f\u9858\u3002 Hotjar \u5efa\u8b70\u6975\u77ed\u554f\u5377 \u7528\u65bc\u6eff\u610f\u5ea6 4 \u984c\u5167 1 \u5206\u9418 \u77ed\u554f\u5377 \u57fa\u672c\u8abf\u67e5 10 \u984c\u5167 3 \u5206\u9418 \u4e2d\u554f\u5377 \u9a57\u8b49\u5047\u8aaa 10~25 10 \u5206\u9418 \u9577\u554f\u5377 \u591a\u7a2e\u4ea4\u53c9\u5206\u6790","title":"\u9700\u8981\u653e\u591a\u5c11\u984c\u76ee"},{"location":"essay/questionnaire-principal/#_21","text":"","title":"\u554f\u5377\u5de5\u5177"},{"location":"essay/questionnaire-principal/#microsoft-form","text":"O365 \u9644\u9001 \u6709 NPS \u9810\u8a2d\u554f\u984c \u582a\u7528 \u548c O365 \u6574\u5408","title":"Microsoft Form"},{"location":"essay/questionnaire-principal/#_22","text":"\u7121\u6cd5\u4f7f\u7528\u5716\u7247\u4f5c\u70ba\u9078\u9805 \u4e0d\u5bb9\u6613\u908f\u8f2f\u8df3\u8f49","title":"\u7f3a\u9ede"},{"location":"essay/questionnaire-principal/#google-form","text":"\u514d\u8cbb \u6700\u5ee3\u6cdb \u582a\u7528 \u548c Google Doc \u6574\u5408","title":"Google Form"},{"location":"essay/questionnaire-principal/#_23","text":"\u8907\u9078\u984c\u539f\u59cb\u8cc7\u6599\u4e0d\u597d\u5206\u6790","title":"\u7f3a\u9ede"},{"location":"essay/questionnaire-principal/#survey-cake","text":"\u6709\u514d\u8cbb\u7248 \u53f0\u7063\u516c\u53f8 \u529f\u80fd\u5b8c\u6574\u3001\u6559\u5b78\u6587\u4ef6\u8c50\u5bcc \u53ef\u5728\u5f8c\u53f0\u5b8c\u6210\u90e8\u5206\u5206\u6790","title":"Survey Cake"},{"location":"essay/questionnaire-principal/#_24","text":"\u8ffd\u6c42\u826f\u597d\u9ad4\u9a57 \u6700\u9ad8\u5ea6\u7684\u5ba2\u5236\u9ad4\u9a57 \u554f\u5377\u7d50\u679c\u9032\u884c\u62bd\u734e","title":"\u4f7f\u7528\u5834\u666f"},{"location":"essay/questionnaire-principal/#_25","text":"\u904b\u884c\u901f\u5ea6\u6162","title":"\u7f3a\u9ede"},{"location":"essay/questionnaire-principal/#hotjar","text":"\u6709\u514d\u8cbb\u7248 \u63d2\u5165\u7db2\u9801 \u5f62\u5f0f\u5c0e\u81f4\u984c\u6578\u6709\u56b4\u683c\u9650\u5236","title":"Hotjar"},{"location":"essay/questionnaire-principal/#_26","text":"\u7b2c\u4e00\u5370\u8c61\u3001\u5230\u7ad9\u539f\u56e0 \u907f\u514d\u8a55\u4f30\u529f\u80fd\u984c","title":"\u4f7f\u7528\u5834\u666f"},{"location":"essay/questionnaire-principal/#_27","text":"\u5c0d\u7528\u6236\u5e72\u64fe\u7387\u9ad8 \u53ea\u80fd\u6975\u77ed\u554f\u5377 \u53ea\u80fd\u9472\u5d4c\u5728\u7db2\u9801\u800c\u975e APP","title":"\u7f3a\u9ede"},{"location":"essay/questionnaire-principal/#_28","text":"Typeform \u826f\u597d\u4f7f\u7528\u8005\u9ad4\u9a57 \u6709\u904e\u500b\u8cc7\u5916\u6d29\u7684\u7d93\u9a57 SurveyMonkey \u50c5\u6b21\u65bc Google \u7684\u5927\u578b\u554f\u5377\u670d\u52d9 \u8a08\u7b97\u6a5f Qualtrics \u586b\u7b54\u9ad4\u9a57\u4f73 \u5f8c\u53f0\u50c5\u6709\u82f1\u6587","title":"\u5728\u53f0\u7063\u975e\u4e3b\u6d41"},{"location":"essay/questionnaire-principal/#_29","text":"graph LR subgraph one[\u521d\u6b65\u968e\u6bb5] \u8a0e\u8ad6 --> \u8349\u7a3f \u8349\u7a3f --> \u8a0e\u8ad6 end \u8a0e\u8ad6 --> \u7dda\u4e0a\u7248\u672c \u7dda\u4e0a\u7248\u672c --> \u767c\u9001","title":"\u88fd\u4f5c\u6d41\u7a0b"},{"location":"essay/questionnaire-principal/#_30","text":"\u5229\u7528 spreadsheet \u3001 excel \u7b49\u5de5\u5177\u505a\u8349\u7a3f\uff0c\u65b9\u4fbf\u8a18\u9304\u4fee\u6539\u904e\u7a0b\u548c\u505a\u7559\u8a00\u3002","title":"\u8349\u7a3f\u5de5\u5177"},{"location":"essay/questionnaire-principal/#_31","text":"\u628a\u6b77\u4f86\u7684\u984c\u76ee\u3001\u9078\u9805\u5404\u4e00\u9801\uff0c\u65b9\u4fbf\u8a2d\u8a08\u65b0\u7684\u554f\u5377","title":"\u8a18\u9304\u4fdd\u5b58"},{"location":"essay/questionnaire-principal/#_32","text":"\u6587\u6848\u5beb\u4f5c\uff0c\u6309\u7167\u65cf\u7fa4\u6027\u8cea\u8abf\u6574\u3002","title":"\u6587\u6848"},{"location":"essay/questionnaire-principal/#_33","text":"\u4e0d\u50c5\u8981\u8ffd\u8e64\u554f\u5377\u767c\u9001\u6578\u91cf\uff0c\u4e5f\u8981\u770b\u8f49\u63db\u7387 \u907f\u514d\u53ef\u4ee5\u900f\u904e\u8cc7\u6599\u4ea4\u53c9\u6bd4\u5c0d\u51fa\u4e00\u500b\u4eba\uff0c\u4fdd\u8b77\u586b\u7b54\u8005\u7684\u96b1\u79c1 \u82e5\u586b\u7b54\u8005\u4e0d\u5e0c\u671b\u7559\u4e0b\u500b\u8cc7\uff0c\u8981\u53ef\u4ee5\u522a\u9664\u8a72\u7d00\u9304","title":"\u554f\u5377\u5206\u6790"},{"location":"essay/questionnaire-principal/#_34","text":"\u5169\u500b\u8b8a\u9805\u5f7c\u6b64\u4ea4\u53c9\uff0c\u89c0\u5bdf\u8da8\u52e2\u548c\u5dee\u7570 Excel \u7684 \u6a1e\u7d10\u5206\u6790","title":"\u4ea4\u53c9\u5206\u6790"},{"location":"essay/questionnaire-principal/#_35","text":"\u7528\u6236\u6a23\u8c8c Profile \u5713\u9905\u5716 \u9577\u689d\u5716 \u8981\u6ce8\u610f\u62bd\u6a23\u8aa4\u5dee Margin of Error https://cyber-edge.com/determining-minimum-survey-sample-sizes-based-on-survey-margin-of-error/","title":"\u5831\u544a\u65b9\u5f0f"},{"location":"essay/architecture/made-container/","text":"\u5982\u4f55\u88fd\u4f5c Docker Container \u5efa\u7acb container \u524d\uff0c\u9700\u8981\u5148\u5efa\u7acb image\uff0c\u7136\u800c\u9019\u6b65\u9a5f\u6703\u548c\u61c9\u7528\u7a0b\u5f0f\u7684\u9700\u6c42\u800c\u6709\u5f88\u5927\u7684\u4e0d\u540c\uff0c\u5728\u6b64\u8b39\u6982\u7565\u4ecb\u7d39\u4ee5 Node.js \u70ba\u80cc\u666f\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 \u88fd\u4f5c image \u5206\u70ba\u4e09\u500b\u6b65\u9a5f\uff1a \u6e96\u5099\u597d\u61c9\u7528\u7a0b\u5f0f\u7684\u76f8\u4f9d\u5957\u4ef6 \u6e96\u5099\u597d\u57f7\u884c\u61c9\u7528\u7a0b\u5f0f\u7684\u74b0\u5883 \u57f7\u884c\u61c9\u7528\u7a0b\u5f0f \u6e96\u5099\u597d\u61c9\u7528\u7a0b\u5f0f\u7684\u76f8\u4f9d\u5957\u4ef6 \u4ee5 Node.js \u70ba\u4f8b\uff0c\u5247\u662f npm i \u6216\u66f4\u7cbe\u7c21\u7684 npm ci --only=production \u3002 \u5176\u4ed6\u5982\uff1a PHP \u7684 composer install --no-dev --optimize-autoloader Python \u7684 pip install Gradle \u7684 bundle install --clean --without dev Dockerfile \u662f Docker \u7528\u4f86\u5efa\u7acb image \u7684\u6307\u4ee4\u8868\uff0c\u985e\u4f3c Makefile\u3002 \u4ee5\u4e0b\u70ba Node.js \u5efa\u7acb\u76f8\u4f9d\u5957\u4ef6\u7684\u6307\u4ee4\u8868\uff1a FROM node:lts-alpine AS deps # Change current folder to /srv WORKDIR /srv COPY package*.json ./ RUN npm ci --only = production \u4e0a\u8ff0\u6bcf\u4e00\u884c\u90fd\u4ee3\u8868\u4e00\u500b Layer\uff0c\u800c\u6bcf\u4e00\u6b21\u547c\u53eb FROM \uff0c\u5373\u4ee3\u8868\u5efa\u7acb\u4e00\u7d44 Stage\u3002 \u5728 Docker \u7684 Best Practice \u4e2d\u6703\u5efa\u8b70\u4f7f\u7528\u8d8a\u5c11 command \u8d8a\u597d\u5c31\u662f\u907f\u514d\u904e\u5927\u7684 layer \u6e96\u5099\u597d\u57f7\u884c\u61c9\u7528\u7a0b\u5f0f\u7684\u74b0\u5883 \u5728\u57f7\u884c\u74b0\u5883\u4e2d\uff0c\u4e0d\u9700\u8981\u4e00\u4e9b Node.js \u7684\u7279\u5b9a\u529f\u80fd\uff0c\u5982 npm \u3002 FROM node:lts-slim AS release \u9664\u6b64\u4e4b\u5916\u4e5f\u53ef\u4ee5\u5728 Alpine \u74b0\u5883\u4e0b\u5efa\u7acb\u6975\u7c21\u7684 Node.js\uff0c\u8a73\u898b \u5be6\u4f5c\u7684\u7a0b\u5f0f\u78bc \u3002 \u6982\u5ff5\u5c31\u662f\u4e0b\u8f09 curl \uff08Alpine \u7121 curl \uff09\u518d\u4e0b\u8f09 Node.js \u5f8c\u522a\u9664\u4e0d\u5fc5\u8981\u6a94\u6848 \u66f4\u5b8c\u6574\u5167\u5bb9\u8a73\u898b Node.js \u63d0\u4f9b\u7684\u5efa\u7acb image \u7684 \u6700\u4f73\u505a\u6cd5\u6307\u5f15 \u518d\u4f86\u5c31\u5269\u628a\u525b\u525b\u5728 deps \u74b0\u5883\u4e2d\u5efa\u7acb\u7684\u76f8\u4f9d\u5957\u4ef6\u62c9\u904e\u4f86\uff1a COPY --from = deps /srv/node_modules ./node_modules COPY . . \u8b66\u544a\uff1a COPY . . \u4ee3\u8868\u6703\u628a\u73fe\u5728\u672c\u5730\u7aef\u8cc7\u6599\u593e\u4e2d\u7684\u6240\u6709\u6a94\u6848\u8907\u88fd\u6b64 image \u4e2d\u3002 \u70ba\u4e86\u907f\u514d\u4e0d\u5fc5\u8981\u6a94\u6848\u88ab\u8907\u88fd\uff0c\u53ef\u65bc .dockerignore \u4e2d\u8a2d\u5b9a .dockerignore \u7bc4\u4f8b\uff1a node_modules npm-debug.log Dockerfile .git .gitignore .eslintrc \u57f7\u884c\u61c9\u7528\u7a0b\u5f0f \u518d\u4f86\u5c31\u5269\u6e96\u5099\u8a2d\u5b9a\u6a94\u548c\u57f7\u884c\u7a0b\u5f0f\u4e86\uff1a EXPOSE 1337 ENV HOST 0 .0.0.0 ENV PORT 1337 CMD [ \"node\" , \"server.js\" \u5305\u88dd\u6210 Container docker build -t example/server:v0.0.1 . \u9019\u6642\u5c31\u53ef\u4ee5\u770b\u5230\u5404\u500b layer \u88ab\u57f7\u884c\u7684\u904e\u7a0b\u3002 Sending build context to Docker daemon 155.6kB Step 1/11 : FROM node:lts-alpine AS deps ---> 532fd65ecacd ... TRUNCATED ... Step 11/11 : CMD [ \"node\", \"server.js\" ] ---> Running in d7bde6cfc4dc Removing intermediate container d7bde6cfc4dc ---> a99750d85d81 Successfully built a99750d85d81 \u66f4\u65b0 Docker Image \u5728\u5efa\u7acb\u6642\uff0c\u6703\u900f\u904e SHA \u503c\u9032\u884c\u66ab\u5b58\uff0c\u6240\u4ee5\u7576\u6709\u90e8\u5206\u6539\u52d5\u7684\u6642\u5019\u5c31\u4e0d\u9700\u8981\u5168\u90e8\u91cd\u65b0\u5efa\u7acb\u3002 SHA \u503c\u8a08\u7b97\u65b9\u5f0f\u662f\u4e0a\u4e00\u500b SHA \u503c\u52a0\u4e0a\u73fe\u884c\u7684\u6307\u4ee4\u7d44\u51fa\u4f86\u7684\u3002 \u4e5f\u5c31\u662f\u8aaa\uff0c\u82e5\u6539\u52d5\u7684\u50c5\u6709\u61c9\u7528\u7a0b\u5f0f\u7684\u7a0b\u5f0f\u78bc\uff0c\u5982 server.js \uff0c\u5728\u91cd\u5efa image \u6642\u5c31\u50c5\u9700\u8981\u57f7\u884c COPY . . \u4ee5\u5f8c\u7684\u4ee3\u78bc\u3002 \u76f8\u5c0d\u7684\uff0c\u7576 package.json \u6539\u8b8a\u6642\uff08\u5982 dependency \u589e\u52a0\uff09\u5c31\u9700\u8981\u5f9e deps \u9019\u5c64 stage \u958b\u59cb\u5efa\u7acb\u8d77\u3002 \u7bc4\u4f8b \u900f\u904e docker history example/server:v0.0.1 \u53ef\u4ee5\u89c0\u770b\u5176\u5efa\u7acb\u6642\u7684\u8a18\u61b6\u9ad4\u7528\u91cf\u3002 v0.0.1 \u4ee3\u8868\u521d\u59cb\u7248\u672c v0.0.2 \u4ee3\u8868\u4fee\u6b63 server.js v0.0.3 \u4ee3\u8868\u65b0\u589e\u5957\u4ef6 Layer Size v0.0.1 v0.0.2 v0.0.3 1: FROM node AS deps N/A 532fd65ecacd 532fd65ecacd 532fd65ecacd 2: WORKDIR /srv N/A bec6e0fc4a96 bec6e0fc4a96 bec6e0fc4a96 3: COPY package* N/A 58341ced6003 58341ced6003 959c7f2c693b 4: RUN npm ci N/A dd6cd3c5a283 dd6cd3c5a283 6e9065bacad0 5: FROM node:lts-slim AS release 5.6MB e7d92cdc71fe e7d92cdc71fe e7d92cdc71fe 6: COPY node_modules 67.8MB a86f6f94fc75 a86f6f94fc75 b97b002f4734 7: COPY . . 138kB cab24763e869 7f6f49f5bc16 f2c9ac237a1c 8: EXPOSE 0 0efe3d9cd543 4fc6b68804c9 f4b64a1c5e64 9: ENV HOST 0 9104495370ba df073bd1c682 fee5ff92855c 10: ENV PORT 0 04d6b8f0afce f67d0897cb11 638a7ff0c240 11: CMD 0 b3babfadde8e 9b6514336e72 12d0c7e37935 Cost per Deploy N/A 0 138kB 68MB","title":"\u5982\u4f55\u88fd\u4f5c Docker Container"},{"location":"essay/architecture/made-container/#docker-container","text":"\u5efa\u7acb container \u524d\uff0c\u9700\u8981\u5148\u5efa\u7acb image\uff0c\u7136\u800c\u9019\u6b65\u9a5f\u6703\u548c\u61c9\u7528\u7a0b\u5f0f\u7684\u9700\u6c42\u800c\u6709\u5f88\u5927\u7684\u4e0d\u540c\uff0c\u5728\u6b64\u8b39\u6982\u7565\u4ecb\u7d39\u4ee5 Node.js \u70ba\u80cc\u666f\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 \u88fd\u4f5c image \u5206\u70ba\u4e09\u500b\u6b65\u9a5f\uff1a \u6e96\u5099\u597d\u61c9\u7528\u7a0b\u5f0f\u7684\u76f8\u4f9d\u5957\u4ef6 \u6e96\u5099\u597d\u57f7\u884c\u61c9\u7528\u7a0b\u5f0f\u7684\u74b0\u5883 \u57f7\u884c\u61c9\u7528\u7a0b\u5f0f","title":"\u5982\u4f55\u88fd\u4f5c Docker Container"},{"location":"essay/architecture/made-container/#_1","text":"\u4ee5 Node.js \u70ba\u4f8b\uff0c\u5247\u662f npm i \u6216\u66f4\u7cbe\u7c21\u7684 npm ci --only=production \u3002 \u5176\u4ed6\u5982\uff1a PHP \u7684 composer install --no-dev --optimize-autoloader Python \u7684 pip install Gradle \u7684 bundle install --clean --without dev Dockerfile \u662f Docker \u7528\u4f86\u5efa\u7acb image \u7684\u6307\u4ee4\u8868\uff0c\u985e\u4f3c Makefile\u3002 \u4ee5\u4e0b\u70ba Node.js \u5efa\u7acb\u76f8\u4f9d\u5957\u4ef6\u7684\u6307\u4ee4\u8868\uff1a FROM node:lts-alpine AS deps # Change current folder to /srv WORKDIR /srv COPY package*.json ./ RUN npm ci --only = production \u4e0a\u8ff0\u6bcf\u4e00\u884c\u90fd\u4ee3\u8868\u4e00\u500b Layer\uff0c\u800c\u6bcf\u4e00\u6b21\u547c\u53eb FROM \uff0c\u5373\u4ee3\u8868\u5efa\u7acb\u4e00\u7d44 Stage\u3002 \u5728 Docker \u7684 Best Practice \u4e2d\u6703\u5efa\u8b70\u4f7f\u7528\u8d8a\u5c11 command \u8d8a\u597d\u5c31\u662f\u907f\u514d\u904e\u5927\u7684 layer","title":"\u6e96\u5099\u597d\u61c9\u7528\u7a0b\u5f0f\u7684\u76f8\u4f9d\u5957\u4ef6"},{"location":"essay/architecture/made-container/#_2","text":"\u5728\u57f7\u884c\u74b0\u5883\u4e2d\uff0c\u4e0d\u9700\u8981\u4e00\u4e9b Node.js \u7684\u7279\u5b9a\u529f\u80fd\uff0c\u5982 npm \u3002 FROM node:lts-slim AS release \u9664\u6b64\u4e4b\u5916\u4e5f\u53ef\u4ee5\u5728 Alpine \u74b0\u5883\u4e0b\u5efa\u7acb\u6975\u7c21\u7684 Node.js\uff0c\u8a73\u898b \u5be6\u4f5c\u7684\u7a0b\u5f0f\u78bc \u3002 \u6982\u5ff5\u5c31\u662f\u4e0b\u8f09 curl \uff08Alpine \u7121 curl \uff09\u518d\u4e0b\u8f09 Node.js \u5f8c\u522a\u9664\u4e0d\u5fc5\u8981\u6a94\u6848 \u66f4\u5b8c\u6574\u5167\u5bb9\u8a73\u898b Node.js \u63d0\u4f9b\u7684\u5efa\u7acb image \u7684 \u6700\u4f73\u505a\u6cd5\u6307\u5f15 \u518d\u4f86\u5c31\u5269\u628a\u525b\u525b\u5728 deps \u74b0\u5883\u4e2d\u5efa\u7acb\u7684\u76f8\u4f9d\u5957\u4ef6\u62c9\u904e\u4f86\uff1a COPY --from = deps /srv/node_modules ./node_modules COPY . . \u8b66\u544a\uff1a COPY . . \u4ee3\u8868\u6703\u628a\u73fe\u5728\u672c\u5730\u7aef\u8cc7\u6599\u593e\u4e2d\u7684\u6240\u6709\u6a94\u6848\u8907\u88fd\u6b64 image \u4e2d\u3002 \u70ba\u4e86\u907f\u514d\u4e0d\u5fc5\u8981\u6a94\u6848\u88ab\u8907\u88fd\uff0c\u53ef\u65bc .dockerignore \u4e2d\u8a2d\u5b9a .dockerignore \u7bc4\u4f8b\uff1a node_modules npm-debug.log Dockerfile .git .gitignore .eslintrc","title":"\u6e96\u5099\u597d\u57f7\u884c\u61c9\u7528\u7a0b\u5f0f\u7684\u74b0\u5883"},{"location":"essay/architecture/made-container/#_3","text":"\u518d\u4f86\u5c31\u5269\u6e96\u5099\u8a2d\u5b9a\u6a94\u548c\u57f7\u884c\u7a0b\u5f0f\u4e86\uff1a EXPOSE 1337 ENV HOST 0 .0.0.0 ENV PORT 1337 CMD [ \"node\" , \"server.js\"","title":"\u57f7\u884c\u61c9\u7528\u7a0b\u5f0f"},{"location":"essay/architecture/made-container/#container","text":"docker build -t example/server:v0.0.1 . \u9019\u6642\u5c31\u53ef\u4ee5\u770b\u5230\u5404\u500b layer \u88ab\u57f7\u884c\u7684\u904e\u7a0b\u3002 Sending build context to Docker daemon 155.6kB Step 1/11 : FROM node:lts-alpine AS deps ---> 532fd65ecacd ... TRUNCATED ... Step 11/11 : CMD [ \"node\", \"server.js\" ] ---> Running in d7bde6cfc4dc Removing intermediate container d7bde6cfc4dc ---> a99750d85d81 Successfully built a99750d85d81","title":"\u5305\u88dd\u6210 Container"},{"location":"essay/architecture/made-container/#_4","text":"Docker Image \u5728\u5efa\u7acb\u6642\uff0c\u6703\u900f\u904e SHA \u503c\u9032\u884c\u66ab\u5b58\uff0c\u6240\u4ee5\u7576\u6709\u90e8\u5206\u6539\u52d5\u7684\u6642\u5019\u5c31\u4e0d\u9700\u8981\u5168\u90e8\u91cd\u65b0\u5efa\u7acb\u3002 SHA \u503c\u8a08\u7b97\u65b9\u5f0f\u662f\u4e0a\u4e00\u500b SHA \u503c\u52a0\u4e0a\u73fe\u884c\u7684\u6307\u4ee4\u7d44\u51fa\u4f86\u7684\u3002 \u4e5f\u5c31\u662f\u8aaa\uff0c\u82e5\u6539\u52d5\u7684\u50c5\u6709\u61c9\u7528\u7a0b\u5f0f\u7684\u7a0b\u5f0f\u78bc\uff0c\u5982 server.js \uff0c\u5728\u91cd\u5efa image \u6642\u5c31\u50c5\u9700\u8981\u57f7\u884c COPY . . \u4ee5\u5f8c\u7684\u4ee3\u78bc\u3002 \u76f8\u5c0d\u7684\uff0c\u7576 package.json \u6539\u8b8a\u6642\uff08\u5982 dependency \u589e\u52a0\uff09\u5c31\u9700\u8981\u5f9e deps \u9019\u5c64 stage \u958b\u59cb\u5efa\u7acb\u8d77\u3002","title":"\u66f4\u65b0"},{"location":"essay/architecture/made-container/#_5","text":"\u900f\u904e docker history example/server:v0.0.1 \u53ef\u4ee5\u89c0\u770b\u5176\u5efa\u7acb\u6642\u7684\u8a18\u61b6\u9ad4\u7528\u91cf\u3002 v0.0.1 \u4ee3\u8868\u521d\u59cb\u7248\u672c v0.0.2 \u4ee3\u8868\u4fee\u6b63 server.js v0.0.3 \u4ee3\u8868\u65b0\u589e\u5957\u4ef6 Layer Size v0.0.1 v0.0.2 v0.0.3 1: FROM node AS deps N/A 532fd65ecacd 532fd65ecacd 532fd65ecacd 2: WORKDIR /srv N/A bec6e0fc4a96 bec6e0fc4a96 bec6e0fc4a96 3: COPY package* N/A 58341ced6003 58341ced6003 959c7f2c693b 4: RUN npm ci N/A dd6cd3c5a283 dd6cd3c5a283 6e9065bacad0 5: FROM node:lts-slim AS release 5.6MB e7d92cdc71fe e7d92cdc71fe e7d92cdc71fe 6: COPY node_modules 67.8MB a86f6f94fc75 a86f6f94fc75 b97b002f4734 7: COPY . . 138kB cab24763e869 7f6f49f5bc16 f2c9ac237a1c 8: EXPOSE 0 0efe3d9cd543 4fc6b68804c9 f4b64a1c5e64 9: ENV HOST 0 9104495370ba df073bd1c682 fee5ff92855c 10: ENV PORT 0 04d6b8f0afce f67d0897cb11 638a7ff0c240 11: CMD 0 b3babfadde8e 9b6514336e72 12d0c7e37935 Cost per Deploy N/A 0 138kB 68MB","title":"\u7bc4\u4f8b"},{"location":"essay/architecture/pki-checklist/","text":"\u5efa\u7f6e PKI \u6ce8\u610f\u4e8b\u9805 \u672c\u8cc7\u6599\u4f86\u6e90\u65bc NIST 800-32 Ct.3 Certification Path Building Key Rollover in the Resource Public Key Infrastructure X.509 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 IDC \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 Root \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u25b2\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 HTTP \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 HTTP \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502 \u2502 \u2502 \u2502 \u2502Intermediate\u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u25ba \u25c4\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 HTTP \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u25b2\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u25bc\u2500\u2500\u2500\u2510 \u250c\u2500\u25bc\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u25bc\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u25ba AES \u25c4\u2500\u2500\u2500\u2510 \u2502 EE \u2502 \u2502 EE \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u25b2\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 HTTPS\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2510 \u2514\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2534\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2534\u2500\u2500\u2510 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2524 API \u2502 \u2502 Service \u2502 \u2502 APP \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u53ef\u80fd\u9700\u8981\u6e9d\u901a\u7684\u539f\u56e0\uff1a \u521d\u59cb\u8a3b\u518a/\u8a8d\u8b49 \u91d1\u9470\u5c0d\u66f4\u65b0 \u6191\u8b49\u66f4\u65b0 NIST \u540d\u8a5e\u4ecb\u7d39 CA \u7c3d\u7f72\u7c3d\u8b49\u7d66 user\uff0c\u6b64\u6642 CA \u662f issuer\u3002 CA \u6703\u628a\u9a57\u8b49 user \u7684\u8cc7\u8a0a\u4e1f\u7d66 Registration Authority(RA)\uff0c\u4f8b\u5982\uff1aDNS \u4f7f\u7528 CA \u7c3d\u51fa\u4f86\u7684\u7c3d\u8b49\uff0c\u4e26\u4ee5\u6b64\u4f86\u4fe1\u4efb user \u7684\u7b2c\u4e09\u65b9\u7a31\u70ba relying parties certificate policy \u5b9a\u7fa9\u7c3d\u8b49\u7684\u653f\u7b56\uff0c\u4f8b\u5982\u8a72\u7528\u4ec0\u9ebc\u91d1\u9470\u7a2e\u985e\u3001\u9577\u5ea6\u3002\u80fd\u505a\u5230\u6aa2\u67e5\u7684\u6b65\u9a5f\uff0c\u5be6\u52d9\u4e0a\u50c5\u6709\u7c3d\u767c\u6642\u4f5c\u6aa2\u67e5\uff0c\u7136\u5f8c\u518d\u628a\u8cc7\u8a0a\u653e\u5728\u7c3d\u8b49\u4e0a\u3002 correctly configuring root certificate stores is a critical step in key management. X.509 \u6703\u653e user name issuer name public key signature validity (starting and expiring times) cryptographic algorithm(s) \u548c\u5176\u4ed6 Private \u7684 extension \u9a57\u8b49\u904e\u7a0b Cross certificates\uff0c\u5c31\u7b97\u662f root CA( trust anchors )\u4e5f\u53ef\u80fd\u6703\u9700\u8981\u5176\u4ed6\u540c\u6a23\u662f root CA \u7684\u7c3d\u8b49\u3002 certification path\uff0crelying party \u5f9e user \u5230 trust anchors \u7684\u9a57\u8b49\u6d41\u7a0b \u9a57\u8b49\u904e\u7a0b\u4e2d\u7684\u6bcf\u4e00\u6bb5\u90fd\u9700\u8981\u78ba\u8a8d\uff08path validation\uff09\uff1a \u7c3d\u8b49\u9a57\u8b49 \u7c3d\u8b49\u6c92\u88ab\u64a4\u92b7 \u88ab\u6b63\u78ba\u7684\u653f\u7b56 issue \u7c3d\u8b49\u7684\u72c0\u614b\u5c55\u793a\uff08\u7c3d\u8b49\u6c92\u88ab\u64a4\u92b7\uff09\u65b9\u5f0f\u6709\u5169\u7a2e\uff1a Online Certificate Status Protocol (OCSP) certificate revocation list, or CRL \u82e5\u4e00\u958b\u59cb\u662f\u4f7f\u7528 key establishment \u505a\u7c3d\u8b49\uff0c\u8981\u53ef\u4ee5\u505a\u91d1\u9470\u7684\u56de\u5fa9\u3002 Procurement Guidance \u6311\u9078 CA \u7522\u54c1\u7684 check list\u3002 CA/RA Software and Hardware: [ ] \u78ba\u4fdd\u652f\u63f4\u4efb\u4e00\u5354\u5b9a\uff1a Certificate Management Protocol (CMP) RFC 4210 Enrollment over Secure Transport (EST) RFC 7030 Certificate Management Using Cryptographic Message Syntax (CMC) RFC 5272 [ ] \u78ba\u4fdd\u53ef\u4ee5\u7522\u751f\u6191\u8b49\uff0c\u5176\u4e2d\u61c9\u542b\u6709\u7684\u8cc7\u8a0a\u65bc\u5f8c\u8a0e\u8ad6\u4e4b\u3002 [ ] \u53ef\u4ee5\u7522\u751f\u591a\u7d44\u6191\u8b49\uff0c\u4e14\u5141\u8a31\u7279\u5b9a\u91d1\u9470\u7a2e\u985e\u3002 [ ] \u5141\u8a31 CRL\u3002 [ ] \u5141\u8a31\u5916\u90e8\u9023\u7d50 CRL\uff0c\u4e14\u5fc5\u9808\u542b\u6709 HTTP URLS\u3002 [ ] \u61c9\u53ef\u4ee5\u900f\u904e LDPA \u53d6\u5f97 CRL\u3002 [ ] \u5141\u8a31 OCSP\u3002 [ ] \u6bcf\u7d44 PKI \u90fd\u6709\u5176\u6191\u8b49\u8cc7\u8a0a\uff0c\u4e14\u8cc7\u8a0a\u80fd\u88ab\u986f\u793a\u65bc\u5176\u7c3d\u7f72\u7684\u7c3d\u8b49 CRL\u3002 [ ] \u5141\u8a31\u8a2d\u5b9a\u5ba2\u5236\u76f8\u95dc\u8cc7\u8a0a\u65bc\u6191\u8b49\u4e2d\u3002 [ ] \u5141\u8a31\u4f7f\u7528 RSA \u548c ECDSA \u6f14\u7b97\u6cd5\u3002 [ ] \u53ef\u4ee5\u5099\u4efd\u4e26\u707d\u96e3\u5fa9\u539f\u3002 [ ] \u5141\u8a31\u6b0a\u9650\u5728\u5e33\u865f\u4e4b\u9593\u7684\u8f49\u79fb\u3002 OCSP Responders: [ ] \u78ba\u4fdd OCSP responders \u7b26\u5408 RFC 6960 Online Certificate Status Protocol \u3002 [ ] \u78ba\u4fdd\u80fd\u8655\u7406\u6709\u7121\u7c3d\u7ae0\u548c\u540d\u7a31\u7684\u8acb\u6c42\uff0c\u5c31\u7b97\u662f\u62d2\u7d55\u4e5f\u9808\u56de\u61c9\u3002 [ ] \u56de\u61c9\u6642\u6c92\u6709\u4efb\u4f55\u65bc RFC 5019 \u4e2d\u63d0\u53ca\u7684\u932f\u8aa4 [ ] \u56de\u61c9\u6642\u7684\u7c3d\u7ae0\u5efa\u8b70\u7b26\u5408\u548c\u5176\u7522\u751f\u7684\u6191\u8b49\u7684\u6f14\u7b97\u6cd5\u76f8\u540c\uff0c\u91d1\u9470\u683c\u5f0f\u4e5f\u5efa\u8b70\u4e00\u6a23\u3002\u5141\u8a31\u4f7f\u7528 RSA \u548c ECDSA \u6f14\u7b97\u6cd5\u3002 \u52a0\u5bc6\u6a21\u7d44 [ ] CAs\u3001Key Recovery Servers \u548c OCSP responders \u9ad8\u65bc FIPS 140-2 \u7b49\u7d1a 3\u3002 [ ] RAs \u9700\u9ad8\u65bc FIPS 140-2 \u7b49\u7d1a 2\u3002 [ ] \u78ba\u4fdd\u8acb\u6c42\u7c3d\u8b49\u7684\u55ae\u4f4d\u548c\u4f7f\u7528\u8005\u7684\u52a0\u5bc6\u6a21\u7d44\u9ad8\u65bc FIPS 140-2 \u7b49\u7d1a 1\u3002 Key Recovery Servers [ ] \u5982\u679c PKI \u652f\u63f4\u91d1\u9470\u7522\u751f\uff0c\u5c31\u61c9\u652f\u63f4\u91d1\u9470\u6551\u63f4\u670d\u52d9\u3002 [ ] \u61c9\u652f\u63f4\u81ea\u52d5\u5316\u7684\u91d1\u9470\u6551\u63f4\u670d\u52d9\u3002 Relying Party Software [ ] \u8def\u7a0b\u9a57\u8b49\uff08path validation\uff09 [ ] \u78ba\u4fdd\u7b26\u5408 RFC 5280 conformant path validation \u3002 [ ] \u5141\u8a31\u7d44\u7e54\u5916\u7684\u9a57\u8b49\uff08\u4f8b\u5982\u900f\u904e federal agency\uff09\u4e14\u9700\u7b26\u5408 NIST \u5efa\u8b70\u7684\u9a57\u8b49\u65b9\u5f0f \u3002 [ ] \u5141\u8a31\u6709 Bridge \u7684\u8def\u5f91\uff0c\u4e14\u9700\u7b26\u5408 NIST \u5efa\u8b70\u7684\u9a57\u8b49\u65b9\u5f0f \u3002 [ ] \u61c9\u8a72\u540c\u6642\u652f\u63f4 CRLs \u548c OCSP\u3002 \u9a57\u8b49\u6191\u8b49 [ ] \u78ba\u4fdd\u53ef\u4ee5\u5efa\u7acb\u9a57\u8b49\u7684\u8def\u5f91 [ ] \u81f3\u5c11\u8981\u80fd\u8655\u7406 HTTP-based \u7684\u56de\u61c9 [ ] \u61c9\u8981\u80fd\u8655\u7406 LDAP \u7684\u5354\u5b9a [ ] \u4f5c\u7528\u65bc\u4f01\u696d\u7aef PKI \u7684 RP \u61c9\u80fd\u767c\u73fe\u8def\u5f91\u4e0a\u53d7 trust anchor CA \u8a8d\u8b49\u7684\u968e\u5c64\u5f0f CA\u3002 [ ] \u975e\u4f01\u696d\u7aef PKI \u7684 RP \u61c9\u80fd\u767c\u73fe\u8def\u5f91\u4e0a\u975e\u968e\u5c64\u5f0f\u7684 CA\u3002 Client Software [ ] \u5ba2\u6236\u7aef\u5141\u8a31\u591a\u500b\u516c\u79c1\u9470\u8acb\u6c42\u591a\u500b\u7c3d\u8b49 [ ] \u52a0\u5bc6\u6a21\u7d44\u9ad8\u65bc FIPS 140-2 \u7b49\u7d1a 1 [ ] \u5ba2\u6236\u61c9\u53ef\u4f7f\u7528 CA \u63d0\u4f9b\u7684 certificate management protocol \u7d66 PKI \u7ba1\u7406\u8005\u7684\u5efa\u8b70 \u7ba1\u7406\u8005\u61c9\u78ba\u4fdd\u4f7f\u7528\u7aef\u7684\u4eba\u63a5\u53d7\u5fc5\u8981\u8a13\u7df4\u548c\u516c\u53f8\u5b89\u5168\u653f\u7b56\u88ab\u57f7\u884c\u3002 Certificate Issuance [ ] \u78ba\u4fdd CAs \u8a2d\u5b9a\u597d\u53ef\u63a5\u53d7\u7684\u516c\u79c1\u9470\u6f14\u7b97\u6cd5\u548c\u91d1\u9470\u9577\u5ea6\uff0c\u9084\u6709\u9a57\u8b49 domain [ ] \u70ba\u4e86\u6700\u5927\u5316\u6a19\u6e96\u6027\uff0c\u61c9\u4f7f\u7528 RSA \u53bb\u505a\u7c3d\u7ae0\u548c\u91d1\u9470\u8f49\u79fb [ ] \u70ba\u4e86\u6700\u5927\u5316\u5b89\u5168\u6027\u548c\u6548\u7387\uff0c\u61c9\u4f7f\u7528 EC \u53bb\u505a\u7c3d\u7ae0\u548c\u91d1\u9470\u8f49\u79fb [ ] \u7576\u7c3d\u767c\u7c3d\u8b49\u6216 CRLs \u6642\uff0c\u61c9\u7b26\u5408\u6f14\u7b97\u6cd5\u3001\u9577\u5ea6\u7684\u898f\u7bc4 [ ] \u5229\u7528 subject key \u7522\u751f signing key \u6642\uff0c\u7c3d\u8b49\u7684\u5b89\u5168\u6027\u61c9\u5927\u65bc subject key \u53bb\u7c3d\u8b49 \u7522\u751f\u91d1\u9470\u6642\uff1a [ ] \u4f7f\u7528\u8005\u61c9\u7522\u751f\u5c6c\u65bc\u4ed6\u5011\u81ea\u5df1\u7684\u7c3d\u8b49\u91d1\u9470 [ ] \u82e5\u4e0a PKI \u900f\u904e\u91d1\u9470\u50b3\u9001\u65b9\u5f0f\u53bb\u50b3\u9001\u91d1\u9470\uff0c\u61c9\u63d0\u4f9b\u91d1\u9470\u5fa9\u539f\u670d\u52d9 [ ] CAs \u8981\u78ba\u4fdd\u91d1\u9470\u771f\u7684\u5c6c\u65bc\u4f7f\u7528\u8005\uff08PoP\uff09 [ ] \u61c9\u5728\u7c3d\u8b49\u524d\u5148\u9a57\u8b49\u91d1\u9470 Key usage extension [ ] \u7c3d\u8b49\u61c9\u5305\u542b key-ussage extension [ ] key-ussage extension \u61c9\u9650\u5236\u4e00\u7a2e\u7372\u53d6\u65b9\u5f0f\uff0c\u4f7f\u7528\u8005\u81ea\u5df1\u7522\u751f\u6216 PKI \u7522\u751f [ ] \u6240\u6709\u7c3d\u8b49\u61c9\u5305\u542b CRLs \u7684\u4f4d\u7f6e\u8cc7\u8a0a [ ] \u82e5\u63d0\u4f9b OCSP responder\uff0c\u61c9\u63d0\u4f9b\u4f4d\u7f6e\u8cc7\u8a0a\u65bc\u7c3d\u8b49\u4e2d [ ] \u5728\u904e\u671f\u524d\u61c9\u91cd\u65b0\u7c3d\u7f72\u5b8c\u6210\uff0c\u4e26\u4e14\u6b63\u78ba\u66f4\u65b0\u6191\u8b49\u8cc7\u8a0a\uff0c\u5982 domain \u6216\u4fe1\u7bb1 Certificate Revocation Requests [ ] \u61c9\u63d0\u4f9b\u81ea\u52d5\u64a4\u92b7\u6a5f\u5236\uff1a [ ] CAs \u61c9\u5728\u64a4\u92b7\u6642\u9032\u884c\u8eab\u4efd\u9a57\u8b49 [ ] \u4f7f\u7528\u8005\u63d0\u4f9b\u8eab\u4efd\u8b49\u660e\u4e26\u8981\u6c42\u64a4\u92b7\u6642\uff0c\u61c9\u5728\u4e0d\u9700\u4eba\u529b\u4ecb\u5165\u4e0b\u57f7\u884c\u3002 [ ] RAs \u61c9\u80fd\u5728\u8a2d\u5b9a\u5f8c\uff0c\u4ee3\u8868\u4f7f\u7528\u8005\u6216\u516c\u53f8\u8acb\u6c42\u7c3d\u8b49\u64a4\u92b7 Certificate Revocation List Generation [ ] \u70ba\u4e86\u6700\u5927\u6a19\u6e96\u5316\uff0cCAs \u61c9\u63d0\u4f9b\u5b8c\u6574\u7684\u64a4\u92b7\u7c3d\u8b49\u65bc CRL \u4e2d [ ] \u82e5\u6709\u5927\u91cf\u7684\u64a4\u92b7\u7c3d\u8b49\uff0c\u53ef\u4ee5\u7522\u751f\u90e8\u5206\u7684 CRL\uff0c\u4f46\u9808\u984d\u5916\u63d0\u4f9b\u5b8c\u6574\u7684 CRL \u4f4d\u7f6e\u8cc7\u8a0a\u3002\u4e00\u4efd CRL \u4e0d\u61c9\u8d85\u904e 250,000 \u7684\u64a4\u92b7\u7c3d\u8b49\u3002 PKI Repositories for the Distribution of Certificates and CRLs [ ] PKIs \u61c9\u80fd\u516c\u958b\u63d0\u4f9b\u7c3d\u8b49\u548c CRL [ ] PKI \u5eab\u61c9\u80fd\u63d0\u4f9b\u8eab\u4efd\u9a57\u8b49\u5f8c\u7684\u7c3d\u8b49\u4f4d\u7f6e\u4fee\u6539\u548c PKI \u5eab\u7684 CRL \u5206\u4f48 [ ] PKI \u5eab\u61c9\u81f3\u5c11\u5141\u8a31 HTTP 1.1 \u6216 LDAP version 3 [ ] \u70ba\u4e86\u6700\u5927\u6a19\u6e96\u5316\uff0c HTTP \u548c LDAP \u90fd\u61c9\u88ab\u7b26\u5408 [ ] HA \u61c9\u88ab\u8003\u616e [ ] PKI \u5eab\u61c9\u5305\u542b\u6240\u6709\u5176\u64c1\u6709\u7684 PKI \u7684\u6240\u6709\u7c3d\u8b49 [ ] PKI \u5eab\u61c9\u5305\u542b\u6240\u6709\u5176\u64c1\u6709\u7684 PKI \u7684 CRL OCSP Responders For federal agencies, detailed configuration guidance for OCSP responders is specified in Draft Guidance for OCSP Responders in the U.S. Federal PKI.17 \u70ba\u4e86\u6700\u5927\u6a19\u6e96\u5316\uff1a [ ] OCSP responders \u4e0d\u61c9\u8981\u6c42\u8acb\u6c42\u8981\u6709\u7c3d\u540d\uff0c\u4e14\u4e0d\u80fd\u9650\u5236\u54ea\u4e9b\u7c3d\u8b49\u72c0\u614b\u662f\u53ef\u4ee5\u88ab\u5141\u8a31\u7684 [ ] \u61c9\u80fd\u56de\u61c9\u57fa\u672c\u7684\u8cc7\u8a0a\uff0c\u4e14\u4e0d\u80fd\u542b\u6709\u5371\u96aa\u7684 extensions \u82e5\u50c5\u9700\u7b26\u5408\u5167\u90e8\u793e\u7fa4\u800c\u975e\u6a19\u6e96\u5316\uff1a [ ] OCSP responders \u53ef\u8981\u6c42\u8acb\u6c42\u8981\u6709\u7c3d\u540d\uff0c\u4e14\u53ef\u62d2\u7d55\u5916\u90e8\u7684\u8acb\u6c42 [ ] OCSP \u7684\u56de\u61c9\u8a0a\u606f\u53ef\u80fd\u542b\u6709\u7279\u6b8a\u7684 extensions Backup and Archive [ ] \u61c9\u8a72\u5099\u4efd\u8cc7\u6599\uff0c\u4e26\u7576\u707d\u96e3\u767c\u751f\u5f8c\u80fd\u91cd\u65b0\u555f\u7528 [ ] CAs \u61c9\u7d00\u9304\u4f55\u6642\u548c\u4f55\u4eba\u7533\u8acb\u7684\u7c3d\u8b49 [ ] \u61c9\u6709 log \u7d00\u9304\u6240\u6709\u7c3d\u8b49\u548c CRL [ ] \u7533\u8acb\u4eba\u7684\u516c\u9470\u61c9\u548c\u5176\u7c3d\u8b49\u4e00\u8d77\u88ab\u4fdd\u5b58 Relying Party Integration and Configuration [ ] \u61c9\u53ef\u4ee5\u767c\u73fe\u8def\u5f91\u548c\u7372\u5f97\u72c0\u614b\u8cc7\u8a0a [ ] \u61c9\u8981\u53ef\u4ee5\u652f\u63f4 CRL \u548c OCSP \u7684\u683c\u5f0f [ ] \u61c9\u80fd\u5206\u8fa8\u6700\u5c0f\u55ae\u4f4d\u7684 trust anchors [ ] \u7576\u60c5\u5883\u8655\u65bc\u300c\u516c\u53f8\u5c0d\u653f\u5e9c\u300d\u6216\u300c\u653f\u5e9c\u5c0d\u653f\u5e9c\u300d\uff0c\u61c9\u4f7f\u7528 Common Policy Root CA \u6216\u548c Common Policy Root CA \u4e92\u76f8\u8a8d\u8b49\u7684 CA \u6216\u4ee5 Federal Bridge \u70ba trust anchor \u7684 CA [ ] \u7576\u60c5\u5883\u5c6c\u65bc\u300c\u4f7f\u7528\u8005\u5c0d\u653f\u5e9c\u300d\uff0c\u61c9\u7528\u7a0b\u5f0f\u7684\u5b89\u5168\u6027\u7121\u6cd5\u505a\u5230\u9ad8\u5ea6\u9650\u5236\uff0c\u70ba\u4e86\u9054\u6210\u9ad8\u6a19\u6e96\u6027\uff0c\u4f7f\u7528\u8005\u53ef\u80fd\u6703\u4f7f\u7528\u7684\u9810\u5148\u5b89\u88dd\u81f3 COTS products \u7684 trust anchors \u8def\u5f91\u9a57\u8b49\uff1a [ ] \u5c0d\u548c\u4f7f\u7528\u8005\u61c9\u7528\u7a0b\u5f0f\u5c0d\u63a5\u7684\u9023\u7dda\uff0c\u8def\u5f91\u9a57\u8b49\u61c9\u88ab\u8a2d\u5b9a\u6210\u53ef\u63a5\u53d7\u6240\u6709\u5408\u6cd5\u8def\u5f91 [ ] \u5c0d\u9700\u8981\u9ad8\u5ea6\u5b89\u5168\u6027\u7684\u7cfb\u7d71\uff0c\u61c9\u88ab\u8a2d\u5b9a\u6210\u50c5\u63a5\u53d7\u7279\u5b9a\u9069\u7576\u7684\u653f\u7b56\u7684\u8def\u5f91 User Guidance (Subscribers) \u5c0d\u65bc\u548c PKI \u7533\u8acb\u6b0a\u8b49\u7684\u4f7f\u7528\u8005\uff1a [ ] \u4f7f\u7528\u8005\u61c9\u7522\u751f\u5c6c\u65bc\u81ea\u5df1\u7684\u91d1\u9470\uff0c\u7528\u4f5c\u7c3d\u8b49\u548c\u8eab\u4efd\u8b49\u660e [ ] \u4f7f\u7528\u8005\u53ef\u80fd\u81ea\u5df1\u7522\u751f\u91d1\u9470\uff0c\u6216\u5f9e\u53ef\u4fe1\u4efb\u7684\u8cc7\u6e90\u53d6\u5f97\u91d1\u9470 [ ] \u4f7f\u7528\u8005\u61c9\u5305\u7ba1\u597d\u79c1\u9470\uff0c\u5305\u62ec\u52a0\u5bc6\u79c1\u9470\u7684 PIN \u78bc\u6216\u5bc6\u78bc [ ] \u4f7f\u7528\u8005\u61c9\u8acb\u6c42\u64a4\u92b7\uff0c\u7576\u4ed6\u89ba\u5f97\u8a72\u6a21\u7d44\u88ab\u5077\u3001\u8907\u88fd\u6216\u7834\u58de \u4f7f\u7528\u8005\u61c9\u7ba1\u7406\u820a\u7684\u91d1\u9470\uff0c\u9664\u975e\u7ba1\u7406\u55ae\u4f4d\u6709\u53e6\u5916\u653f\u7b56\u8aaa\u660e\uff1a [ ] \u7576\u7c3d\u8b49\u904e\u671f\u5c31\u61c9\u628a\u79c1\u9470\u4e1f\u68c4 [ ] 2. \u7528\u4f86\u7522\u751f\u7c3d\u7ae0\u7684\u79c1\u9470\uff0c\u61c9\u7b49\u5230\u5176\u7522\u751f\u7684\u79c1\u9470\u90fd\u88ab\u91cd\u65b0\u52a0\u5bc6\u6216\u6368\u68c4\u5f8c\u624d\u80fd\u4e1f\u68c4","title":"\u5efa\u7f6e PKI \u6ce8\u610f\u4e8b\u9805"},{"location":"essay/architecture/pki-checklist/#pki","text":"\u672c\u8cc7\u6599\u4f86\u6e90\u65bc NIST 800-32 Ct.3 Certification Path Building Key Rollover in the Resource Public Key Infrastructure X.509 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 IDC \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 Root \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u25b2\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 HTTP \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 HTTP \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502 \u2502 \u2502 \u2502 \u2502Intermediate\u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u25ba \u25c4\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 HTTP \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u25b2\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u25bc\u2500\u2500\u2500\u2510 \u250c\u2500\u25bc\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u25bc\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u25ba AES \u25c4\u2500\u2500\u2500\u2510 \u2502 EE \u2502 \u2502 EE \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u25b2\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 HTTPS\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2510 \u2514\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2534\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2534\u2500\u2500\u2510 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2524 API \u2502 \u2502 Service \u2502 \u2502 APP \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u53ef\u80fd\u9700\u8981\u6e9d\u901a\u7684\u539f\u56e0\uff1a \u521d\u59cb\u8a3b\u518a/\u8a8d\u8b49 \u91d1\u9470\u5c0d\u66f4\u65b0 \u6191\u8b49\u66f4\u65b0","title":"\u5efa\u7f6e PKI \u6ce8\u610f\u4e8b\u9805"},{"location":"essay/architecture/pki-checklist/#nist","text":"","title":"NIST"},{"location":"essay/architecture/pki-checklist/#_1","text":"CA \u7c3d\u7f72\u7c3d\u8b49\u7d66 user\uff0c\u6b64\u6642 CA \u662f issuer\u3002 CA \u6703\u628a\u9a57\u8b49 user \u7684\u8cc7\u8a0a\u4e1f\u7d66 Registration Authority(RA)\uff0c\u4f8b\u5982\uff1aDNS \u4f7f\u7528 CA \u7c3d\u51fa\u4f86\u7684\u7c3d\u8b49\uff0c\u4e26\u4ee5\u6b64\u4f86\u4fe1\u4efb user \u7684\u7b2c\u4e09\u65b9\u7a31\u70ba relying parties certificate policy \u5b9a\u7fa9\u7c3d\u8b49\u7684\u653f\u7b56\uff0c\u4f8b\u5982\u8a72\u7528\u4ec0\u9ebc\u91d1\u9470\u7a2e\u985e\u3001\u9577\u5ea6\u3002\u80fd\u505a\u5230\u6aa2\u67e5\u7684\u6b65\u9a5f\uff0c\u5be6\u52d9\u4e0a\u50c5\u6709\u7c3d\u767c\u6642\u4f5c\u6aa2\u67e5\uff0c\u7136\u5f8c\u518d\u628a\u8cc7\u8a0a\u653e\u5728\u7c3d\u8b49\u4e0a\u3002 correctly configuring root certificate stores is a critical step in key management. X.509 \u6703\u653e user name issuer name public key signature validity (starting and expiring times) cryptographic algorithm(s) \u548c\u5176\u4ed6 Private \u7684 extension \u9a57\u8b49\u904e\u7a0b Cross certificates\uff0c\u5c31\u7b97\u662f root CA( trust anchors )\u4e5f\u53ef\u80fd\u6703\u9700\u8981\u5176\u4ed6\u540c\u6a23\u662f root CA \u7684\u7c3d\u8b49\u3002 certification path\uff0crelying party \u5f9e user \u5230 trust anchors \u7684\u9a57\u8b49\u6d41\u7a0b \u9a57\u8b49\u904e\u7a0b\u4e2d\u7684\u6bcf\u4e00\u6bb5\u90fd\u9700\u8981\u78ba\u8a8d\uff08path validation\uff09\uff1a \u7c3d\u8b49\u9a57\u8b49 \u7c3d\u8b49\u6c92\u88ab\u64a4\u92b7 \u88ab\u6b63\u78ba\u7684\u653f\u7b56 issue \u7c3d\u8b49\u7684\u72c0\u614b\u5c55\u793a\uff08\u7c3d\u8b49\u6c92\u88ab\u64a4\u92b7\uff09\u65b9\u5f0f\u6709\u5169\u7a2e\uff1a Online Certificate Status Protocol (OCSP) certificate revocation list, or CRL \u82e5\u4e00\u958b\u59cb\u662f\u4f7f\u7528 key establishment \u505a\u7c3d\u8b49\uff0c\u8981\u53ef\u4ee5\u505a\u91d1\u9470\u7684\u56de\u5fa9\u3002","title":"\u540d\u8a5e\u4ecb\u7d39"},{"location":"essay/architecture/pki-checklist/#procurement-guidance","text":"\u6311\u9078 CA \u7522\u54c1\u7684 check list\u3002","title":"Procurement Guidance"},{"location":"essay/architecture/pki-checklist/#cara-software-and-hardware","text":"[ ] \u78ba\u4fdd\u652f\u63f4\u4efb\u4e00\u5354\u5b9a\uff1a Certificate Management Protocol (CMP) RFC 4210 Enrollment over Secure Transport (EST) RFC 7030 Certificate Management Using Cryptographic Message Syntax (CMC) RFC 5272 [ ] \u78ba\u4fdd\u53ef\u4ee5\u7522\u751f\u6191\u8b49\uff0c\u5176\u4e2d\u61c9\u542b\u6709\u7684\u8cc7\u8a0a\u65bc\u5f8c\u8a0e\u8ad6\u4e4b\u3002 [ ] \u53ef\u4ee5\u7522\u751f\u591a\u7d44\u6191\u8b49\uff0c\u4e14\u5141\u8a31\u7279\u5b9a\u91d1\u9470\u7a2e\u985e\u3002 [ ] \u5141\u8a31 CRL\u3002 [ ] \u5141\u8a31\u5916\u90e8\u9023\u7d50 CRL\uff0c\u4e14\u5fc5\u9808\u542b\u6709 HTTP URLS\u3002 [ ] \u61c9\u53ef\u4ee5\u900f\u904e LDPA \u53d6\u5f97 CRL\u3002 [ ] \u5141\u8a31 OCSP\u3002 [ ] \u6bcf\u7d44 PKI \u90fd\u6709\u5176\u6191\u8b49\u8cc7\u8a0a\uff0c\u4e14\u8cc7\u8a0a\u80fd\u88ab\u986f\u793a\u65bc\u5176\u7c3d\u7f72\u7684\u7c3d\u8b49 CRL\u3002 [ ] \u5141\u8a31\u8a2d\u5b9a\u5ba2\u5236\u76f8\u95dc\u8cc7\u8a0a\u65bc\u6191\u8b49\u4e2d\u3002 [ ] \u5141\u8a31\u4f7f\u7528 RSA \u548c ECDSA \u6f14\u7b97\u6cd5\u3002 [ ] \u53ef\u4ee5\u5099\u4efd\u4e26\u707d\u96e3\u5fa9\u539f\u3002 [ ] \u5141\u8a31\u6b0a\u9650\u5728\u5e33\u865f\u4e4b\u9593\u7684\u8f49\u79fb\u3002","title":"CA/RA Software and Hardware:"},{"location":"essay/architecture/pki-checklist/#ocsp-responders","text":"[ ] \u78ba\u4fdd OCSP responders \u7b26\u5408 RFC 6960 Online Certificate Status Protocol \u3002 [ ] \u78ba\u4fdd\u80fd\u8655\u7406\u6709\u7121\u7c3d\u7ae0\u548c\u540d\u7a31\u7684\u8acb\u6c42\uff0c\u5c31\u7b97\u662f\u62d2\u7d55\u4e5f\u9808\u56de\u61c9\u3002 [ ] \u56de\u61c9\u6642\u6c92\u6709\u4efb\u4f55\u65bc RFC 5019 \u4e2d\u63d0\u53ca\u7684\u932f\u8aa4 [ ] \u56de\u61c9\u6642\u7684\u7c3d\u7ae0\u5efa\u8b70\u7b26\u5408\u548c\u5176\u7522\u751f\u7684\u6191\u8b49\u7684\u6f14\u7b97\u6cd5\u76f8\u540c\uff0c\u91d1\u9470\u683c\u5f0f\u4e5f\u5efa\u8b70\u4e00\u6a23\u3002\u5141\u8a31\u4f7f\u7528 RSA \u548c ECDSA \u6f14\u7b97\u6cd5\u3002","title":"OCSP Responders:"},{"location":"essay/architecture/pki-checklist/#_2","text":"[ ] CAs\u3001Key Recovery Servers \u548c OCSP responders \u9ad8\u65bc FIPS 140-2 \u7b49\u7d1a 3\u3002 [ ] RAs \u9700\u9ad8\u65bc FIPS 140-2 \u7b49\u7d1a 2\u3002 [ ] \u78ba\u4fdd\u8acb\u6c42\u7c3d\u8b49\u7684\u55ae\u4f4d\u548c\u4f7f\u7528\u8005\u7684\u52a0\u5bc6\u6a21\u7d44\u9ad8\u65bc FIPS 140-2 \u7b49\u7d1a 1\u3002","title":"\u52a0\u5bc6\u6a21\u7d44"},{"location":"essay/architecture/pki-checklist/#key-recovery-servers","text":"[ ] \u5982\u679c PKI \u652f\u63f4\u91d1\u9470\u7522\u751f\uff0c\u5c31\u61c9\u652f\u63f4\u91d1\u9470\u6551\u63f4\u670d\u52d9\u3002 [ ] \u61c9\u652f\u63f4\u81ea\u52d5\u5316\u7684\u91d1\u9470\u6551\u63f4\u670d\u52d9\u3002","title":"Key Recovery Servers"},{"location":"essay/architecture/pki-checklist/#relying-party-software","text":"[ ] \u8def\u7a0b\u9a57\u8b49\uff08path validation\uff09 [ ] \u78ba\u4fdd\u7b26\u5408 RFC 5280 conformant path validation \u3002 [ ] \u5141\u8a31\u7d44\u7e54\u5916\u7684\u9a57\u8b49\uff08\u4f8b\u5982\u900f\u904e federal agency\uff09\u4e14\u9700\u7b26\u5408 NIST \u5efa\u8b70\u7684\u9a57\u8b49\u65b9\u5f0f \u3002 [ ] \u5141\u8a31\u6709 Bridge \u7684\u8def\u5f91\uff0c\u4e14\u9700\u7b26\u5408 NIST \u5efa\u8b70\u7684\u9a57\u8b49\u65b9\u5f0f \u3002 [ ] \u61c9\u8a72\u540c\u6642\u652f\u63f4 CRLs \u548c OCSP\u3002 \u9a57\u8b49\u6191\u8b49 [ ] \u78ba\u4fdd\u53ef\u4ee5\u5efa\u7acb\u9a57\u8b49\u7684\u8def\u5f91 [ ] \u81f3\u5c11\u8981\u80fd\u8655\u7406 HTTP-based \u7684\u56de\u61c9 [ ] \u61c9\u8981\u80fd\u8655\u7406 LDAP \u7684\u5354\u5b9a [ ] \u4f5c\u7528\u65bc\u4f01\u696d\u7aef PKI \u7684 RP \u61c9\u80fd\u767c\u73fe\u8def\u5f91\u4e0a\u53d7 trust anchor CA \u8a8d\u8b49\u7684\u968e\u5c64\u5f0f CA\u3002 [ ] \u975e\u4f01\u696d\u7aef PKI \u7684 RP \u61c9\u80fd\u767c\u73fe\u8def\u5f91\u4e0a\u975e\u968e\u5c64\u5f0f\u7684 CA\u3002","title":"Relying Party Software"},{"location":"essay/architecture/pki-checklist/#client-software","text":"[ ] \u5ba2\u6236\u7aef\u5141\u8a31\u591a\u500b\u516c\u79c1\u9470\u8acb\u6c42\u591a\u500b\u7c3d\u8b49 [ ] \u52a0\u5bc6\u6a21\u7d44\u9ad8\u65bc FIPS 140-2 \u7b49\u7d1a 1 [ ] \u5ba2\u6236\u61c9\u53ef\u4f7f\u7528 CA \u63d0\u4f9b\u7684 certificate management protocol","title":"Client Software"},{"location":"essay/architecture/pki-checklist/#pki_1","text":"\u7ba1\u7406\u8005\u61c9\u78ba\u4fdd\u4f7f\u7528\u7aef\u7684\u4eba\u63a5\u53d7\u5fc5\u8981\u8a13\u7df4\u548c\u516c\u53f8\u5b89\u5168\u653f\u7b56\u88ab\u57f7\u884c\u3002","title":"\u7d66 PKI \u7ba1\u7406\u8005\u7684\u5efa\u8b70"},{"location":"essay/architecture/pki-checklist/#certificate-issuance","text":"[ ] \u78ba\u4fdd CAs \u8a2d\u5b9a\u597d\u53ef\u63a5\u53d7\u7684\u516c\u79c1\u9470\u6f14\u7b97\u6cd5\u548c\u91d1\u9470\u9577\u5ea6\uff0c\u9084\u6709\u9a57\u8b49 domain [ ] \u70ba\u4e86\u6700\u5927\u5316\u6a19\u6e96\u6027\uff0c\u61c9\u4f7f\u7528 RSA \u53bb\u505a\u7c3d\u7ae0\u548c\u91d1\u9470\u8f49\u79fb [ ] \u70ba\u4e86\u6700\u5927\u5316\u5b89\u5168\u6027\u548c\u6548\u7387\uff0c\u61c9\u4f7f\u7528 EC \u53bb\u505a\u7c3d\u7ae0\u548c\u91d1\u9470\u8f49\u79fb [ ] \u7576\u7c3d\u767c\u7c3d\u8b49\u6216 CRLs \u6642\uff0c\u61c9\u7b26\u5408\u6f14\u7b97\u6cd5\u3001\u9577\u5ea6\u7684\u898f\u7bc4 [ ] \u5229\u7528 subject key \u7522\u751f signing key \u6642\uff0c\u7c3d\u8b49\u7684\u5b89\u5168\u6027\u61c9\u5927\u65bc subject key \u53bb\u7c3d\u8b49 \u7522\u751f\u91d1\u9470\u6642\uff1a [ ] \u4f7f\u7528\u8005\u61c9\u7522\u751f\u5c6c\u65bc\u4ed6\u5011\u81ea\u5df1\u7684\u7c3d\u8b49\u91d1\u9470 [ ] \u82e5\u4e0a PKI \u900f\u904e\u91d1\u9470\u50b3\u9001\u65b9\u5f0f\u53bb\u50b3\u9001\u91d1\u9470\uff0c\u61c9\u63d0\u4f9b\u91d1\u9470\u5fa9\u539f\u670d\u52d9 [ ] CAs \u8981\u78ba\u4fdd\u91d1\u9470\u771f\u7684\u5c6c\u65bc\u4f7f\u7528\u8005\uff08PoP\uff09 [ ] \u61c9\u5728\u7c3d\u8b49\u524d\u5148\u9a57\u8b49\u91d1\u9470 Key usage extension [ ] \u7c3d\u8b49\u61c9\u5305\u542b key-ussage extension [ ] key-ussage extension \u61c9\u9650\u5236\u4e00\u7a2e\u7372\u53d6\u65b9\u5f0f\uff0c\u4f7f\u7528\u8005\u81ea\u5df1\u7522\u751f\u6216 PKI \u7522\u751f [ ] \u6240\u6709\u7c3d\u8b49\u61c9\u5305\u542b CRLs \u7684\u4f4d\u7f6e\u8cc7\u8a0a [ ] \u82e5\u63d0\u4f9b OCSP responder\uff0c\u61c9\u63d0\u4f9b\u4f4d\u7f6e\u8cc7\u8a0a\u65bc\u7c3d\u8b49\u4e2d [ ] \u5728\u904e\u671f\u524d\u61c9\u91cd\u65b0\u7c3d\u7f72\u5b8c\u6210\uff0c\u4e26\u4e14\u6b63\u78ba\u66f4\u65b0\u6191\u8b49\u8cc7\u8a0a\uff0c\u5982 domain \u6216\u4fe1\u7bb1","title":"Certificate Issuance"},{"location":"essay/architecture/pki-checklist/#certificate-revocation-requests","text":"[ ] \u61c9\u63d0\u4f9b\u81ea\u52d5\u64a4\u92b7\u6a5f\u5236\uff1a [ ] CAs \u61c9\u5728\u64a4\u92b7\u6642\u9032\u884c\u8eab\u4efd\u9a57\u8b49 [ ] \u4f7f\u7528\u8005\u63d0\u4f9b\u8eab\u4efd\u8b49\u660e\u4e26\u8981\u6c42\u64a4\u92b7\u6642\uff0c\u61c9\u5728\u4e0d\u9700\u4eba\u529b\u4ecb\u5165\u4e0b\u57f7\u884c\u3002 [ ] RAs \u61c9\u80fd\u5728\u8a2d\u5b9a\u5f8c\uff0c\u4ee3\u8868\u4f7f\u7528\u8005\u6216\u516c\u53f8\u8acb\u6c42\u7c3d\u8b49\u64a4\u92b7","title":"Certificate Revocation Requests"},{"location":"essay/architecture/pki-checklist/#certificate-revocation-list-generation","text":"[ ] \u70ba\u4e86\u6700\u5927\u6a19\u6e96\u5316\uff0cCAs \u61c9\u63d0\u4f9b\u5b8c\u6574\u7684\u64a4\u92b7\u7c3d\u8b49\u65bc CRL \u4e2d [ ] \u82e5\u6709\u5927\u91cf\u7684\u64a4\u92b7\u7c3d\u8b49\uff0c\u53ef\u4ee5\u7522\u751f\u90e8\u5206\u7684 CRL\uff0c\u4f46\u9808\u984d\u5916\u63d0\u4f9b\u5b8c\u6574\u7684 CRL \u4f4d\u7f6e\u8cc7\u8a0a\u3002\u4e00\u4efd CRL \u4e0d\u61c9\u8d85\u904e 250,000 \u7684\u64a4\u92b7\u7c3d\u8b49\u3002","title":"Certificate Revocation List Generation"},{"location":"essay/architecture/pki-checklist/#pki-repositories-for-the-distribution-of-certificates-and-crls","text":"[ ] PKIs \u61c9\u80fd\u516c\u958b\u63d0\u4f9b\u7c3d\u8b49\u548c CRL [ ] PKI \u5eab\u61c9\u80fd\u63d0\u4f9b\u8eab\u4efd\u9a57\u8b49\u5f8c\u7684\u7c3d\u8b49\u4f4d\u7f6e\u4fee\u6539\u548c PKI \u5eab\u7684 CRL \u5206\u4f48 [ ] PKI \u5eab\u61c9\u81f3\u5c11\u5141\u8a31 HTTP 1.1 \u6216 LDAP version 3 [ ] \u70ba\u4e86\u6700\u5927\u6a19\u6e96\u5316\uff0c HTTP \u548c LDAP \u90fd\u61c9\u88ab\u7b26\u5408 [ ] HA \u61c9\u88ab\u8003\u616e [ ] PKI \u5eab\u61c9\u5305\u542b\u6240\u6709\u5176\u64c1\u6709\u7684 PKI \u7684\u6240\u6709\u7c3d\u8b49 [ ] PKI \u5eab\u61c9\u5305\u542b\u6240\u6709\u5176\u64c1\u6709\u7684 PKI \u7684 CRL","title":"PKI Repositories for the Distribution of Certificates and CRLs"},{"location":"essay/architecture/pki-checklist/#ocsp-responders_1","text":"For federal agencies, detailed configuration guidance for OCSP responders is specified in Draft Guidance for OCSP Responders in the U.S. Federal PKI.17 \u70ba\u4e86\u6700\u5927\u6a19\u6e96\u5316\uff1a [ ] OCSP responders \u4e0d\u61c9\u8981\u6c42\u8acb\u6c42\u8981\u6709\u7c3d\u540d\uff0c\u4e14\u4e0d\u80fd\u9650\u5236\u54ea\u4e9b\u7c3d\u8b49\u72c0\u614b\u662f\u53ef\u4ee5\u88ab\u5141\u8a31\u7684 [ ] \u61c9\u80fd\u56de\u61c9\u57fa\u672c\u7684\u8cc7\u8a0a\uff0c\u4e14\u4e0d\u80fd\u542b\u6709\u5371\u96aa\u7684 extensions \u82e5\u50c5\u9700\u7b26\u5408\u5167\u90e8\u793e\u7fa4\u800c\u975e\u6a19\u6e96\u5316\uff1a [ ] OCSP responders \u53ef\u8981\u6c42\u8acb\u6c42\u8981\u6709\u7c3d\u540d\uff0c\u4e14\u53ef\u62d2\u7d55\u5916\u90e8\u7684\u8acb\u6c42 [ ] OCSP \u7684\u56de\u61c9\u8a0a\u606f\u53ef\u80fd\u542b\u6709\u7279\u6b8a\u7684 extensions","title":"OCSP Responders"},{"location":"essay/architecture/pki-checklist/#backup-and-archive","text":"[ ] \u61c9\u8a72\u5099\u4efd\u8cc7\u6599\uff0c\u4e26\u7576\u707d\u96e3\u767c\u751f\u5f8c\u80fd\u91cd\u65b0\u555f\u7528 [ ] CAs \u61c9\u7d00\u9304\u4f55\u6642\u548c\u4f55\u4eba\u7533\u8acb\u7684\u7c3d\u8b49 [ ] \u61c9\u6709 log \u7d00\u9304\u6240\u6709\u7c3d\u8b49\u548c CRL [ ] \u7533\u8acb\u4eba\u7684\u516c\u9470\u61c9\u548c\u5176\u7c3d\u8b49\u4e00\u8d77\u88ab\u4fdd\u5b58","title":"Backup and Archive"},{"location":"essay/architecture/pki-checklist/#relying-party-integration-and-configuration","text":"[ ] \u61c9\u53ef\u4ee5\u767c\u73fe\u8def\u5f91\u548c\u7372\u5f97\u72c0\u614b\u8cc7\u8a0a [ ] \u61c9\u8981\u53ef\u4ee5\u652f\u63f4 CRL \u548c OCSP \u7684\u683c\u5f0f [ ] \u61c9\u80fd\u5206\u8fa8\u6700\u5c0f\u55ae\u4f4d\u7684 trust anchors [ ] \u7576\u60c5\u5883\u8655\u65bc\u300c\u516c\u53f8\u5c0d\u653f\u5e9c\u300d\u6216\u300c\u653f\u5e9c\u5c0d\u653f\u5e9c\u300d\uff0c\u61c9\u4f7f\u7528 Common Policy Root CA \u6216\u548c Common Policy Root CA \u4e92\u76f8\u8a8d\u8b49\u7684 CA \u6216\u4ee5 Federal Bridge \u70ba trust anchor \u7684 CA [ ] \u7576\u60c5\u5883\u5c6c\u65bc\u300c\u4f7f\u7528\u8005\u5c0d\u653f\u5e9c\u300d\uff0c\u61c9\u7528\u7a0b\u5f0f\u7684\u5b89\u5168\u6027\u7121\u6cd5\u505a\u5230\u9ad8\u5ea6\u9650\u5236\uff0c\u70ba\u4e86\u9054\u6210\u9ad8\u6a19\u6e96\u6027\uff0c\u4f7f\u7528\u8005\u53ef\u80fd\u6703\u4f7f\u7528\u7684\u9810\u5148\u5b89\u88dd\u81f3 COTS products \u7684 trust anchors \u8def\u5f91\u9a57\u8b49\uff1a [ ] \u5c0d\u548c\u4f7f\u7528\u8005\u61c9\u7528\u7a0b\u5f0f\u5c0d\u63a5\u7684\u9023\u7dda\uff0c\u8def\u5f91\u9a57\u8b49\u61c9\u88ab\u8a2d\u5b9a\u6210\u53ef\u63a5\u53d7\u6240\u6709\u5408\u6cd5\u8def\u5f91 [ ] \u5c0d\u9700\u8981\u9ad8\u5ea6\u5b89\u5168\u6027\u7684\u7cfb\u7d71\uff0c\u61c9\u88ab\u8a2d\u5b9a\u6210\u50c5\u63a5\u53d7\u7279\u5b9a\u9069\u7576\u7684\u653f\u7b56\u7684\u8def\u5f91","title":"Relying Party Integration and Configuration"},{"location":"essay/architecture/pki-checklist/#user-guidance-subscribers","text":"\u5c0d\u65bc\u548c PKI \u7533\u8acb\u6b0a\u8b49\u7684\u4f7f\u7528\u8005\uff1a [ ] \u4f7f\u7528\u8005\u61c9\u7522\u751f\u5c6c\u65bc\u81ea\u5df1\u7684\u91d1\u9470\uff0c\u7528\u4f5c\u7c3d\u8b49\u548c\u8eab\u4efd\u8b49\u660e [ ] \u4f7f\u7528\u8005\u53ef\u80fd\u81ea\u5df1\u7522\u751f\u91d1\u9470\uff0c\u6216\u5f9e\u53ef\u4fe1\u4efb\u7684\u8cc7\u6e90\u53d6\u5f97\u91d1\u9470 [ ] \u4f7f\u7528\u8005\u61c9\u5305\u7ba1\u597d\u79c1\u9470\uff0c\u5305\u62ec\u52a0\u5bc6\u79c1\u9470\u7684 PIN \u78bc\u6216\u5bc6\u78bc [ ] \u4f7f\u7528\u8005\u61c9\u8acb\u6c42\u64a4\u92b7\uff0c\u7576\u4ed6\u89ba\u5f97\u8a72\u6a21\u7d44\u88ab\u5077\u3001\u8907\u88fd\u6216\u7834\u58de \u4f7f\u7528\u8005\u61c9\u7ba1\u7406\u820a\u7684\u91d1\u9470\uff0c\u9664\u975e\u7ba1\u7406\u55ae\u4f4d\u6709\u53e6\u5916\u653f\u7b56\u8aaa\u660e\uff1a [ ] \u7576\u7c3d\u8b49\u904e\u671f\u5c31\u61c9\u628a\u79c1\u9470\u4e1f\u68c4 [ ] 2. \u7528\u4f86\u7522\u751f\u7c3d\u7ae0\u7684\u79c1\u9470\uff0c\u61c9\u7b49\u5230\u5176\u7522\u751f\u7684\u79c1\u9470\u90fd\u88ab\u91cd\u65b0\u52a0\u5bc6\u6216\u6368\u68c4\u5f8c\u624d\u80fd\u4e1f\u68c4","title":"User Guidance (Subscribers)"},{"location":"essay/architecture/replace-docker-desktop/","text":"\u53d6\u4ee3 Docker Desktop Docker Desktop \u5728 \u7279\u5b9a\u689d\u4ef6 \u4e0b\u8981\u9322\u4e86\uff0c\u8a72\u7528\u4ec0\u9ebc\u53d6\u4ee3\uff1f \u73fe\u6709\u5de5\u5177\uff1a Lima \u4f46\u662f\u9019\u6703\u9700\u8981\u91cd\u65b0\u64b0\u5beb script\uff1a docker ... \u8b8a\u6210 limactl ... \u9664\u6b64\u4e4b\u5916\uff0c\u9084\u53ef\u81ea\u5df1\u5efa\u7acb\u4e00\u500b VM\uff08Linux based\uff09\u53bb\u652f\u6490 Docker\u3002 \u70ba\u4ec0\u9ebc\u8981\u7528 VM\uff1f \u79fb\u9664 Docker Desktop \u9ede\u9078\u53f3\u4e0a\u89d2\u87f2\u87f2\u5716\u6848 \u6700\u4e0b\u9762\u7684 Uninstall \u91cd\u65b0\u5b89\u88dd Docker $ brew install docker # Optional: docker-compose $ brew install docker-compose \u6e96\u5099\u5de5\u5177 Vagrant VirtualBox $ brew install vagrant $ brew install virtualbox Provision \u5efa\u7acb Vagrantfile\uff1a # encoding: utf-8 # -*- mode: ruby -*- # vi: set ft=ruby : VAGRANTFILE_API_VERSION = \"2\" Vagrant.configure('2') do |config| # ubuntu 14.x # config.vm.box = 'ubuntu/trusty64' # ubuntu 16.x config.vm.box = 'ubuntu/xenial64' # ubuntu 18.x # config.vm.box = 'ubuntu/bionic64' # ubuntu 20.x # config.vm.box = 'ubuntu/focal64' # Optional: hostmanager config.hostmanager.enabled = true config.hostmanager.manage_host = true config.hostmanager.manage_guest = true config.hostmanager.include_offline = true config.vm.hostname = 'docker.local' # \u4efb\u4e00 IP \u5373\u53ef # \u672c\u6a5f\u8981\u9023\u7d50\u5230\u6b64 Docker \u9700\u8981\u5148\u6307\u5b9a\u4f4d\u7f6e # export DOCKER_HOST=tcp://192.168.66.4:2375 # \u6216\u8005\u900f\u904e hostmanager \u6307\u5b9a\u7684 host name # export DOCKER_HOST=tcp://docker.local:2375 # \u4f46\u662f\u9019\u6703\u9700\u8981\u66f4\u591a\u6642\u9593\u53bb\u8b93\u6a5f\u5668\u53bb\u8fa8\u8a8d IP config.vm.network 'private_network', ip: '192.168.66.4' # guest \u4ee3\u8868 VM port\uff0chost \u4ee3\u8868\u672c\u6a5f port config.vm.network 'forwarded_port', guest: 2375, host: 2375, id: 'dockerd' # \u4f7f\u7528 ID \u65b9\u4fbf\u8a18\u61b6 config.vm.network 'forwarded_port', guest: 80, host: 80, id: 'http' # Protocol \u6709\u9700\u8981\uff0c\u8981\u6539 config.vm.network 'forwarded_port', guest: 2000, host: 2000, id: 'xray', protocol: 'udp' config.vm.provision \"docker\" config.vm.provision 'shell', path: 'provision.sh' end \u5efa\u7acb provision.sh # Configure Docker to listen on a TCP socket # https://stackoverflow.com/a/42204921/12089368 # https://dev.to/dhwaneetbhatt/run-docker-without-docker-desktop-on-macos-306h mkdir /etc/systemd/system/docker.service.d echo '[Service] ExecStart= ExecStart=/usr/bin/dockerd --containerd=/run/containerd/containerd.sock' > /etc/systemd/system/docker.service.d/docker.conf echo '{ \"hosts\": [\"fd://\", \"tcp://0.0.0.0:2375\"] }' > /etc/docker/daemon.json # Reload configuration systemctl daemon-reload systemctl restart docker.service Go \u5efa\u7acb VM # Build VM + provision $ vagrant up # play with VM $ vagrant ssh # \u66f4\u65b0 IP \u8a2d\u5b9a $ vagrant reload \u8a2d\u5b9a Docker Daemon \u8def\u5f91 # IP \u6216\u662f Host \u8a73\u898b\u4e0a\u9762\u7684 Vagrantfile $ export DOCKER_HOST = tcp://192.168.66.4:2375 \u958b\u59cb\u4f7f\u7528 Docker\uff01","title":"\u53d6\u4ee3 Docker Desktop"},{"location":"essay/architecture/replace-docker-desktop/#docker-desktop","text":"Docker Desktop \u5728 \u7279\u5b9a\u689d\u4ef6 \u4e0b\u8981\u9322\u4e86\uff0c\u8a72\u7528\u4ec0\u9ebc\u53d6\u4ee3\uff1f \u73fe\u6709\u5de5\u5177\uff1a Lima \u4f46\u662f\u9019\u6703\u9700\u8981\u91cd\u65b0\u64b0\u5beb script\uff1a docker ... \u8b8a\u6210 limactl ... \u9664\u6b64\u4e4b\u5916\uff0c\u9084\u53ef\u81ea\u5df1\u5efa\u7acb\u4e00\u500b VM\uff08Linux based\uff09\u53bb\u652f\u6490 Docker\u3002 \u70ba\u4ec0\u9ebc\u8981\u7528 VM\uff1f","title":"\u53d6\u4ee3 Docker Desktop"},{"location":"essay/architecture/replace-docker-desktop/#docker-desktop_1","text":"\u9ede\u9078\u53f3\u4e0a\u89d2\u87f2\u87f2\u5716\u6848 \u6700\u4e0b\u9762\u7684 Uninstall","title":"\u79fb\u9664 Docker Desktop"},{"location":"essay/architecture/replace-docker-desktop/#docker","text":"$ brew install docker # Optional: docker-compose $ brew install docker-compose","title":"\u91cd\u65b0\u5b89\u88dd Docker"},{"location":"essay/architecture/replace-docker-desktop/#_1","text":"Vagrant VirtualBox $ brew install vagrant $ brew install virtualbox","title":"\u6e96\u5099\u5de5\u5177"},{"location":"essay/architecture/replace-docker-desktop/#provision","text":"\u5efa\u7acb Vagrantfile\uff1a # encoding: utf-8 # -*- mode: ruby -*- # vi: set ft=ruby : VAGRANTFILE_API_VERSION = \"2\" Vagrant.configure('2') do |config| # ubuntu 14.x # config.vm.box = 'ubuntu/trusty64' # ubuntu 16.x config.vm.box = 'ubuntu/xenial64' # ubuntu 18.x # config.vm.box = 'ubuntu/bionic64' # ubuntu 20.x # config.vm.box = 'ubuntu/focal64' # Optional: hostmanager config.hostmanager.enabled = true config.hostmanager.manage_host = true config.hostmanager.manage_guest = true config.hostmanager.include_offline = true config.vm.hostname = 'docker.local' # \u4efb\u4e00 IP \u5373\u53ef # \u672c\u6a5f\u8981\u9023\u7d50\u5230\u6b64 Docker \u9700\u8981\u5148\u6307\u5b9a\u4f4d\u7f6e # export DOCKER_HOST=tcp://192.168.66.4:2375 # \u6216\u8005\u900f\u904e hostmanager \u6307\u5b9a\u7684 host name # export DOCKER_HOST=tcp://docker.local:2375 # \u4f46\u662f\u9019\u6703\u9700\u8981\u66f4\u591a\u6642\u9593\u53bb\u8b93\u6a5f\u5668\u53bb\u8fa8\u8a8d IP config.vm.network 'private_network', ip: '192.168.66.4' # guest \u4ee3\u8868 VM port\uff0chost \u4ee3\u8868\u672c\u6a5f port config.vm.network 'forwarded_port', guest: 2375, host: 2375, id: 'dockerd' # \u4f7f\u7528 ID \u65b9\u4fbf\u8a18\u61b6 config.vm.network 'forwarded_port', guest: 80, host: 80, id: 'http' # Protocol \u6709\u9700\u8981\uff0c\u8981\u6539 config.vm.network 'forwarded_port', guest: 2000, host: 2000, id: 'xray', protocol: 'udp' config.vm.provision \"docker\" config.vm.provision 'shell', path: 'provision.sh' end \u5efa\u7acb provision.sh # Configure Docker to listen on a TCP socket # https://stackoverflow.com/a/42204921/12089368 # https://dev.to/dhwaneetbhatt/run-docker-without-docker-desktop-on-macos-306h mkdir /etc/systemd/system/docker.service.d echo '[Service] ExecStart= ExecStart=/usr/bin/dockerd --containerd=/run/containerd/containerd.sock' > /etc/systemd/system/docker.service.d/docker.conf echo '{ \"hosts\": [\"fd://\", \"tcp://0.0.0.0:2375\"] }' > /etc/docker/daemon.json # Reload configuration systemctl daemon-reload systemctl restart docker.service","title":"Provision"},{"location":"essay/architecture/replace-docker-desktop/#go","text":"\u5efa\u7acb VM # Build VM + provision $ vagrant up # play with VM $ vagrant ssh # \u66f4\u65b0 IP \u8a2d\u5b9a $ vagrant reload \u8a2d\u5b9a Docker Daemon \u8def\u5f91 # IP \u6216\u662f Host \u8a73\u898b\u4e0a\u9762\u7684 Vagrantfile $ export DOCKER_HOST = tcp://192.168.66.4:2375 \u958b\u59cb\u4f7f\u7528 Docker\uff01","title":"Go"},{"location":"essay/architecture/tomcat-max-packet-size/","text":"Tomcat \u7684 max_packet_size Tomcat \u4e2d\uff0c\u82e5 HTTP \u8868\u982d\u904e\u5927\uff0c\u6703\u56de\u61c9 413\u3002\u4f46\u662f\u6839\u64da MDN 413 \u4ee3\u8868 Payload Too Large\uff0c\u4e5f\u5c31\u662f HTTP Body \u904e\u5927\uff0c\u70ba\u4ec0\u9ebc\u6703\u6709\u9019\u5dee\u7570\uff1f \u70ba\u4e86\u907f\u514d Header \u904e\u5927\uff0c\u6211\u5011\u4e0d\u662f\u61c9\u8a72\u8a2d\u7f6e maxHttpHeaderSize \u55ce\uff1f\u70ba\u4ec0\u9ebc\u6703\u9700\u8981\u8a2d\u7f6e packetSize \u9019\u548c Header \u770b\u8d77\u4f86\u6c92\u4ec0\u9ebc\u95dc\u4fc2\u7684\u8a2d\u7f6e\u5462\uff1f Tomcat \u662f\u4e00\u500b\u63d0\u4f9b Web \u5bb9\u5668 \u7684\u7522\u54c1\uff0c\u5118\u7ba1\u672c\u8eab\u63d0\u4f9b web-server \u7684\u529f\u80fd\uff0c\u4f46\u662f\u5927\u90e8\u5206\u60c5\u6cc1\u4ecd\u548c\u7b2c\u4e09\u65b9\u7684 web-server \u505a\u4e32\u63a5\u3002 web server Apache HTTP Server Microsoft IIS iPlanet Web Server \u4e0d\u540c\u7684 Server \u6703\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7684 connector \u4f86\u548c Tomcat \u505a\u6e9d\u901a\u3002 \u4ee5\u4e0a\u8ff0\u9806\u5e8f\u4f86\u8aaa\uff0c\u5404\u81ea\u5206\u5225\u9700\u8981 mod_jk ISAPI redirector NSAPI redirector \u4f86\u628a HTTP \u8acb\u6c42\u50b3\u9001\u7d66 Tomcat\u3002 worker \u5c0d\u61c9 web server \u4f86\u8aaa\uff0c\u5be6\u969b\u8655\u7406\u76f8\u95dc HTTP \u8acb\u6c42\u7684\u670d\u52d9\uff0c\u7a31\u70ba worker\uff08backend\uff09\u3002 \u96d6\u7136\u672c\u6587\u8b39\u505a Tomcat \u7684\u4ecb\u7d39\uff0c\u5be6\u969b\u4ecd\u6709\uff1a Jetty JBoss ... \u7d9c\u4e0a\u8ff0\u6240\u8aaa\uff0c\u6211\u5011\u53ef\u4ee5\u6574\u7406\u51fa\u4ee5\u4e0b\u95dc\u4fc2\uff1a graph LR 0[HTTP Client] subgraph Web Server 1[HTTP Connector] 2[AJP Connector] end 3[Worker] 0 -- HTTP Request --> 1 1 --> 2 2 -- AJP --> 3 \u4e0a\u95dc\u4fc2\u5716\u770b\u5230 Web Server \u548c Worker \u7684\u6e9d\u901a\u662f\u900f\u904e AJP\uff08 Apache JServ Protocol \uff09\u9019\u5354\u5b9a\u6240\u5f62\u6210\u7684\u3002 HTTP Connector \u7684\u8a2d\u7f6e\u8aaa\u660e\u3002 AJP Connector \u7684\u8a2d\u7f6e\u8aaa\u660e\u3002 AJP \u56de\u5230\u4e00\u958b\u59cb\u7684\u554f\u984c\uff0c\u70ba\u4ec0\u9ebc HTTP Header \u904e\u5927\uff0cTomcat \u8981\u56de 413\uff1f\u6839\u64da AJP \u4e2d Request Packet Structure \u7684\u8aaa\u660e\uff0c\u4ed6\u6703\u628a HTTP Header \u548c\u4e00\u4e9b\u8cc7\u8a0a\u6574\u5408\u9032\u4e8c\u9032\u4f4d\u7684\u7de8\u78bc\u8cc7\u6599\u4e2d\uff0c\u4e26\u50b3\u9001\u7d66 Worker\u3002 \u4ee5\u4e0a\u8ff0\u72c0\u6cc1\u4f86\u8003\u616e\uff0c\u5c0d Worker \u4f86\u8aaa\uff0c\u4ed6\u6536\u5230\u7684 HTTP Request \u4e2d\u7684 Header \u4e0d\u55ae\u55ae\u53ea\u662f Header\uff0c\u800c\u662f\u5728\u4ed6\u5011\u4e16\u754c\u4e2d\u7684 packet\u3002\u5c01\u5305\u904e\u5927\uff0c\u5c31\u56de 413\uff0c\u807d\u8d77\u4f86\u5f88\u5408\u7406... \u6700\u5f8c\u5c31\u662f\u70ba\u4ec0\u9ebc\u8981\u8a2d\u7f6e maxHttpHeaderSize \u548c packetSize \uff1f\u539f\u4f86 maxHttpHeaderSize \u662f\u7528\u4f86\u7d66 HTTP Connector \u7684\u8a2d\u7f6e\uff0c\u800c packetSize \u662f\u7528\u4f86\u7d66 AJP Connector \u7684\u3002","title":"Tomcat \u7684 max_packet_size"},{"location":"essay/architecture/tomcat-max-packet-size/#tomcat-max_packet_size","text":"Tomcat \u4e2d\uff0c\u82e5 HTTP \u8868\u982d\u904e\u5927\uff0c\u6703\u56de\u61c9 413\u3002\u4f46\u662f\u6839\u64da MDN 413 \u4ee3\u8868 Payload Too Large\uff0c\u4e5f\u5c31\u662f HTTP Body \u904e\u5927\uff0c\u70ba\u4ec0\u9ebc\u6703\u6709\u9019\u5dee\u7570\uff1f \u70ba\u4e86\u907f\u514d Header \u904e\u5927\uff0c\u6211\u5011\u4e0d\u662f\u61c9\u8a72\u8a2d\u7f6e maxHttpHeaderSize \u55ce\uff1f\u70ba\u4ec0\u9ebc\u6703\u9700\u8981\u8a2d\u7f6e packetSize \u9019\u548c Header \u770b\u8d77\u4f86\u6c92\u4ec0\u9ebc\u95dc\u4fc2\u7684\u8a2d\u7f6e\u5462\uff1f Tomcat \u662f\u4e00\u500b\u63d0\u4f9b Web \u5bb9\u5668 \u7684\u7522\u54c1\uff0c\u5118\u7ba1\u672c\u8eab\u63d0\u4f9b web-server \u7684\u529f\u80fd\uff0c\u4f46\u662f\u5927\u90e8\u5206\u60c5\u6cc1\u4ecd\u548c\u7b2c\u4e09\u65b9\u7684 web-server \u505a\u4e32\u63a5\u3002","title":"Tomcat \u7684 max_packet_size"},{"location":"essay/architecture/tomcat-max-packet-size/#web-server","text":"Apache HTTP Server Microsoft IIS iPlanet Web Server \u4e0d\u540c\u7684 Server \u6703\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7684 connector \u4f86\u548c Tomcat \u505a\u6e9d\u901a\u3002 \u4ee5\u4e0a\u8ff0\u9806\u5e8f\u4f86\u8aaa\uff0c\u5404\u81ea\u5206\u5225\u9700\u8981 mod_jk ISAPI redirector NSAPI redirector \u4f86\u628a HTTP \u8acb\u6c42\u50b3\u9001\u7d66 Tomcat\u3002","title":"web server"},{"location":"essay/architecture/tomcat-max-packet-size/#worker","text":"\u5c0d\u61c9 web server \u4f86\u8aaa\uff0c\u5be6\u969b\u8655\u7406\u76f8\u95dc HTTP \u8acb\u6c42\u7684\u670d\u52d9\uff0c\u7a31\u70ba worker\uff08backend\uff09\u3002 \u96d6\u7136\u672c\u6587\u8b39\u505a Tomcat \u7684\u4ecb\u7d39\uff0c\u5be6\u969b\u4ecd\u6709\uff1a Jetty JBoss ... \u7d9c\u4e0a\u8ff0\u6240\u8aaa\uff0c\u6211\u5011\u53ef\u4ee5\u6574\u7406\u51fa\u4ee5\u4e0b\u95dc\u4fc2\uff1a graph LR 0[HTTP Client] subgraph Web Server 1[HTTP Connector] 2[AJP Connector] end 3[Worker] 0 -- HTTP Request --> 1 1 --> 2 2 -- AJP --> 3 \u4e0a\u95dc\u4fc2\u5716\u770b\u5230 Web Server \u548c Worker \u7684\u6e9d\u901a\u662f\u900f\u904e AJP\uff08 Apache JServ Protocol \uff09\u9019\u5354\u5b9a\u6240\u5f62\u6210\u7684\u3002 HTTP Connector \u7684\u8a2d\u7f6e\u8aaa\u660e\u3002 AJP Connector \u7684\u8a2d\u7f6e\u8aaa\u660e\u3002","title":"worker"},{"location":"essay/architecture/tomcat-max-packet-size/#ajp","text":"\u56de\u5230\u4e00\u958b\u59cb\u7684\u554f\u984c\uff0c\u70ba\u4ec0\u9ebc HTTP Header \u904e\u5927\uff0cTomcat \u8981\u56de 413\uff1f\u6839\u64da AJP \u4e2d Request Packet Structure \u7684\u8aaa\u660e\uff0c\u4ed6\u6703\u628a HTTP Header \u548c\u4e00\u4e9b\u8cc7\u8a0a\u6574\u5408\u9032\u4e8c\u9032\u4f4d\u7684\u7de8\u78bc\u8cc7\u6599\u4e2d\uff0c\u4e26\u50b3\u9001\u7d66 Worker\u3002 \u4ee5\u4e0a\u8ff0\u72c0\u6cc1\u4f86\u8003\u616e\uff0c\u5c0d Worker \u4f86\u8aaa\uff0c\u4ed6\u6536\u5230\u7684 HTTP Request \u4e2d\u7684 Header \u4e0d\u55ae\u55ae\u53ea\u662f Header\uff0c\u800c\u662f\u5728\u4ed6\u5011\u4e16\u754c\u4e2d\u7684 packet\u3002\u5c01\u5305\u904e\u5927\uff0c\u5c31\u56de 413\uff0c\u807d\u8d77\u4f86\u5f88\u5408\u7406... \u6700\u5f8c\u5c31\u662f\u70ba\u4ec0\u9ebc\u8981\u8a2d\u7f6e maxHttpHeaderSize \u548c packetSize \uff1f\u539f\u4f86 maxHttpHeaderSize \u662f\u7528\u4f86\u7d66 HTTP Connector \u7684\u8a2d\u7f6e\uff0c\u800c packetSize \u662f\u7528\u4f86\u7d66 AJP Connector \u7684\u3002","title":"AJP"},{"location":"essay/code/node.js-best-practice/","text":"Node.js \u6700\u4f73\u5be6\u4f5c Do In Code Compression: proxy > app.use(compression()) Asynchronous (async.) >> Synchronous (sync.) - The only reason to use sync. function is the time to start up server. \u552f\u4e00\u6709\u7406\u7531\u4f7f\u7528\u540c\u6b65\u51fd\u6578\u7684\u6642\u6a5f\u662f\u5728\u6700\u521d\u555f\u52d5\u4e4b\u6642 Static files: proxy > serve-static > res.sendFile() Console is sync! Always use async or use sync only in development. Debugging: debug >> console Application: Winston / Bunyan >> console Handle Error ( Important!, Detail in next section ) Try-catch Promise Handle Error Try-catch is synchronous . Express catch all sync. error in default (v.5 catch Promise as well) What will log? const callback = async () => { console . log ( \"do another thing\" ); throw new Error ( \"foo\" ); console . log ( \"do more thing\" ); }; const method = async () => { console . log ( \"do first thing\" ); await callback (); console . log ( \"do second thing\" ); }; const main = async () => { try { await method (); } catch ( err ) { console . log ( \"fire try-catch!\" ); } console . log ( \"finish project!\" ); }; result: do first thing do another thing do second thing finish project! UnhandledPromiseRejectionWarning: Error: foo ... (error stack) why? callback invoked some time later after method ( do another thing ) happend exception! wait to finish other process finish method ( do second thing ) finish try-catch block final run ( finish project! ) Category Operational Errors The errors you are/can except. Log, Show, Retry/Abort. Programmer Errors The best way to recover from programmer errors is to crash immediately Try debug your program rather than handle it. Do In Configuration env.NODE_ENV='production'; Rebuild after error, use helpers or init system [1] [2] Multi-threads [ 1 ][ 2 ] Caching [ Varnish ][ Nginx ] Reverse-Proxy [ Nginx ][ HAProxy ]","title":"Node.js \u6700\u4f73\u5be6\u4f5c"},{"location":"essay/code/node.js-best-practice/#nodejs","text":"","title":"Node.js \u6700\u4f73\u5be6\u4f5c"},{"location":"essay/code/node.js-best-practice/#do-in-code","text":"Compression: proxy > app.use(compression()) Asynchronous (async.) >> Synchronous (sync.) - The only reason to use sync. function is the time to start up server. \u552f\u4e00\u6709\u7406\u7531\u4f7f\u7528\u540c\u6b65\u51fd\u6578\u7684\u6642\u6a5f\u662f\u5728\u6700\u521d\u555f\u52d5\u4e4b\u6642 Static files: proxy > serve-static > res.sendFile() Console is sync! Always use async or use sync only in development. Debugging: debug >> console Application: Winston / Bunyan >> console Handle Error ( Important!, Detail in next section ) Try-catch Promise","title":"Do In Code"},{"location":"essay/code/node.js-best-practice/#handle-error","text":"Try-catch is synchronous . Express catch all sync. error in default (v.5 catch Promise as well)","title":"Handle Error"},{"location":"essay/code/node.js-best-practice/#what-will-log","text":"const callback = async () => { console . log ( \"do another thing\" ); throw new Error ( \"foo\" ); console . log ( \"do more thing\" ); }; const method = async () => { console . log ( \"do first thing\" ); await callback (); console . log ( \"do second thing\" ); }; const main = async () => { try { await method (); } catch ( err ) { console . log ( \"fire try-catch!\" ); } console . log ( \"finish project!\" ); };","title":"What will log?"},{"location":"essay/code/node.js-best-practice/#result","text":"do first thing do another thing do second thing finish project! UnhandledPromiseRejectionWarning: Error: foo ... (error stack)","title":"result:"},{"location":"essay/code/node.js-best-practice/#why","text":"callback invoked some time later after method ( do another thing ) happend exception! wait to finish other process finish method ( do second thing ) finish try-catch block final run ( finish project! )","title":"why?"},{"location":"essay/code/node.js-best-practice/#category","text":"Operational Errors The errors you are/can except. Log, Show, Retry/Abort. Programmer Errors The best way to recover from programmer errors is to crash immediately Try debug your program rather than handle it.","title":"Category"},{"location":"essay/code/node.js-best-practice/#do-in-configuration","text":"env.NODE_ENV='production'; Rebuild after error, use helpers or init system [1] [2] Multi-threads [ 1 ][ 2 ] Caching [ Varnish ][ Nginx ] Reverse-Proxy [ Nginx ][ HAProxy ]","title":"Do In Configuration"},{"location":"essay/code/node.js-error/","text":"Node.js \u7684\u932f\u8aa4\u6709\u54ea\u4e9b Network Error Context Ambiguous Meaning EACCES Server N/A Cannot listen on port due to permissions EADDRINUSE Server N/A Cannot listen on port since another process has it ECONNREFUSED Client No Client unable to connect to server ENOTFOUND Client No DNS lookup for the server failed ECONNRESET Client Yes Server closed connection with client EPIPE Client Yes Connection to server has closed ETIMEDOUT Client Yes Server didn\u2019t respond in time Process EACCES (Permission denied): An attempt was made to access a file in a way forbidden by its file access permissions. EADDRINUSE (Address already in use): An attempt to bind a server ( net , http , or https ) to a local address failed due to another server on the local system already occupying that address. EPERM (Operation not permitted): An attempt was made to perform an operation that requires elevated privileges. File System EEXIST (File exists): An existing file was the target of an operation that required that the target not exist. EISDIR (Is a directory): An operation expected a file, but the given pathname was a directory. EMFILE (Too many open files in system): Maximum number of file descriptors allowable on the system has been reached, and requests for another descriptor cannot be fulfilled until at least one has been closed. This is encountered when opening many files at once in parallel, especially on systems (in particular, macOS) where there is a low file descriptor limit for processes. To remedy a low limit, run ulimit -n 2048 in the same shell that will run the Node.js process. ENOENT (No such file or directory): Commonly raised by fs operations to indicate that a component of the specified pathname does not exist. No entity (file or directory) could be found by the given path. ENOTDIR (Not a directory): A component of the given pathname existed, but was not a directory as expected. Commonly raised by fs.readdir . ENOTEMPTY (Directory not empty): A directory with entries was the target of an operation that requires an empty directory, usually fs.unlink .","title":"Node.js \u7684\u932f\u8aa4\u6709\u54ea\u4e9b"},{"location":"essay/code/node.js-error/#nodejs","text":"","title":"Node.js \u7684\u932f\u8aa4\u6709\u54ea\u4e9b"},{"location":"essay/code/node.js-error/#network","text":"Error Context Ambiguous Meaning EACCES Server N/A Cannot listen on port due to permissions EADDRINUSE Server N/A Cannot listen on port since another process has it ECONNREFUSED Client No Client unable to connect to server ENOTFOUND Client No DNS lookup for the server failed ECONNRESET Client Yes Server closed connection with client EPIPE Client Yes Connection to server has closed ETIMEDOUT Client Yes Server didn\u2019t respond in time","title":"Network"},{"location":"essay/code/node.js-error/#process","text":"EACCES (Permission denied): An attempt was made to access a file in a way forbidden by its file access permissions. EADDRINUSE (Address already in use): An attempt to bind a server ( net , http , or https ) to a local address failed due to another server on the local system already occupying that address. EPERM (Operation not permitted): An attempt was made to perform an operation that requires elevated privileges.","title":"Process"},{"location":"essay/code/node.js-error/#file-system","text":"EEXIST (File exists): An existing file was the target of an operation that required that the target not exist. EISDIR (Is a directory): An operation expected a file, but the given pathname was a directory. EMFILE (Too many open files in system): Maximum number of file descriptors allowable on the system has been reached, and requests for another descriptor cannot be fulfilled until at least one has been closed. This is encountered when opening many files at once in parallel, especially on systems (in particular, macOS) where there is a low file descriptor limit for processes. To remedy a low limit, run ulimit -n 2048 in the same shell that will run the Node.js process. ENOENT (No such file or directory): Commonly raised by fs operations to indicate that a component of the specified pathname does not exist. No entity (file or directory) could be found by the given path. ENOTDIR (Not a directory): A component of the given pathname existed, but was not a directory as expected. Commonly raised by fs.readdir . ENOTEMPTY (Directory not empty): A directory with entries was the target of an operation that requires an empty directory, usually fs.unlink .","title":"File System"},{"location":"essay/vault/engine-pki/","text":"Vault PKI \u516c\u958b\u91d1\u9470\u57fa\u790e\u5efa\u8a2d Public Key Infrastructure \u50b3\u7d71\u6d41\u7a0b \u5efa\u7acb Certificate Signing Request (CSR) \u81ea\u5df1\u7522\u751f\u516c\u79c1\u9470 \u7528\u79c1\u9470\u7c3d\u7f72 CSR \u5bc4\u767c CSR \u7d66 Certificate Authority (CA) CA \u7c3d\u7f72\u8a72 CSR \u56de\u50b3\u7684\u6771\u897f\u5c31\u662f\u4f60\u7684 Certificate \u82e5\u64a4\u92b7 CSR \u5247\u53ef\u80fd \u66f4\u65b0 CA \u672c\u5730\u7aef\u7684 Certificate Revocation List (CRL) \u6216\u7dda\u4e0a\u7684 Online Certificate Status Protocal (OCSP) \u6709 Vault \u7684\u6d41\u7a0b \u82e5 root CA \u653e\u5728 Vault \u5916\u9762 \u5efa\u7acb root CA \u5728 Vault \u5916\u9762 \u5efa\u7acb intermediate CA \u5728 Vault \u88e1\u9762 \u5efa\u7acb intermediate CA \u7684 CSR \u62ff\u51fa CSR \u4e26\u7d66 root CA \u7c3d\u7f72\u5f8c\u653e\u9032 Vault \u88e1\u9762 \u82e5 root CA \u5728 Vault \u88e1\u9762 \u9806\u8457\u4e0a\u8ff0\u6d41\u7a0b\u6253 API \u5c31\u597d Vault \u6703\u5e6b\u6211\u5011\u505a\u597d\u5404\u7a2e\u6e9d\u901a \u64a4\u92b7 \u77ed\u671f\u7684 TTL \u53ef\u4ee5\u7701\u6389\u64a4\u92b7\u7684\u6a5f\u5236\uff0c\u4e26\u4e14\u7e2e\u77ed CRL \u7684\u9577\u5ea6 \u4e0d\u5efa\u8b70\u5229\u7528 command \u64a4\u92b7\uff0c\u591a\u5229\u7528\u77ed\u671f\u7684 TTL \u548c\u81ea\u52d5\u5316\u53bb\u9054\u5230\u5b89\u5168\u6027 Demo \u74b0\u5883 $ vault secrets enable -path = root-pki pki \u5efa\u7acb root CA $ vault write root-pki/root/generate/internal \\ common_name = \"My Root CA\" \\ ttl = 24h # issuing certificate, CRL distribution points, and OCSP server endpoints $ vault write root-pki/config/urls \\ issuing_certificates = \" $VAULT_ADDR /v1/root-pki/ca\" \\ crl_distribution_points = \" $VAULT_ADDR /v1/root-pki/crl\" # See configuration $ curl -s \" $VAULT_ADDR /v1/root-pki/ca/pem\" | openssl x509 -text /ca/pem \u7121\u6cd5\u900f\u904e CLI \u7372\u5f97\uff0c\u4e14\u4e0d\u9700\u9a57\u8b49\u5373\u53ef\u5f97\u5230\u8a72\u503c\u3002 \u76f8\u95dc\u8aaa\u660e -----BEGIN CERTIFICATE----- MIIDITCCAgmgAwIBAgIUB+EbBBHSHVRn+onGcck9Fq8MI0EwDQYJKoZIhvcNAQEL BQAwGDEWMBQGA1UEAxMNVmF1bHQgUm9vdCBDQTAeFw0yMTA3MjYwODQ4NDNaFw0y MTA3MjYwOTQ5MTJaMBgxFjAUBgNVBAMTDVZhdWx0IFJvb3QgQ0EwggEiMA0GCSqG SIb3DQEBAQUAA4IBDwAwggEKAoIBAQCtIl1caDwF/H4TiB7PwGRvc3FrSZfp0A5A jPOGkcP8x0aNDz+RV+WVya2ANNXou4rIICWJDhkfUTNXkDXVCOcxeCl6x211EP69 6BkyGvbf7bIhMVcMmrzNqoHWSBFdPT0/rztdlUTgmW0ukYEdfSghrsGsaaAbxyyE aze+5dESuFQv+RXWp34kX81UJt+Z3e39DrjBWPDCoJUM6g6IijRgy0vVdV05GHmS SKGPqf03/2Iw9xmDEui4iomclqwvmG07UivEdD1pb4nZJBmCLnWXTe/5a9+1QdQf 7xEFAMpXOqHG9EQJWzG3rjNb5MhR+VXytNDq6nteEbaaiQwB6KhXAgMBAAGjYzBh MA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBTCy+Pz 4mqP6gnIkXkeq88JW4ExFDAfBgNVHSMEGDAWgBTCy+Pz4mqP6gnIkXkeq88JW4Ex FDANBgkqhkiG9w0BAQsFAAOCAQEADdzNcD085699P/cB24JKFk49zidHe33NwEI0 7Y9tPaAChPc6ZDOUX1wguy2QL8NpZNKbxAU73HXFKHK1UOGgJQxzOUKdGLRAKc5z E7pUF1lAyG2caJ4XtuECXKcFI/m2oaI5v+Mj8eeEv0PqV5aOmKqBsJfDtepZRYdj 0wzV8gyag2Y9rLMeveUmWF73y2l6g7KspSF0YXqzjZTJQj5oQcAmvdxSmKB8UBYD 1Rpa5Wdoq/XMwFPxL3b3qFuK+seGZzwvY9WGey5kAZQBZkkkWw519ZFGdiU1/Xjm L4zS/WOwyBRamvriYB2fG09Vtr+i+tGsghgzEm1smu0uSSPNhA== -----END CERTIFICATE-----% \u5efa\u7acb intermediate CA $ vault secrets enable -path = int-pki pki $ vault write -field = csr \\ int-pki/intermediate/generate/internal \\ common_name = \"My Intermediate CA\" \\ ttl = 12h > cert/intermediate.csr # Get signed CSR from root $ vault write -field = certificate \\ root-pki/root/sign-intermediate \\ csr = @cert/intermediate.csr \\ format = pem_bundle \\ ttl = 12h > cert/intermediate.crt # Root CA sign intermediate $ vault write int-pki/intermediate/set-signed \\ certificate = @cert/intermediate.crt # Urls $ vault write int-pki/config/urls \\ issuing_certificates = \" $VAULT_ADDR /v1/int-pki/ca\" \\ crl_distribution_points = \" $VAULT_ADDR /v1/int-pki/crl\" # Set role $ vault write int-pki/roles/example-dot-com \\ allowed_domains = example.com \\ allow_subdomains = true \\ allow_glob_domains = true \\ generate_lease = true \\ max_ttl = 1m \\ ttl = 1m \u4e0a\u8ff0\u5efa\u7acb\u7684 public url \u53ef\u900f\u904e curl $VAULT_ADDR/vi/int-pki/ca/pem \uff0c\u4ee5 PEM \u683c\u5f0f\u53d6\u5f97\u3002 \u53d6\u5f97\u7684 CA\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u6548\u671f\u9650\u662f 12 \u5c0f\u6642\uff1a Common Name: My Intermediate CA Issuing Certificate: My Root CA Serial Number: 2EEF1ACC06016AE04CE00FE575D7426CEE982582 Signature: sha256WithRSAEncryption Valid From: 07:16:44 21 Jul 2021 Valid To: 19:17:14 21 Jul 2021 Key Usage: Certificate Sign, CRL Sign Basic Constraints: CA:TRUE Subject Key Identifier: 46:C4:1E:F3:5B:EE:3D:64:88:37:CF:67:A8:E5:11:82:B5:CE:F0:18 Authority Key Identifier: keyid:71:37:14:BE:9B:66:E7:93:3E:4A:45:F1:B3:78:6E:37:30:38:CC:4D Authority Info Access: CA Issuers - URI:http://localhost:8200/v1/root-pki/ca \u53d6\u5f97\u7684 CRL\uff0c\u5f85\u6703 revoke certificate \u4e4b\u5f8c\u53ef\u4ee5\u770b\u5176\u8b8a\u5316\uff1a Version: 2 IssuerDN: CN=My Intermediate CA This update: Wed Jul 21 07:17:31 UTC 2021 Next update: Sat Jul 24 07:17:31 UTC 2021 Signature Algorithm: SHA256WITHRSA Signature: 282359565d73c1ab950771e685ec352827967bd0 a969e57cbacad44d2c435d4478de6f6139ef8594 59fd862df7f61894f79cd1e775104ef45da7a95f 7749ee639fda5a0e12a7a7b211d875aaf1c6a876 7e5089492d38bd0098c4adc3d57d51fa7f5a90e6 4ae2fd715376b65cd58a004002002b8d91a0251d 1f01d0bdcead7784d5b55a7ce010a1830452bbd1 2b37f62e3d85bc62c8f05111c8cbbfdc554f27ff 588cc2efa77cd462d02a0026dc19fc5fd64b3021 cf6bf17279e9b1ab1f13a03e3737dbe60601828f 1e3cc669b508837b602abb9dcb221ae05047a7d4 22859538c78eb44887cef9cdd62adf45abc8f278 dad4dada9835ef6eccbe3a7ccd1a915b Extensions: critical(false) 2.5.29.35 value = Sequence Tagged [0] IMPLICIT DER Octet String[20] \u5efa\u7acb Token Policy policy.hcl # Intermediate CA issue you! path \"int-pki/issue/example-dot-com\" { \"capabilities\" = [\"create\", \"update\"] } # Root CA verify cert! path \"root-pki/cert/ca\" { \"capabilities\" = [\"read\"] } # Token path \"auth/token/renew\" { \"capabilities\" = [\"update\"] } path \"auth/token/renew-self\" { \"capabilities\" = [\"update\"] } \u8a2d\u5b9a policy \u548c\u5efa\u7acb token # Policy $ vault policy write intermediate-pki policy.hcl # Token $ vault token create \\ -field = token \\ -policy = intermediate-pki \\ -ttl = 1h > pki.token \u5229\u7528 consul-template \u53bb\u81ea\u52d5\u8981 certificate Template certificate.tpl {{- with secret \"int-pki/issue/example-dot-com\" \"common_name=blah.example.com\" -}} {{ .Data.certificate }}{{ end }} key.tpl {{- with secret \"int-pki/issue/example-dot-com\" \"common_name=blah.example.com\" -}} {{ .Data.private_key }}{{ end }} consul-template \u7684\u53c3\u6578 config.hcl vault { address = \"http://127.0.0.1:8200\" vault_agent_token_file = \"pki.token\" renew_token = true retry { attempts = 1 backoff = \"250ms\" } } // log_level = \"debug\" template { source = \"certificate.tpl\" destination = \"client.crt\" command = \"echo generate certificate!\" } template { source = \"key.tpl\" destination = \"client.key\" command = \"echo generate key!\" } \u8dd1\u8dd1\u770b\u5427\uff01 $ consul-template -config = config.hcl \u5c31\u6703\u770b\u5230\u4e0b\u5217\u8a0a\u606f\u53cd\u8986\u51fa\u73fe\uff1a generate certificate! generate key! expiration: revoked lease: lease_id=int-pki/issue/example-dot-com/.. \u62ff\u5230\u7684 Certificate\uff1a Common Name: blah.example.com Issuing Certificate: My Intermediate CA Serial Number: 6C24455D423496C85411FF857EAC28127DF16B4D Signature: sha256WithRSAEncryption Valid From: 07:38:44 21 Jul 2021 Valid To: 07:40:14 21 Jul 2021 Key Usage: Digital Signature, Key Encipherment, Key Agreement Extended Key Usage: TLS Web Server Authentication, TLS Web Client Authentication Subject Key Identifier: 77:79:22:4B:12:19:5D:F2:55:FF:76:11:CE:5D:34:1C:60:4C:44:76 Authority Key Identifier: keyid:46:C4:1E:F3:5B:EE:3D:64:88:37:CF:67:A8:E5:11:82:B5:CE:F0:18 Authority Info Access: CA Issuers - URI:http://localhost:8200/v1/int-pki/ca Subject Alternative Names: DNS:blah.example.com clean up \u82e5\u8981\u6e05\u9664\u904e\u671f\u7684 cert\uff0c\u8acb\u547c\u53eb $ vault write root-pki/tidy tidy_revoked_certs = true \u76f8\u95dc\u8aaa\u660e","title":"PKI"},{"location":"essay/vault/engine-pki/#vault-pki","text":"\u516c\u958b\u91d1\u9470\u57fa\u790e\u5efa\u8a2d Public Key Infrastructure","title":"Vault PKI"},{"location":"essay/vault/engine-pki/#_1","text":"\u5efa\u7acb Certificate Signing Request (CSR) \u81ea\u5df1\u7522\u751f\u516c\u79c1\u9470 \u7528\u79c1\u9470\u7c3d\u7f72 CSR \u5bc4\u767c CSR \u7d66 Certificate Authority (CA) CA \u7c3d\u7f72\u8a72 CSR \u56de\u50b3\u7684\u6771\u897f\u5c31\u662f\u4f60\u7684 Certificate \u82e5\u64a4\u92b7 CSR \u5247\u53ef\u80fd \u66f4\u65b0 CA \u672c\u5730\u7aef\u7684 Certificate Revocation List (CRL) \u6216\u7dda\u4e0a\u7684 Online Certificate Status Protocal (OCSP)","title":"\u50b3\u7d71\u6d41\u7a0b"},{"location":"essay/vault/engine-pki/#vault","text":"","title":"\u6709 Vault \u7684\u6d41\u7a0b"},{"location":"essay/vault/engine-pki/#root-ca-vault","text":"\u5efa\u7acb root CA \u5728 Vault \u5916\u9762 \u5efa\u7acb intermediate CA \u5728 Vault \u88e1\u9762 \u5efa\u7acb intermediate CA \u7684 CSR \u62ff\u51fa CSR \u4e26\u7d66 root CA \u7c3d\u7f72\u5f8c\u653e\u9032 Vault \u88e1\u9762","title":"\u82e5 root CA \u653e\u5728 Vault \u5916\u9762"},{"location":"essay/vault/engine-pki/#root-ca-vault_1","text":"\u9806\u8457\u4e0a\u8ff0\u6d41\u7a0b\u6253 API \u5c31\u597d Vault \u6703\u5e6b\u6211\u5011\u505a\u597d\u5404\u7a2e\u6e9d\u901a","title":"\u82e5 root CA \u5728 Vault \u88e1\u9762"},{"location":"essay/vault/engine-pki/#_2","text":"\u77ed\u671f\u7684 TTL \u53ef\u4ee5\u7701\u6389\u64a4\u92b7\u7684\u6a5f\u5236\uff0c\u4e26\u4e14\u7e2e\u77ed CRL \u7684\u9577\u5ea6 \u4e0d\u5efa\u8b70\u5229\u7528 command \u64a4\u92b7\uff0c\u591a\u5229\u7528\u77ed\u671f\u7684 TTL \u548c\u81ea\u52d5\u5316\u53bb\u9054\u5230\u5b89\u5168\u6027","title":"\u64a4\u92b7"},{"location":"essay/vault/engine-pki/#demo","text":"","title":"Demo"},{"location":"essay/vault/engine-pki/#_3","text":"$ vault secrets enable -path = root-pki pki","title":"\u74b0\u5883"},{"location":"essay/vault/engine-pki/#root-ca","text":"$ vault write root-pki/root/generate/internal \\ common_name = \"My Root CA\" \\ ttl = 24h # issuing certificate, CRL distribution points, and OCSP server endpoints $ vault write root-pki/config/urls \\ issuing_certificates = \" $VAULT_ADDR /v1/root-pki/ca\" \\ crl_distribution_points = \" $VAULT_ADDR /v1/root-pki/crl\" # See configuration $ curl -s \" $VAULT_ADDR /v1/root-pki/ca/pem\" | openssl x509 -text /ca/pem \u7121\u6cd5\u900f\u904e CLI \u7372\u5f97\uff0c\u4e14\u4e0d\u9700\u9a57\u8b49\u5373\u53ef\u5f97\u5230\u8a72\u503c\u3002 \u76f8\u95dc\u8aaa\u660e -----BEGIN CERTIFICATE----- MIIDITCCAgmgAwIBAgIUB+EbBBHSHVRn+onGcck9Fq8MI0EwDQYJKoZIhvcNAQEL BQAwGDEWMBQGA1UEAxMNVmF1bHQgUm9vdCBDQTAeFw0yMTA3MjYwODQ4NDNaFw0y MTA3MjYwOTQ5MTJaMBgxFjAUBgNVBAMTDVZhdWx0IFJvb3QgQ0EwggEiMA0GCSqG SIb3DQEBAQUAA4IBDwAwggEKAoIBAQCtIl1caDwF/H4TiB7PwGRvc3FrSZfp0A5A jPOGkcP8x0aNDz+RV+WVya2ANNXou4rIICWJDhkfUTNXkDXVCOcxeCl6x211EP69 6BkyGvbf7bIhMVcMmrzNqoHWSBFdPT0/rztdlUTgmW0ukYEdfSghrsGsaaAbxyyE aze+5dESuFQv+RXWp34kX81UJt+Z3e39DrjBWPDCoJUM6g6IijRgy0vVdV05GHmS SKGPqf03/2Iw9xmDEui4iomclqwvmG07UivEdD1pb4nZJBmCLnWXTe/5a9+1QdQf 7xEFAMpXOqHG9EQJWzG3rjNb5MhR+VXytNDq6nteEbaaiQwB6KhXAgMBAAGjYzBh MA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBTCy+Pz 4mqP6gnIkXkeq88JW4ExFDAfBgNVHSMEGDAWgBTCy+Pz4mqP6gnIkXkeq88JW4Ex FDANBgkqhkiG9w0BAQsFAAOCAQEADdzNcD085699P/cB24JKFk49zidHe33NwEI0 7Y9tPaAChPc6ZDOUX1wguy2QL8NpZNKbxAU73HXFKHK1UOGgJQxzOUKdGLRAKc5z E7pUF1lAyG2caJ4XtuECXKcFI/m2oaI5v+Mj8eeEv0PqV5aOmKqBsJfDtepZRYdj 0wzV8gyag2Y9rLMeveUmWF73y2l6g7KspSF0YXqzjZTJQj5oQcAmvdxSmKB8UBYD 1Rpa5Wdoq/XMwFPxL3b3qFuK+seGZzwvY9WGey5kAZQBZkkkWw519ZFGdiU1/Xjm L4zS/WOwyBRamvriYB2fG09Vtr+i+tGsghgzEm1smu0uSSPNhA== -----END CERTIFICATE-----%","title":"\u5efa\u7acb root CA"},{"location":"essay/vault/engine-pki/#intermediate-ca","text":"$ vault secrets enable -path = int-pki pki $ vault write -field = csr \\ int-pki/intermediate/generate/internal \\ common_name = \"My Intermediate CA\" \\ ttl = 12h > cert/intermediate.csr # Get signed CSR from root $ vault write -field = certificate \\ root-pki/root/sign-intermediate \\ csr = @cert/intermediate.csr \\ format = pem_bundle \\ ttl = 12h > cert/intermediate.crt # Root CA sign intermediate $ vault write int-pki/intermediate/set-signed \\ certificate = @cert/intermediate.crt # Urls $ vault write int-pki/config/urls \\ issuing_certificates = \" $VAULT_ADDR /v1/int-pki/ca\" \\ crl_distribution_points = \" $VAULT_ADDR /v1/int-pki/crl\" # Set role $ vault write int-pki/roles/example-dot-com \\ allowed_domains = example.com \\ allow_subdomains = true \\ allow_glob_domains = true \\ generate_lease = true \\ max_ttl = 1m \\ ttl = 1m \u4e0a\u8ff0\u5efa\u7acb\u7684 public url \u53ef\u900f\u904e curl $VAULT_ADDR/vi/int-pki/ca/pem \uff0c\u4ee5 PEM \u683c\u5f0f\u53d6\u5f97\u3002 \u53d6\u5f97\u7684 CA\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u6548\u671f\u9650\u662f 12 \u5c0f\u6642\uff1a Common Name: My Intermediate CA Issuing Certificate: My Root CA Serial Number: 2EEF1ACC06016AE04CE00FE575D7426CEE982582 Signature: sha256WithRSAEncryption Valid From: 07:16:44 21 Jul 2021 Valid To: 19:17:14 21 Jul 2021 Key Usage: Certificate Sign, CRL Sign Basic Constraints: CA:TRUE Subject Key Identifier: 46:C4:1E:F3:5B:EE:3D:64:88:37:CF:67:A8:E5:11:82:B5:CE:F0:18 Authority Key Identifier: keyid:71:37:14:BE:9B:66:E7:93:3E:4A:45:F1:B3:78:6E:37:30:38:CC:4D Authority Info Access: CA Issuers - URI:http://localhost:8200/v1/root-pki/ca \u53d6\u5f97\u7684 CRL\uff0c\u5f85\u6703 revoke certificate \u4e4b\u5f8c\u53ef\u4ee5\u770b\u5176\u8b8a\u5316\uff1a Version: 2 IssuerDN: CN=My Intermediate CA This update: Wed Jul 21 07:17:31 UTC 2021 Next update: Sat Jul 24 07:17:31 UTC 2021 Signature Algorithm: SHA256WITHRSA Signature: 282359565d73c1ab950771e685ec352827967bd0 a969e57cbacad44d2c435d4478de6f6139ef8594 59fd862df7f61894f79cd1e775104ef45da7a95f 7749ee639fda5a0e12a7a7b211d875aaf1c6a876 7e5089492d38bd0098c4adc3d57d51fa7f5a90e6 4ae2fd715376b65cd58a004002002b8d91a0251d 1f01d0bdcead7784d5b55a7ce010a1830452bbd1 2b37f62e3d85bc62c8f05111c8cbbfdc554f27ff 588cc2efa77cd462d02a0026dc19fc5fd64b3021 cf6bf17279e9b1ab1f13a03e3737dbe60601828f 1e3cc669b508837b602abb9dcb221ae05047a7d4 22859538c78eb44887cef9cdd62adf45abc8f278 dad4dada9835ef6eccbe3a7ccd1a915b Extensions: critical(false) 2.5.29.35 value = Sequence Tagged [0] IMPLICIT DER Octet String[20]","title":"\u5efa\u7acb intermediate CA"},{"location":"essay/vault/engine-pki/#token","text":"","title":"\u5efa\u7acb Token"},{"location":"essay/vault/engine-pki/#policy","text":"policy.hcl # Intermediate CA issue you! path \"int-pki/issue/example-dot-com\" { \"capabilities\" = [\"create\", \"update\"] } # Root CA verify cert! path \"root-pki/cert/ca\" { \"capabilities\" = [\"read\"] } # Token path \"auth/token/renew\" { \"capabilities\" = [\"update\"] } path \"auth/token/renew-self\" { \"capabilities\" = [\"update\"] }","title":"Policy"},{"location":"essay/vault/engine-pki/#policy-token","text":"# Policy $ vault policy write intermediate-pki policy.hcl # Token $ vault token create \\ -field = token \\ -policy = intermediate-pki \\ -ttl = 1h > pki.token","title":"\u8a2d\u5b9a policy \u548c\u5efa\u7acb token"},{"location":"essay/vault/engine-pki/#consul-template-certificate","text":"","title":"\u5229\u7528 consul-template \u53bb\u81ea\u52d5\u8981 certificate"},{"location":"essay/vault/engine-pki/#template","text":"certificate.tpl {{- with secret \"int-pki/issue/example-dot-com\" \"common_name=blah.example.com\" -}} {{ .Data.certificate }}{{ end }} key.tpl {{- with secret \"int-pki/issue/example-dot-com\" \"common_name=blah.example.com\" -}} {{ .Data.private_key }}{{ end }}","title":"Template"},{"location":"essay/vault/engine-pki/#consul-template","text":"config.hcl vault { address = \"http://127.0.0.1:8200\" vault_agent_token_file = \"pki.token\" renew_token = true retry { attempts = 1 backoff = \"250ms\" } } // log_level = \"debug\" template { source = \"certificate.tpl\" destination = \"client.crt\" command = \"echo generate certificate!\" } template { source = \"key.tpl\" destination = \"client.key\" command = \"echo generate key!\" }","title":"consul-template \u7684\u53c3\u6578"},{"location":"essay/vault/engine-pki/#_4","text":"$ consul-template -config = config.hcl \u5c31\u6703\u770b\u5230\u4e0b\u5217\u8a0a\u606f\u53cd\u8986\u51fa\u73fe\uff1a generate certificate! generate key! expiration: revoked lease: lease_id=int-pki/issue/example-dot-com/.. \u62ff\u5230\u7684 Certificate\uff1a Common Name: blah.example.com Issuing Certificate: My Intermediate CA Serial Number: 6C24455D423496C85411FF857EAC28127DF16B4D Signature: sha256WithRSAEncryption Valid From: 07:38:44 21 Jul 2021 Valid To: 07:40:14 21 Jul 2021 Key Usage: Digital Signature, Key Encipherment, Key Agreement Extended Key Usage: TLS Web Server Authentication, TLS Web Client Authentication Subject Key Identifier: 77:79:22:4B:12:19:5D:F2:55:FF:76:11:CE:5D:34:1C:60:4C:44:76 Authority Key Identifier: keyid:46:C4:1E:F3:5B:EE:3D:64:88:37:CF:67:A8:E5:11:82:B5:CE:F0:18 Authority Info Access: CA Issuers - URI:http://localhost:8200/v1/int-pki/ca Subject Alternative Names: DNS:blah.example.com","title":"\u8dd1\u8dd1\u770b\u5427\uff01"},{"location":"essay/vault/engine-pki/#clean-up","text":"\u82e5\u8981\u6e05\u9664\u904e\u671f\u7684 cert\uff0c\u8acb\u547c\u53eb $ vault write root-pki/tidy tidy_revoked_certs = true \u76f8\u95dc\u8aaa\u660e","title":"clean up"},{"location":"essay/vault/engine-transit/","text":"Vault Transit \u529f\u80fd \u8b93 Vault \u8b8a\u6210\u4e00\u53f0\u5e6b\u5fd9\u8655\u7406\u52a0\u89e3\u5bc6\u7684\u6a5f\u5668 \u660e\u6587\u8f38\u5165\uff0c\u5bc6\u6587\u8f38\u51fa\u3002 \u5bc6\u6587\u8f38\u5165\uff0c\u900f\u904e\u5bc6\u6587\u7684\u5b57\u9996\u5224\u65b7\u662f\u54ea\u4e00\u500b\u91d1\u9470\u505a\u7684\u52a0\u5bc6\uff0c\u8f38\u51fa\u660e\u6587\u3002 \u4e5f\u53ef\u4ee5\u7d14\u505a\u7c3d\u3001\u9a57\u8b49\u3002 \u91d1\u9470\u8f49\u63db \u6703\u628a\u8a72\u7248\u672c\u7684\u91d1\u9470\u6240\u7522\u751f\u7684\u5bc6\u6587\u52a0\u4e0a\u8a72\u7248\u672c\u7684\u6a19\u982d\u3002 v1 key encryption result: vault:v1:8SDd3WHDO... v5 key encryption result: vault:v5:bXkgc2Vjc... \u53ef\u4ee5\u5728\u900f\u904e\u53c3\u6578 min_decryption_version \u7981\u6b62\u4f7f\u7528\u904e\u820a\u7684\u91d1\u9470\u3002 \u82e5\u8f49\u63db\u904e\u591a\u91d1\u9470\u6703\u9020\u6210\u6548\u7387\u554f\u984c \u53ef\u4ee5\u7522\u751f\u5168\u65b0\u7684\u91d1\u9470\u4f86\u907f\u514d\u904e\u5927\u7684\u9470\u5319\u7248\u672c key1:v8:abc... => post to key1 with vault:v8:abc... key2:v6:def... => post to key2 with vault:v6:def... \u91d1\u9470\u7248\u672c\u9650\u5236 min_decryption_version , min_encryption_version , min_available_version \uff08\u522a\u9664\u820a\u7248\u672c\u7684\u91d1\u9470\uff09 \u5982\u679c\u8981\u9010\u6b65\u6dd8\u6c70\u820a\u7248\u7684\u91d1\u9470\u5462\uff1f rewrap - \u628a\u6307\u5b9a\u7684\u5bc6\u6587\u89e3\u5bc6\u4e26\u91cd\u65b0\u7528\u65b0\u7684\u91d1\u9470\u52a0\u5bc6 key_version - \u9810\u8a2d\u70ba\u6700\u65b0\u7248\u7684\u91d1\u9470 batch_input \u7279\u6b8a\u529f\u80fd Key derivation \u52a0\u89e3\u5bc6\u6703\u9700\u8981 content \uff08\u548c salt \u4e00\u6a23\uff09\u3002 new key = HMAC(key, content) \u8b93\u9470\u5319\u5728\u6bcf\u6b21\u52a0\u5bc6\u90fd\u4e0d\u4e00\u6a23\uff0c\u64c1\u6709\u66f4\u9ad8\u7684\u5b89\u5168\u6027\u3002 Convergent encryption \u78ba\u4fdd\u7576\u660e\u6587\u4e00\u6a23\uff0c\u5bc6\u6587\u5c31\u6703\u4e00\u6a23\u3002 \u7528\u9014\u4e4b\u4e00\uff1a\u53ef\u4ee5\u907f\u514d\u91cd\u8907\u7684\u8cc7\u6599\u5b58\u5165 DB \u5fc5\u9808\u914d\u5408\u4f7f\u7528 key derivation \u4fdd\u8b49\u5b89\u5168\u6027\u3002 \u8f38\u5165\u660e\u6587\u5916\u9084\u8981\u8f38\u5165 nonce \u3002 Datakey generation \u7528\u9014\u4e4b\u4e00\uff1a\u52a0\u5bc6\u5927\u91cf\u8cc7\u6599\uff0c\u907f\u514d\u983b\u5bec\u7684\u4f54\u7528\u3002 \u7522\u751f\u9470\u5319\u3002 \u5229\u7528\u52a0\u89e3\u5bc6\u91d1\u9470\u52a0\u5bc6\u6b64\u9470\u5319\u3002 \u8f38\u51fa\u52a0\u5bc6\u5f8c\u7684\u9470\u5319 \u91cd\u65b0\u8981\u6c42\u89e3\u5bc6\u5f97\u5230\u771f\u6b63\u7684\u9470\u5319 \u76f4\u63a5\u8f38\u51fa\u771f\u6b63\u7684\u9470\u5319 \u9810\u8a2d\uff1a\u5169\u500b\u90fd\u8f38\u51fa DEMO \u74b0\u5883 $ vault secrets enable transit # -f for force post request when no data $ vault write -f transit/keys/example $ vault policy write transit-example policy.hcl $ vault token create \\ -field = token \\ -policy = transit-example \\ -ttl = 1h \u52a0\u5bc6 $ vault write -field = ciphertext \\ transit/encrypt/example \\ plaintext = $( base64 <<< \"4111 1111 1111 1111\" ) vault:v1:+W+aOV4DqhOLqCmTZ2oRqj6qAjTyZNYkoYfUraPl88XwEy3hC8Ul2WyrcP8Mz/sg \u89e3\u5bc6 $ vault write -field = plaintext \\ transit/decrypt/example \\ ciphertext = 'vault:v1:+W+aOV4DqhOLqCmTZ2oRqj6qAjTyZNYkoYfUraPl88XwEy3hC8Ul2WyrcP8Mz/sg' NDExMSAxMTExIDExMTEgMTExMQo \u91d1\u9470\u8f49\u63db $ vault write -f transit/keys/example/rotate $ vault write -field = ciphertext \\ transit/encrypt/example \\ plaintext = $( base64 <<< \"4111 1111 1111 1111\" ) vault:v2:Dbpgk1UhlY+74uj8ecmFEiYfriDTWZc907VgO1EWfSXmMnPW3j+qDaetDlnOTVOI \u91d1\u9470\u9650\u5236 $ vault write transit/keys/example/config \\ min_decryption_version = 2 \\ min_encryption_version = 2 # Decrypt v1 will return error $ vault write transit/decrypt/example \\ ciphertext = 'vault:v1:+W+aOV4DqhOLqCmTZ2oRqj6qAjTyZNYkoYfUraPl88XwEy3hC8Ul2WyrcP8Mz/sg' \u91cd\u5305\u5bc6\u6587 $ vault write transit/keys/example/config min_decryption_version = 1 $ vault write -field = ciphertext \\ transit/rewrap/example \\ ciphertext = 'vault:v1:+W+aOV4DqhOLqCmTZ2oRqj6qAjTyZNYkoYfUraPl88XwEy3hC8Ul2WyrcP8Mz/sg' \u6c38\u4e45\u522a\u9664\u820a\u7248\u91d1\u9470 $ vault write transit/keys/example/config min_decryption_version = 2 $ vault write transit/keys/example/trim min_available_version = 2 \u91d1\u9470\u53ef\u4ee5\u5bb9\u5fcd\u7684\u6700\u5927\u7248\u672c\u6578\u91cf \u91d1\u9470\u7a2e\u985e Consul \u9810\u8a2d\u503c (512 KiB) aes128-gcm96 keys 2008 aes256-gcm96 keys 1865 chacha-poly1305 keys 1865 ed25519 keys 1420 ecdsa-p256 keys 817 ecdsa-p384 keys 659 ecdsa-p523 keys 539 1024-bit RSA keys 169 2048-bit RSA keys 116 4096-bit RSA kyes 89","title":"Transit"},{"location":"essay/vault/engine-transit/#vault-transit","text":"","title":"Vault Transit"},{"location":"essay/vault/engine-transit/#_1","text":"\u8b93 Vault \u8b8a\u6210\u4e00\u53f0\u5e6b\u5fd9\u8655\u7406\u52a0\u89e3\u5bc6\u7684\u6a5f\u5668 \u660e\u6587\u8f38\u5165\uff0c\u5bc6\u6587\u8f38\u51fa\u3002 \u5bc6\u6587\u8f38\u5165\uff0c\u900f\u904e\u5bc6\u6587\u7684\u5b57\u9996\u5224\u65b7\u662f\u54ea\u4e00\u500b\u91d1\u9470\u505a\u7684\u52a0\u5bc6\uff0c\u8f38\u51fa\u660e\u6587\u3002 \u4e5f\u53ef\u4ee5\u7d14\u505a\u7c3d\u3001\u9a57\u8b49\u3002","title":"\u529f\u80fd"},{"location":"essay/vault/engine-transit/#_2","text":"\u6703\u628a\u8a72\u7248\u672c\u7684\u91d1\u9470\u6240\u7522\u751f\u7684\u5bc6\u6587\u52a0\u4e0a\u8a72\u7248\u672c\u7684\u6a19\u982d\u3002 v1 key encryption result: vault:v1:8SDd3WHDO... v5 key encryption result: vault:v5:bXkgc2Vjc... \u53ef\u4ee5\u5728\u900f\u904e\u53c3\u6578 min_decryption_version \u7981\u6b62\u4f7f\u7528\u904e\u820a\u7684\u91d1\u9470\u3002 \u82e5\u8f49\u63db\u904e\u591a\u91d1\u9470\u6703\u9020\u6210\u6548\u7387\u554f\u984c \u53ef\u4ee5\u7522\u751f\u5168\u65b0\u7684\u91d1\u9470\u4f86\u907f\u514d\u904e\u5927\u7684\u9470\u5319\u7248\u672c key1:v8:abc... => post to key1 with vault:v8:abc... key2:v6:def... => post to key2 with vault:v6:def...","title":"\u91d1\u9470\u8f49\u63db"},{"location":"essay/vault/engine-transit/#_3","text":"min_decryption_version , min_encryption_version , min_available_version \uff08\u522a\u9664\u820a\u7248\u672c\u7684\u91d1\u9470\uff09 \u5982\u679c\u8981\u9010\u6b65\u6dd8\u6c70\u820a\u7248\u7684\u91d1\u9470\u5462\uff1f rewrap - \u628a\u6307\u5b9a\u7684\u5bc6\u6587\u89e3\u5bc6\u4e26\u91cd\u65b0\u7528\u65b0\u7684\u91d1\u9470\u52a0\u5bc6 key_version - \u9810\u8a2d\u70ba\u6700\u65b0\u7248\u7684\u91d1\u9470 batch_input","title":"\u91d1\u9470\u7248\u672c\u9650\u5236"},{"location":"essay/vault/engine-transit/#_4","text":"","title":"\u7279\u6b8a\u529f\u80fd"},{"location":"essay/vault/engine-transit/#key-derivation","text":"\u52a0\u89e3\u5bc6\u6703\u9700\u8981 content \uff08\u548c salt \u4e00\u6a23\uff09\u3002 new key = HMAC(key, content) \u8b93\u9470\u5319\u5728\u6bcf\u6b21\u52a0\u5bc6\u90fd\u4e0d\u4e00\u6a23\uff0c\u64c1\u6709\u66f4\u9ad8\u7684\u5b89\u5168\u6027\u3002","title":"Key derivation"},{"location":"essay/vault/engine-transit/#convergent-encryption","text":"\u78ba\u4fdd\u7576\u660e\u6587\u4e00\u6a23\uff0c\u5bc6\u6587\u5c31\u6703\u4e00\u6a23\u3002 \u7528\u9014\u4e4b\u4e00\uff1a\u53ef\u4ee5\u907f\u514d\u91cd\u8907\u7684\u8cc7\u6599\u5b58\u5165 DB \u5fc5\u9808\u914d\u5408\u4f7f\u7528 key derivation \u4fdd\u8b49\u5b89\u5168\u6027\u3002 \u8f38\u5165\u660e\u6587\u5916\u9084\u8981\u8f38\u5165 nonce \u3002","title":"Convergent encryption"},{"location":"essay/vault/engine-transit/#datakey-generation","text":"\u7528\u9014\u4e4b\u4e00\uff1a\u52a0\u5bc6\u5927\u91cf\u8cc7\u6599\uff0c\u907f\u514d\u983b\u5bec\u7684\u4f54\u7528\u3002 \u7522\u751f\u9470\u5319\u3002 \u5229\u7528\u52a0\u89e3\u5bc6\u91d1\u9470\u52a0\u5bc6\u6b64\u9470\u5319\u3002 \u8f38\u51fa\u52a0\u5bc6\u5f8c\u7684\u9470\u5319 \u91cd\u65b0\u8981\u6c42\u89e3\u5bc6\u5f97\u5230\u771f\u6b63\u7684\u9470\u5319 \u76f4\u63a5\u8f38\u51fa\u771f\u6b63\u7684\u9470\u5319 \u9810\u8a2d\uff1a\u5169\u500b\u90fd\u8f38\u51fa","title":"Datakey generation"},{"location":"essay/vault/engine-transit/#demo","text":"","title":"DEMO"},{"location":"essay/vault/engine-transit/#_5","text":"$ vault secrets enable transit # -f for force post request when no data $ vault write -f transit/keys/example $ vault policy write transit-example policy.hcl $ vault token create \\ -field = token \\ -policy = transit-example \\ -ttl = 1h","title":"\u74b0\u5883"},{"location":"essay/vault/engine-transit/#_6","text":"$ vault write -field = ciphertext \\ transit/encrypt/example \\ plaintext = $( base64 <<< \"4111 1111 1111 1111\" ) vault:v1:+W+aOV4DqhOLqCmTZ2oRqj6qAjTyZNYkoYfUraPl88XwEy3hC8Ul2WyrcP8Mz/sg","title":"\u52a0\u5bc6"},{"location":"essay/vault/engine-transit/#_7","text":"$ vault write -field = plaintext \\ transit/decrypt/example \\ ciphertext = 'vault:v1:+W+aOV4DqhOLqCmTZ2oRqj6qAjTyZNYkoYfUraPl88XwEy3hC8Ul2WyrcP8Mz/sg' NDExMSAxMTExIDExMTEgMTExMQo","title":"\u89e3\u5bc6"},{"location":"essay/vault/engine-transit/#_8","text":"$ vault write -f transit/keys/example/rotate $ vault write -field = ciphertext \\ transit/encrypt/example \\ plaintext = $( base64 <<< \"4111 1111 1111 1111\" ) vault:v2:Dbpgk1UhlY+74uj8ecmFEiYfriDTWZc907VgO1EWfSXmMnPW3j+qDaetDlnOTVOI","title":"\u91d1\u9470\u8f49\u63db"},{"location":"essay/vault/engine-transit/#_9","text":"$ vault write transit/keys/example/config \\ min_decryption_version = 2 \\ min_encryption_version = 2 # Decrypt v1 will return error $ vault write transit/decrypt/example \\ ciphertext = 'vault:v1:+W+aOV4DqhOLqCmTZ2oRqj6qAjTyZNYkoYfUraPl88XwEy3hC8Ul2WyrcP8Mz/sg'","title":"\u91d1\u9470\u9650\u5236"},{"location":"essay/vault/engine-transit/#_10","text":"$ vault write transit/keys/example/config min_decryption_version = 1 $ vault write -field = ciphertext \\ transit/rewrap/example \\ ciphertext = 'vault:v1:+W+aOV4DqhOLqCmTZ2oRqj6qAjTyZNYkoYfUraPl88XwEy3hC8Ul2WyrcP8Mz/sg'","title":"\u91cd\u5305\u5bc6\u6587"},{"location":"essay/vault/engine-transit/#_11","text":"$ vault write transit/keys/example/config min_decryption_version = 2 $ vault write transit/keys/example/trim min_available_version = 2","title":"\u6c38\u4e45\u522a\u9664\u820a\u7248\u91d1\u9470"},{"location":"essay/vault/engine-transit/#_12","text":"\u91d1\u9470\u7a2e\u985e Consul \u9810\u8a2d\u503c (512 KiB) aes128-gcm96 keys 2008 aes256-gcm96 keys 1865 chacha-poly1305 keys 1865 ed25519 keys 1420 ecdsa-p256 keys 817 ecdsa-p384 keys 659 ecdsa-p523 keys 539 1024-bit RSA keys 169 2048-bit RSA keys 116 4096-bit RSA kyes 89","title":"\u91d1\u9470\u53ef\u4ee5\u5bb9\u5fcd\u7684\u6700\u5927\u7248\u672c\u6578\u91cf"},{"location":"essay/vault/implementation/","text":"Vault \u5be6\u4f5c Server \u8a2d\u5b9a { \"storage\" : { \"mysql\" : { \"address\" : \"127.0.0.1:3306\" , \"database\" : \"playground\" , \"table\" : \"vault\" , \"username\" : \"root\" , \"password\" : \"mysql-password\" , \"plaintext_connection_allowed\" : true , \"ha_enabled\" : true } }, \"listener\" : { \"tcp\" : { \"tls_disable\" : true } }, \"seal\" : { \"awskms\" : { \"region\" : \"ap-northeast-1\" , \"access_key\" : \"aws-iam-access-key\" , \"secret_key\" : \"aws-iam-secret-key\" , \"kms_key_id\" : \"aws-kms-key-id\" } }, \"ui\" : true , \"disable_mlock\" : true , \"api_addr\" : \"http://127.0.0.1:8200\" , \"cluster_addr\" : \"https://127.0.0.1:8201\" } $ vault server -config = config.json Seal/Unseal \u521d\u59cb\u5316\u4e26\u7372\u5f97 Recovery Key \u548c Root Token $ vault operator init -recovery-shares = 1 -recovery-threshold = 1 Recovery Key 1 : fFtAyv+N/h4YdgQmLveOleONswIYmNorw6E65Jv7ciU Initial Root Token: s.9gFtHEu35b4FCBHbUtaLxeOw $ vault status Key Value --- ----- Recovery Seal Type shamir Initialized true Sealed false Total Recovery Shares 1 Threshold 1 Version 1 .6.1 Storage Type mysql Cluster Name vault-cluster-d4a98a31 Cluster ID 06bbee1f-d643-31c1-a87b-ba43d3b1d2d3 HA Enabled true HA Cluster https://127.0.0.1:8201 HA Mode active MySQL \u53ef\u4ee5\u770b\u5230\u4e3b\u9470\u548c\u52a0\u5bc6\u91d1\u66dc\u90fd\u5df2\u7d93\u5efa\u7acb\u597d\u4e86 vault_key vault_value --------- ----------- core/keyring ... core/master ... Login $ vault login s.9gFtHEu35b4FCBHbUtaLxeOw Seal \u91cd\u65b0\u5c01\u5370\u4e26\u518d\u89e3\u5c01\u7684\u8a71\u8981\u8f38\u5165 Recovery Key \u6ce8\u610f\uff1a\u82e5\u91cd\u65b0\u7533\u8acb\u4e00\u500b Root Token \uff0c\u4e5f\u6703\u9700\u8981 Recovery Key $ vault operator seal $ vault operator unseal Unseal Key ( will be hidden ) : Secrets key-value \u7684\u8cc7\u6599\u5eab $ vault secrets enable -path = secret kv $ vault kv put secret/hello foo = world $ vault kv list secret $ vault kv get secret/hello MySQL \u53ef\u4ee5\u770b\u5230\u8cc7\u6599\u5eab\u4f9d\u6b64\u5efa\u7acb\u4e86\u65b0\u7684\u8def\u5f91\uff0c secret/hello \u4e2d\u7684 secret \u88ab\u52a0\u5bc6\u4e86 vault_key vault_value --------- ----------- logical/beefac89-6bc8-6bfd-1af8-c1436c19926c/hello ... Authentication \u5148\u5141\u8a31 GitHub \u767b\u5165 $ vault auth enable github $ vault write auth/github/config organization = 104corp \u767b\u51fa $ rm ~/.vault-token GitHub \u5b58\u53d6\u6b0a\u6756 \u53bb GitHub \u8a2d\u5b9a\u9801 > Developer settings > Personal access tokens > Generate new token \u6b0a\u9650\u8981\u6709\uff1a admin:org > read:org \uff0c\u8b93 Vault \u53ef\u4ee5\u8b80\u53d6\u4f60\u5e33\u865f\u7684\u7d44\u7e54 \u767b\u5165 $ vault login -method = github -token = access-token-from-github Key Value --- ------ token s.AtDndppL6auMYfI27zfkvgn1 token_accessor WC8tFkMglS9S3RLtitHdAtRe token_duration 768h token_renewable true token_policies [ \"default\" ] identity_policies [] policies [ \"default\" ] token_meta_username evan361425 token_meta_org 104corp \u8cc7\u8a0a $ vault token lookup s.AtDndppL6auMYfI27zfkvgn1 Key Value --- ----- accessor WC8tFkMglS9S3RLtitHdAtRe creation_time 1610344081 creation_ttl 768h display_name github-evan361425 entity_id 7b404dd3-5b23-da3f-663c-76a66e84ebe8 expire_time 2021 -02-12T13:48:01.492935+08:00 explicit_max_ttl 0s id s.AtDndppL6auMYfI27zfkvgn1 issue_time 2021 -01-11T13:48:01.492956+08:00 meta map [ org:104corp username:evan361425 ] num_uses 0 orphan true path auth/github/login policies [ default ] renewable true ttl 767h36m19s type service Token \u5148\u91cd\u65b0\u767b\u5165\u56de Root Token # \u770b\u770b\u73fe\u5728\u662f\u7528\u4ec0\u9ebc\u6b0a\u6756 $ vault print token s.AtDndppL6auMYfI27zfkvgn1 # \u6b64\u6b0a\u6756\u4e26\u975e Root Token\uff0c\u767b\u51fa $ rm ~/.vault-token $ vault login s.9gFtHEu35b4FCBHbUtaLxeOw \u5217\u51fa\u6240\u6709 token \u7684 accessor $ vault list auth/token/accessors Batch Token \u5148\u5efa\u7acb Policy $ vault token create -type = batch -orphan = true -policy = my-policy Key Value --- ----- token b.AAAAAQKn0sVCMJNVTBWHXpwjQ1HbgpyDsJ8WeKtVaZiiUCLK13uT4-pknd0lsHyiXVw7jaRy2U03o0K-TjtEU40v5f26KZXiY12vlMakT1WZuL-NdQ6pGD9fj4YGRp39qKY_jbQyrx8 token_accessor n/a token_duration 768h token_renewable false token_policies [ \"default\" \"my-policy\" ] identity_policies [] policies [ \"default\" \"my-policy\" ] batch token \u958b\u982d\u662f b \uff0c\u53cd\u4e4b\uff0c\u5e38\u898b\u7684 token \u662f s \u958b\u982d\uff0c\u4ee3\u8868 service token Wrapping Token $ vault token create -policy = my-policy -wrap-ttl = 120 Key Value --- ----- wrapping_token: s.F7S12zD0PUcEL5VShhElBZIb wrapping_accessor: LsfBV3JiC4zwWCaFEZqNW9db wrapping_token_ttl: 2m wrapping_token_creation_time: 2021 -01-11 16 :49:11.614054 +0800 CST wrapping_token_creation_path: auth/token/create wrapped_accessor: oW7NNQUM35G7mvTQ4vieDPqi vault unwrap s.F7S12zD0PUcEL5VShhElBZIb Key Value --- ----- token s.v8lwNg4uwfZzlHvDrmPdkRyF token_accessor oW7NNQUM35G7mvTQ4vieDPqi token_duration 768h token_renewable true token_policies [ \"default\" \"my-policy\" ] identity_policies [] policies [ \"default\" \"my-policy\" ] API $ curl \\ --header \"X-Vault-Token: s.9gFtHEu35b4FCBHbUtaLxeOw\" \\ --header \"X-Vault-Wrap-TTL: 60\" \\ --request POST \\ --data \"{\\\"foo\\\": \\\"bar\\\"}\" \\ http://127.0.0.1:8200/v1/sys/wrapping/wrap { \"request_id\" : \"\" , \"lease_id\" : \"\" , \"renewable\" : false, \"lease_duration\" : 0 , \"data\" : null, \"wrap_info\" : { \"token\" : \"s.3MeMoyxudk19RHKzCZAa55oi\" , \"accessor\" : \"6rKApXj7R8iNz3gZjkIpd8Y4\" , \"ttl\" : 60 , \"creation_time\" : \"2021-01-11T17:08:44.876296+08:00\" , \"creation_path\" : \"sys/wrapping/wrap\" } , \"warnings\" : null, \"auth\" : null } $ curl \\ --header \"X-Vault-Token: s.9gFtHEu35b4FCBHbUtaLxeOw\" \\ --request POST \\ --data \"{\\\"token\\\":\\\"s.3MeMoyxudk19RHKzCZAa55oi\\\"}\" \\ http://127.0.0.1:8200/v1/sys/wrapping/lookup { \"request_id\" : \"67be1f69-e921-0eac-a660-5aa4f2761cb1\" , \"lease_id\" : \"\" , \"renewable\" : false, \"lease_duration\" : 0 , \"data\" : { \"creation_path\" : \"sys/wrapping/wrap\" , \"creation_time\" : \"2021-01-11T17:11:00.784059+08:00\" , \"creation_ttl\" : 60 } , \"wrap_info\" : null, \"warnings\" : null, \"auth\" : null } Policy \u8b80\u53d6\u73fe\u6709\u7684\u653f\u7b56 $ vault read sys/policy Key Value --- ----- keys [ default root ] policies [ default root ] \u5efa\u7acb\u653f\u7b56 $ vault policy write my-policy policy.hcl policy.hcl \u6a94\uff1a path \"secret/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"] } path \"secret/hello\" { capabilities = [\"deny\"] } path \"secret/restricted\" { capabilities = [\"create\"] allowed_parameters = { \"foo\" = [] \"bar\" = [\"zip\", \"zap\"] } } High Availability Different from config { \"listener\" : { \"tcp\" : { \"address\" : \"127.0.0.1:8100\" , \"cluster_address\" : \"127.0.0.1:8101\" } } } $ export VAULT_ADDR = \"http://127.0.0.1:8100\" $ vault status Key Value --- ----- Recovery Seal Type shamir Initialized true Sealed false Total Recovery Shares 1 Threshold 1 Version 1 .6.1 Storage Type mysql Cluster Name vault-cluster-d4a98a31 Cluster ID 06bbee1f-d643-31c1-a87b-ba43d3b1d2d3 HA Enabled true HA Cluster https://127.0.0.1:8201 HA Mode standby Active Node Address http://127.0.0.1:8200 Rate Limit $ vault read sys/quotas/config Key Value --- ----- enable_rate_limit_audit_logging false enable_rate_limit_response_headers false rate_limit_exempt_paths [ /v1/sys/generate-recovery-token/attempt /v1/sys/generate-recovery-token/update /v1/sys/generate-root/attempt /v1/sys/generate-root/update /v1/sys/health /v1/sys/seal-status /v1/sys/unseal ] \u5b58\u53d6\u3001\u7de8\u8f2f $ vault write sys/quotas/rate-limit/global-rate rate = 500 $ vault read sys/quotas/rate-limit/global-rate Key Value --- ----- block_interval 0 interval 1 name global-rate path n/a rate 500 type rate-limit $ vault write sys/quotas/rate-limit/global-rate rate = 501 $ vault delete sys/quotas/rate-limit/global-rate Debug $ vault debug","title":"\u5be6\u4f5c"},{"location":"essay/vault/implementation/#vault","text":"","title":"Vault \u5be6\u4f5c"},{"location":"essay/vault/implementation/#server","text":"{ \"storage\" : { \"mysql\" : { \"address\" : \"127.0.0.1:3306\" , \"database\" : \"playground\" , \"table\" : \"vault\" , \"username\" : \"root\" , \"password\" : \"mysql-password\" , \"plaintext_connection_allowed\" : true , \"ha_enabled\" : true } }, \"listener\" : { \"tcp\" : { \"tls_disable\" : true } }, \"seal\" : { \"awskms\" : { \"region\" : \"ap-northeast-1\" , \"access_key\" : \"aws-iam-access-key\" , \"secret_key\" : \"aws-iam-secret-key\" , \"kms_key_id\" : \"aws-kms-key-id\" } }, \"ui\" : true , \"disable_mlock\" : true , \"api_addr\" : \"http://127.0.0.1:8200\" , \"cluster_addr\" : \"https://127.0.0.1:8201\" } $ vault server -config = config.json","title":"Server \u8a2d\u5b9a"},{"location":"essay/vault/implementation/#sealunseal","text":"\u521d\u59cb\u5316\u4e26\u7372\u5f97 Recovery Key \u548c Root Token $ vault operator init -recovery-shares = 1 -recovery-threshold = 1 Recovery Key 1 : fFtAyv+N/h4YdgQmLveOleONswIYmNorw6E65Jv7ciU Initial Root Token: s.9gFtHEu35b4FCBHbUtaLxeOw $ vault status Key Value --- ----- Recovery Seal Type shamir Initialized true Sealed false Total Recovery Shares 1 Threshold 1 Version 1 .6.1 Storage Type mysql Cluster Name vault-cluster-d4a98a31 Cluster ID 06bbee1f-d643-31c1-a87b-ba43d3b1d2d3 HA Enabled true HA Cluster https://127.0.0.1:8201 HA Mode active","title":"Seal/Unseal"},{"location":"essay/vault/implementation/#mysql","text":"\u53ef\u4ee5\u770b\u5230\u4e3b\u9470\u548c\u52a0\u5bc6\u91d1\u66dc\u90fd\u5df2\u7d93\u5efa\u7acb\u597d\u4e86 vault_key vault_value --------- ----------- core/keyring ... core/master ...","title":"MySQL"},{"location":"essay/vault/implementation/#login","text":"$ vault login s.9gFtHEu35b4FCBHbUtaLxeOw","title":"Login"},{"location":"essay/vault/implementation/#seal","text":"\u91cd\u65b0\u5c01\u5370\u4e26\u518d\u89e3\u5c01\u7684\u8a71\u8981\u8f38\u5165 Recovery Key \u6ce8\u610f\uff1a\u82e5\u91cd\u65b0\u7533\u8acb\u4e00\u500b Root Token \uff0c\u4e5f\u6703\u9700\u8981 Recovery Key $ vault operator seal $ vault operator unseal Unseal Key ( will be hidden ) :","title":"Seal"},{"location":"essay/vault/implementation/#secrets","text":"key-value \u7684\u8cc7\u6599\u5eab $ vault secrets enable -path = secret kv $ vault kv put secret/hello foo = world $ vault kv list secret $ vault kv get secret/hello","title":"Secrets"},{"location":"essay/vault/implementation/#mysql_1","text":"\u53ef\u4ee5\u770b\u5230\u8cc7\u6599\u5eab\u4f9d\u6b64\u5efa\u7acb\u4e86\u65b0\u7684\u8def\u5f91\uff0c secret/hello \u4e2d\u7684 secret \u88ab\u52a0\u5bc6\u4e86 vault_key vault_value --------- ----------- logical/beefac89-6bc8-6bfd-1af8-c1436c19926c/hello ...","title":"MySQL"},{"location":"essay/vault/implementation/#authentication","text":"\u5148\u5141\u8a31 GitHub \u767b\u5165 $ vault auth enable github $ vault write auth/github/config organization = 104corp","title":"Authentication"},{"location":"essay/vault/implementation/#_1","text":"$ rm ~/.vault-token","title":"\u767b\u51fa"},{"location":"essay/vault/implementation/#github","text":"","title":"GitHub"},{"location":"essay/vault/implementation/#_2","text":"\u53bb GitHub \u8a2d\u5b9a\u9801 > Developer settings > Personal access tokens > Generate new token \u6b0a\u9650\u8981\u6709\uff1a admin:org > read:org \uff0c\u8b93 Vault \u53ef\u4ee5\u8b80\u53d6\u4f60\u5e33\u865f\u7684\u7d44\u7e54","title":"\u5b58\u53d6\u6b0a\u6756"},{"location":"essay/vault/implementation/#_3","text":"$ vault login -method = github -token = access-token-from-github Key Value --- ------ token s.AtDndppL6auMYfI27zfkvgn1 token_accessor WC8tFkMglS9S3RLtitHdAtRe token_duration 768h token_renewable true token_policies [ \"default\" ] identity_policies [] policies [ \"default\" ] token_meta_username evan361425 token_meta_org 104corp","title":"\u767b\u5165"},{"location":"essay/vault/implementation/#_4","text":"$ vault token lookup s.AtDndppL6auMYfI27zfkvgn1 Key Value --- ----- accessor WC8tFkMglS9S3RLtitHdAtRe creation_time 1610344081 creation_ttl 768h display_name github-evan361425 entity_id 7b404dd3-5b23-da3f-663c-76a66e84ebe8 expire_time 2021 -02-12T13:48:01.492935+08:00 explicit_max_ttl 0s id s.AtDndppL6auMYfI27zfkvgn1 issue_time 2021 -01-11T13:48:01.492956+08:00 meta map [ org:104corp username:evan361425 ] num_uses 0 orphan true path auth/github/login policies [ default ] renewable true ttl 767h36m19s type service","title":"\u8cc7\u8a0a"},{"location":"essay/vault/implementation/#token","text":"\u5148\u91cd\u65b0\u767b\u5165\u56de Root Token # \u770b\u770b\u73fe\u5728\u662f\u7528\u4ec0\u9ebc\u6b0a\u6756 $ vault print token s.AtDndppL6auMYfI27zfkvgn1 # \u6b64\u6b0a\u6756\u4e26\u975e Root Token\uff0c\u767b\u51fa $ rm ~/.vault-token $ vault login s.9gFtHEu35b4FCBHbUtaLxeOw","title":"Token"},{"location":"essay/vault/implementation/#token-accessor","text":"$ vault list auth/token/accessors","title":"\u5217\u51fa\u6240\u6709 token \u7684 accessor"},{"location":"essay/vault/implementation/#batch-token","text":"\u5148\u5efa\u7acb Policy $ vault token create -type = batch -orphan = true -policy = my-policy Key Value --- ----- token b.AAAAAQKn0sVCMJNVTBWHXpwjQ1HbgpyDsJ8WeKtVaZiiUCLK13uT4-pknd0lsHyiXVw7jaRy2U03o0K-TjtEU40v5f26KZXiY12vlMakT1WZuL-NdQ6pGD9fj4YGRp39qKY_jbQyrx8 token_accessor n/a token_duration 768h token_renewable false token_policies [ \"default\" \"my-policy\" ] identity_policies [] policies [ \"default\" \"my-policy\" ] batch token \u958b\u982d\u662f b \uff0c\u53cd\u4e4b\uff0c\u5e38\u898b\u7684 token \u662f s \u958b\u982d\uff0c\u4ee3\u8868 service token","title":"Batch Token"},{"location":"essay/vault/implementation/#wrapping-token","text":"$ vault token create -policy = my-policy -wrap-ttl = 120 Key Value --- ----- wrapping_token: s.F7S12zD0PUcEL5VShhElBZIb wrapping_accessor: LsfBV3JiC4zwWCaFEZqNW9db wrapping_token_ttl: 2m wrapping_token_creation_time: 2021 -01-11 16 :49:11.614054 +0800 CST wrapping_token_creation_path: auth/token/create wrapped_accessor: oW7NNQUM35G7mvTQ4vieDPqi vault unwrap s.F7S12zD0PUcEL5VShhElBZIb Key Value --- ----- token s.v8lwNg4uwfZzlHvDrmPdkRyF token_accessor oW7NNQUM35G7mvTQ4vieDPqi token_duration 768h token_renewable true token_policies [ \"default\" \"my-policy\" ] identity_policies [] policies [ \"default\" \"my-policy\" ]","title":"Wrapping Token"},{"location":"essay/vault/implementation/#api","text":"$ curl \\ --header \"X-Vault-Token: s.9gFtHEu35b4FCBHbUtaLxeOw\" \\ --header \"X-Vault-Wrap-TTL: 60\" \\ --request POST \\ --data \"{\\\"foo\\\": \\\"bar\\\"}\" \\ http://127.0.0.1:8200/v1/sys/wrapping/wrap { \"request_id\" : \"\" , \"lease_id\" : \"\" , \"renewable\" : false, \"lease_duration\" : 0 , \"data\" : null, \"wrap_info\" : { \"token\" : \"s.3MeMoyxudk19RHKzCZAa55oi\" , \"accessor\" : \"6rKApXj7R8iNz3gZjkIpd8Y4\" , \"ttl\" : 60 , \"creation_time\" : \"2021-01-11T17:08:44.876296+08:00\" , \"creation_path\" : \"sys/wrapping/wrap\" } , \"warnings\" : null, \"auth\" : null } $ curl \\ --header \"X-Vault-Token: s.9gFtHEu35b4FCBHbUtaLxeOw\" \\ --request POST \\ --data \"{\\\"token\\\":\\\"s.3MeMoyxudk19RHKzCZAa55oi\\\"}\" \\ http://127.0.0.1:8200/v1/sys/wrapping/lookup { \"request_id\" : \"67be1f69-e921-0eac-a660-5aa4f2761cb1\" , \"lease_id\" : \"\" , \"renewable\" : false, \"lease_duration\" : 0 , \"data\" : { \"creation_path\" : \"sys/wrapping/wrap\" , \"creation_time\" : \"2021-01-11T17:11:00.784059+08:00\" , \"creation_ttl\" : 60 } , \"wrap_info\" : null, \"warnings\" : null, \"auth\" : null }","title":"API"},{"location":"essay/vault/implementation/#policy","text":"","title":"Policy"},{"location":"essay/vault/implementation/#_5","text":"$ vault read sys/policy Key Value --- ----- keys [ default root ] policies [ default root ]","title":"\u8b80\u53d6\u73fe\u6709\u7684\u653f\u7b56"},{"location":"essay/vault/implementation/#_6","text":"$ vault policy write my-policy policy.hcl policy.hcl \u6a94\uff1a path \"secret/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"] } path \"secret/hello\" { capabilities = [\"deny\"] } path \"secret/restricted\" { capabilities = [\"create\"] allowed_parameters = { \"foo\" = [] \"bar\" = [\"zip\", \"zap\"] } }","title":"\u5efa\u7acb\u653f\u7b56"},{"location":"essay/vault/implementation/#high-availability","text":"Different from config { \"listener\" : { \"tcp\" : { \"address\" : \"127.0.0.1:8100\" , \"cluster_address\" : \"127.0.0.1:8101\" } } } $ export VAULT_ADDR = \"http://127.0.0.1:8100\" $ vault status Key Value --- ----- Recovery Seal Type shamir Initialized true Sealed false Total Recovery Shares 1 Threshold 1 Version 1 .6.1 Storage Type mysql Cluster Name vault-cluster-d4a98a31 Cluster ID 06bbee1f-d643-31c1-a87b-ba43d3b1d2d3 HA Enabled true HA Cluster https://127.0.0.1:8201 HA Mode standby Active Node Address http://127.0.0.1:8200","title":"High Availability"},{"location":"essay/vault/implementation/#rate-limit","text":"$ vault read sys/quotas/config Key Value --- ----- enable_rate_limit_audit_logging false enable_rate_limit_response_headers false rate_limit_exempt_paths [ /v1/sys/generate-recovery-token/attempt /v1/sys/generate-recovery-token/update /v1/sys/generate-root/attempt /v1/sys/generate-root/update /v1/sys/health /v1/sys/seal-status /v1/sys/unseal ]","title":"Rate Limit"},{"location":"essay/vault/implementation/#_7","text":"$ vault write sys/quotas/rate-limit/global-rate rate = 500 $ vault read sys/quotas/rate-limit/global-rate Key Value --- ----- block_interval 0 interval 1 name global-rate path n/a rate 500 type rate-limit $ vault write sys/quotas/rate-limit/global-rate rate = 501 $ vault delete sys/quotas/rate-limit/global-rate","title":"\u5b58\u53d6\u3001\u7de8\u8f2f"},{"location":"essay/vault/implementation/#debug","text":"$ vault debug","title":"Debug"},{"location":"essay/vault/introduction/","text":"Vault \u4ecb\u7d39 Seal/Unseal \u5c01\u5370/\u89e3\u5c01 graph LR subgraph g1 [\u89e3\u5c01] sf[\u52a0\u89e3\u5bc6\u91d1\u9470] end subgraph \u521d\u59cb\u5316 s1[(\u7522\u751f \u52a0\u89e3\u5bc6\u91d1\u9470)] --> sf s2[\u8f38\u51fa \u89e3\u5c01\u91d1\u9470] end subgraph \u5efa\u7acb\u548c\u8cc7\u6599\u5eab\u7684\u9023\u7dda \u5c01\u5370 s0[\u6c92\u6709\u91d1\u9470] --> s1 s0 -- \u900f\u904e \u89e3\u5c01\u91d1\u9470 \u7372\u5f97 --> sf end \u89e3\u5c01\u91d1\u9470\u63db\u5f97\u52a0\u89e3\u5bc6\u91d1\u9470 graph LR k1[\u89e3\u5c01\u91d1\u9470] -- \u89e3\u5bc6 \u4e1f\u68c4 --> k2[(\u52a0\u5bc6\u5f8c\u7684\u4e3b\u9470\u5319)] subgraph \u8cc7\u6599\u5eab k2 -- \u89e3\u5bc6 \u8a18\u61b6 --> 3[(\u52a0\u5bc6\u5f8c\u7684\u9470\u5319\u5708)] end \u89e3\u5c01\u91d1\u9470 Shamir Unseal Keys \u9700\u8981\u591a\u628a\u9470\u5319\u53bb\u7d44\u5408\u51fa\u4e00\u628a\u771f\u6b63\u7684\u89e3\u5c01\u91d1\u9470 \u53ef\u8a2d\u5b9a\u6240\u9700\u91d1\u9470\u7684\u95a5\u503c \u624b\u52d5\u8f38\u5165 Auto Seal AWSKMS, GCP Cloud KMS, OCI KMS ... \u6703\u7522\u751f recovery key \u900f\u904e recovery key \u6388\u6b0a KMS \u53bb\u89e3\u5c01 Vault \u900f\u904e recovery key \u53bb\u91cd\u65b0\u8a2d\u5b9a\u89e3\u5c01\u53c3\u6578 Lease, Renew, Revoke \u4f7f\u7528\u7279\u5b9a\u65b9\u5f0f\u9a57\u8b49\u6216\u670d\u52d9\u6642\u6642\u6703\u7d66\u4e88 \u79df\u8cc3 \uff0c\u9700\u8981\u4f7f\u7528\u8005\u5b9a\u671f \u5237\u65b0 \uff0c\u4ee5\u907f\u514d\u904e\u671f\u3002 \u7ba1\u7406\u65b9\u4e5f\u53ef \u64a4\u92b7 \u6307\u5b9a\u7684 \u79df\u8cc3 \u3002 \u4f8b\u5982\uff1a\u52d5\u614b\u7372\u5f97 AWS \u7684\u5b58\u53d6\u6b0a\u6756 $ vault read aws/creds/my-role Key Value --- ----- lease_id aws/creds/my-role/f3e92392-7d9c-09c8-c921-575d62fe80d8 lease_duration 768h lease_renewable true access_key AKIAIOWQXTLW36DV7IEA secret_key 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 security_token <nil> Authentication \u9a57\u8b49\u904e\u5f8c\u624d\u80fd\u57f7\u884c\u6240\u6709\u9700\u8981\u57f7\u884c\u7684\u52d5\u4f5c\uff0c\u9664\u4e86\u6700\u4e00\u958b\u59cb\u7684 init \u548c unseal \u3002 \u9a57\u8b49\u65b9\u6cd5 GitHub, LDAP, AppRole ... Tokens \u9a57\u8b49\u6210\u529f\u6703\u7d66\u4e88 token Tokens \u6b0a\u6756 \u6700\u4e00\u958b\u59cb\u7684\u6b0a\u6756 \u5373\u662f\u5728\u5efa\u7acb\u4e4b\u521d\u6240\u5f97\u5230\u7684 Root Token \u900f\u904e\u8a2d\u5b9a\uff0c\u5141\u8a31\u4e0d\u540c\u7684 \u9a57\u8b49\u65b9\u6cd5 \uff0c\u6bcf\u6b21\u767b\u5165\u90fd\u6703\u7d66\u4e88\u4e00\u500b\u6b0a\u6756 \u900f\u904e \u653f\u7b56 \u53bb\u7ba1\u7406 \u6709\u6642\u5019\u6703\u900f\u904e\u6b0a\u6756\u53bb\u53d6\u5f97 \u79df\u8cc3 \u3002 Root Token \u6839\u6b0a\u6756 \u61c9\u8a72\u5728\u521d\u59cb\u5316\u64cd\u4f5c\uff08 \u9a57\u8b49\u65b9\u6cd5 \u548c \u653f\u7b56 \uff09\u5f8c \u64a4\u92b7 \u82e5\u6709\u9700\u8981\u6839\u6b0a\u6756\uff0c\u53ef\u900f\u904e vault operator generate-root \u53bb\u7522\u751f \u9700\u8981\u89e3\u5c01\u9470\u5319 \u8a73\u898b \u6b0a\u6756\u7684\u5236\u5ea6 \u900f\u904e\u6b0a\u6756\uff0c\u53ef\u4ee5\u751f\u7522\u5168\u65b0\u7684\u6b0a\u6756\uff0c\u6b64\u6642\u8a72\u6b0a\u6756\u7a31\u70ba\u5b50\u6b0a\u6756\uff0c\u82e5\u5efa\u7acb\u5b50\u6b0a\u6756\u7684\u6b0a\u6756\u88ab\u64a4\u92b7\uff0c\u5b50\u6b0a\u6756\u540c\u6642\u6703\u88ab\u64a4\u92b7 \u907f\u514d\u904e\u5927\u7684\u5bb6\u65cf\u5c0e\u81f4\u64a4\u92b7\u7684\u56f0\u96e3 \u4ecd\u80fd\u7279\u904e\u7279\u6b8a\u65b9\u5f0f\u5efa\u7acb\u6c92\u6709\u7236\u6bcd\u7684\u6b0a\u6756 Orphan Token \uff0c \u8a73\u898b \u6b0a\u6756\u7684 accessor \u7528\u4f86\u4ee3\u8868\u8a72\u6b0a\u6756\u7684\u8def\u6a19\uff0c\u53ef\u7528\u6b64\u8def\u6a19 \u67e5\u770b\u8a72\u6b0a\u6756\u7684\u8cc7\u8a0a\uff0c\u9664\u4e86\u6b0a\u6756 ID \u672c\u8eab\uff0c \u8a73\u898b \u67e5\u770b\u8a72\u6b0a\u6756\u53ef\u5426\u4f7f\u7528\u53ef\u4ee5\u7279\u5b9a\u6b0a\u5229\uff08\u50c5\u80fd API\uff09\uff0c \u8a73\u898b \u64a4\u92b7\u6b0a\u6756\uff0c \u8a73\u898b \u91cd\u65b0\u8a08\u7b97\u6b0a\u6756\u7684\u904e\u671f\u6642\u9593\uff08\u50c5\u9650 API\uff09\uff0c \u8a73\u898b \u6b0a\u6756\u7684\u904e\u671f \u53ef\u91cd\u65b0\u8a08\u7b97\u6b0a\u6756\u7684\u904e\u671f\u6642\u9593\u3002\u4e26\u975e\u758a\u52a0\uff0c\u800c\u662f\u91cd\u65b0\u8a08\u7b97 \u7d66\u4e88\u6a5f\u5668\u77ed\u6642\u9593\u7684\u6b0a\u6756\uff0c\u4e26\u8981\u6c42\u77ed\u6642\u9593\u5167\u91cd\u65b0\u8a08\u7b97\u904e\u671f\u6642\u9593\u3002\u4ee5\u78ba\u4fdd\u6a5f\u5668\u5b58\u6d3b\u72c0\u614b \u7d66\u4e88\u975e\u6a5f\u5668\u9577\u6642\u9593\uff0832 \u5929\uff09\u7684\u6b0a\u6756 Batch Tokens \u6b0a\u6756\u4e2d\u542b\u6709\u8db3\u5920\u7684\u8cc7\u8a0a\u53bb\u505a\u4e8b\u60c5 \u82e5\u6c92\u6709\u7236\u6bcd\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u6a5f\u5668\uff08Node\uff09\u9593\u4f7f\u7528 $ vault token create -type = batch -orphan = true -policy = my-policy Key Value --- ----- token b.AAAAAQKn0sVCMJNVTBWHXpwjQ1HbgpyDsJ8WeKtVaZiiUCLK13uT4-pknd0lsHyiXVw7jaRy2U03o0K-TjtEU40v5f26KZXiY12vlMakT1WZuL-NdQ6pGD9fj4YGRp39qKY_jbQyrx8 token_accessor n/a token_duration 768h token_renewable false token_policies [ \"default\" \"my-policy\" ] identity_policies [] policies [ \"default\" \"my-policy\" ] Response Wrapping \u4e00\u53f0\u6a5f\u5668\u9a57\u8b49\u901a\u904e\u5f8c\u5f97\u5230\u6b0a\u6756\uff0c\u4e26\u6301\u7e8c\u66f4\u65b0\u6b0a\u6756\u4fdd\u6301\u5176\u53ef\u7528\u6027\u3002 \u4f46\u662f\u6a5f\u5668\u5982\u679c\u9700\u8981\u91cd\u555f\uff1f \u4e0d\u80fd\u4fdd\u8b49\u6a5f\u5668\u7684\u5408\u6cd5\u6027\uff0c\u4f46\u9700\u8981\u4ed6\u7372\u5f97\u6b0a\u6756 \u624b\u6a5f app \u628a\u6b0a\u6756\u5305\u88dd\uff08Wrapping\uff09\u8d77\u4f86\u7d66\u6307\u5b9a\u6a5f\u5668\u3002 $ vault token create -policy = apps -wrap-ttl = 120 graph LR root -- 1. \u8981\u6c42\u5305\u88dd\u6b0a\u6756 --> Vault root -- 2. \u5bc4\u9001\u5305\u88dd\u6b0a\u6756 --> APP APP -- 3. \u900f\u904e\u5305\u88dd\u6b0a\u6756\u53d6\u5f97\u6b0a\u6756 --> Vault APP -- 4. \u7279\u904e\u6b0a\u6756\u53d6\u5f97\u8cc7\u8a0a --> Vault \u95dc\u65bc\u5305\u88dd\u6b0a\u6756 \u82e5\u6c92\u6709\u5305\u88dd\u6b0a\u6756\u4ecd\u53ef\u900f\u904e unwrap-accessor \u53bb\u64a4\u92b7\u5176\u4ee3\u8868\u7684\u6b0a\u6756 \u5305\u88dd\u6b0a\u6756\u4e26\u672a\u505a\u7c3d\u8b49\uff08sign\uff09\uff0c\u56e0\u70ba\u5176\u5229\u7528 key-value \u53bb\u7372\u5f97\u771f\u6b63\u7684\u6b0a\u6756\uff0c \u8a73\u898b \u5be6\u4f5c \u5b89\u5168\u6027\u505a\u6cd5 \u5efa\u7acb Audit Log Device \u505a\u7d00\u9304\u3002 \u6bcf\u6b21\u5f97\u5230\u5305\u88dd\u6b0a\u6756\uff0c\u57f7\u884c Look-up\uff0c\u53ef\u4ee5\u5f97\u5230\u5efa\u9020\u5176\u7684\u4f4d\u7f6e\uff0c\u4e26\u505a\u9a57\u8b49\u3002 Policy \u653f\u7b56 \u6839\u64da\u9a57\u8b49\u65b9\u5f0f\uff0c\u53ef\u4ee5\u8a2d\u8a08\u4e0d\u540c\u55ae\u4f4d\uff08\u751a\u81f3\u500b\u9ad4\uff09\u4e0d\u540c\u653f\u7b56 \u901a\u5e38\u662f\u9650\u5236\u53ef\u4ee5\u7372\u53d6\u54ea\u4e9b\u8cc7\u6599\u548c\u5c0d\u8a72\u8cc7\u6599\u7684\u8655\u7406\u6b0a\u9650 create , read , update , delete , list sudo , deny \u53ef\u4ee5\u8981\u6c42\u6307\u5b9a\u8cc7\u6599\u5fc5\u9808 \u5305\u88dd graph LR root -- \u5efa\u7acb\u9a57\u8b49\u65b9\u5f0f --> Vault root -- \u653f\u7b56 --> Vault Vault -- \u5132\u5b58 --> k[(\u8cc7\u6599\u5eab)] graph LR user -- 1. \u9a57\u8b49 --> Vault Vault -- 2. \u78ba\u8a8d --> \u9a57\u8b49\u6a5f\u69cb k[(\u8cc7\u6599\u5eab)] -- 3. \u653f\u7b56 --> Vault Vault -- 4.\u6b0a\u6756 --> user \u6ce8\u610f\u4e8b\u9805 \u5beb\u4f5c\u65b9\u5f0f\uff0c \u8a73\u898b \u653f\u7b56\u6a21\u677f\uff0c\u8b93\u6bcf\u500b\u4eba\u50c5\u80fd\u8b80\u53d6\u5404\u81ea\u7684\u8cc7\u6599\uff0c \u8a73\u898b \u9650\u5236\u7279\u5b9a key-value \u7684\u5b58\u53d6\uff0c \u8a73\u898b \u5217\u8868\u3001\u8b80\u53d6\u3001\u7de8\u8f2f\u3001\u522a\u9664\uff0c \u8a73\u898b High Availability Standby-node \u53ea\u6703\u628a\u9700\u6c42 \u91cd\u65b0\u5c0e\u5411 \u81f3 Active-node Standby-node \u900f\u904e \u8cc7\u6599\u5eab \u5f97\u5230 Active-node \u7684\u8cc7\u8a0a \u4e00\u822c\u4f86\u8aaa\uff0c\u6548\u80fd\u74f6\u9838\u662f\u4f86\u81ea\u65bc\u8cc7\u6599\u5eab\u7684\u7de8\u8f2f\u548c\u5b58\u53d6 Performance Standby-node\uff08\u4ed8\u8cbb\uff09 \u5141\u8a31 Standby-node \u8b80\u53d6\u8cc7\u6599 \u91cd\u65b0\u5c0e\u5411 Standby-node \u548c Active-node \u6e9d\u901a\uff08\u9810\u8a2d\u503c\uff09 \u900f\u904e \u8cc7\u6599\u5eab \u7684\u79c1\u9470\u548c\u7c3d\u7ae0\u4f86\u548c Active node \u505a TLS1.2 \u6e9d\u901a cluster_address Standby-node \u56de\u61c9 307 \u7d66\u4f7f\u7528\u8005\uff0c\u4e26\u8981\u6c42\u91cd\u65b0\u5c0e\u5411\u81f3 Active-node \u82e5\u6709 Load Balance \u53ef\u4ee5\u91cd\u65b0\u5c0e\u5411\u81f3\u6b64 api_address Integrated Storage \u5982\u679c\u8cc7\u6599\u5eab\u4e0d\u80fd\u9023\u7dda\u4e86...\uff1f \u5efa\u7acb\u591a\u500b\u8cc7\u6599\u5eab\u4e26\u6574\u5408 RAFT - \u5e6b\u52a9\u591a\u500b\u8cc7\u6599\u5eab\u7684\u6574\u5408 \u8cc7\u6599\u5eab\u662f\u7528 File System \u6bcf\u500b Node \u90fd\u9700\u8981\u6709\u4e00\u500b\u7368\u7acb\u7684\u8cc7\u6599\u5eab\uff0c\u4f46\u662f\u6703\u548c\u5176\u4ed6 Node \u6574\u5408 \u8a08\u6578 API\uff0c \u8a73\u898b \u53ef\u4ee5\u9650\u5236\u5176\u6b21\u6578 User\uff0c \u8a73\u898b \u7368\u7acb\u500b\u9ad4\uff08\u900f\u904e\u7279\u5b9a\u9a57\u8b49\u65b9\u5f0f\uff09+ \u975e\u7368\u7acb\u500b\u9ad4\u7684\u6b0a\u6756","title":"\u4ecb\u7d39"},{"location":"essay/vault/introduction/#vault","text":"","title":"Vault \u4ecb\u7d39"},{"location":"essay/vault/introduction/#sealunseal","text":"\u5c01\u5370/\u89e3\u5c01 graph LR subgraph g1 [\u89e3\u5c01] sf[\u52a0\u89e3\u5bc6\u91d1\u9470] end subgraph \u521d\u59cb\u5316 s1[(\u7522\u751f \u52a0\u89e3\u5bc6\u91d1\u9470)] --> sf s2[\u8f38\u51fa \u89e3\u5c01\u91d1\u9470] end subgraph \u5efa\u7acb\u548c\u8cc7\u6599\u5eab\u7684\u9023\u7dda \u5c01\u5370 s0[\u6c92\u6709\u91d1\u9470] --> s1 s0 -- \u900f\u904e \u89e3\u5c01\u91d1\u9470 \u7372\u5f97 --> sf end","title":"Seal/Unseal"},{"location":"essay/vault/introduction/#_1","text":"graph LR k1[\u89e3\u5c01\u91d1\u9470] -- \u89e3\u5bc6 \u4e1f\u68c4 --> k2[(\u52a0\u5bc6\u5f8c\u7684\u4e3b\u9470\u5319)] subgraph \u8cc7\u6599\u5eab k2 -- \u89e3\u5bc6 \u8a18\u61b6 --> 3[(\u52a0\u5bc6\u5f8c\u7684\u9470\u5319\u5708)] end","title":"\u89e3\u5c01\u91d1\u9470\u63db\u5f97\u52a0\u89e3\u5bc6\u91d1\u9470"},{"location":"essay/vault/introduction/#_2","text":"","title":"\u89e3\u5c01\u91d1\u9470"},{"location":"essay/vault/introduction/#shamir-unseal-keys","text":"\u9700\u8981\u591a\u628a\u9470\u5319\u53bb\u7d44\u5408\u51fa\u4e00\u628a\u771f\u6b63\u7684\u89e3\u5c01\u91d1\u9470 \u53ef\u8a2d\u5b9a\u6240\u9700\u91d1\u9470\u7684\u95a5\u503c \u624b\u52d5\u8f38\u5165","title":"Shamir Unseal Keys"},{"location":"essay/vault/introduction/#auto-seal","text":"AWSKMS, GCP Cloud KMS, OCI KMS ... \u6703\u7522\u751f recovery key \u900f\u904e recovery key \u6388\u6b0a KMS \u53bb\u89e3\u5c01 Vault \u900f\u904e recovery key \u53bb\u91cd\u65b0\u8a2d\u5b9a\u89e3\u5c01\u53c3\u6578","title":"Auto Seal"},{"location":"essay/vault/introduction/#lease-renew-revoke","text":"\u4f7f\u7528\u7279\u5b9a\u65b9\u5f0f\u9a57\u8b49\u6216\u670d\u52d9\u6642\u6642\u6703\u7d66\u4e88 \u79df\u8cc3 \uff0c\u9700\u8981\u4f7f\u7528\u8005\u5b9a\u671f \u5237\u65b0 \uff0c\u4ee5\u907f\u514d\u904e\u671f\u3002 \u7ba1\u7406\u65b9\u4e5f\u53ef \u64a4\u92b7 \u6307\u5b9a\u7684 \u79df\u8cc3 \u3002 \u4f8b\u5982\uff1a\u52d5\u614b\u7372\u5f97 AWS \u7684\u5b58\u53d6\u6b0a\u6756 $ vault read aws/creds/my-role Key Value --- ----- lease_id aws/creds/my-role/f3e92392-7d9c-09c8-c921-575d62fe80d8 lease_duration 768h lease_renewable true access_key AKIAIOWQXTLW36DV7IEA secret_key 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 security_token <nil>","title":"Lease, Renew, Revoke"},{"location":"essay/vault/introduction/#authentication","text":"\u9a57\u8b49\u904e\u5f8c\u624d\u80fd\u57f7\u884c\u6240\u6709\u9700\u8981\u57f7\u884c\u7684\u52d5\u4f5c\uff0c\u9664\u4e86\u6700\u4e00\u958b\u59cb\u7684 init \u548c unseal \u3002","title":"Authentication"},{"location":"essay/vault/introduction/#_3","text":"GitHub, LDAP, AppRole ...","title":"\u9a57\u8b49\u65b9\u6cd5"},{"location":"essay/vault/introduction/#tokens","text":"\u9a57\u8b49\u6210\u529f\u6703\u7d66\u4e88 token","title":"Tokens"},{"location":"essay/vault/introduction/#tokens_1","text":"\u6b0a\u6756 \u6700\u4e00\u958b\u59cb\u7684\u6b0a\u6756 \u5373\u662f\u5728\u5efa\u7acb\u4e4b\u521d\u6240\u5f97\u5230\u7684 Root Token \u900f\u904e\u8a2d\u5b9a\uff0c\u5141\u8a31\u4e0d\u540c\u7684 \u9a57\u8b49\u65b9\u6cd5 \uff0c\u6bcf\u6b21\u767b\u5165\u90fd\u6703\u7d66\u4e88\u4e00\u500b\u6b0a\u6756 \u900f\u904e \u653f\u7b56 \u53bb\u7ba1\u7406 \u6709\u6642\u5019\u6703\u900f\u904e\u6b0a\u6756\u53bb\u53d6\u5f97 \u79df\u8cc3 \u3002","title":"Tokens"},{"location":"essay/vault/introduction/#root-token","text":"\u6839\u6b0a\u6756 \u61c9\u8a72\u5728\u521d\u59cb\u5316\u64cd\u4f5c\uff08 \u9a57\u8b49\u65b9\u6cd5 \u548c \u653f\u7b56 \uff09\u5f8c \u64a4\u92b7 \u82e5\u6709\u9700\u8981\u6839\u6b0a\u6756\uff0c\u53ef\u900f\u904e vault operator generate-root \u53bb\u7522\u751f \u9700\u8981\u89e3\u5c01\u9470\u5319 \u8a73\u898b","title":"Root Token"},{"location":"essay/vault/introduction/#_4","text":"\u900f\u904e\u6b0a\u6756\uff0c\u53ef\u4ee5\u751f\u7522\u5168\u65b0\u7684\u6b0a\u6756\uff0c\u6b64\u6642\u8a72\u6b0a\u6756\u7a31\u70ba\u5b50\u6b0a\u6756\uff0c\u82e5\u5efa\u7acb\u5b50\u6b0a\u6756\u7684\u6b0a\u6756\u88ab\u64a4\u92b7\uff0c\u5b50\u6b0a\u6756\u540c\u6642\u6703\u88ab\u64a4\u92b7 \u907f\u514d\u904e\u5927\u7684\u5bb6\u65cf\u5c0e\u81f4\u64a4\u92b7\u7684\u56f0\u96e3 \u4ecd\u80fd\u7279\u904e\u7279\u6b8a\u65b9\u5f0f\u5efa\u7acb\u6c92\u6709\u7236\u6bcd\u7684\u6b0a\u6756 Orphan Token \uff0c \u8a73\u898b","title":"\u6b0a\u6756\u7684\u5236\u5ea6"},{"location":"essay/vault/introduction/#accessor","text":"\u7528\u4f86\u4ee3\u8868\u8a72\u6b0a\u6756\u7684\u8def\u6a19\uff0c\u53ef\u7528\u6b64\u8def\u6a19 \u67e5\u770b\u8a72\u6b0a\u6756\u7684\u8cc7\u8a0a\uff0c\u9664\u4e86\u6b0a\u6756 ID \u672c\u8eab\uff0c \u8a73\u898b \u67e5\u770b\u8a72\u6b0a\u6756\u53ef\u5426\u4f7f\u7528\u53ef\u4ee5\u7279\u5b9a\u6b0a\u5229\uff08\u50c5\u80fd API\uff09\uff0c \u8a73\u898b \u64a4\u92b7\u6b0a\u6756\uff0c \u8a73\u898b \u91cd\u65b0\u8a08\u7b97\u6b0a\u6756\u7684\u904e\u671f\u6642\u9593\uff08\u50c5\u9650 API\uff09\uff0c \u8a73\u898b","title":"\u6b0a\u6756\u7684 accessor"},{"location":"essay/vault/introduction/#_5","text":"\u53ef\u91cd\u65b0\u8a08\u7b97\u6b0a\u6756\u7684\u904e\u671f\u6642\u9593\u3002\u4e26\u975e\u758a\u52a0\uff0c\u800c\u662f\u91cd\u65b0\u8a08\u7b97 \u7d66\u4e88\u6a5f\u5668\u77ed\u6642\u9593\u7684\u6b0a\u6756\uff0c\u4e26\u8981\u6c42\u77ed\u6642\u9593\u5167\u91cd\u65b0\u8a08\u7b97\u904e\u671f\u6642\u9593\u3002\u4ee5\u78ba\u4fdd\u6a5f\u5668\u5b58\u6d3b\u72c0\u614b \u7d66\u4e88\u975e\u6a5f\u5668\u9577\u6642\u9593\uff0832 \u5929\uff09\u7684\u6b0a\u6756","title":"\u6b0a\u6756\u7684\u904e\u671f"},{"location":"essay/vault/introduction/#batch-tokens","text":"\u6b0a\u6756\u4e2d\u542b\u6709\u8db3\u5920\u7684\u8cc7\u8a0a\u53bb\u505a\u4e8b\u60c5 \u82e5\u6c92\u6709\u7236\u6bcd\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u6a5f\u5668\uff08Node\uff09\u9593\u4f7f\u7528 $ vault token create -type = batch -orphan = true -policy = my-policy Key Value --- ----- token b.AAAAAQKn0sVCMJNVTBWHXpwjQ1HbgpyDsJ8WeKtVaZiiUCLK13uT4-pknd0lsHyiXVw7jaRy2U03o0K-TjtEU40v5f26KZXiY12vlMakT1WZuL-NdQ6pGD9fj4YGRp39qKY_jbQyrx8 token_accessor n/a token_duration 768h token_renewable false token_policies [ \"default\" \"my-policy\" ] identity_policies [] policies [ \"default\" \"my-policy\" ]","title":"Batch Tokens"},{"location":"essay/vault/introduction/#response-wrapping","text":"\u4e00\u53f0\u6a5f\u5668\u9a57\u8b49\u901a\u904e\u5f8c\u5f97\u5230\u6b0a\u6756\uff0c\u4e26\u6301\u7e8c\u66f4\u65b0\u6b0a\u6756\u4fdd\u6301\u5176\u53ef\u7528\u6027\u3002 \u4f46\u662f\u6a5f\u5668\u5982\u679c\u9700\u8981\u91cd\u555f\uff1f \u4e0d\u80fd\u4fdd\u8b49\u6a5f\u5668\u7684\u5408\u6cd5\u6027\uff0c\u4f46\u9700\u8981\u4ed6\u7372\u5f97\u6b0a\u6756 \u624b\u6a5f app \u628a\u6b0a\u6756\u5305\u88dd\uff08Wrapping\uff09\u8d77\u4f86\u7d66\u6307\u5b9a\u6a5f\u5668\u3002 $ vault token create -policy = apps -wrap-ttl = 120 graph LR root -- 1. \u8981\u6c42\u5305\u88dd\u6b0a\u6756 --> Vault root -- 2. \u5bc4\u9001\u5305\u88dd\u6b0a\u6756 --> APP APP -- 3. \u900f\u904e\u5305\u88dd\u6b0a\u6756\u53d6\u5f97\u6b0a\u6756 --> Vault APP -- 4. \u7279\u904e\u6b0a\u6756\u53d6\u5f97\u8cc7\u8a0a --> Vault","title":"Response Wrapping"},{"location":"essay/vault/introduction/#_6","text":"\u82e5\u6c92\u6709\u5305\u88dd\u6b0a\u6756\u4ecd\u53ef\u900f\u904e unwrap-accessor \u53bb\u64a4\u92b7\u5176\u4ee3\u8868\u7684\u6b0a\u6756 \u5305\u88dd\u6b0a\u6756\u4e26\u672a\u505a\u7c3d\u8b49\uff08sign\uff09\uff0c\u56e0\u70ba\u5176\u5229\u7528 key-value \u53bb\u7372\u5f97\u771f\u6b63\u7684\u6b0a\u6756\uff0c \u8a73\u898b \u5be6\u4f5c","title":"\u95dc\u65bc\u5305\u88dd\u6b0a\u6756"},{"location":"essay/vault/introduction/#_7","text":"\u5efa\u7acb Audit Log Device \u505a\u7d00\u9304\u3002 \u6bcf\u6b21\u5f97\u5230\u5305\u88dd\u6b0a\u6756\uff0c\u57f7\u884c Look-up\uff0c\u53ef\u4ee5\u5f97\u5230\u5efa\u9020\u5176\u7684\u4f4d\u7f6e\uff0c\u4e26\u505a\u9a57\u8b49\u3002","title":"\u5b89\u5168\u6027\u505a\u6cd5"},{"location":"essay/vault/introduction/#policy","text":"\u653f\u7b56 \u6839\u64da\u9a57\u8b49\u65b9\u5f0f\uff0c\u53ef\u4ee5\u8a2d\u8a08\u4e0d\u540c\u55ae\u4f4d\uff08\u751a\u81f3\u500b\u9ad4\uff09\u4e0d\u540c\u653f\u7b56 \u901a\u5e38\u662f\u9650\u5236\u53ef\u4ee5\u7372\u53d6\u54ea\u4e9b\u8cc7\u6599\u548c\u5c0d\u8a72\u8cc7\u6599\u7684\u8655\u7406\u6b0a\u9650 create , read , update , delete , list sudo , deny \u53ef\u4ee5\u8981\u6c42\u6307\u5b9a\u8cc7\u6599\u5fc5\u9808 \u5305\u88dd graph LR root -- \u5efa\u7acb\u9a57\u8b49\u65b9\u5f0f --> Vault root -- \u653f\u7b56 --> Vault Vault -- \u5132\u5b58 --> k[(\u8cc7\u6599\u5eab)] graph LR user -- 1. \u9a57\u8b49 --> Vault Vault -- 2. \u78ba\u8a8d --> \u9a57\u8b49\u6a5f\u69cb k[(\u8cc7\u6599\u5eab)] -- 3. \u653f\u7b56 --> Vault Vault -- 4.\u6b0a\u6756 --> user","title":"Policy"},{"location":"essay/vault/introduction/#_8","text":"\u5beb\u4f5c\u65b9\u5f0f\uff0c \u8a73\u898b \u653f\u7b56\u6a21\u677f\uff0c\u8b93\u6bcf\u500b\u4eba\u50c5\u80fd\u8b80\u53d6\u5404\u81ea\u7684\u8cc7\u6599\uff0c \u8a73\u898b \u9650\u5236\u7279\u5b9a key-value \u7684\u5b58\u53d6\uff0c \u8a73\u898b \u5217\u8868\u3001\u8b80\u53d6\u3001\u7de8\u8f2f\u3001\u522a\u9664\uff0c \u8a73\u898b","title":"\u6ce8\u610f\u4e8b\u9805"},{"location":"essay/vault/introduction/#high-availability","text":"Standby-node \u53ea\u6703\u628a\u9700\u6c42 \u91cd\u65b0\u5c0e\u5411 \u81f3 Active-node Standby-node \u900f\u904e \u8cc7\u6599\u5eab \u5f97\u5230 Active-node \u7684\u8cc7\u8a0a \u4e00\u822c\u4f86\u8aaa\uff0c\u6548\u80fd\u74f6\u9838\u662f\u4f86\u81ea\u65bc\u8cc7\u6599\u5eab\u7684\u7de8\u8f2f\u548c\u5b58\u53d6 Performance Standby-node\uff08\u4ed8\u8cbb\uff09 \u5141\u8a31 Standby-node \u8b80\u53d6\u8cc7\u6599","title":"High Availability"},{"location":"essay/vault/introduction/#_9","text":"Standby-node \u548c Active-node \u6e9d\u901a\uff08\u9810\u8a2d\u503c\uff09 \u900f\u904e \u8cc7\u6599\u5eab \u7684\u79c1\u9470\u548c\u7c3d\u7ae0\u4f86\u548c Active node \u505a TLS1.2 \u6e9d\u901a cluster_address Standby-node \u56de\u61c9 307 \u7d66\u4f7f\u7528\u8005\uff0c\u4e26\u8981\u6c42\u91cd\u65b0\u5c0e\u5411\u81f3 Active-node \u82e5\u6709 Load Balance \u53ef\u4ee5\u91cd\u65b0\u5c0e\u5411\u81f3\u6b64 api_address","title":"\u91cd\u65b0\u5c0e\u5411"},{"location":"essay/vault/introduction/#integrated-storage","text":"\u5982\u679c\u8cc7\u6599\u5eab\u4e0d\u80fd\u9023\u7dda\u4e86...\uff1f \u5efa\u7acb\u591a\u500b\u8cc7\u6599\u5eab\u4e26\u6574\u5408 RAFT - \u5e6b\u52a9\u591a\u500b\u8cc7\u6599\u5eab\u7684\u6574\u5408 \u8cc7\u6599\u5eab\u662f\u7528 File System \u6bcf\u500b Node \u90fd\u9700\u8981\u6709\u4e00\u500b\u7368\u7acb\u7684\u8cc7\u6599\u5eab\uff0c\u4f46\u662f\u6703\u548c\u5176\u4ed6 Node \u6574\u5408","title":"Integrated Storage"},{"location":"essay/vault/introduction/#_10","text":"API\uff0c \u8a73\u898b \u53ef\u4ee5\u9650\u5236\u5176\u6b21\u6578 User\uff0c \u8a73\u898b \u7368\u7acb\u500b\u9ad4\uff08\u900f\u904e\u7279\u5b9a\u9a57\u8b49\u65b9\u5f0f\uff09+ \u975e\u7368\u7acb\u500b\u9ad4\u7684\u6b0a\u6756","title":"\u8a08\u6578"},{"location":"essay/web/ntp/","text":"NTP Network Time Protocol \u8aaa\u660e\u5982\u4f55\u8b93\u5404\u65b9\u88dd\u7f6e\u53ef\u4ee5\u548c\u4e2d\u592e\u7684 NTP Server \u9032\u884c\u6821\u6642\u7684\u5de5\u4f5c\u3002 \u958f\u79d2 \u7531\u65bc UTC \u6642\u9593\u900f\u904e\u539f\u5b50\u9418\u505a\u8a08\u7b97\uff0c\u4ee5\u6b64\u53ef\u4ee5\u7cbe\u6e96\u5f97\u51fa\u904e\u4e86\u591a\u5c11\u6642\u9593\uff0c\u4f46\u662f\u548c\u4e00\u822c\u4f7f\u7528\u7684\u66c6\u6cd5\u6703\u6709\u6240\u885d\u7a81\u3002 \u885d\u7a81\u5c31\u4f86\u81ea\u65bc\u4e00\u822c\u66c6\u6cd5\u662f\u900f\u904e\u89c0\u6e2c\u592a\u967d\u4f86\u8a2d\u8a08\u51fa\u4e00\u6574\u5e74\u6709 365.25 \u5929\u3002\u4f46\u5be6\u969b\u5730\u7403\u81ea\u8f49\u548c\u516c\u8f49\u7684\u9031\u671f\u662f\u6709\u4e9b\u5fae\u8b8a\u5316\u7684\uff0c\u4e5f\u5c31\u662f\uff0c\u900f\u904e\u539f\u5b50\u9418\u8a08\u7b97\u7684\u6642\u9593\u6703\u548c\u66c6\u6cd5\u6642\u9593\u6703\u6709\u4e0d\u898f\u5247\u7684\u5dee\u7570\u3002 \u4e0d\u898f\u5247\u6027 \u5730\u7403\u81ea\u8f49\u901f\u5ea6\u6e1b\u6162\u7684\u4e3b\u8981\u539f\u56e0\u662f\u6f6e\u6c50\u6469\u64e6\uff0c\u50c5\u6b64\u4e00\u9805\u5c31\u5c07\u4f7f\u4e00\u5929\u6bcf\u4e16\u7d00\u5ef6\u9577 2.3ms\u3002\u5176\u4ed6\u4fc3\u6210\u56e0\u7d20\u5305\u62ec\u5730\u7403\u5730\u6bbc\u76f8\u5c0d\u65bc\u5176\u6838\u5fc3\u7684\u904b\u52d5\uff0c\u5730\u51fd\u5c0d\u6d41\u7684\u8b8a\u5316\uff0c\u4ee5\u53ca\u5c0e\u81f4\u5de8\u5927\u8cea\u91cf\u518d\u5206\u914d\u7684\u4efb\u4f55\u5176\u4ed6\u4e8b\u4ef6\u6216\u904e\u7a0b\u3002\u9019\u4e9b\u904e\u7a0b\u6539\u8b8a\u4e86\u5730\u7403\u7684\u6163\u6027\u77e9\uff0c\u7531\u65bc\u89d2\u52d5\u91cf\u5b88\u6046\u800c\u5f71\u97ff\u4e86\u81ea\u8f49\u901f\u7387\u3002\u5176\u4e2d\u4e00\u4e9b\u91cd\u5206\u914d\u6703\u63d0\u9ad8\u5730\u7403\u7684\u81ea\u8f49\u901f\u5ea6\uff0c\u7e2e\u77ed\u592a\u967d\u65e5\uff0c\u4e26\u5c0d\u6297\u6f6e\u6c50\u6469\u64e6\u3002\u4f8b\u5982\uff0c\u51b0\u6cb3\u53cd\u5f48\u5c07\u592a\u967d\u65e5\u7e2e\u77ed\u4e86 0.6ms / \u4e16\u7d00\uff0c2004 \u5e74\u767c\u751f\u5728\u5370\u5ea6\u6d0b\u7684\u5730\u9707\u548c\u6d77\u562f\u88ab\u8a8d\u70ba\u7e2e\u77ed\u4e86 2.68 \u5fae\u79d2\u3002 \u70ba\u4e86\u6d88\u5f4c\u9019\u9805\u5dee\u7570\uff0c\u958f\u79d2\u88ab\u8a2d\u8a08\u51fa\u4f86\u4e86\u3002 \u958f\u79d2\u53ef\u52a0\u53ef\u6e1b \u958f\u79d2\u6703\u88ab\u52a0\u9032\u539f\u5b50\u9418\u7b97\u51fa\u7684 UTC \u6642\u9593\uff0c\u7406\u8ad6\u4e0a\u53ef\u4ee5\u662f\u589e\u52a0\u6216\u6e1b\u5c11\u3002 \u4f46\u6b77\u53f2\u4e0a\uff08\u81ea\u5f9e 1972 \u5e74\u4ee5\u5f8c\uff09\u53ea\u589e\u52a0\u904e\u958f\u79d2\u3002 \u62b9\u9ed1\u5728\u958f\u79d2\u9644\u8fd1\u7684\u6642\u9593 \u300c\u62b9\u9ed1\u5728\u958f\u79d2\u9644\u8fd1\u7684\u6642\u9593\u300d\u662f\u7dad\u57fa\u767e\u79d1\u7684\u7ffb\u8b6f\uff0c\u82f1\u6587\u70ba leap smear \u3002 Ref Time, technology and leaping seconds The One-second War","title":"NTP"},{"location":"essay/web/ntp/#ntp","text":"Network Time Protocol \u8aaa\u660e\u5982\u4f55\u8b93\u5404\u65b9\u88dd\u7f6e\u53ef\u4ee5\u548c\u4e2d\u592e\u7684 NTP Server \u9032\u884c\u6821\u6642\u7684\u5de5\u4f5c\u3002","title":"NTP"},{"location":"essay/web/ntp/#_1","text":"\u7531\u65bc UTC \u6642\u9593\u900f\u904e\u539f\u5b50\u9418\u505a\u8a08\u7b97\uff0c\u4ee5\u6b64\u53ef\u4ee5\u7cbe\u6e96\u5f97\u51fa\u904e\u4e86\u591a\u5c11\u6642\u9593\uff0c\u4f46\u662f\u548c\u4e00\u822c\u4f7f\u7528\u7684\u66c6\u6cd5\u6703\u6709\u6240\u885d\u7a81\u3002 \u885d\u7a81\u5c31\u4f86\u81ea\u65bc\u4e00\u822c\u66c6\u6cd5\u662f\u900f\u904e\u89c0\u6e2c\u592a\u967d\u4f86\u8a2d\u8a08\u51fa\u4e00\u6574\u5e74\u6709 365.25 \u5929\u3002\u4f46\u5be6\u969b\u5730\u7403\u81ea\u8f49\u548c\u516c\u8f49\u7684\u9031\u671f\u662f\u6709\u4e9b\u5fae\u8b8a\u5316\u7684\uff0c\u4e5f\u5c31\u662f\uff0c\u900f\u904e\u539f\u5b50\u9418\u8a08\u7b97\u7684\u6642\u9593\u6703\u548c\u66c6\u6cd5\u6642\u9593\u6703\u6709\u4e0d\u898f\u5247\u7684\u5dee\u7570\u3002 \u4e0d\u898f\u5247\u6027 \u5730\u7403\u81ea\u8f49\u901f\u5ea6\u6e1b\u6162\u7684\u4e3b\u8981\u539f\u56e0\u662f\u6f6e\u6c50\u6469\u64e6\uff0c\u50c5\u6b64\u4e00\u9805\u5c31\u5c07\u4f7f\u4e00\u5929\u6bcf\u4e16\u7d00\u5ef6\u9577 2.3ms\u3002\u5176\u4ed6\u4fc3\u6210\u56e0\u7d20\u5305\u62ec\u5730\u7403\u5730\u6bbc\u76f8\u5c0d\u65bc\u5176\u6838\u5fc3\u7684\u904b\u52d5\uff0c\u5730\u51fd\u5c0d\u6d41\u7684\u8b8a\u5316\uff0c\u4ee5\u53ca\u5c0e\u81f4\u5de8\u5927\u8cea\u91cf\u518d\u5206\u914d\u7684\u4efb\u4f55\u5176\u4ed6\u4e8b\u4ef6\u6216\u904e\u7a0b\u3002\u9019\u4e9b\u904e\u7a0b\u6539\u8b8a\u4e86\u5730\u7403\u7684\u6163\u6027\u77e9\uff0c\u7531\u65bc\u89d2\u52d5\u91cf\u5b88\u6046\u800c\u5f71\u97ff\u4e86\u81ea\u8f49\u901f\u7387\u3002\u5176\u4e2d\u4e00\u4e9b\u91cd\u5206\u914d\u6703\u63d0\u9ad8\u5730\u7403\u7684\u81ea\u8f49\u901f\u5ea6\uff0c\u7e2e\u77ed\u592a\u967d\u65e5\uff0c\u4e26\u5c0d\u6297\u6f6e\u6c50\u6469\u64e6\u3002\u4f8b\u5982\uff0c\u51b0\u6cb3\u53cd\u5f48\u5c07\u592a\u967d\u65e5\u7e2e\u77ed\u4e86 0.6ms / \u4e16\u7d00\uff0c2004 \u5e74\u767c\u751f\u5728\u5370\u5ea6\u6d0b\u7684\u5730\u9707\u548c\u6d77\u562f\u88ab\u8a8d\u70ba\u7e2e\u77ed\u4e86 2.68 \u5fae\u79d2\u3002 \u70ba\u4e86\u6d88\u5f4c\u9019\u9805\u5dee\u7570\uff0c\u958f\u79d2\u88ab\u8a2d\u8a08\u51fa\u4f86\u4e86\u3002 \u958f\u79d2\u53ef\u52a0\u53ef\u6e1b \u958f\u79d2\u6703\u88ab\u52a0\u9032\u539f\u5b50\u9418\u7b97\u51fa\u7684 UTC \u6642\u9593\uff0c\u7406\u8ad6\u4e0a\u53ef\u4ee5\u662f\u589e\u52a0\u6216\u6e1b\u5c11\u3002 \u4f46\u6b77\u53f2\u4e0a\uff08\u81ea\u5f9e 1972 \u5e74\u4ee5\u5f8c\uff09\u53ea\u589e\u52a0\u904e\u958f\u79d2\u3002","title":"\u958f\u79d2"},{"location":"essay/web/ntp/#_2","text":"\u300c\u62b9\u9ed1\u5728\u958f\u79d2\u9644\u8fd1\u7684\u6642\u9593\u300d\u662f\u7dad\u57fa\u767e\u79d1\u7684\u7ffb\u8b6f\uff0c\u82f1\u6587\u70ba leap smear \u3002","title":"\u62b9\u9ed1\u5728\u958f\u79d2\u9644\u8fd1\u7684\u6642\u9593"},{"location":"essay/web/ntp/#ref","text":"Time, technology and leaping seconds The One-second War","title":"Ref"},{"location":"essay/web/retry-strategy/","text":"Retry \u7684\u7b56\u7565 Retry in HTTP method Method Idempotent Destructive Safe 4XX 5XX Ambiguous Purpose GET O X O No Retry Retry Retry \u53d6\u5f97\u8cc7\u6599 POST X X X No Retry No Retry No Retry \u5efa\u7acb\u8cc7\u6599 PUT O O X No Retry Retry Retry \u5efa\u7acb\u6216\u7de8\u8f2f\u8cc7\u6599 PATCH X O X No Retry Retry Retry \u7de8\u8f2f\u8cc7\u6599 DELETE O O X No Retry Retry Retry \u522a\u9664\u8cc7\u6599 Idempotent \u51aa\u7b49\u7684\uff0c\u91cd\u8907\u57f7\u884c\u5f8c\u7d50\u679c\u4ecd\u76f8\u540c Destructive\uff1a \u7834\u58de\u6027\u7684\uff0c\u57f7\u884c\u5f8c\u6703\u53ef\u80fd\u6703\u9020\u6210\u8cc7\u6599\u7684\u7121\u6cd5\u5fa9\u539f PUT \u53ef\u80fd\u70ba user.name = 'Evan' \uff0cPATH \u53ef\u80fd\u70ba user.access_count += 1 \uff0c\u6545\u51aa\u7b49\u662f\u4e0d\u540c\u7684\u3002 \u82e5\u70ba Destructive\uff0c\u53ef\u4f7f\u7528 ETAG \u548c If-Match \u7684 HTTP \u8868\u982d\u4f86\u78ba\u8a8d\u662f\u5426\u91cd\u8907\u4fee\u6539\uff0c\u6216\u5728\u66f4\u6539\u904e\u7a0b\u4e2d\uff0c\u5f9e\u4ed6\u8655\u5df2\u7d93\u88ab\u4fee\u6539\u3002 \u5c31\u5982\u540c Memcached \u7684 CAS \u503c \u6bcf\u6b21 Request \u4e2d\u589e\u52a0 idempotency key \u53ef\u4ee5\u7528\u4f5c cache key Circuit Breaker Pattern \u591a\u4e45 Retry \u4e00\u6b21\uff1f \u7db2\u8def\u65b7\u7dda\uff0c\u53ef\u80fd\u50c5\u9020\u6210\u6578\u6beb\u79d2\u7684 rejection DB connection\uff0c\u53ef\u80fd\u9020\u6210\u6578\u79d2\u7684 rejection reboot \u53ef\u80fd\u9020\u6210\u6578\u5206\u9418\u7684 rejection rolling back \u53ef\u80fd\u9020\u6210\u5c0f\u6642\u7684 rejection \u5728\u4e0a\u8ff0\u7684\u60c5\u6cc1\u4e0b\uff0cexponential backoff \u5c31\u662f\u696d\u754c\u7684 retry \u6a19\u6e96\uff0c\u4f8b\u5982\uff1a 100ms 250ms 500ms 1s 2.5s 5s 5s ... quit Jitter \u82e5\u540c\u6642\u6709\u8a31\u591a instance \u8981 retry connection\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u540c\u6642\u9593\u904e\u591a\u7684 request \u9032\u5165 server \u4e2d\u3002 \u5982\u4e0a\u5716\u6240\u793a\uff0c\u9019\u72c0\u6cc1\u5c31\u53eb thundering herd \u3002 \u9019\u6642\u5728\u5404\u500b instance \u4e2d\u589e\u52a0 \u00b110% \u5167\u7684\u4e82\u6578\u6703\u5e73\u5747\u5206\u6563\u9019\u4e9b\u8acb\u6c42\u3002\u9019\u7a2e\u505a\u6cd5\u5c31\u53eb\u505a jitter let time = SCHEDULE [ times ] || DEFAULT ; return Math . random () * ( time * 0.2 ) + time * 0.9 ; \u6216\u662f\u589e\u52a0 offset\uff1a const PERIOD = 60 _000 ; const OFFSET = Math . random () * PERIOD ; setTimeout (() => { setInterval (() => retry (), PERIOD ); }, OFFSET );","title":"Retry \u7684\u7b56\u7565"},{"location":"essay/web/retry-strategy/#retry","text":"","title":"Retry \u7684\u7b56\u7565"},{"location":"essay/web/retry-strategy/#retry-in-http-method","text":"Method Idempotent Destructive Safe 4XX 5XX Ambiguous Purpose GET O X O No Retry Retry Retry \u53d6\u5f97\u8cc7\u6599 POST X X X No Retry No Retry No Retry \u5efa\u7acb\u8cc7\u6599 PUT O O X No Retry Retry Retry \u5efa\u7acb\u6216\u7de8\u8f2f\u8cc7\u6599 PATCH X O X No Retry Retry Retry \u7de8\u8f2f\u8cc7\u6599 DELETE O O X No Retry Retry Retry \u522a\u9664\u8cc7\u6599 Idempotent \u51aa\u7b49\u7684\uff0c\u91cd\u8907\u57f7\u884c\u5f8c\u7d50\u679c\u4ecd\u76f8\u540c Destructive\uff1a \u7834\u58de\u6027\u7684\uff0c\u57f7\u884c\u5f8c\u6703\u53ef\u80fd\u6703\u9020\u6210\u8cc7\u6599\u7684\u7121\u6cd5\u5fa9\u539f PUT \u53ef\u80fd\u70ba user.name = 'Evan' \uff0cPATH \u53ef\u80fd\u70ba user.access_count += 1 \uff0c\u6545\u51aa\u7b49\u662f\u4e0d\u540c\u7684\u3002 \u82e5\u70ba Destructive\uff0c\u53ef\u4f7f\u7528 ETAG \u548c If-Match \u7684 HTTP \u8868\u982d\u4f86\u78ba\u8a8d\u662f\u5426\u91cd\u8907\u4fee\u6539\uff0c\u6216\u5728\u66f4\u6539\u904e\u7a0b\u4e2d\uff0c\u5f9e\u4ed6\u8655\u5df2\u7d93\u88ab\u4fee\u6539\u3002 \u5c31\u5982\u540c Memcached \u7684 CAS \u503c \u6bcf\u6b21 Request \u4e2d\u589e\u52a0 idempotency key \u53ef\u4ee5\u7528\u4f5c cache key","title":"Retry in HTTP method"},{"location":"essay/web/retry-strategy/#circuit-breaker-pattern","text":"\u591a\u4e45 Retry \u4e00\u6b21\uff1f \u7db2\u8def\u65b7\u7dda\uff0c\u53ef\u80fd\u50c5\u9020\u6210\u6578\u6beb\u79d2\u7684 rejection DB connection\uff0c\u53ef\u80fd\u9020\u6210\u6578\u79d2\u7684 rejection reboot \u53ef\u80fd\u9020\u6210\u6578\u5206\u9418\u7684 rejection rolling back \u53ef\u80fd\u9020\u6210\u5c0f\u6642\u7684 rejection \u5728\u4e0a\u8ff0\u7684\u60c5\u6cc1\u4e0b\uff0cexponential backoff \u5c31\u662f\u696d\u754c\u7684 retry \u6a19\u6e96\uff0c\u4f8b\u5982\uff1a 100ms 250ms 500ms 1s 2.5s 5s 5s ... quit","title":"Circuit Breaker Pattern"},{"location":"essay/web/retry-strategy/#jitter","text":"\u82e5\u540c\u6642\u6709\u8a31\u591a instance \u8981 retry connection\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u540c\u6642\u9593\u904e\u591a\u7684 request \u9032\u5165 server \u4e2d\u3002 \u5982\u4e0a\u5716\u6240\u793a\uff0c\u9019\u72c0\u6cc1\u5c31\u53eb thundering herd \u3002 \u9019\u6642\u5728\u5404\u500b instance \u4e2d\u589e\u52a0 \u00b110% \u5167\u7684\u4e82\u6578\u6703\u5e73\u5747\u5206\u6563\u9019\u4e9b\u8acb\u6c42\u3002\u9019\u7a2e\u505a\u6cd5\u5c31\u53eb\u505a jitter let time = SCHEDULE [ times ] || DEFAULT ; return Math . random () * ( time * 0.2 ) + time * 0.9 ; \u6216\u662f\u589e\u52a0 offset\uff1a const PERIOD = 60 _000 ; const OFFSET = Math . random () * PERIOD ; setTimeout (() => { setInterval (() => retry (), PERIOD ); }, OFFSET );","title":"Jitter"},{"location":"essay/web/tcp/","text":"TCP Transmission Control Protocol \u50b3\u8f38\u63a7\u5236\u5354\u5b9a\u7684\u4f5c\u7528\u8aaa\u660e\u3002 OSI \u4e2d\u626e\u6f14\u7684\u89d2\u8272 \u6d41\u7a0b TCP \u5728 Berkeley Socket \u4e4b\u4e0a\u7684\u6d41\u7a0b\uff0cSocket \u70ba\u5305\u88dd\u5e95\u5c64\u904b\u4f5c\u7684 API\uff0c\u5305\u62ec Data Link Layer \u548c Network Layer\u3002 \u5404\u6d41\u7a0b\u7c21\u4ecb \u540d\u7a31 \u529f\u80fd Socket \u5efa\u7acb Socket \u4f86\u76e3\u807d\uff08listen\uff09\u9023\u7dda Bind \u7d81\u5b9a address \u548c port\uff0c\u53ef\u8a2d\u5b9a IP \u906e\u7f69 Listen \u76e3\u807d TCP \u9023\u7dda\u548c\u9650\u5236\u9023\u7dda\u6578\uff0cUDP \u4e0d\u9700\u8981\u547c\u53eb\u672c\u51fd\u5f0f Accept \u8ff4\u5708\u53bb\u63a5\u53d7\u9023\u7dda\uff0c\u4e26\u9032\u884c\u5f8c\u7e8c\u7684\u4ea4\u63e1\u884c\u70ba \u5be6\u4f5c\u7bc4\u4f8b /* Bind an address to the socket */ bzero (( char * ) & server , sizeof ( struct sockaddr_in )); server . sin_family = AF_INET ; server . sin_port = htons ( port ); server . sin_addr . s_addr = htonl ( INADDR_ANY ); if ( bind ( sd , ( struct sockaddr * ) & server , sizeof ( server )) == -1 ) { fprintf ( stderr , \"Can't bind name to socket \\n \" ); exit ( 1 ); } /* queue up to 5 connect requests */ listen ( sd , 5 ); while ( 1 ) { client_len = sizeof ( client ); /* Do things(read and write) on new_sd, sd continue to listen requests */ if (( new_sd = accept ( sd , ( struct sockaddr * ) & client , & client_len )) == -1 ) { fprintf ( stderr , \"Can't accept client \\n \" ); exit ( 1 ); } } Connect \u4ee5\u9023\u7dda\u5230 google.com \u4e2d\u7522\u751f\u7684\u591a\u500b\u5c01\u5305\u505a\u8aaa\u660e\u3002 \u4e09\u6b21\u63e1\u624b SEQuence number AWKnowledge number \u56db\u6b21\u63ee\u624b \u70ba\u4ec0\u9ebc\u63ee\u624b\u8981\u56db\u6b21\uff0c\u63e1\u624b\u50c5\u4e09\u6b21\u5c31\u53ef\u4ee5\uff1f \u5f85\u64b0\u5beb","title":"TCP"},{"location":"essay/web/tcp/#tcp","text":"Transmission Control Protocol \u50b3\u8f38\u63a7\u5236\u5354\u5b9a\u7684\u4f5c\u7528\u8aaa\u660e\u3002","title":"TCP"},{"location":"essay/web/tcp/#osi","text":"","title":"OSI \u4e2d\u626e\u6f14\u7684\u89d2\u8272"},{"location":"essay/web/tcp/#_1","text":"TCP \u5728 Berkeley Socket \u4e4b\u4e0a\u7684\u6d41\u7a0b\uff0cSocket \u70ba\u5305\u88dd\u5e95\u5c64\u904b\u4f5c\u7684 API\uff0c\u5305\u62ec Data Link Layer \u548c Network Layer\u3002","title":"\u6d41\u7a0b"},{"location":"essay/web/tcp/#_2","text":"\u540d\u7a31 \u529f\u80fd Socket \u5efa\u7acb Socket \u4f86\u76e3\u807d\uff08listen\uff09\u9023\u7dda Bind \u7d81\u5b9a address \u548c port\uff0c\u53ef\u8a2d\u5b9a IP \u906e\u7f69 Listen \u76e3\u807d TCP \u9023\u7dda\u548c\u9650\u5236\u9023\u7dda\u6578\uff0cUDP \u4e0d\u9700\u8981\u547c\u53eb\u672c\u51fd\u5f0f Accept \u8ff4\u5708\u53bb\u63a5\u53d7\u9023\u7dda\uff0c\u4e26\u9032\u884c\u5f8c\u7e8c\u7684\u4ea4\u63e1\u884c\u70ba","title":"\u5404\u6d41\u7a0b\u7c21\u4ecb"},{"location":"essay/web/tcp/#_3","text":"/* Bind an address to the socket */ bzero (( char * ) & server , sizeof ( struct sockaddr_in )); server . sin_family = AF_INET ; server . sin_port = htons ( port ); server . sin_addr . s_addr = htonl ( INADDR_ANY ); if ( bind ( sd , ( struct sockaddr * ) & server , sizeof ( server )) == -1 ) { fprintf ( stderr , \"Can't bind name to socket \\n \" ); exit ( 1 ); } /* queue up to 5 connect requests */ listen ( sd , 5 ); while ( 1 ) { client_len = sizeof ( client ); /* Do things(read and write) on new_sd, sd continue to listen requests */ if (( new_sd = accept ( sd , ( struct sockaddr * ) & client , & client_len )) == -1 ) { fprintf ( stderr , \"Can't accept client \\n \" ); exit ( 1 ); } }","title":"\u5be6\u4f5c\u7bc4\u4f8b"},{"location":"essay/web/tcp/#connect","text":"\u4ee5\u9023\u7dda\u5230 google.com \u4e2d\u7522\u751f\u7684\u591a\u500b\u5c01\u5305\u505a\u8aaa\u660e\u3002","title":"Connect"},{"location":"essay/web/tcp/#_4","text":"","title":"\u4e09\u6b21\u63e1\u624b"},{"location":"essay/web/tcp/#sequence-number","text":"","title":"SEQuence number"},{"location":"essay/web/tcp/#awknowledge-number","text":"","title":"AWKnowledge number"},{"location":"essay/web/tcp/#_5","text":"\u70ba\u4ec0\u9ebc\u63ee\u624b\u8981\u56db\u6b21\uff0c\u63e1\u624b\u50c5\u4e09\u6b21\u5c31\u53ef\u4ee5\uff1f \u5f85\u64b0\u5beb","title":"\u56db\u6b21\u63ee\u624b"},{"location":"essay/web/url-structure/","text":"URL \u9577\u4ec0\u9ebc\u6a23\u5b50 URL: scheme://host:port/path Scheme http , https Host subdomain.domain.tld Top layer Domain (TLD) com com.tw io github.io Port http default 80 https default 443 Path /path?query_key=query_value#fragment Diagram sequenceDiagram participant scheme participant subdomain participant domain participant tld participant port domain->>tld: site subdomain->>tld: host scheme->>port: origin Example https://example.com:443 is same origin to https://example.com http://eample.com:443 is different origin to http://example.com (why? http default port is 80) http://api.example.com is same site of http://auth.example.com Extension schemeful-same-site consider scheme on site HTTP header Sec-Fetch-Site ([time=April, 2020]) can know where request came from same-site same-origin cross-site none","title":"URL \u9577\u4ec0\u9ebc\u6a23\u5b50"},{"location":"essay/web/url-structure/#url","text":"URL: scheme://host:port/path","title":"URL \u9577\u4ec0\u9ebc\u6a23\u5b50"},{"location":"essay/web/url-structure/#scheme","text":"http , https","title":"Scheme"},{"location":"essay/web/url-structure/#host","text":"subdomain.domain.tld","title":"Host"},{"location":"essay/web/url-structure/#top-layer-domain-tld","text":"com com.tw io github.io","title":"Top layer Domain (TLD)"},{"location":"essay/web/url-structure/#port","text":"http default 80 https default 443","title":"Port"},{"location":"essay/web/url-structure/#path","text":"/path?query_key=query_value#fragment","title":"Path"},{"location":"essay/web/url-structure/#diagram","text":"sequenceDiagram participant scheme participant subdomain participant domain participant tld participant port domain->>tld: site subdomain->>tld: host scheme->>port: origin","title":"Diagram"},{"location":"essay/web/url-structure/#example","text":"https://example.com:443 is same origin to https://example.com http://eample.com:443 is different origin to http://example.com (why? http default port is 80) http://api.example.com is same site of http://auth.example.com","title":"Example"},{"location":"essay/web/url-structure/#extension","text":"schemeful-same-site consider scheme on site HTTP header Sec-Fetch-Site ([time=April, 2020]) can know where request came from same-site same-origin cross-site none","title":"Extension"},{"location":"essay/web-security/cross-origin-resources-sharing/","text":"CORS What is Origin? \u6b77\u53f2 \u70ba\u4e86\u4fdd\u8b77\u4f7f\u7528\u8005\u7684\u96b1\u79c1\u548c\u88ab\u8981\u6c42\u7684\u7db2\u7ad9\u96b1\u79c1\u3002 \u5716\u8868\u8aaa\u660e sequenceDiagram participant example.com participant browser participant image.com example.com->>browser: 1. \u7d66\u6211\u770b\u770b\u5716\u7247\uff01 browser->>image.com: 2. HTTP Request Origin: http://example.com image.com->>browser: 3.1 HTTP Response\uff08\u6210\u529f\uff09 Access-Control-Allow-Origin: http://example.com image.com-->>browser: 3.1 HTTP Response\uff08\u5931\u6557\uff09 Access-Control-Allow-Origin: http://other.com \u4f7f\u7528\u8005\u9032\u5230 http://example.com \u7684\u7db2\u7ad9\u3002 \u4f7f\u7528\u8005\u7684\u700f\u89bd\u5668\u900f\u904e\u7db2\u7ad9\u9700\u6c42\u53ef\u80fd\u6703\u53bb\u8ddf\u5176\u4ed6\u7db2\u7ad9\uff08 http://image.com \uff09\u8981\u6a94\u6848\uff08\u5716\u7247\uff0cCSS \u6a94...\uff09\u3002 \u70ba\u4e86\u4fdd\u8b77\u88ab\u8981\u6c42\u7684\u7db2\u7ad9\u96b1\u79c1\uff0c\u82e5\u8a72\u7db2\u7ad9\u56de\u50b3\u7684\u6a19\u982d\u4e0d\u5141\u8a31\u8a72\u5b58\u53d6\uff0c\u700f\u89bd\u5668\u6703\u5224\u5b9a\u8981\u6c42\u5931\u6557\uff0c\u53cd\u4e4b\u5247\u6210\u529f\u3002 Access-Control-Allow-Origin http://example.com http://example.com | http://other.com * \u7d30\u7bc0 \u82e5 HTTP request \u593e\u96dc\u4e86\u4e9b\u6771\u897f \uff0cHTTP response \u5c31\u6703 \u9700\u8981\u66f4\u591a\u6a19\u982d\u4f86\u8868\u9054\u610f\u9858 \u3002 \u82e5 HTTP request \u593e\u96dc\u4e86\u4e9b\u6771\u897f \uff0c\u700f\u89bd\u5668\u53ef\u80fd\u9084\u9700\u8981\u505a \u9810\u5148\u6aa2\u67e5 \uff0c\u82e5\u6aa2\u67e5\u5931\u6557\uff0c\u4e0d\u6703\u505a\u9032\u4e00\u6b65\u7684\u8981\u6c42\u3002 \u593e\u96dc\u7684\u6771\u897f\u5e38\u5e38\u5c31\u662f\u4f7f\u7528\u8005\u7684\u96b1\u79c1\u3002 \u653b\u64ca \u82e5\u5141\u8a31\u6240\u6709\u7684\u8981\u6c42\uff0c\u653b\u64ca\u8005\u53ef\u4ee5\u5728\u81ea\u5df1\u7db2\u7ad9\uff08 devil.com \uff09\u8981\u6c42\u4e00\u500b\u5728\u88ab\u653b\u64ca\u7db2\u7ad9\uff08 example.com \uff09\u4e2d\u7684\u6703\u54e1\u5c08\u5c6c\u5716\u7247\uff0c\u4e26\u900f\u904e\u5716\u7247\u6216\u5176\u4ed6\u4e92\u52d5\u65b9\u5f0f\u8981\u5230\u6703\u54e1\u500b\u4eba\u53ef\u8fa8\u8b58\u7684\u8cc7\u6599\u6216\u751a\u81f3 cookie \u7684\u503c\u3002 \u5ef6\u4f38 very new feature!! Cross Origin Embedder Policy (COEP) \u7db2\u7ad9\u662f\u5426\u9700\u8981\u4f7f\u7528 CORP \u548c CORS Cross Origin Opener Policy (COOP) \u80fd\u5426\u5728\u4e0d\u79fb\u52d5\u7db2\u5740\u60c5\u6cc1\u4e0b\u6253\u958b\u5176\u4ed6\u7db2\u9801\uff08popup\uff09 Cross Origin Resource Policy (CORP) Cross-Origin-Resource-Policy same-origin same-site cross-origin Cross Origin Read Blocking (CORB) Cross-Origin-Embedder-Policy require-corp","title":"CORS"},{"location":"essay/web-security/cross-origin-resources-sharing/#cors","text":"What is Origin?","title":"CORS"},{"location":"essay/web-security/cross-origin-resources-sharing/#_1","text":"\u70ba\u4e86\u4fdd\u8b77\u4f7f\u7528\u8005\u7684\u96b1\u79c1\u548c\u88ab\u8981\u6c42\u7684\u7db2\u7ad9\u96b1\u79c1\u3002","title":"\u6b77\u53f2"},{"location":"essay/web-security/cross-origin-resources-sharing/#_2","text":"sequenceDiagram participant example.com participant browser participant image.com example.com->>browser: 1. \u7d66\u6211\u770b\u770b\u5716\u7247\uff01 browser->>image.com: 2. HTTP Request Origin: http://example.com image.com->>browser: 3.1 HTTP Response\uff08\u6210\u529f\uff09 Access-Control-Allow-Origin: http://example.com image.com-->>browser: 3.1 HTTP Response\uff08\u5931\u6557\uff09 Access-Control-Allow-Origin: http://other.com \u4f7f\u7528\u8005\u9032\u5230 http://example.com \u7684\u7db2\u7ad9\u3002 \u4f7f\u7528\u8005\u7684\u700f\u89bd\u5668\u900f\u904e\u7db2\u7ad9\u9700\u6c42\u53ef\u80fd\u6703\u53bb\u8ddf\u5176\u4ed6\u7db2\u7ad9\uff08 http://image.com \uff09\u8981\u6a94\u6848\uff08\u5716\u7247\uff0cCSS \u6a94...\uff09\u3002 \u70ba\u4e86\u4fdd\u8b77\u88ab\u8981\u6c42\u7684\u7db2\u7ad9\u96b1\u79c1\uff0c\u82e5\u8a72\u7db2\u7ad9\u56de\u50b3\u7684\u6a19\u982d\u4e0d\u5141\u8a31\u8a72\u5b58\u53d6\uff0c\u700f\u89bd\u5668\u6703\u5224\u5b9a\u8981\u6c42\u5931\u6557\uff0c\u53cd\u4e4b\u5247\u6210\u529f\u3002","title":"\u5716\u8868\u8aaa\u660e"},{"location":"essay/web-security/cross-origin-resources-sharing/#access-control-allow-origin","text":"http://example.com http://example.com | http://other.com *","title":"Access-Control-Allow-Origin"},{"location":"essay/web-security/cross-origin-resources-sharing/#_3","text":"\u82e5 HTTP request \u593e\u96dc\u4e86\u4e9b\u6771\u897f \uff0cHTTP response \u5c31\u6703 \u9700\u8981\u66f4\u591a\u6a19\u982d\u4f86\u8868\u9054\u610f\u9858 \u3002 \u82e5 HTTP request \u593e\u96dc\u4e86\u4e9b\u6771\u897f \uff0c\u700f\u89bd\u5668\u53ef\u80fd\u9084\u9700\u8981\u505a \u9810\u5148\u6aa2\u67e5 \uff0c\u82e5\u6aa2\u67e5\u5931\u6557\uff0c\u4e0d\u6703\u505a\u9032\u4e00\u6b65\u7684\u8981\u6c42\u3002 \u593e\u96dc\u7684\u6771\u897f\u5e38\u5e38\u5c31\u662f\u4f7f\u7528\u8005\u7684\u96b1\u79c1\u3002","title":"\u7d30\u7bc0"},{"location":"essay/web-security/cross-origin-resources-sharing/#_4","text":"\u82e5\u5141\u8a31\u6240\u6709\u7684\u8981\u6c42\uff0c\u653b\u64ca\u8005\u53ef\u4ee5\u5728\u81ea\u5df1\u7db2\u7ad9\uff08 devil.com \uff09\u8981\u6c42\u4e00\u500b\u5728\u88ab\u653b\u64ca\u7db2\u7ad9\uff08 example.com \uff09\u4e2d\u7684\u6703\u54e1\u5c08\u5c6c\u5716\u7247\uff0c\u4e26\u900f\u904e\u5716\u7247\u6216\u5176\u4ed6\u4e92\u52d5\u65b9\u5f0f\u8981\u5230\u6703\u54e1\u500b\u4eba\u53ef\u8fa8\u8b58\u7684\u8cc7\u6599\u6216\u751a\u81f3 cookie \u7684\u503c\u3002","title":"\u653b\u64ca"},{"location":"essay/web-security/cross-origin-resources-sharing/#_5","text":"very new feature!! Cross Origin Embedder Policy (COEP) \u7db2\u7ad9\u662f\u5426\u9700\u8981\u4f7f\u7528 CORP \u548c CORS Cross Origin Opener Policy (COOP) \u80fd\u5426\u5728\u4e0d\u79fb\u52d5\u7db2\u5740\u60c5\u6cc1\u4e0b\u6253\u958b\u5176\u4ed6\u7db2\u9801\uff08popup\uff09 Cross Origin Resource Policy (CORP) Cross-Origin-Resource-Policy same-origin same-site cross-origin Cross Origin Read Blocking (CORB) Cross-Origin-Embedder-Policy require-corp","title":"\u5ef6\u4f38"},{"location":"essay/web-security/mixed-content/","text":"\u4ec0\u9ebc\u662f Mixed Content \u540c\u4e00\u500b\u7db2\u7ad9\u64c1\u6709\u591a\u500b\u7db2\u7ad9\u7684\u8cc7\u6e90 JS CSS \u5716\u7247\u7b49\u7b49 \u5f71\u97ff\u7db2\u7ad9\u884c\u70ba \\ \u4e0d\u662f\uff01 \u54ea\u4e9b\u9700\u8981\u6ce8\u610f \u9664\u4e86\u5f71\u7247\u3001\u8072\u97f3\u3001\u5716\u50cf\u90fd\u61c9\u8a72\u8981\u64cb \u5716\u50cf\u4e5f\u8981\u6ce8\u610f \u628a\u5783\u573e\u6876\u7684\u5716\u6a19\u548c\u5132\u5b58\u8d77\u4f86\u7684\u5716\u6a19\u4ea4\u63db \u820a\u7684\u700f\u89bd\u5668\u53ef\u80fd\u9632\u8b77\u4e0d\u5920 IE8 \u4ee5\u4e0b \u9632\u8b77 http:// => https:// \u5f9e\u672c\u5730\u7aef\u9001\u8cc7\u6599\u800c\u4e0d\u662f\u5f9e\u5225\u7684\u7db2\u7ad9\u8981 Header: Content Security Policy upgrade-insecure-requests cascades into \\ blocking resources \u6383\u63cf\u5de5\u5177\uff1a HTTPSChecker Mixed Content Scan","title":"Mixed Content"},{"location":"essay/web-security/mixed-content/#mixed-content","text":"\u540c\u4e00\u500b\u7db2\u7ad9\u64c1\u6709\u591a\u500b\u7db2\u7ad9\u7684\u8cc7\u6e90 JS CSS \u5716\u7247\u7b49\u7b49 \u5f71\u97ff\u7db2\u7ad9\u884c\u70ba \\ \u4e0d\u662f\uff01","title":"\u4ec0\u9ebc\u662f Mixed Content"},{"location":"essay/web-security/mixed-content/#_1","text":"\u9664\u4e86\u5f71\u7247\u3001\u8072\u97f3\u3001\u5716\u50cf\u90fd\u61c9\u8a72\u8981\u64cb \u5716\u50cf\u4e5f\u8981\u6ce8\u610f \u628a\u5783\u573e\u6876\u7684\u5716\u6a19\u548c\u5132\u5b58\u8d77\u4f86\u7684\u5716\u6a19\u4ea4\u63db \u820a\u7684\u700f\u89bd\u5668\u53ef\u80fd\u9632\u8b77\u4e0d\u5920 IE8 \u4ee5\u4e0b","title":"\u54ea\u4e9b\u9700\u8981\u6ce8\u610f"},{"location":"essay/web-security/mixed-content/#_2","text":"http:// => https:// \u5f9e\u672c\u5730\u7aef\u9001\u8cc7\u6599\u800c\u4e0d\u662f\u5f9e\u5225\u7684\u7db2\u7ad9\u8981 Header: Content Security Policy upgrade-insecure-requests cascades into \\ blocking resources \u6383\u63cf\u5de5\u5177\uff1a HTTPSChecker Mixed Content Scan","title":"\u9632\u8b77"},{"location":"essay/web-security/owasp-api-top10/","text":"OWASP API Top 10 Broken Object Level Authorization GET /api/v2/shops/{shop_name}/revenue_data.json HTTP/1.1 ... \u653b\u64ca\u8005\u53ea\u8981\u66f4\u6539 shop_name \u5c31\u53ef\u4ee5\u5b58\u53d6\u4ed6\u4eba\u7684\u8cc7\u6599\u3002 Broken Authentication \u5982\u679c API \u5728\u8655\u7406\u8eab\u4efd\u8a8d\u8b49\u6642\uff0c\u6c92\u6709\u9069\u7576\u4fdd\u8b77\uff0c\u5982\uff1a CAPTCHA \u3001 \u901f\u5ea6\u9650\u5236 \u3001 \u9396 IP \u7b49\u3002 \u653b\u64ca\u8005\u53ef\u4ee5\u904b\u7528\u4f7f\u7528\u8005\u5e33\u865f\u3001\u5bc6\u78bc\u7d44\u5408\u5217\u8868\u53cd\u8986\u5617\u8a66\u4f86\u53d6\u5f97\u6b0a\u9650\uff0c \u5c31\u53ef\u4ee5\u5f97\u5230\u6b63\u78ba\u7684\u7d44\u5408\u3002 Excessive Data Exposure \u65b0\u9032 \u4fdd\u5168 \u53ea\u80fd\u5b58\u53d6\u9650\u5236\u7684 \u76e3\u63a7 \u3002 GET /api/v2/camera/ids HTTP/1.1 ... \u56de\u50b3\u7684\u537b\u662f\u5168\u90e8\u7684 \u76e3\u63a7 \uff0c\u7136\u5f8c\u518d\u5728 APP \u4f5c\u904e\u6ffe\u548c\u9650\u5236\u3002 Lack of Resources & Rate Limiting \u963b\u65b7\u670d\u52d9\u653b\u64ca (DoS) GET /api/v2/users?page=1&size=100 HTTP/1.1 ... size \u5f9e 100 \u8abf\u6574\u6210 2,000,000 \u3002 Broken Function Level Authorization \u53ef\u4ee5\u5b58\u53d6\u672a\u7d93\u6388\u6b0a\u7684\u529f\u80fd POST /api/admin/v2/invites HTTP/1.1 ... {\"email\"\uff1a\"hugo@malicious.com\"} \u6ce8\u610f\u548c Object \u4e4b\u9593\u7684\u5dee\u7570 Mass Assignment \u6bd4\u8f03\u4e0b\u5217\u5169\u6bb5\u7a0b\u5f0f\u78bc\u7684\u5dee\u7570\u3002 const user = new User ( req . body ); user . update (); const data = req . body ; const user = new User ({ name : data . name , age : data . age }); user . update (); \u82e5\u4f7f\u7528\u8005\u6253\u5165\u4ee5\u4e0b API \u5c1a\u7121\u5f71\u97ff\u3002 PUT /api/v2/user/data HTTP/1.1 ... {\"name\"\uff1a\"john\",\"age\"\uff1a24} \u4f46\u6539\u6210\u4ee5\u4e0b\u8cc7\u8a0a\uff0c\u5247\u6703\u7d66\u4e88\u932f\u8aa4\u6b0a\u9650\u3002 PUT /api/v2/user/data HTTP/1.1 ... {\"name\"\uff1a\"john\",\"age\"\uff1a24,\"money\"\uff1a999999} Security Misconfiguration \u5982\u679c\u8cc7\u6599\u5eab\u7ba1\u7406\u7cfb\u7d71\u4f7f\u7528\u7684\u662f\u9810\u8a2d\u914d\u7f6e \u800c\u5176\u5728\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\u6703\u89e3\u9664\u8eab\u4efd\u8a8d\u8b49... Injection POST /api/v2/auth/login HTTP/1.1 ... {\"account\"\uff1a\"some-account' OR 1 --\", \"password\": \"dont-care\"} \u5728\u8cc7\u6599\u5eab\u4e2d\u6703\u5982\u4ee5\u4e0b\u57f7\u884c\uff1a SELECT * FROM user WHERE account = 'some-account' OR 1 --' AND password='dont-care' LIMIT 1 Improper Assets Management v2 \u628a Lack of Resources & Rate Limiting \u7684\u554f\u984c\u4fee\u597d\u4e86 GET /api/v2/users?page=1&size=100 HTTP/1.1 ... \u4f46\u662f v1 \u5462\uff1f\u6709\u6b63\u78ba\u4fee\u6b63\u6216\u91cd\u65b0\u5c0e\u5165\uff08redirect\uff09\u5230 v2 \u55ce \u6e2c\u8a66\u74b0\u5883\u7684 DB \u6709\u6c92\u6709\u548c\u6b63\u5f0f\u74b0\u5883\u4e92\u76f8\u5f71\u97ff\uff1f Insufficient Logging & Monitoring \u597d\u7684 Log \u548c\u8b66\u544a\u7cfb\u7d71\uff0c\u6703\u8b93\u7ba1\u7406\u54e1\u6709\u80fd\u529b\u7576\u4e0b\u5c0d\u653b\u64ca\u505a\u8655\u7406\u3002","title":"OWASP API Top 10"},{"location":"essay/web-security/owasp-api-top10/#owasp-api-top-10","text":"","title":"OWASP API Top 10"},{"location":"essay/web-security/owasp-api-top10/#broken-object-level-authorization","text":"GET /api/v2/shops/{shop_name}/revenue_data.json HTTP/1.1 ... \u653b\u64ca\u8005\u53ea\u8981\u66f4\u6539 shop_name \u5c31\u53ef\u4ee5\u5b58\u53d6\u4ed6\u4eba\u7684\u8cc7\u6599\u3002","title":"Broken Object Level Authorization"},{"location":"essay/web-security/owasp-api-top10/#broken-authentication","text":"\u5982\u679c API \u5728\u8655\u7406\u8eab\u4efd\u8a8d\u8b49\u6642\uff0c\u6c92\u6709\u9069\u7576\u4fdd\u8b77\uff0c\u5982\uff1a CAPTCHA \u3001 \u901f\u5ea6\u9650\u5236 \u3001 \u9396 IP \u7b49\u3002 \u653b\u64ca\u8005\u53ef\u4ee5\u904b\u7528\u4f7f\u7528\u8005\u5e33\u865f\u3001\u5bc6\u78bc\u7d44\u5408\u5217\u8868\u53cd\u8986\u5617\u8a66\u4f86\u53d6\u5f97\u6b0a\u9650\uff0c \u5c31\u53ef\u4ee5\u5f97\u5230\u6b63\u78ba\u7684\u7d44\u5408\u3002","title":"Broken Authentication"},{"location":"essay/web-security/owasp-api-top10/#excessive-data-exposure","text":"\u65b0\u9032 \u4fdd\u5168 \u53ea\u80fd\u5b58\u53d6\u9650\u5236\u7684 \u76e3\u63a7 \u3002 GET /api/v2/camera/ids HTTP/1.1 ... \u56de\u50b3\u7684\u537b\u662f\u5168\u90e8\u7684 \u76e3\u63a7 \uff0c\u7136\u5f8c\u518d\u5728 APP \u4f5c\u904e\u6ffe\u548c\u9650\u5236\u3002","title":"Excessive Data Exposure"},{"location":"essay/web-security/owasp-api-top10/#lack-of-resources-rate-limiting","text":"\u963b\u65b7\u670d\u52d9\u653b\u64ca (DoS) GET /api/v2/users?page=1&size=100 HTTP/1.1 ... size \u5f9e 100 \u8abf\u6574\u6210 2,000,000 \u3002","title":"Lack of Resources &amp; Rate Limiting"},{"location":"essay/web-security/owasp-api-top10/#broken-function-level-authorization","text":"\u53ef\u4ee5\u5b58\u53d6\u672a\u7d93\u6388\u6b0a\u7684\u529f\u80fd POST /api/admin/v2/invites HTTP/1.1 ... {\"email\"\uff1a\"hugo@malicious.com\"} \u6ce8\u610f\u548c Object \u4e4b\u9593\u7684\u5dee\u7570","title":"Broken Function Level Authorization"},{"location":"essay/web-security/owasp-api-top10/#mass-assignment","text":"\u6bd4\u8f03\u4e0b\u5217\u5169\u6bb5\u7a0b\u5f0f\u78bc\u7684\u5dee\u7570\u3002 const user = new User ( req . body ); user . update (); const data = req . body ; const user = new User ({ name : data . name , age : data . age }); user . update (); \u82e5\u4f7f\u7528\u8005\u6253\u5165\u4ee5\u4e0b API \u5c1a\u7121\u5f71\u97ff\u3002 PUT /api/v2/user/data HTTP/1.1 ... {\"name\"\uff1a\"john\",\"age\"\uff1a24} \u4f46\u6539\u6210\u4ee5\u4e0b\u8cc7\u8a0a\uff0c\u5247\u6703\u7d66\u4e88\u932f\u8aa4\u6b0a\u9650\u3002 PUT /api/v2/user/data HTTP/1.1 ... {\"name\"\uff1a\"john\",\"age\"\uff1a24,\"money\"\uff1a999999}","title":"Mass Assignment"},{"location":"essay/web-security/owasp-api-top10/#security-misconfiguration","text":"\u5982\u679c\u8cc7\u6599\u5eab\u7ba1\u7406\u7cfb\u7d71\u4f7f\u7528\u7684\u662f\u9810\u8a2d\u914d\u7f6e \u800c\u5176\u5728\u9ed8\u8a8d\u60c5\u6cc1\u4e0b\u6703\u89e3\u9664\u8eab\u4efd\u8a8d\u8b49...","title":"Security Misconfiguration"},{"location":"essay/web-security/owasp-api-top10/#injection","text":"POST /api/v2/auth/login HTTP/1.1 ... {\"account\"\uff1a\"some-account' OR 1 --\", \"password\": \"dont-care\"} \u5728\u8cc7\u6599\u5eab\u4e2d\u6703\u5982\u4ee5\u4e0b\u57f7\u884c\uff1a SELECT * FROM user WHERE account = 'some-account' OR 1 --' AND password='dont-care' LIMIT 1","title":"Injection"},{"location":"essay/web-security/owasp-api-top10/#improper-assets-management","text":"v2 \u628a Lack of Resources & Rate Limiting \u7684\u554f\u984c\u4fee\u597d\u4e86 GET /api/v2/users?page=1&size=100 HTTP/1.1 ... \u4f46\u662f v1 \u5462\uff1f\u6709\u6b63\u78ba\u4fee\u6b63\u6216\u91cd\u65b0\u5c0e\u5165\uff08redirect\uff09\u5230 v2 \u55ce \u6e2c\u8a66\u74b0\u5883\u7684 DB \u6709\u6c92\u6709\u548c\u6b63\u5f0f\u74b0\u5883\u4e92\u76f8\u5f71\u97ff\uff1f","title":"Improper Assets Management"},{"location":"essay/web-security/owasp-api-top10/#insufficient-logging-monitoring","text":"\u597d\u7684 Log \u548c\u8b66\u544a\u7cfb\u7d71\uff0c\u6703\u8b93\u7ba1\u7406\u54e1\u6709\u80fd\u529b\u7576\u4e0b\u5c0d\u653b\u64ca\u505a\u8655\u7406\u3002","title":"Insufficient Logging &amp; Monitoring"},{"location":"essay/web-security/owasp-authentication-best-practice/","text":"OWASP \u9a57\u8b49\u6a5f\u5236\u6700\u4f73\u6307\u5357 Passsword Referer: https://github.com/OWASP/owasp-mstg/blob/master/Document/0x04e-Testing-Authentication-and-Session-Management.md#testing-best-practices-for-passwords-mstg-auth-5-and-mstg-auth-6 \u67b6\u69cb\u7684\u6aa2\u67e5 \u6aa2\u67e5\u5bc6\u78bc\u5f37\u5ea6\uff0c zxcvbn \u6aa2\u67e5\u5bc6\u78bc\u88ab\u7834\u89e3\u904e\uff0c Have I been pwned? \u9650\u5236\u5617\u8a66 \u81ea\u5df1\u653b\u64ca\u770b\u770b\uff0c Burp Suite Intruder Session Referer: https://github.com/OWASP/owasp-mstg/blob/master/Document/0x04e-Testing-Authentication-and-Session-Management.md#session-management-best-practices \u6bcf\u6b21\u9700\u8981\u9a57\u8b49\u8eab\u4efd\u6642\u8981\u505a\u6aa2\u67e5 \u8981\u904e\u671f \u6839\u64da\u4e0d\u540c Framework \u6709\u4e0d\u540c best practice\uff0c\u8acb\u8a73\u95b1\uff01\uff01 2FA SMS-OTP NIST: \"Due to the risk that SMS messages may be intercepted or redirected, implementers of new systems SHOULD carefully consider alternative authenticators.\" \u53ef\u80fd\u906d\u9047\u7684\u5a01\u8105\u548c\u9810\u9632\u65b9\u5f0f\uff1ahttps://github.com/OWASP/owasp-mstg/blob/master/Document/0x04e-Testing-Authentication-and-Session-Management.md#dangers-of-sms-otp Transaction Signing with Push Notifications and PKI \u624b\u6a5f\u5efa\u7acb\u516c\u79c1\u9470 \u516c\u9470\u9001\u7d66\u5f8c\u7aef \u82e5\u9700\u8981\u9a57\u8b49\u7684\u884c\u70ba\uff1a \u767c\u901a\u77e5\uff08Push notifications\uff09\u5230\u624b\u6a5f \u4f7f\u7528\u8005\u6388\u6b0a \u50b3\u9001\u79c1\u9470\u7c3d\u6838\u904e\u7684\u8a0a\u606f \u9a57\u8b49 \u8a73\u7d30\u6ce8\u610f\u4e8b\u9805\u548c\u6e2c\u8a66\uff1ahttps://github.com/OWASP/owasp-mstg/blob/master/Document/0x04e-Testing-Authentication-and-Session-Management.md#transaction-signing-with-push-notifications-and-pki JWT \u6bcf\u6b21\u90fd\u8981\u9a57\u8b49 \u9470\u5319\u85cf\u597d \u85cf\u597d\u6a5f\u654f\u8cc7\u6599\uff0c\u82e5\u6709\u5fc5\u8981\u8acb\u52a0\u5bc6 \u4f7f\u7528 jti \uff08JWT ID\uff09 token \u8acb\u653e\u5728 KeyChain \u6216 KeyStore Header \u4e0d\u80fd\u8b93 alg \u53ef\u63a5\u53d7 none exp \u8981\u6ce8\u610f OAuth 2.0 \u5225\u7528 implicit grant \uff0c code grant \u8981\u4e00\u6b21\u6027\u4e14\u77ed\u6642 PKCE Access Token \u82e5\u5b58\u5728\u4e0d\u4fe1\u4efb\u7684\u5730\u65b9\u8981\u77ed\u66ab\u7684\u671f\u9650 \u6709\u9650\u5236\u7684 scope \u9664\u4e86 access token \u8981\u6709\u53ef\u4ee5\u9a57\u8b49\u4f7f\u7528\u8005\u7684\u8cc7\u8a0a OAuth 2.0 for Native APP \u600e\u9ebc\u78ba\u8a8d\u9019\u662f\u540c\u4e00\u53f0\u624b\u6a5f \u5982\u8ad6\u4f55\u7a2e\u72c0\u6cc1\uff0c\u4f60\u90fd\u61c9\u8a72\u9a57\u8b49\u8acb\u6c42\u662f\u5426\u4f86\u81ea\u4e0d\u540c\u88dd\u7f6e\u3002\u56e0\u6b64\uff0c\u8981\u80fd\u78ba\u8a8d\u4f60\u7684\u7a0b\u5f0f\u771f\u7684\u88ab\u88dd\u5728\u6b63\u78ba\u7684\u88dd\u7f6e\u4e0a\u3002 iOS\uff1a In iOS, a developer can use identifierForVendor , which is related to the bundle ID: the moment you change a bundle ID, the method will return a different value. When the app is ran for the first time, make sure you store the value returned by identifierForVendor to the KeyChain, so that changes to it can be detected at an early stage. Android\uff1a In Android, the developer can use Settings.Secure.ANDROID_ID till Android 8.0 (API level 26) to identify an application instance. Note that starting at Android 8.0 (API level 26), ANDROID_ID is no longer a device unique ID. Instead, it becomes scoped by the combination of app signing key, user and device. So validating ANDROID_ID for device blocking could be tricky for these Android versions. Because if an app changes its signing key, the ANDROID_ID will change and it won't be able to recognize old users devices. Therefore, it's better to store the ANDROID_ID encrypted and privately in a private a shared preferences file using a randomly generated key from the AndroidKeyStore and preferably AES_GCM encryption. The moment the app signature changes, the application can check for a delta and register the new ANDROID_ID . The moment this new ID changes without a new application signing key, it should indicate that something else is wrong. \u9664\u6b64\u4e4b\u5916\uff0c\u5728\u4e00\u958b\u59cb\u7684\u88dd\u7f6e\u7d81\u5b9a\u4e0a\uff0c\u53ef\u4ee5\u900f\u904e\u7c3d\u767c\u8acb\u6c42\uff0c\u4f86\u63d0\u9ad8\u5b89\u5168\u6027\u3002 Next, the device binding can be extended by signing requests with a key stored in the Keychain for iOS and in the KeyStore in Android can reassure strong device binding. \u4f60\u4e5f\u53ef\u4ee5\u9a57\u8b49 IP \u3001 \u5730\u7406\u4f4d\u7f6e \u548c \u6642\u9593\u8ecc\u8de1 \u3002 \u5176\u4ed6 \u8b93\u4f7f\u7528\u8005\u77e5\u9053 {} \u4e5f\u767b\u5165\u5e33\u865f\u4e86 \u54ea\u500b\u88dd\u7f6e \u54ea\u500b\u6642\u9593 \u54ea\u500b\u5730\u9ede \u8981\u901a\u77e5\u4f7f\u7528\u8005\u6709\u65b0\u7684\u767b\u5165 \u8b93\u4f7f\u7528\u8005\u77e5\u9053\u6700\u5f8c\u884c\u70ba\u662f\u4ec0\u9ebc \u6bcf\u6b21\u767b\u5165\u3001\u767b\u51fa\u8981\u505a\u7d00\u9304 \u9019\u4e9b\u662f\u6a5f\u654f\u7684\u884c\u70ba \u767b\u5165 \u6539\u5bc6\u78bc \u500b\u8cc7\u6539\u8b8a (name, email address, telephone number, etc.) \u654f\u611f\u884c\u70ba (purchase, accessing important resources, etc.) \u540c\u610f\u689d\u6b3e","title":"OWASP \u9a57\u8b49\u6a5f\u5236\u6700\u4f73\u6307\u5357"},{"location":"essay/web-security/owasp-authentication-best-practice/#owasp","text":"","title":"OWASP \u9a57\u8b49\u6a5f\u5236\u6700\u4f73\u6307\u5357"},{"location":"essay/web-security/owasp-authentication-best-practice/#passsword","text":"Referer: https://github.com/OWASP/owasp-mstg/blob/master/Document/0x04e-Testing-Authentication-and-Session-Management.md#testing-best-practices-for-passwords-mstg-auth-5-and-mstg-auth-6 \u67b6\u69cb\u7684\u6aa2\u67e5 \u6aa2\u67e5\u5bc6\u78bc\u5f37\u5ea6\uff0c zxcvbn \u6aa2\u67e5\u5bc6\u78bc\u88ab\u7834\u89e3\u904e\uff0c Have I been pwned? \u9650\u5236\u5617\u8a66 \u81ea\u5df1\u653b\u64ca\u770b\u770b\uff0c Burp Suite Intruder","title":"Passsword"},{"location":"essay/web-security/owasp-authentication-best-practice/#session","text":"Referer: https://github.com/OWASP/owasp-mstg/blob/master/Document/0x04e-Testing-Authentication-and-Session-Management.md#session-management-best-practices \u6bcf\u6b21\u9700\u8981\u9a57\u8b49\u8eab\u4efd\u6642\u8981\u505a\u6aa2\u67e5 \u8981\u904e\u671f \u6839\u64da\u4e0d\u540c Framework \u6709\u4e0d\u540c best practice\uff0c\u8acb\u8a73\u95b1\uff01\uff01","title":"Session"},{"location":"essay/web-security/owasp-authentication-best-practice/#2fa","text":"SMS-OTP NIST: \"Due to the risk that SMS messages may be intercepted or redirected, implementers of new systems SHOULD carefully consider alternative authenticators.\" \u53ef\u80fd\u906d\u9047\u7684\u5a01\u8105\u548c\u9810\u9632\u65b9\u5f0f\uff1ahttps://github.com/OWASP/owasp-mstg/blob/master/Document/0x04e-Testing-Authentication-and-Session-Management.md#dangers-of-sms-otp Transaction Signing with Push Notifications and PKI \u624b\u6a5f\u5efa\u7acb\u516c\u79c1\u9470 \u516c\u9470\u9001\u7d66\u5f8c\u7aef \u82e5\u9700\u8981\u9a57\u8b49\u7684\u884c\u70ba\uff1a \u767c\u901a\u77e5\uff08Push notifications\uff09\u5230\u624b\u6a5f \u4f7f\u7528\u8005\u6388\u6b0a \u50b3\u9001\u79c1\u9470\u7c3d\u6838\u904e\u7684\u8a0a\u606f \u9a57\u8b49 \u8a73\u7d30\u6ce8\u610f\u4e8b\u9805\u548c\u6e2c\u8a66\uff1ahttps://github.com/OWASP/owasp-mstg/blob/master/Document/0x04e-Testing-Authentication-and-Session-Management.md#transaction-signing-with-push-notifications-and-pki","title":"2FA"},{"location":"essay/web-security/owasp-authentication-best-practice/#jwt","text":"\u6bcf\u6b21\u90fd\u8981\u9a57\u8b49 \u9470\u5319\u85cf\u597d \u85cf\u597d\u6a5f\u654f\u8cc7\u6599\uff0c\u82e5\u6709\u5fc5\u8981\u8acb\u52a0\u5bc6 \u4f7f\u7528 jti \uff08JWT ID\uff09 token \u8acb\u653e\u5728 KeyChain \u6216 KeyStore Header \u4e0d\u80fd\u8b93 alg \u53ef\u63a5\u53d7 none exp \u8981\u6ce8\u610f","title":"JWT"},{"location":"essay/web-security/owasp-authentication-best-practice/#oauth-20","text":"\u5225\u7528 implicit grant \uff0c code grant \u8981\u4e00\u6b21\u6027\u4e14\u77ed\u6642 PKCE Access Token \u82e5\u5b58\u5728\u4e0d\u4fe1\u4efb\u7684\u5730\u65b9\u8981\u77ed\u66ab\u7684\u671f\u9650 \u6709\u9650\u5236\u7684 scope \u9664\u4e86 access token \u8981\u6709\u53ef\u4ee5\u9a57\u8b49\u4f7f\u7528\u8005\u7684\u8cc7\u8a0a OAuth 2.0 for Native APP","title":"OAuth 2.0"},{"location":"essay/web-security/owasp-authentication-best-practice/#_1","text":"\u5982\u8ad6\u4f55\u7a2e\u72c0\u6cc1\uff0c\u4f60\u90fd\u61c9\u8a72\u9a57\u8b49\u8acb\u6c42\u662f\u5426\u4f86\u81ea\u4e0d\u540c\u88dd\u7f6e\u3002\u56e0\u6b64\uff0c\u8981\u80fd\u78ba\u8a8d\u4f60\u7684\u7a0b\u5f0f\u771f\u7684\u88ab\u88dd\u5728\u6b63\u78ba\u7684\u88dd\u7f6e\u4e0a\u3002 iOS\uff1a In iOS, a developer can use identifierForVendor , which is related to the bundle ID: the moment you change a bundle ID, the method will return a different value. When the app is ran for the first time, make sure you store the value returned by identifierForVendor to the KeyChain, so that changes to it can be detected at an early stage. Android\uff1a In Android, the developer can use Settings.Secure.ANDROID_ID till Android 8.0 (API level 26) to identify an application instance. Note that starting at Android 8.0 (API level 26), ANDROID_ID is no longer a device unique ID. Instead, it becomes scoped by the combination of app signing key, user and device. So validating ANDROID_ID for device blocking could be tricky for these Android versions. Because if an app changes its signing key, the ANDROID_ID will change and it won't be able to recognize old users devices. Therefore, it's better to store the ANDROID_ID encrypted and privately in a private a shared preferences file using a randomly generated key from the AndroidKeyStore and preferably AES_GCM encryption. The moment the app signature changes, the application can check for a delta and register the new ANDROID_ID . The moment this new ID changes without a new application signing key, it should indicate that something else is wrong. \u9664\u6b64\u4e4b\u5916\uff0c\u5728\u4e00\u958b\u59cb\u7684\u88dd\u7f6e\u7d81\u5b9a\u4e0a\uff0c\u53ef\u4ee5\u900f\u904e\u7c3d\u767c\u8acb\u6c42\uff0c\u4f86\u63d0\u9ad8\u5b89\u5168\u6027\u3002 Next, the device binding can be extended by signing requests with a key stored in the Keychain for iOS and in the KeyStore in Android can reassure strong device binding. \u4f60\u4e5f\u53ef\u4ee5\u9a57\u8b49 IP \u3001 \u5730\u7406\u4f4d\u7f6e \u548c \u6642\u9593\u8ecc\u8de1 \u3002","title":"\u600e\u9ebc\u78ba\u8a8d\u9019\u662f\u540c\u4e00\u53f0\u624b\u6a5f"},{"location":"essay/web-security/owasp-authentication-best-practice/#_2","text":"\u8b93\u4f7f\u7528\u8005\u77e5\u9053 {} \u4e5f\u767b\u5165\u5e33\u865f\u4e86 \u54ea\u500b\u88dd\u7f6e \u54ea\u500b\u6642\u9593 \u54ea\u500b\u5730\u9ede \u8981\u901a\u77e5\u4f7f\u7528\u8005\u6709\u65b0\u7684\u767b\u5165 \u8b93\u4f7f\u7528\u8005\u77e5\u9053\u6700\u5f8c\u884c\u70ba\u662f\u4ec0\u9ebc \u6bcf\u6b21\u767b\u5165\u3001\u767b\u51fa\u8981\u505a\u7d00\u9304 \u9019\u4e9b\u662f\u6a5f\u654f\u7684\u884c\u70ba \u767b\u5165 \u6539\u5bc6\u78bc \u500b\u8cc7\u6539\u8b8a (name, email address, telephone number, etc.) \u654f\u611f\u884c\u70ba (purchase, accessing important resources, etc.) \u540c\u610f\u689d\u6b3e","title":"\u5176\u4ed6"},{"location":"essay/web-security/owasp-mobile-risk-top10/","text":"OWASP \u884c\u52d5\u88dd\u7f6e\u98a8\u96aa \u4e0d\u540c\u5e73\u53f0\u9593\u7684\u932f\u8aa4\u5be6\u4f5c\uff08Improper Platform Usage\uff09 \u4f8b\u5982\u628a\u6a5f\u654f\u8cc7\u6599\u5b58\u9032 local storage \u800c\u4e0d\u662f\u539f\u751f\u7684\u52a0\u5bc6\u5132\u5b58\u7a7a\u9593\uff1a iOS \u7684 Keychain Android \u7684 Keystore \u8acb\u53c3\u7167\u5404\u5e73\u53f0\u7684\u6700\u4f73\u505a\u6cd5\uff01\uff01 \u4e0d\u5b89\u5168\u7684\u8cc7\u6599\u5132\u5b58\uff08Insecure Data Storage\uff09 \u53ef\u80fd\u7684\u5132\u5b58\u7a7a\u9593\uff1a Log SD card Cloud synced OS Frameworkd\uff08\u6846\u67b6\u5982\uff1aFlutter\uff09 Binary data\uff08\u7a0b\u5f0f\u78bc\u88e1\u9762\uff09 \u9810\u9632\uff1a \u53ea\u5132\u5b58\u5fc5\u8981\u8cc7\u8a0a \u5c07\u654f\u611f\u6a94\u6848\u52a0\u5bc6\uff0c\u548c\u9078\u64c7\u597d\u5132\u5b58\u7684\u4f4d\u7f6e iGoat \u7684 \u6559\u5b78\u5f71\u7247 \u3002 \u50b3\u8f38\u5c64\u4fdd\u8b77\u4e0d\u8db3\uff08Insecure Communication\uff09 \u50b3\u8f38\u5a92\u4ecb\u53ef\u5305\u542b\uff1a \u7db2\u8def\u9023\u7dda Wifi \u9023\u7dda \u8fd1\u5834\u901a\u8a0a\uff08Near Field Communication\uff0cNFC\uff09\u9023\u7dda ... \u6700\u4f73\u505a\u6cd5\uff1a \u78ba\u4fdd\u6240\u6709\u654f\u611f\u6027\u8cc7\u6599\u6709\u63a1\u7528\u52a0\u5bc6\u65b9\u5f0f\uff08TLS\u3001SSL\uff09\u9032\u884c\u50b3\u8f38 \u4e26\u5be6\u8e10\u5176\u6700\u4f73\u505a\u6cd5 \u6301\u7e8c\u6ce8\u610f\u7db2\u8def\u6d41\u91cf \u4e0d\u8981\u628a\u6a5f\u654f\u8cc7\u6599\u900f\u904e SMS \u3001 MMS \u50b3\u51fa\u53bb \u4e0d\u5b89\u5168\u7684\u9a57\u8b49\u6a5f\u5236\uff08Insecure Authentication\uff09 \u628a Session \u6216 Token \u5132\u5b58\u9032\u5b89\u5168\u4f4d\u7f6e \u5225\u7528 PIN \u78bc\u9a57\u8b49 \u82e5\u60a8\u7684 App \u7121\u9808 \u96e2\u7dda\u5b58\u53d6 \uff0c\u8acb\u505c\u7528\u6b64\u529f\u80fd \u82e5\u60a8\u7684\u61c9\u7528\u7a0b\u5f0f\u9700\u7dad\u6301\u6a5f\u5bc6\u6027\uff0c\u8acb\u9032\u884c \u96d9\u56e0\u7d20\u8eab\u5206\u9a57\u8b49 \u5584\u7528\u5982 Microsoft / Google Authenticator \u7b49\u670d\u52d9 \u932f\u8aa4\u7684\u4f7f\u7528\u5bc6\u78bc\u5b78(Broken Cryptography) \u4fdd\u8b77\u597d\u4f60\u7684\u9470\u5319 \u5225\u81ea\u5df1\u8a2d\u8a08\u5bc6\u78bc\u5b78\u76f8\u95dc\u7684\u6f14\u7b97\u6cd5 \u4e0d\u5b89\u5168\u6216\u904e\u6642\u7684\u6f14\u7b97\u6cd5\uff08\u4e0d\u55ae\u6307\u52a0\u5bc6\uff09 RC2 MD4 MD5 SHA1 \u4e0d\u5b89\u5168\u7684\u6388\u6b0a\u6a5f\u5236\uff08Insecure Authorization\uff09 GET /api/some-method?rule=user HTTP/1.1 \u53ef\u4ee5\u8f15\u6613\u6539\u6210 rule=admin \u8acb\u7528 Server \u7aef\u7684\u8cc7\u6599\u4f86\u6388\u6b0a\u4f7f\u7528\u8005 \u4f60\u7684 APP \u5beb\u5f97\u4e0d\u597d\uff08Poor Code Quality\uff09 \u6cdb\u6307\u6240\u6709\u5728 Client \u7aef\u7684\u767c\u751f\u7684\u554f\u984c buffer overflow format string vulnerabilities ... \u9810\u9632\uff1a \u8b93\u591a\u4eba\u4e00\u8d77\u6aa2\u67e5\u7a0b\u5f0f\u78bc \u5beb\u597d\u770b\u7684\u7a0b\u5f0f\u78bc\uff0c\u597d\u770b\u7684\u7a0b\u5f0f\u78bc\u5e6b\u52a9 Debug buffer overflow \u548c memory leak \u662f\u9ad8\u98a8\u96aa\u7684\u5b89\u5168\u6027\u554f\u984c include < stdio . h > int main ( int argc , char ** argv ) { char buf [ 8 ]; // buffer for eight characters gets ( buf ); // \u4f7f\u7528\u8005\u8f38\u5165\uff0c\u9019\u5f88\u5371\u96aa\uff01 printf ( \"%s \\n \" , buf ); // print out data stored in buf return 0 ; // 0 as return value } \u4f60\u7684\u7a0b\u5f0f\u78bc\u88ab\u653e\u5230\u975e\u6b63\u5e38\u74b0\u5883\u4e86\uff08Code Tampering\uff09 \u4e00\u822c\u4f86\u8aaa\uff0c\u6240\u6709 APP \u90fd\u6703\u6709\u9019\u554f\u984c \u4f46\u662f\u5982\u679c APP \u5927\u90e8\u5206\u908f\u8f2f\u90fd\u5728\u9a57\u8b49\u5f8c\u6216 Server \u7aef\u7684\u8f38\u51fa\uff0c\u5247\u6b64\u985e\u5b89\u5168\u6027\u8b70\u984c\u53ef\u5ffd\u7565 \u8f03\u9700\u8981\u6ce8\u610f\u7684\u7522\u696d\uff1a\u624b\u904a\u3001\u5de5\u5177\u7a0b\u5f0f \u9700\u53c3\u7167\u5404\u5e73\u53f0\u7684\u6700\u4f73\u4f5c\u6cd5\u4f86\u9810\u9632\u3002 \u9006\u5411\u5de5\u7a0b\uff08Reverse Engineering\uff09 \u6709\u5de5\u5177\u53ef\u9810\u9632\uff08IDA Pro\u3001Hopper\uff09\uff0c\u4e5f\u6709\u5f88\u591a\u5de5\u5177\u53ef\u5e6b\u52a9\u9006\u5411\u5de5\u7a0b\uff0c\u6311\u4e00\u4e0b \u6e1b\u5c11\u4e00\u500b Function \u7684\u5de5\u4f5c\uff0c\u8b93\u9006\u5411\u5f8c\u7684\u7a0b\u5f0f\u78bc\u4e0d\u5bb9\u6613\u95b1\u8b80 \u53ef\u5f71\u97ff\u7a0b\u5f0f\u904b\u884c\u7684\u6a5f\u5236\uff08Extraneous Functionality\uff09 \u653b\u64ca\u8005\u53ef\u4ee5\u628a APP \u57f7\u884c\u5728 local \u7aef\uff0c\u7136\u5f8c\u6539\u8a2d\u5b9a\u6a94\u6216\u89c0\u5bdf log\u3002 \u6700\u7d42\u7684\u7a0b\u5f0f\u78bc\u4e0d\u80fd\u6709 debug \u7684 log \u907f\u514d\u82e5 config \u6a94\u8b8a\u5316\u4e86\uff0c\u7522\u54c1\u7684\u6a5f\u654f\u8cc7\u8a0a\u6216\u7279\u6b8a\u74b0\u5883\u4ecd\u80fd\u904b\u884c\u6216\u66b4\u9732 \u55ae\u5143\u6216\u6574\u5408\u6e2c\u8a66\u4e0d\u8981\u5728\u6700\u7d42\u7522\u54c1\u4e2d \u4e0d\u80fd\u6709 UAT\u3001staging\u3001demo \u6216 test \u74b0\u5883\u7684\u7a0b\u5f0f\u78bc\u5728\u6700\u7d42\u7522\u54c1 \u820a\u7684 \u4f3a\u670d\u5668\u7aef\u5b89\u5168\u63a7\u5236\u8106\u5f31\uff08Weak Server Side Controls\uff09 \u5f8c\u7aef\u9700\u8981\u6ce8\u610f\u53ef\u80fd\u906d\u53d7\u7684\u653b\u64ca\uff1a OWASP Top 10 OWASP API Top 10 \u57fa\u672c\u89c0\u5ff5\uff1a \u7d55\u4e0d\u76f8\u4fe1\u7528\u6236\u7aef \u8b39\u614e\u8a2d\u8a08\u884c\u52d5\u88dd\u7f6e\u7684\u4f3a\u670d\u5668\u7aef\u63a7\u5236 \u7d55\u4e0d\u4f7f\u7528\u7528\u6236\u7aef\u61c9\u7528\u7a0b\u5f0f\u57f7\u884c\u5b58\u53d6\u63a7\u5236 \u975e\u6545\u610f\u6216\u610f\u5916\u9020\u6210\u7684\u8cc7\u6599\u5916\u6d29\uff08Unintended Data Leakage\uff09 \u5c07\u88dd\u7f6e\u53ef\u6536\u96c6\u7684\u8cc7\u6599\u9650\u5236\u5728\u5176\u6240\u9700\u7684\u7bc4\u570d \u5207\u52ff\u5c07\u654f\u611f\u8cc7\u6599\u5132\u5b58\u65bc\u516c\u5171\u5834\u6240 \u77ad\u89e3\u4e26\u5bc6\u5207\u76e3\u63a7\u60a8\u7684\u61c9\u7528\u7a0b\u5f0f\u8655\u7406\uff0c\u5982\uff1a\u526a\u4e0b - \u8cbc\u4e0a\u3001\u61c9\u7528\u7a0b\u5f0f\u80cc\u666f\u8655\u7406\u3001Cookie\u3001 URL \u5feb\u53d6\u53ca\u9375\u76e4\u6309\u4e0b\u5feb\u53d6\u7b49\u52d5\u4f5c \u5ba2\u6236\u7aef\u6ce8\u5165(Client Side Injection) \u4f7f\u7528\u767d\u540d\u55ae\u65b9\u6cd5\u662f\u62b5\u64cb XSS \u78ba\u4fdd\u4f7f\u7528\u8005\u8cc7\u6599\u901a\u904e\u53c3\u6578\u5316\u7684\u67e5\u8a62 \u9a57\u8b49\u4e26\u7de8\u78bc\u6240\u6709\u5132\u5b58\u5728\u88dd\u7f6e\u4e0a\u7684\u8cc7\u6599 \u4f7f\u7528\u56b4\u8b39\u7684\u8eab\u5206\u9a57\u8b49\u8207\u6388\u6b0a\uff08\u4f8b\u5982\uff1a\u96d9\u56e0\u7d20\u8a8d\u8b49\uff09 \u4e0d\u9069\u7576\u7684 Session \u8655\u7406\uff08Improper Session Handling\uff09 \u907f\u514d\u4f7f\u7528\u88dd\u7f6e\u7684\u786c\u9ad4\u8b58\u5225\u78bc\u4f86\u7576\u4f5c Session \u503c Session \u503c\u7684\u904e\u671f\u6642\u9593\u61c9\u8a2d\u5b9a\u5728\u4e00\u500b\u53ef\u63a5\u53d7\u7bc4\u570d\u5167 \u61c9\u6709\u80fd\u5920\u5feb\u901f\u64a4\u92b7 Token \u7684\u6a5f\u5236 \u5b89\u5168\u6c7a\u7b56\u662f\u7d93\u7531\u4e0d\u53d7\u4fe1\u4efb\u7684\u8f38\u5165\uff08Security Decisions Via Untrusted Inputs\uff09 \u5047\u8a2d Skype \u61c9\u7528\u7a0b\u5f0f\u5177\u6709 HTML \u6216 Script Injection \u5f31\u9ede\uff0c\u653b\u64ca\u8005\u53ea\u8981\u4e8b\u5148\u628a\u5177\u6709\u60e1\u610f\u9023\u7d50\u7684 iframe \u5beb\u5165\u67d0\u500b\u7279\u5b9a\u7db2\u9801\uff1a <iframe src=\"skype:17031234567?call\"></iframe> \u4e00\u4f46\u53ef\u651c\u5f0f\u884c\u52d5\u88dd\u7f6e\u7684\u700f\u89bd\u5668\u8b80\u53d6\u5230\u6b64 iframe \u7a0b\u5f0f\u78bc\u6642\uff0cSkype \u61c9\u7528\u7a0b\u5f0f\u5c07\u7121\u9700\u4f7f\u7528\u8005\u6388\u6b0a\uff0c\u81ea\u52d5\u958b\u59cb\u64ad\u865f\u7d66\u6307\u5b9a\u7684\u96fb\u8a71\u865f\u78bc\u3002 Cross Site Rrequest Foriegn \u5c01\u88dd\u6a94\u6848\u4fdd\u8b77\u4e0d\u8db3 / \u7f3a\u5c11\u4e8c\u9032\u4f4d\u4fdd\u8b77\uff08Lack of Binary Protections\uff09 Binary \u4fdd\u8b77\u53ef\u78ba\u4fdd\u653b\u64ca\u8005\u7121\u6cd5\u900f\u904e\u9006\u5411\u5de5\u7a0b\u7372\u5f97\u60a8\u7684 App \u5207\u52ff\u5c07\u7a0b\u5f0f\u78bc\u5132\u5b58\u5728\u4e0d\u53d7\u60a8\u63a7\u5236\u7684\u4e0d\u5b89\u5168\u74b0\u5883\u4e0b \u78ba\u4fdd\u6b63\u78ba\u4f7f\u7528\u6191\u8b49\u7d81\u5b9a\u53ca\u5075\u932f\u5de5\u5177\u5075\u6e2c\u63a7\u5236 \u76e3\u63a7\u57f7\u884c\u968e\u6bb5\u7a0b\u5f0f\u78bc\u662f\u5426\u5728 App \u6d3b\u52d5\u4e2d\u51fa\u73fe\u7570\u5e38 \u5074\u901a\u9053\u8cc7\u6599\u6d29\u6f0f\uff08Side Channel Data Leakage\uff09 \u8cc7\u6599\u61c9\u907f\u514d\u81ea\u52d5\u5132\u5b58\u65bc\u53ef\u651c\u5f0f\u884c\u52d5\u88dd\u7f6e\u5167 \u7db2\u9801\u66ab\u5b58\uff08Web Cache\uff09 \u6309\u9375\u5074\u9304\uff08Keystorke Logging\uff09 \u64f7\u53d6\u756b\u9762\uff08Screenshots\uff09 \u65e5\u8a8c\u6a94\uff08Logs\uff09 \u66ab\u5b58\u76ee\u9304\uff08Temp Directories\uff09 \u654f\u611f\u8cc7\u8a0a\u6d29\u6f0f\uff08Sensitive Informaiton Disclosure\uff09 \u61c9\u7528\u7a0b\u5f0f\u539f\u59cb\u78bc\u4e2d\uff0c\u628a\u8f38\u5165\u6216\u8f38\u51fa\u7684\u76f8\u95dc\u53c3\u6578\u76f4\u63a5\u5beb\u5165\u5728\u7a0b\u5f0f\u78bc\u7576\u4e2d","title":"OWASP \u884c\u52d5\u88dd\u7f6e\u98a8\u96aa"},{"location":"essay/web-security/owasp-mobile-risk-top10/#owasp","text":"","title":"OWASP \u884c\u52d5\u88dd\u7f6e\u98a8\u96aa"},{"location":"essay/web-security/owasp-mobile-risk-top10/#improper-platform-usage","text":"\u4f8b\u5982\u628a\u6a5f\u654f\u8cc7\u6599\u5b58\u9032 local storage \u800c\u4e0d\u662f\u539f\u751f\u7684\u52a0\u5bc6\u5132\u5b58\u7a7a\u9593\uff1a iOS \u7684 Keychain Android \u7684 Keystore \u8acb\u53c3\u7167\u5404\u5e73\u53f0\u7684\u6700\u4f73\u505a\u6cd5\uff01\uff01","title":"\u4e0d\u540c\u5e73\u53f0\u9593\u7684\u932f\u8aa4\u5be6\u4f5c\uff08Improper Platform Usage\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#insecure-data-storage","text":"\u53ef\u80fd\u7684\u5132\u5b58\u7a7a\u9593\uff1a Log SD card Cloud synced OS Frameworkd\uff08\u6846\u67b6\u5982\uff1aFlutter\uff09 Binary data\uff08\u7a0b\u5f0f\u78bc\u88e1\u9762\uff09 \u9810\u9632\uff1a \u53ea\u5132\u5b58\u5fc5\u8981\u8cc7\u8a0a \u5c07\u654f\u611f\u6a94\u6848\u52a0\u5bc6\uff0c\u548c\u9078\u64c7\u597d\u5132\u5b58\u7684\u4f4d\u7f6e iGoat \u7684 \u6559\u5b78\u5f71\u7247 \u3002","title":"\u4e0d\u5b89\u5168\u7684\u8cc7\u6599\u5132\u5b58\uff08Insecure Data Storage\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#insecure-communication","text":"\u50b3\u8f38\u5a92\u4ecb\u53ef\u5305\u542b\uff1a \u7db2\u8def\u9023\u7dda Wifi \u9023\u7dda \u8fd1\u5834\u901a\u8a0a\uff08Near Field Communication\uff0cNFC\uff09\u9023\u7dda ... \u6700\u4f73\u505a\u6cd5\uff1a \u78ba\u4fdd\u6240\u6709\u654f\u611f\u6027\u8cc7\u6599\u6709\u63a1\u7528\u52a0\u5bc6\u65b9\u5f0f\uff08TLS\u3001SSL\uff09\u9032\u884c\u50b3\u8f38 \u4e26\u5be6\u8e10\u5176\u6700\u4f73\u505a\u6cd5 \u6301\u7e8c\u6ce8\u610f\u7db2\u8def\u6d41\u91cf \u4e0d\u8981\u628a\u6a5f\u654f\u8cc7\u6599\u900f\u904e SMS \u3001 MMS \u50b3\u51fa\u53bb","title":"\u50b3\u8f38\u5c64\u4fdd\u8b77\u4e0d\u8db3\uff08Insecure Communication\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#insecure-authentication","text":"\u628a Session \u6216 Token \u5132\u5b58\u9032\u5b89\u5168\u4f4d\u7f6e \u5225\u7528 PIN \u78bc\u9a57\u8b49 \u82e5\u60a8\u7684 App \u7121\u9808 \u96e2\u7dda\u5b58\u53d6 \uff0c\u8acb\u505c\u7528\u6b64\u529f\u80fd \u82e5\u60a8\u7684\u61c9\u7528\u7a0b\u5f0f\u9700\u7dad\u6301\u6a5f\u5bc6\u6027\uff0c\u8acb\u9032\u884c \u96d9\u56e0\u7d20\u8eab\u5206\u9a57\u8b49 \u5584\u7528\u5982 Microsoft / Google Authenticator \u7b49\u670d\u52d9","title":"\u4e0d\u5b89\u5168\u7684\u9a57\u8b49\u6a5f\u5236\uff08Insecure Authentication\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#broken-cryptography","text":"\u4fdd\u8b77\u597d\u4f60\u7684\u9470\u5319 \u5225\u81ea\u5df1\u8a2d\u8a08\u5bc6\u78bc\u5b78\u76f8\u95dc\u7684\u6f14\u7b97\u6cd5 \u4e0d\u5b89\u5168\u6216\u904e\u6642\u7684\u6f14\u7b97\u6cd5\uff08\u4e0d\u55ae\u6307\u52a0\u5bc6\uff09 RC2 MD4 MD5 SHA1","title":"\u932f\u8aa4\u7684\u4f7f\u7528\u5bc6\u78bc\u5b78(Broken Cryptography)"},{"location":"essay/web-security/owasp-mobile-risk-top10/#insecure-authorization","text":"GET /api/some-method?rule=user HTTP/1.1 \u53ef\u4ee5\u8f15\u6613\u6539\u6210 rule=admin \u8acb\u7528 Server \u7aef\u7684\u8cc7\u6599\u4f86\u6388\u6b0a\u4f7f\u7528\u8005","title":"\u4e0d\u5b89\u5168\u7684\u6388\u6b0a\u6a5f\u5236\uff08Insecure Authorization\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#app-poor-code-quality","text":"\u6cdb\u6307\u6240\u6709\u5728 Client \u7aef\u7684\u767c\u751f\u7684\u554f\u984c buffer overflow format string vulnerabilities ... \u9810\u9632\uff1a \u8b93\u591a\u4eba\u4e00\u8d77\u6aa2\u67e5\u7a0b\u5f0f\u78bc \u5beb\u597d\u770b\u7684\u7a0b\u5f0f\u78bc\uff0c\u597d\u770b\u7684\u7a0b\u5f0f\u78bc\u5e6b\u52a9 Debug buffer overflow \u548c memory leak \u662f\u9ad8\u98a8\u96aa\u7684\u5b89\u5168\u6027\u554f\u984c include < stdio . h > int main ( int argc , char ** argv ) { char buf [ 8 ]; // buffer for eight characters gets ( buf ); // \u4f7f\u7528\u8005\u8f38\u5165\uff0c\u9019\u5f88\u5371\u96aa\uff01 printf ( \"%s \\n \" , buf ); // print out data stored in buf return 0 ; // 0 as return value }","title":"\u4f60\u7684 APP \u5beb\u5f97\u4e0d\u597d\uff08Poor Code Quality\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#code-tampering","text":"\u4e00\u822c\u4f86\u8aaa\uff0c\u6240\u6709 APP \u90fd\u6703\u6709\u9019\u554f\u984c \u4f46\u662f\u5982\u679c APP \u5927\u90e8\u5206\u908f\u8f2f\u90fd\u5728\u9a57\u8b49\u5f8c\u6216 Server \u7aef\u7684\u8f38\u51fa\uff0c\u5247\u6b64\u985e\u5b89\u5168\u6027\u8b70\u984c\u53ef\u5ffd\u7565 \u8f03\u9700\u8981\u6ce8\u610f\u7684\u7522\u696d\uff1a\u624b\u904a\u3001\u5de5\u5177\u7a0b\u5f0f \u9700\u53c3\u7167\u5404\u5e73\u53f0\u7684\u6700\u4f73\u4f5c\u6cd5\u4f86\u9810\u9632\u3002","title":"\u4f60\u7684\u7a0b\u5f0f\u78bc\u88ab\u653e\u5230\u975e\u6b63\u5e38\u74b0\u5883\u4e86\uff08Code Tampering\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#reverse-engineering","text":"\u6709\u5de5\u5177\u53ef\u9810\u9632\uff08IDA Pro\u3001Hopper\uff09\uff0c\u4e5f\u6709\u5f88\u591a\u5de5\u5177\u53ef\u5e6b\u52a9\u9006\u5411\u5de5\u7a0b\uff0c\u6311\u4e00\u4e0b \u6e1b\u5c11\u4e00\u500b Function \u7684\u5de5\u4f5c\uff0c\u8b93\u9006\u5411\u5f8c\u7684\u7a0b\u5f0f\u78bc\u4e0d\u5bb9\u6613\u95b1\u8b80","title":"\u9006\u5411\u5de5\u7a0b\uff08Reverse Engineering\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#extraneous-functionality","text":"\u653b\u64ca\u8005\u53ef\u4ee5\u628a APP \u57f7\u884c\u5728 local \u7aef\uff0c\u7136\u5f8c\u6539\u8a2d\u5b9a\u6a94\u6216\u89c0\u5bdf log\u3002 \u6700\u7d42\u7684\u7a0b\u5f0f\u78bc\u4e0d\u80fd\u6709 debug \u7684 log \u907f\u514d\u82e5 config \u6a94\u8b8a\u5316\u4e86\uff0c\u7522\u54c1\u7684\u6a5f\u654f\u8cc7\u8a0a\u6216\u7279\u6b8a\u74b0\u5883\u4ecd\u80fd\u904b\u884c\u6216\u66b4\u9732 \u55ae\u5143\u6216\u6574\u5408\u6e2c\u8a66\u4e0d\u8981\u5728\u6700\u7d42\u7522\u54c1\u4e2d \u4e0d\u80fd\u6709 UAT\u3001staging\u3001demo \u6216 test \u74b0\u5883\u7684\u7a0b\u5f0f\u78bc\u5728\u6700\u7d42\u7522\u54c1","title":"\u53ef\u5f71\u97ff\u7a0b\u5f0f\u904b\u884c\u7684\u6a5f\u5236\uff08Extraneous Functionality\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#_1","text":"","title":"\u820a\u7684"},{"location":"essay/web-security/owasp-mobile-risk-top10/#weak-server-side-controls","text":"\u5f8c\u7aef\u9700\u8981\u6ce8\u610f\u53ef\u80fd\u906d\u53d7\u7684\u653b\u64ca\uff1a OWASP Top 10 OWASP API Top 10 \u57fa\u672c\u89c0\u5ff5\uff1a \u7d55\u4e0d\u76f8\u4fe1\u7528\u6236\u7aef \u8b39\u614e\u8a2d\u8a08\u884c\u52d5\u88dd\u7f6e\u7684\u4f3a\u670d\u5668\u7aef\u63a7\u5236 \u7d55\u4e0d\u4f7f\u7528\u7528\u6236\u7aef\u61c9\u7528\u7a0b\u5f0f\u57f7\u884c\u5b58\u53d6\u63a7\u5236","title":"\u4f3a\u670d\u5668\u7aef\u5b89\u5168\u63a7\u5236\u8106\u5f31\uff08Weak Server Side Controls\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#unintended-data-leakage","text":"\u5c07\u88dd\u7f6e\u53ef\u6536\u96c6\u7684\u8cc7\u6599\u9650\u5236\u5728\u5176\u6240\u9700\u7684\u7bc4\u570d \u5207\u52ff\u5c07\u654f\u611f\u8cc7\u6599\u5132\u5b58\u65bc\u516c\u5171\u5834\u6240 \u77ad\u89e3\u4e26\u5bc6\u5207\u76e3\u63a7\u60a8\u7684\u61c9\u7528\u7a0b\u5f0f\u8655\u7406\uff0c\u5982\uff1a\u526a\u4e0b - \u8cbc\u4e0a\u3001\u61c9\u7528\u7a0b\u5f0f\u80cc\u666f\u8655\u7406\u3001Cookie\u3001 URL \u5feb\u53d6\u53ca\u9375\u76e4\u6309\u4e0b\u5feb\u53d6\u7b49\u52d5\u4f5c","title":"\u975e\u6545\u610f\u6216\u610f\u5916\u9020\u6210\u7684\u8cc7\u6599\u5916\u6d29\uff08Unintended Data Leakage\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#client-side-injection","text":"\u4f7f\u7528\u767d\u540d\u55ae\u65b9\u6cd5\u662f\u62b5\u64cb XSS \u78ba\u4fdd\u4f7f\u7528\u8005\u8cc7\u6599\u901a\u904e\u53c3\u6578\u5316\u7684\u67e5\u8a62 \u9a57\u8b49\u4e26\u7de8\u78bc\u6240\u6709\u5132\u5b58\u5728\u88dd\u7f6e\u4e0a\u7684\u8cc7\u6599 \u4f7f\u7528\u56b4\u8b39\u7684\u8eab\u5206\u9a57\u8b49\u8207\u6388\u6b0a\uff08\u4f8b\u5982\uff1a\u96d9\u56e0\u7d20\u8a8d\u8b49\uff09","title":"\u5ba2\u6236\u7aef\u6ce8\u5165(Client Side Injection)"},{"location":"essay/web-security/owasp-mobile-risk-top10/#session-improper-session-handling","text":"\u907f\u514d\u4f7f\u7528\u88dd\u7f6e\u7684\u786c\u9ad4\u8b58\u5225\u78bc\u4f86\u7576\u4f5c Session \u503c Session \u503c\u7684\u904e\u671f\u6642\u9593\u61c9\u8a2d\u5b9a\u5728\u4e00\u500b\u53ef\u63a5\u53d7\u7bc4\u570d\u5167 \u61c9\u6709\u80fd\u5920\u5feb\u901f\u64a4\u92b7 Token \u7684\u6a5f\u5236","title":"\u4e0d\u9069\u7576\u7684 Session \u8655\u7406\uff08Improper Session Handling\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#security-decisions-via-untrusted-inputs","text":"\u5047\u8a2d Skype \u61c9\u7528\u7a0b\u5f0f\u5177\u6709 HTML \u6216 Script Injection \u5f31\u9ede\uff0c\u653b\u64ca\u8005\u53ea\u8981\u4e8b\u5148\u628a\u5177\u6709\u60e1\u610f\u9023\u7d50\u7684 iframe \u5beb\u5165\u67d0\u500b\u7279\u5b9a\u7db2\u9801\uff1a <iframe src=\"skype:17031234567?call\"></iframe> \u4e00\u4f46\u53ef\u651c\u5f0f\u884c\u52d5\u88dd\u7f6e\u7684\u700f\u89bd\u5668\u8b80\u53d6\u5230\u6b64 iframe \u7a0b\u5f0f\u78bc\u6642\uff0cSkype \u61c9\u7528\u7a0b\u5f0f\u5c07\u7121\u9700\u4f7f\u7528\u8005\u6388\u6b0a\uff0c\u81ea\u52d5\u958b\u59cb\u64ad\u865f\u7d66\u6307\u5b9a\u7684\u96fb\u8a71\u865f\u78bc\u3002 Cross Site Rrequest Foriegn","title":"\u5b89\u5168\u6c7a\u7b56\u662f\u7d93\u7531\u4e0d\u53d7\u4fe1\u4efb\u7684\u8f38\u5165\uff08Security Decisions Via Untrusted Inputs\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#lack-of-binary-protections","text":"Binary \u4fdd\u8b77\u53ef\u78ba\u4fdd\u653b\u64ca\u8005\u7121\u6cd5\u900f\u904e\u9006\u5411\u5de5\u7a0b\u7372\u5f97\u60a8\u7684 App \u5207\u52ff\u5c07\u7a0b\u5f0f\u78bc\u5132\u5b58\u5728\u4e0d\u53d7\u60a8\u63a7\u5236\u7684\u4e0d\u5b89\u5168\u74b0\u5883\u4e0b \u78ba\u4fdd\u6b63\u78ba\u4f7f\u7528\u6191\u8b49\u7d81\u5b9a\u53ca\u5075\u932f\u5de5\u5177\u5075\u6e2c\u63a7\u5236 \u76e3\u63a7\u57f7\u884c\u968e\u6bb5\u7a0b\u5f0f\u78bc\u662f\u5426\u5728 App \u6d3b\u52d5\u4e2d\u51fa\u73fe\u7570\u5e38","title":"\u5c01\u88dd\u6a94\u6848\u4fdd\u8b77\u4e0d\u8db3 / \u7f3a\u5c11\u4e8c\u9032\u4f4d\u4fdd\u8b77\uff08Lack of Binary Protections\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#side-channel-data-leakage","text":"\u8cc7\u6599\u61c9\u907f\u514d\u81ea\u52d5\u5132\u5b58\u65bc\u53ef\u651c\u5f0f\u884c\u52d5\u88dd\u7f6e\u5167 \u7db2\u9801\u66ab\u5b58\uff08Web Cache\uff09 \u6309\u9375\u5074\u9304\uff08Keystorke Logging\uff09 \u64f7\u53d6\u756b\u9762\uff08Screenshots\uff09 \u65e5\u8a8c\u6a94\uff08Logs\uff09 \u66ab\u5b58\u76ee\u9304\uff08Temp Directories\uff09","title":"\u5074\u901a\u9053\u8cc7\u6599\u6d29\u6f0f\uff08Side Channel Data Leakage\uff09"},{"location":"essay/web-security/owasp-mobile-risk-top10/#sensitive-informaiton-disclosure","text":"\u61c9\u7528\u7a0b\u5f0f\u539f\u59cb\u78bc\u4e2d\uff0c\u628a\u8f38\u5165\u6216\u8f38\u51fa\u7684\u76f8\u95dc\u53c3\u6578\u76f4\u63a5\u5beb\u5165\u5728\u7a0b\u5f0f\u78bc\u7576\u4e2d","title":"\u654f\u611f\u8cc7\u8a0a\u6d29\u6f0f\uff08Sensitive Informaiton Disclosure\uff09"},{"location":"feedback/","text":"\u8b80\u66f8\u5fc3\u5f97 \u9019\u88e1\u4f5c\u70ba\u6211\u7684\u8b80\u66f8\u7d00\u9304\uff0c\u8b80\u5b8c\u4f46\u662f\u89ba\u5f97\u4e0d\u9700\u8981\u5beb\u5fc3\u5f97\u5c31\u4e0d\u5217\u5728\u9019\u4e86\u3002 \u66f8\u540d \u4f5c\u8005 \u72c0\u614b \u51fa\u7248\u65e5\u671f Modern CPU Design - \u60f3\u8b80 - Blue Green Test - \u60f3\u8b80 - Implementation Patterns Kent Beck \u8b80\u5b8c 2007-10 Distributed Systems with Node.js Thomas Hunter \u5b8c\u6210 2020-11 Designing Data-intensive Applications Martin Kleppmann \u5beb\u4f5c\u4e2d 2017-03 Stream Processing, CEP, Event Sourcing, and Data Streaming Explained Martin Kleppmann \u8b80\u5b8c 2015-01 \u60f3\u8b80 \u55ef\u3002 \u8b80\u5b8c \u8b80\u5b8c\u66f8\uff0c\u4f46\u662f\u9084\u6c92\u958b\u59cb\u5beb\u5fc3\u5f97\u3002 Implementation Patterns Stream Processing, CEP, Event Sourcing, and Data Streaming Explained \u5beb\u4f5c\u4e2d \u8b80\u5b8c\u66f8\uff0c\u958b\u59cb\u5beb\u4f5c\u3002 Designing Data-intensive Applications \u5b8c\u6210 \u8b80\u5b8c\u4e14\u5beb\u5b8c\u5fc3\u5f97\u3002 Distributed Systems with Node.js","title":"\u76ee\u9304"},{"location":"feedback/#_1","text":"\u9019\u88e1\u4f5c\u70ba\u6211\u7684\u8b80\u66f8\u7d00\u9304\uff0c\u8b80\u5b8c\u4f46\u662f\u89ba\u5f97\u4e0d\u9700\u8981\u5beb\u5fc3\u5f97\u5c31\u4e0d\u5217\u5728\u9019\u4e86\u3002 \u66f8\u540d \u4f5c\u8005 \u72c0\u614b \u51fa\u7248\u65e5\u671f Modern CPU Design - \u60f3\u8b80 - Blue Green Test - \u60f3\u8b80 - Implementation Patterns Kent Beck \u8b80\u5b8c 2007-10 Distributed Systems with Node.js Thomas Hunter \u5b8c\u6210 2020-11 Designing Data-intensive Applications Martin Kleppmann \u5beb\u4f5c\u4e2d 2017-03 Stream Processing, CEP, Event Sourcing, and Data Streaming Explained Martin Kleppmann \u8b80\u5b8c 2015-01","title":"\u8b80\u66f8\u5fc3\u5f97"},{"location":"feedback/#_2","text":"\u55ef\u3002","title":"\u60f3\u8b80"},{"location":"feedback/#_3","text":"\u8b80\u5b8c\u66f8\uff0c\u4f46\u662f\u9084\u6c92\u958b\u59cb\u5beb\u5fc3\u5f97\u3002 Implementation Patterns Stream Processing, CEP, Event Sourcing, and Data Streaming Explained","title":"\u8b80\u5b8c"},{"location":"feedback/#_4","text":"\u8b80\u5b8c\u66f8\uff0c\u958b\u59cb\u5beb\u4f5c\u3002 Designing Data-intensive Applications","title":"\u5beb\u4f5c\u4e2d"},{"location":"feedback/#_5","text":"\u8b80\u5b8c\u4e14\u5beb\u5b8c\u5fc3\u5f97\u3002 Distributed Systems with Node.js","title":"\u5b8c\u6210"},{"location":"feedback/designing-data-intensive-applications/analytic-db/","text":"\u4ec0\u9ebc\u662f OLTP\u3001OLAP \u548c DW \u4e00\u822c\u4f86\u8aaa\uff0c\u8cc7\u6599\u5eab\u5c0d\u65bc\u670d\u52d9\u4f7f\u7528\u8005\u4f86\u8aaa\uff0c\u5373\u662f\u5728\u4e00\u7fa4\u8cc7\u6599\u4e2d\u627e\u51fa\u7279\u5b9a\u8cc7\u6599\uff0c\u505a\u8b80\u5beb\u7684\u52d5\u4f5c\u3002\u9019\u7a2e\u64cd\u4f5c\uff0c\u7a31\u70ba \u7dda\u4e0a\u4ea4\u6613\u8655\u7406 \uff08online transaction processing\uff0cOLTP\uff09\u3002 \u65e9\u671f\u8cc7\u6599\u5eab\u7684\u64cd\u4f5c\u5e7e\u4e4e\u662f\u5546\u52d9\u4ea4\u6613\uff0c\u6240\u4ee5\u4fdd\u7559\u820a\u7a31\u300c\u4ea4\u6613\u300d\uff08transaction\uff09\u3002 \u7136\u800c\uff0c\u96a8\u8457\u8cc7\u6599\u7684\u589e\u52a0\uff0c\u958b\u59cb\u9700\u8981\u5c0d\u8cc7\u6599\u5eab\u505a\u4e00\u4e9b\u5206\u6790\u3002\u5e6b\u52a9\u670d\u52d9\u7ba1\u7406\u8005\u53bb\u505a\u4e00\u4e9b\u7279\u5b9a\u7684\u6c7a\u7b56\uff0c\u4f8b\u5982\uff1a \u8cfc\u7269\u8005\u5728\u4e00\u5929\u4e2d\u8cfc\u8cb7\u7684\u6642\u9593\u5206\u4f48 \u54ea\u500b\u5546\u54c1\u8ce3\u6700\u597d \u9019\u4e00\u985e\u7684\u884c\u70ba\uff0c\u5e38\u5e38\u9700\u8981\u91dd\u5c0d\u6240\u6709\u7684\u8cc7\u6599\u505a\u8b80\u53d6\uff0c\u800c\u4e0d\u9700\u8981\u5beb\u5165\u3002\u6211\u5011\u7a31\u4e4b\u70ba \u7dda\u4e0a\u5206\u6790\u8655\u7406 \uff08online analytic processing\uff0cOLAP\uff09\u3002 \u91dd\u5c0d\u9019\u7a2e\u548c OLTP \u7684\u64cd\u4f5c\u6709\u5f88\u5927\u5dee\u7570\u7684\u8cc7\u6599\uff0c\u800c\u53bb\u505a\u8a2d\u8a08\u7684\u8cc7\u6599\u5eab\uff0c\u6211\u5011\u7a31\u4e4b\u70ba\u8cc7\u6599\u5132\u5009\uff08Data Warehouse\uff0cDW\uff09\u3002 \u6709\u6642\u5019\u4e26\u4e0d\u662f\u90a3\u9ebc\u6e05\u695a\u5c31\u53ef\u4ee5\u5340\u5206 OLTP \u548c OLAP\uff0c\u4f46\u662f\u4ecd\u6709\u4e00\u4e9b\u4e3b\u8981\u7684\u5dee\u7570\uff1a \u5c6c\u6027 OLTP OLAP \u4e3b\u8981\u7684\u8b80\u53d6\u6a21\u5f0f \u5c0f\u91cf\u8cc7\u6599\uff0c\u4e14\u900f\u904e key \u7be9\u9078 \u805a\u5408\uff08aggregate\uff09\u5927\u91cf\u8cc7\u6599 \u4e3b\u8981\u7684\u5beb\u5165\u6a21\u5f0f \u4f4e\u6f5b\u6642\uff08latency \uff09\uff0c\u4e14\u96a8\u6a5f\u5beb\u5165 \u4e00\u6b21\u6027\u5927\u91cf\u5beb\u5165\uff0c\u6216\u900f\u904e\u4e8b\u4ef6\u6d41\u5165 \u4e3b\u8981\u4f7f\u7528\u65bc \u900f\u904e\u7db2\u8def\u6e9d\u901a\u7684\u670d\u52d9\u4f7f\u7528\u8005 \u5167\u90e8\u5206\u6790\u5e2b\uff0c\u5e6b\u52a9\u6c7a\u7b56 \u8cc7\u6599\u4ee3\u8868\u4ec0\u9ebc \u6700\u65b0\u72c0\u614b \u4e8b\u4ef6\u7684\u6b77\u53f2\u7d00\u9304 \u8cc7\u6599\u5eab\u5927\u5c0f GB~TB TB~PB \u6bd4\u8f03 OLTP \u985e\u578b\u8cc7\u6599\u5eab\u901a\u5e38\u662f\u670d\u52d9\u4f7f\u7528\u8005\u76f4\u63a5\u63a5\u89f8\u7684\u3002\u9019\u4ee3\u8868\u5927\u91cf\u7684\u8acb\u6c42\u6703\u88ab\u9700\u8981\u8655\u7406\uff0c\u70ba\u4e86\u8655\u7406\u9019\u985e\u9700\u6c42\uff0c\u8acb\u6c42\u901a\u5e38\u53ea\u6703\u63a5\u89f8\u8cc7\u6599\u5eab\u4e2d\u4e00\u90e8\u4efd\u8cc7\u6599\u3002\u61c9\u7528\u7a0b\u5f0f\u53ef\u80fd\u6703\u900f\u904e\u7d22\u5f15\uff08index\uff09\u4f86\u52a0\u901f\u641c\u5c0b\u3002\u9019\u985e\u7684\u8cc7\u6599\u5eab\u901a\u5e38\u6ce8\u91cd\u5f9e\u78c1\u789f\u4e2d\u627e\u5c0b\u7684\u901f\u5ea6\uff08 seek time \uff0c\u627e\u5c0b\u7279\u5b9a\u8cc7\u6599\u4f4d\u7f6e\u7684\u901f\u5ea6\uff09\u3002 OLAP \u985e\u578b\u8cc7\u6599\u5eab\u8f03\u5c11\u88ab\u77e5\u9053\uff0c\u56e0\u70ba\u9019\u985e\u578b\u8cc7\u6599\u5eab\u662f\u7528\u4f86\u505a\u5206\u6790\uff0c\u800c\u975e\u8b93\u670d\u52d9\u4f7f\u7528\u8005\u76f4\u63a5\u5b58\u53d6\u3002\u96d6\u7136\u8acb\u6c42\u91cf\u6bd4 OLTP \u4f4e\uff0c\u4f46\u662f\u6bcf\u6b21\u8acb\u6c42\u53ef\u80fd\u90fd\u9700\u8981\u904d\u6b77\u8cc7\u6599\u5eab\u4f86\u53d6\u5f97\u7279\u5b9a\u5206\u6790\u7d50\u679c\u3002\u9019\u985e\u7684\u8cc7\u6599\u5eab\u901a\u5e38\u6ce8\u91cd\u5f9e\u78c1\u789f\u4e2d\u7684\u983b\u5bec\uff08 bandwidth \uff0c\u8b80\u53d6\u5927\u91cf\u8cc7\u6599\u7684\u901f\u5ea6\uff09\u3002 Data Warehouse \u5c0d\u65bc\u516c\u53f8\u4f86\u8aaa\u53ef\u80fd\u6703\u6709\u5f88\u591a\u8cc7\u6599\u5eab\u53bb\u6eff\u8db3\u5404\u500b\u55ae\u4f4d\u7684\u9700\u6c42\u3002\u9019\u4e9b\u8cc7\u6599\u5eab\u5f88\u53ef\u80fd\u5f7c\u6b64\u662f\u5404\u81ea\u7368\u7acb\u7684\uff0c\u4f46\u537b\u90fd\u662f\u5728\u66ff\u540c\u4e00\u7fa4\u4f7f\u7528\u8005\u3002\u4f8b\u5982\uff1a\u4eba\u529b\u9280\u884c\u7684 \u6c42\u8077\u8005\u5c65\u6b77\u8cc7\u6599\u5eab \u6c42\u8077\u8005\u7684\u6027\u5411\u6e2c\u9a57 \u9664\u6b64\u4e4b\u5916\uff0c\u9019\u4e9b\u8cc7\u6599\u5eab\u70ba\u4e86\u6eff\u8db3 OLTP \u4f4e\u6f5b\u6642\u6027\uff0c\u7576\u4f60\u8981\u4e0b\u6307\u4ee4\u53bb\u641c\u96c6\u5168\u57df\u7684\u8cc7\u8a0a\u6642\uff0c\u4f60\u5f88\u53ef\u80fd\u6703\u88ab DBA \u62d2\u7d55\u3002\u70ba\u4e86\u540c\u6642\u6eff\u8db3\u7dda\u4e0a\u4f7f\u7528\u8005\u9ad8\u6548\u7387\u7684\u904b\u4f5c\u548c\u5206\u6790\u5e2b\u7684\u6578\u64da\u722c\u53d6\uff0c\u9019\u6642\u8cc7\u6599\u5132\u5009\uff08Data Warehouse\uff0cDW\uff09\u4fbf\u51fa\u73fe\u4e86\u3002 \u5176\u7279\u6027\u6703\u628a\u6240\u6709\u4e0d\u540c\u670d\u52d9\u7684\u8cc7\u6599\uff0c\u5b9a\u6642\uff08periodic data dump\uff09\u6216\u6301\u7e8c\uff08continuous stream of updates\uff09\u5f9e\u8cc7\u6599\u5eab\u4e2d\u64f7\u53d6\u8cc7\u6599\u3002\u4e26\u5b58\u5165\u9069\u5408\u5206\u6790\u7684\u7db1\u76ee\uff08schema\uff09\uff0c\u505a\u4e00\u4e9b\u91cd\u8907\u8cc7\u6599\u7684\u6e05\u7406\u7b49\u7b49\u3002\u9019\u4e00\u7cfb\u5217\u7684\u884c\u70ba\u7a31\u4f5c\u8403\u53d6\u3001\u8b8a\u63db\u53ca\u8f09\u5165\uff08Extract\u2013Transform\u2013Load\uff0cETL\uff09\u3002 \u6211\u5011\u4e4b\u524d\u5b78\u5230\u7684\u7d22\u5f15\uff08index\uff09\u6f14\u7b97\u6cd5\uff0c\u4e26\u4e0d\u9069\u5408\u9019\u985e\u5206\u6790\u6027\u7684\u884c\u70ba\u3002\u6240\u4ee5\u96d6\u7136\u5927\u90e8\u5206 DW \u90fd\u662f\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\uff0c\u5176\u5167\u90e8\u904b\u7b97\u908f\u8f2f\u537b\u548c\u5e38\u898b\u7684 OLTP \u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u4e0d\u540c\u3002\u76ee\u524d\u4e5f\u8d8a\u4f86\u8d8a\u591a\u8cc7\u6599\u5eab\u91dd\u5c0d\u4e0d\u540c\u5834\u57df\u505a\u7279\u5b9a\u7684\u512a\u5316\uff0c\u4e5f\u5c31\u662f\u5f88\u5c11\u6703\u770b\u5230\u4e00\u500b\u8cc7\u6599\u5eab\u540c\u6642\u6eff\u8db3 OLTP \u548c OLAP\u3002 \u4e00\u4e9b DW \u8cc7\u6599\u5eab \u6536\u8cbb\u7684 Teradata Vertica SAP HANA ParAccel Amazon Redshift based on ParAccel and PostgreSQL \u958b\u6e90\u7684 SQL-on-Hadoop \u5c08\u6848 Google's Dremel paper Apache Hive Apache Spark Cloudera Impala Facebook Presto Apache Drill \u7db1\u76ee DW \u53ef\u80fd\u7684\u7db1\u76ee\uff08schema\uff09\u8a2d\u8a08\u6709\u5169\u7a2e\uff1a \u661f\u72c0\u7db1\u76ee\uff08star schema\uff09 DW \u7684\u8cc7\u6599\u548c\u5176\u4ed6\u8cc7\u6599\u5eab\u7684\u8cc7\u91cf\u95dc\u7cfb\uff0c\u6a23\u5b50\u5c31\u597d\u50cf\u661f\u661f\u767c\u51fa\u4f86\u7684\u5149\u4e00\u6a23 \u96ea\u82b1\u7db1\u76ee\uff08snowflake schema\uff09 \u8cc7\u6599\u548c\u8cc7\u6599\u7684\u95dc\u4fc2\u5c64\u5c64\u4ea4\u758a \u661f\u72c0\u7db1\u76ee \u4ee5\u66f8\u4e2d\u7bc4\u4f8b\u505a\u4ecb\u7d39\uff1a \u5728\u7d30\u770b\u9019\u4e9b\u8cc7\u6599\u4ee3\u8868\u7684\u610f\u7fa9\u4e4b\u524d\uff0c\u5148\u6ce8\u610f\u5230\u8868\uff08table\uff09\u7684\u524d\u7db4\u8a5e\u6709\u5169\u7a2e\uff1a dim \u5c0d\u8cc7\u6599\u63d0\u4f9b\u7dad\u5ea6\uff08dimension\uff09\u7684\u8868 fact \u5c55\u793a\u6240\u6709\u72c0\u614b\u7684\u8868\uff0c\u4e8b\u5be6\u8868 \u4ee5\u4e0a\u8ff0\u5716\u7247\u70ba\u4f8b\u5b50\uff0c\u7522\u54c1\u3001\u5546\u5e97\u3001\u9867\u5ba2\u3001\u65e5\u671f\u3001\u63a8\u5ee3\u6d3b\u52d5\u7b49\u7b49\u5c31\u662f\u63d0\u9ad8\u4e8b\u5be6\u8868\u7dad\u5ea6\u7684\u8cc7\u6599\u5eab\u3002\u800c fact_sales \u5c31\u662f\u92b7\u552e\u76f8\u95dc\u7684\u4e8b\u5be6\u8868\uff0c\u6216\u8005\u8aaa\u8a72\u8868\u7d00\u9304\u4e86\u6240\u6709\u92b7\u552e\u76f8\u95dc\u7684\u884c\u70ba\uff08\u4e8b\u4ef6\uff09\u3002 \u5118\u7ba1\u6709\u4e9b\u662f\u5c0d\u7167\u5176\u4ed6\u8868\u7684\u5916\u5340\u9375\uff08foreign key\uff09\uff0c\u4f46\u4ecd\u6709\u5f88\u591a\u6b04\u4f4d\u662f\u76f8\u95dc\u884c\u70ba\uff08\u4e8b\u4ef6\uff09\u7684\u5c6c\u6027\uff0c\u4f8b\u5982\uff1a\u8a72\u300c\u9867\u5ba2\u300d\u65bc\u8a72\u300c\u5546\u5e97\u300d\u8cfc\u8cb7\u8a72\u300c\u7522\u54c1\u300d\u7684\u6578\u91cf\u3001\u539f\u50f9\u3001\u552e\u50f9\u7b49\u7b49\u3002\u7531\u6b64\u53ef\u77e5\uff0c\u82e5\u63d0\u4f9b\u7d30\u7bc0\u4fe1\u606f\uff0c\u8a72\u8868\u683c\u5c07\u6703\u6709\u975e\u5e38\u591a\u7684\u6b04\u4f4d\uff0c\u6216\u8005\u8aaa\u5c6c\u6027\uff08property\uff09\uff0c\u751a\u81f3\u53ef\u80fd\u5230\u6578\u767e\u7a2e\u5c6c\u6027\u3002 \u96ea\u82b1\u7db1\u76ee \u985e\u4f3c\u65bc\u661f\u72c0\u7db1\u76ee\uff0c\u53ea\u662f\u4ed6\u7684\u7dad\u5ea6\u8868\u53ef\u80fd\u6703\u6709\u5f88\u591a\u5c64\uff0c\u4f8b\u5982\uff1a\u300c\u7522\u54c1\u8868\u300d\u53c8\u6703\u6709\u5916\u5340\u9375\u9023\u5230\u300c\u54c1\u724c\u8868\u300d\u548c\u300c\u7a2e\u985e\u8868\u300d\u3002 \u6bd4\u8f03 \u5927\u90e8\u5206\u8cc7\u6599\u5eab\u9078\u64c7\u4f7f\u7528\u661f\u72c0\u7db1\u76ee\uff0c\u56e0\u70ba\u5176 \u597d\u64f4\u5145\uff0c\u4f8b\u5982\uff1a\u7576\u6709\u65b0\u7684\u7a2e\u985e\uff0c\u5c31\u4e0d\u7528\u540c\u6642\u53bb\u6539\u7a2e\u985e\u8868\u548c\u7522\u54c1\u8868 \u9069\u5408\u58d3\u7e2e\u548c\u512a\u5316\u641c\u5c0b\u901f\u5ea6\uff08\u900f\u904e Bitmap Index\uff09\uff0c\u5f8c\u9762\u6703\u4ecb\u7d39 \u597d\u8abf\u6574\uff0c\u65b0\u589e\u5c6c\u6027\u6642\uff0c\u4e0d\u9700\u8981\u8003\u616e\u653e\u5728\u54ea\u500b\u8868\u6bd4\u8f03\u9069\u5408 \u8f03\u597d\u7406\u89e3\uff0c\u4e0d\u7528\u5c64\u5c64\u5806\u780c\uff0c\u5c64\u5c64\u89e3\u6790 \u5217\u5f0f\u8cc7\u6599\u5eab \u5728\u4e00\u822c OLAP \u4e2d\uff0c\u53ea\u6703\u8b80\u53d6\u90e8\u5206\u6b04\u4f4d\uff0c\u4ee5\u4e0a\u8ff0\u8868\u683c\u70ba\u4f8b\uff1a\u5728\u5047\u65e5\u8cfc\u8cb7\u7279\u5b9a\u7a2e\u985e\u7684\u6578\u91cf\uff1a SELECT dim_date . weekday , dim_product . category , SUM ( fact_sales . quantity ) AS quantity_sold FROM fact_sales JOIN dim_date ON fact_sales . date_key = dim_date . date_key JOIN dim_product ON fact_sales . product_sk = dim_product . product_sk WHERE dim_date . year = 2013 AND dim_product . category IN ( 'Fresh fruit' , 'Candy' ) GROUP BY dim_date . weekday , dim_product . category ; \u7531\u6b64\u4f8b\u53ef\u77e5\uff0c\u5728\u8a72\u7279\u6027\u4e0b\uff0c\u82e5\u6bcf\u6b21\u64cd\u4f5c\u50c5\u62ff\u53d6\u90e8\u5206\u8cc7\u6599\u505a\u904b\u7b97\uff0c\u662f\u5426\u6709\u5fc5\u8981\u505a\u529f\u8b93\u5176\u4ed6\u6b04\u4f4d\u7684\u8cc7\u6599\u4e00\u8d77\u5f9e\u78c1\u789f\uff08disk\uff09\u4e2d\u8b80\u53d6\u51fa\u4f86\uff1f \u5c24\u5176\u662f\u5728\u8cc7\u6599\u91cf\u6709\u597d\u5e7e PB\uff0c\u800c\u6bcf\u4e00\u884c\u53ef\u80fd\u6709\u597d\u5e7e\u767e\u500b\u5c6c\u6027\u6642\uff0c\u9019\u985e\u300c\u5c0f\u7f3a\u9ede\u300d\u5c07\u6703\u88ab\u653e\u5927\u3002 \u5217\u5f0f\u8cc7\u6599\u5eab\uff08column-oriented storage\uff09\u7684\u6982\u5ff5\u5c31\u662f\u7531\u6b64\u800c\u751f\uff0c\u6211\u4e0d\u4ee5\u6bcf\u5217\u70ba\u55ae\u4f4d\u505a\u5132\u5b58\uff0c\u800c\u662f\u6539\u70ba\u6bcf\u6b04\u70ba\u55ae\u4f4d\u3002\u9019\u6a23\u5728\u8b80\u53d6\u6642\uff0c\u5c31\u53ea\u9700\u8981\u8b80\u53d6\u5c11\u90e8\u5206\u7684\u8cc7\u6599\u3002 \u4e26\u975e\u53ea\u6709\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u9069\u5408\u505a\u5217\u5f0f\u8cc7\u6599\u5eab\uff0c\u50c5\u50c5\u56e0\u70ba\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u5728\u8b1b\u89e3\u4e0a\u662f\u6700\u597d\u7406\u89e3\u7684\u3002 Parquet \u5c31\u662f\u4e00\u500b\u4ee5 Google's Dremel paper \u70ba\u57fa\u790e\u7684\u6587\u4ef6\u5f0f\u8cc7\u6599\u5eab\u3002 \u9019\u540c\u6642\u4e5f\u4ee3\u8868\uff0c\u6bcf\u4e00\u6b04\u4f4d\u90fd\u9700\u8981\u64c1\u6709\u76f8\u540c\u9806\u5e8f\u548c\u6578\u91cf\u7684\u884c\u4f4d\uff0c\u800c\u9019\u689d\u4ef6\u5728 OLAP \u662f\u7b26\u5408\u7684\uff0c\u56e0\u70ba\u5176\u4e0d\u6703\u522a\u9664\u4efb\u4e00\u884c\u8cc7\u6599\u3002 \u58d3\u7e2e \u597d\u7684\u8cc7\u6599\u58d3\u7e2e\uff0c\u53ef\u4ee5\u964d\u4f4e\u5728\u8b80\u53d6\u6d77\u91cf\u8cc7\u6599\u7684\u6642\u9593\uff0c\u800c OLAP \u9084\u6709\u500b\u7279\u6027\uff0c\u5c31\u662f\u6b04\u4f4d\u53ef\u80fd\u7684\u503c\u662f\u6709\u9650\u7684\u3002\u4f8b\u5982\uff1a\u7522\u54c1\u6578\u91cf\u53ef\u80fd\u53ea\u6709\u6578\u842c\u6216\u6578\u5341\u842c\u500b\uff0c\u4f46\u662f\u8cfc\u7269\u64cd\u4f5c\u537b\u53ef\u80fd\u6bcf\u5e74\u6709\u597d\u5e7e\u5104\u7b46\u3002 \u56e0\u6b64\uff0c\u4ee5\u64cd\u4f5c\u70ba\u6b04\uff0c\u7522\u54c1\u7de8\u865f\u70ba\u5217\uff0c\u53ef\u5f97\u4e0b\u8868\uff1a \u7522\u54c1\u7de8\u865f \u64cd\u4f5c 1 \u64cd\u4f5c 2 \u64cd\u4f5c 3 ... 1 1 0 1 ... 2 0 1 0 ... 3 0 0 0 ... ... - - - ... \u5176\u610f\u7fa9\u4ee3\u8868\uff1a \u64cd\u4f5c 1 \u8cfc\u8cb7 \u7522\u54c1 1 \u64cd\u4f5c 2 \u8cfc\u8cb7 \u7522\u54c1 2 \u64cd\u4f5c 3 \u8cfc\u8cb7 \u7522\u54c1 1 ... \u6b64\u6642\u4e26\u4e0d\u80fd\u58d3\u7e2e\u8cc7\u6599\uff0c\u4e8b\u5be6\u4e0a\uff0c\u4ed6\u53ea\u662f\u628a\u5404\u64cd\u4f5c\u7684\u5404\u7522\u54c1\u7de8\u865f\uff0c\u5c55\u958b\u6210\u4e8c\u9032\u4f4d\u800c\u5df2\u3002\u4e5f\u5c31\u662f\uff0c\u4f4d\u5143\u6620\u5c04\uff08 bitmap encoding \uff09\u3002\u7136\u800c\uff0c\u56e0\u70ba OLAP \u7684\u7279\u6027\u8b93\u6bcf\u5217\u6709\u591a\u500b\u70ba 0 \u7684\u6b04\u4f4d\uff0c\u6b64\u6642\u5c31\u53ef\u4ee5\u900f\u904e\u57f7\u884c\u9577\u5ea6\u7de8\u78bc\uff08 run-length encoded \uff09\u9032\u884c\u58d3\u7e2e\u3002 \u800c\u5c55\u958b\u6210\u4e8c\u9032\u4f4d\u7684\u683c\u5f0f\uff0c\u4e0d\u6b62\u5229\u65bc\u58d3\u7e2e\uff0c\u5728\u8a08\u7b97\u6642\uff0c\u4e5f\u53ef\u4ee5\u55ae\u7d14\u900f\u904e OR AND \u53bb\u505a\u8a08\u7b97\u3002\u4f8b\u5982\uff1a WHERE product_sk IN ( 30 , 68 , 69 ) \u6211\u5011\u8b80\u53d6\u7522\u54c1\u7684\u4f4d\u5143\u6620\u5c04\u8868\u4e2d\u7684\u7b2c 30 \uff0c 68 \u548c 69 \u884c\uff0c\u7136\u5f8c\u62ff\u51fa\u4e09\u6bb5\u4f4d\u5143\u5411\u91cf\uff08bit vector\uff09\u505a\u4f4d\u5143\u9593\u7684 OR \u904b\u7b97\u3002 WHERE product_sk = 31 AND store_sk = 3 \u6211\u5011\u8b80\u53d6\u4f4d\u7522\u54c1\u7684\u5143\u6620\u5c04\u8868\u4e2d\u7684\u7b2c 31 \u884c\uff0c\u7136\u5f8c\u8b80\u53d6\u5546\u5e97\u7684\u5143\u6620\u5c04\u8868\u4e2d\u7684\u7b2c 3 \u884c\u505a\u4f4d\u5143\u9593\u7684 AND \u904b\u7b97\u3002 \u9019\u985e\u64cd\u4f5c\u4e4b\u6240\u4ee5\u53ef\u4ee5\u904b\u4f5c\uff0c\u5c31\u662f\u56e0\u70ba\u6211\u5011\u5728\u5132\u5b58\u6b04\u4f4d\u6642\uff0c\u540c\u6b65\u6240\u6709\u5217\u7684\u6578\u91cf\u548c\u9806\u5e8f\u3002 \u82e5\u9700\u8981\u67e5\u770b\u66f4\u591a\u58d3\u7e2e\u7684\u6f14\u7b97\u6cd5\uff0c\u53ef\u4ee5\u67e5\u770b The Design and Implementation of Modern Column-Oriented Database Systems. Ct4-2 \u3002 Column Family \u548c Column Oriented \u662f\u4e0d\u540c\u7684\u6982\u5ff5\uff0c\u5176\u88ab\u61c9\u7528\u65bc\u57fa\u65bc Bigtable \u67b6\u69cb\u7684\u8cc7\u6599\u5eab Cassandra \u548c HBase \u4e2d\u3002\u5176\u539f\u7406\u662f\u628a\u90e8\u5206\u5217\uff08column\uff09\u5f9e\u884c\uff08row\uff09\u4e2d\u62c9\u51fa\u6574\u5408\u6210\u4e00\u500b\u55ae\u4f4d\uff0c\u985e\u4f3c\u65bc\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u7684\u8868\uff08table\uff09\uff0c\u4e26\u4e14\u4e0d\u6703\u5c0d\u9019\u55ae\u4f4d\u9032\u884c\u5217\u58d3\u7e2e\uff08 column compression \uff09\uff0c\u56e0\u6b64\u8a72\u6a21\u578b\u4ecd\u4e3b\u8981\u662f\u4ee5\u884c\u5f0f\u8cc7\u6599\u5eab\uff08row-oriented\uff09\u70ba\u4e3b\u3002 \u786c\u9ad4\u9762\u512a\u5316 \u7576\u9032\u884c\u904b\u7b97\u548c\u5206\u6790\u6642\uff0c\u7cfb\u7d71\u5fc5\u9808\u5f9e\u786c\u9ad4\u78c1\u789f\uff08disk\uff09\u4e2d\u8b80\u53d6\u8cc7\u6599\u4e26\u5b58\u9032\u8a18\u61b6\u9ad4\uff08memory\uff09\u4e2d\u3002\u9664\u4e86\u9019\u4e00\u6bb5\u7684\u983b\u5bec\u9700\u8981\u8003\u91cf\u5916\uff0c\u9084\u9700\u8981\u8003\u91cf\u8a18\u61b6\u9ad4\u9032\u5165 CPU \u5feb\u53d6\u4e2d\u7684\u983b\u5bec\u3002\u5728\u57f7\u884c\u9019\u4e9b\u884c\u70ba\u7684\u8a0a\u865f\u6642\uff0c\u76e1\u53ef\u80fd\u907f\u514d\u5feb\u53d6\u5c64\u7d1a\u7684\u8aa4\u5224\u548c\u6574\u5408\u9032\u55ae\u4e00 CPU \u904b\u884c\u7684\u5927\u5c0f\uff08page size\uff09\uff0c\u4e26\u4f7f\u7528\u73fe\u4ee3 CPU \u4e2d\u7684 SIMD\uff08single-instruction-multi-data\uff09 \u6307\u4ee4\u3002 \u6307\u4ee4 1/1,000,000,000 \u79d2 = 1 \u5948\u79d2 \u8b80\u53d6\u7b2c\u4e00\u5c64\u5feb\u53d6 0.5 ns \u5feb\u53d6\u5c64\u7d1a\u8aa4\u5224 5 ns \u8b80\u53d6\u7b2c\u4e8c\u5c64\u5feb\u53d6 7 ns \u4e92\u65a5\u9396\u7684\u52a0\u9396\u548c\u89e3\u9396 25 ns \u8b80\u53d6\u4e3b\u8a18\u61b6\u9ad4 100 ns \u5728 1Gbps \u7684\u7db2\u8def\u9001\u51fa 2KB \u7684\u8cc7\u6599 20,000 ns \u5f9e\u4e3b\u8a18\u61b6\u9ad4\u4e2d\u8b80\u53d6 1MB \u7684\u9023\u7e8c\u8cc7\u6599 250,000 ns \u53d6\u5f97\u78c1\u789f\u4e2d\u7684\u65b0\u4f4d\u7f6e\uff08\u9700\u8981\u641c\u5c0b\uff09 8,000,000 ns \u5f9e\u78c1\u789f\u4e2d\u8b80\u53d6 1MB \u7684\u9023\u7e8c\u8cc7\u6599 20,000,000 ns \u8b93\u4e00\u500b\u5c01\u5305\u5f9e\u7f8e\u570b\u5230\u6b50\u6d32\u4f86\u56de 150 ms = 150,000,000 ns \u53c3\u8003\uff1ahttps://hackmd.io/ysFkocN0RreKgzJk_7B-0g?view \u9664\u4e86\u76e1\u53ef\u80fd\u6e1b\u5c11\u62c9\u53d6\u7684\u8cc7\u6599\uff0c\u6bcf\u6b21\u62c9\u53d6\u6642\u4e5f\u9808\u6709\u6548\u7684\u914d\u5408 CPU \u7684\u9031\u671f\u3002\u4f8b\u5982\uff0c\u641c\u5c0b\u5f15\u64ce\u6703\u628a\u58d3\u7e2e\u5f8c\u7684\u5217\u5f0f\u8cc7\u6599\u5206\u6210\u597d\u5e7e\u6bb5\uff08chunk\uff09\uff0c\u4e26\u6301\u7e8c\u4e14\u7dca\u5bc6\u5730\uff08\u4e5f\u5c31\u662f\u904e\u7a0b\u4e2d\u4e0d\u547c\u53eb\u4efb\u4f55\u51fd\u793a\uff0c\u907f\u514d function call/jump\uff09\u653e\u9032 CPU \u7b2c\u4e00\u5c64\u5feb\u53d6\u4e2d\u3002\u9664\u6b64\u4e4b\u5916\u6bcf\u4e00\u6bb5\uff08chunk\uff09\u5f7c\u6b64\u9593\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u96fb\u6676\u9ad4\u53bb\u57f7\u884c AND \u6216 OR \u7b49\u908f\u8f2f\u904b\u7b97\u3002 \u9019\u4e00\u7cfb\u5217\u7684\u6280\u5de7\u7a31\u70ba\u5411\u91cf\u8655\u7406\uff08vectorized processing\uff09\u3002 \u6392\u5e8f \u628a\u8cc7\u6599\u7d93\u904e\u6392\u5e8f\u5f8c\u518d\u5132\u5b58\u9664\u4e86\u52a0\u901f\u641c\u5c0b\u4e5f\u53ef\u4ee5\u8b93\u9577\u5ea6\u7de8\u78bc\uff08run-length encoded\uff09\u66f4\u7dca\u5bc6\u3002\u4f8b\u5982 00001000100 \u6392\u5e8f\u5f8c\u8b8a\u6210 1,2,0,9 \u3002 \u53ef\u4ee5\u900f\u904e\u4e4b\u524d\u63d0\u904e\u7684 SSTable \u4f86\u505a\u6392\u5e8f\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u96d6\u7136\u662f\u628a\u6bcf\u5217\u4f5c\u70ba\u5132\u5b58\u55ae\u4f4d\uff0c\u5728\u6392\u5e8f\u6642\u4ecd\u8981\u8b93\u8a72\u884c\u7684\u5404\u5217\u8cc7\u6599\u540c\u6642\u4fdd\u6301\u76f8\u540c\u9806\u5e8f\u3002 \u4f46\u662f\uff0c\u6392\u5e8f\u7684\u6548\u679c\u50c5\u5728\u505a\u7b2c\u4e00\u7d44\u8cc7\u6599\u6392\u5e8f\u6700\u6709\u6548\uff0c\u4f8b\u5982\uff1a \u82e5\u767c\u73fe\u5e38\u5e38\u4f7f\u7528\u65e5\u671f\u55ae\u4f4d\u505a\u641c\u5c0b\uff0c\u5982\u6bcf\u6708\u7684\u8cfc\u8cb7\u7522\u54c1\u7e3d\u6578\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528 date_key \u3002\u4f46\u662f\u5c0d\u65bc\u4ee5\u7522\u54c1\u70ba\u5e95\u7684\u641c\u5c0b\uff0c\u5982\u8cfc\u8cb7\u8a72\u7522\u54c1\u7684\u6703\u54e1\u5e74\u9f61\u5c31\u6c92\u6709\u4f7f\u7528\u5230\u6392\u5e8f\u7684\u597d\u8655\u3002\u9019\u6642\u5c31\u767c\u5c55\u51fa\u65b0\u7684\u5c0f\u6280\u5de7\u3002\u4f8b\u5982 Vertica \u7684\u8cc7\u6599\u5eab\uff1a \u53cd\u6b63\u8cc7\u6599\u90fd\u8981\u505a\u5099\u4efd\uff08\u548c HA\uff09\u8907\u88fd\u5230\u5404\u6a5f\u5668\uff0c\u4f60\u5c31\u53ef\u4ee5\u628a\u5404\u6a5f\u5668\u7684\u8cc7\u6599\u505a\u4e0d\u540c\u65b9\u5f0f\u53bb\u5132\u5b58\u3002\u4f8b\u5982\u8cc7\u6599\u5eab A \u4ee5\u65e5\u671f\u4f5c\u70ba sort key \uff0c\u8cc7\u6599\u5eab B \u4ee5\u7522\u54c1\u4f5c\u70ba sort key \u3002 \u53ef\u4ee5\u60f3\u50cf\u5176\u548c\u884c\u5f0f\u8cc7\u6599\u5eab\u7684\u591a\u7d22\u5f15\u7684\u5dee\u7570\u3002\u884c\u5f0f\u8cc7\u6599\u5eab\u5728\u591a\u7d22\u5f15\u4e2d\uff0c\u5e38\u5e38\u6703\u5728\u7d22\u5f15\u4e2d\u5132\u5b58\u6a94\u6848\u7684\u4f86\u6e90\uff0c\u4f8b\u5982 heap file \u7b49\u7b49 \u3002\u800c\u5217\u5f0f\u8cc7\u6599\u5eab\u5247\u76f4\u63a5\u5132\u5b58\u8cc7\u6599 \u66ab\u5b58\u805a\u5408 \u641c\u5c0b\u6642\uff0c\u5e38\u5e38\u6703\u7528\u5230\u805a\u5408\uff08aggregation\uff09\u8cc7\u6599\uff0c\u4f8b\u5982\u7e3d\u6578\uff08sum\uff09\u3001\u5e73\u5747\uff08avg\uff09\u7b49\u7b49\u3002\u800c\u9019\u985e\u64cd\u4f5c\u5e38\u5e38\u90fd\u9700\u8981\u904d\u6b77\u8cc7\u6599\u5eab\uff0c\u65e2\u7136\u9019\u4e9b\u8cc7\u6599\u5f88\u8017\u6642\u53c8\u9700\u8981\u5e38\u5e38\u7528\u5230\uff0c\u5c31\u66ab\u5b58\u4ed6\u5427\u3002\u9019\u985e\u66ab\u5b58\u5f8c\u7684\u805a\u5408\u8cc7\u6599\uff0c\u7a31\u70ba\u7269\u5316\u805a\u5408\uff08materialized aggregates\uff09\uff0c\u800c\u5c55\u793a\u9019\u985e\u8cc7\u6599\u7684\u5716\u6216\u8868\uff08table\uff09\u7a31\u70ba\u7269\u5316\u8996\u5716\uff08materialized view\uff09\u3002 \u7269\u5316\u8996\u5716\u548c\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u5e38\u898b\u7684\u6a19\u6e96\u8996\u5716\uff08standard/virtual view\uff09\u6709\u6240\u5dee\u7570\uff0c\u6a19\u6e96\u8996\u5716\u53ea\u662f\u628a\u67e5\u8a62\u8a18\u9304\u6574\u5408\u5728\u4e00\u8d77\uff0c\u7576\u88ab\u4f7f\u7528\u6642\uff0c\u4ecd\u7136\u6703\u57f7\u884c\u5176\u4e2d\u4e00\u7cfb\u5217\u7684\u67e5\u8a62\u3002 \u5716\u4e2d\u5c55\u793a\uff0c\u4e8c\u7dad\u8cc7\u6599\u5728\u505a\u7269\u5316\u6574\u5408\u6642\u7684\u65b9\u5f0f\u3002\u6bcf\u4e00\u500b\u55ae\u5143\uff08cell\uff09\u5132\u5b58\u67d0\u4e00\u5929\u7684\u67d0\u4e00\u500b\u7522\u54c1\u92b7\u552e\u7e3d\u984d\uff0c\u884c\u5c3e\u5132\u5b58\u67d0\u4e00\u5929\u7684\u6240\u6709\u7522\u54c1\u92b7\u552e\u7e3d\u984d\uff0c\u5217\u5c3e\u5132\u5b58\u67d0\u4e00\u7522\u54c1\u7684\u6240\u6709\u92b7\u552e\u7e3d\u984d\u3002 \u7576\u7136\uff0c\u8cc7\u6599\u66f4\u53ef\u80fd\u88ab\u9032\u884c\u591a\u7dad\u5ea6\u7684\u5132\u5b58\uff0c\u4f8b\u5982\u8cfc\u7269\u8005\u7684\u5e74\u9f61\u7b49\u7b49\u3002 \u5beb\u5165 \u4e0a\u8ff0\u63d0\u5230\u7684\u58d3\u7e2e\u3001\u786c\u9ad4\u512a\u5316\u3001\u6392\u5e8f\u3001\u66ab\u5b58\u805a\u5408\u90fd\u662f\u5728\u63d0\u9ad8\u8b80\u53d6\u6548\u7387\uff0c\u96d6\u7136\u9019\u5be6\u969b\u5c31\u662f\u8cc7\u6599\u5132\u5009\u5927\u90e8\u5206\u7684\u696d\u52d9\u9700\u6c42\uff0c\u4f46\u5728\u5f9e\u5404\u500b\u5b50\u8cc7\u6599\u5eab\u4e2d\u62c9\u53d6\u8cc7\u6599\u6642\u4ecd\u9700\u8981\u5beb\u5165\u3002\u8a72\u600e\u9ebc\u505a\u5230\u6709\u6548\u7684\u5beb\u5165\u5462\uff1f \u53ef\u4ee5\u900f\u904e\u5148\u524d\u63d0\u5230\u7684 LSM-Tree \uff0c\u5206\u6210\u78c1\u789f\u4e0a\u7684\u8cc7\u6599\u548c\u8a18\u61b6\u9ad4\u4e2d\u7684\u8cc7\u6599\uff0c\u8a18\u61b6\u9ad4\u7684\u8cc7\u6599\u65b9\u4fbf\u505a\u6392\u5e8f\u548c\u63d2\u5165\u3002\u7576\u8a18\u61b6\u9ad4\u9054\u5230\u4e00\u5b9a\u5927\u5c0f\u5f8c\uff0c\u5beb\u5165\u78c1\u789f\u4e2d\u3002\u800c\u78c1\u789f\u4e2d\u7684\u8cc7\u6599\u5b9a\u671f\u505a\u6574\u5408\u548c\u58d3\u7e2e\u3002 Vertica \u7684\u8cc7\u6599\u5eab\u4fbf\u662f\u4f9d\u6b64\u65b9\u5f0f\u3002 \u5f9e\u9019\u4e5f\u53ef\u4ee5\u770b\u5230 LSM-Tree \u5c0d\u65bc\u8cc7\u6599\u5eab\u7684\u6f14\u7b97\u6cd5\u6709\u5f88\u91cd\u5927\u7684\u5f71\u97ff\u3002","title":"\u8cc7\u6599\u5009\u5132"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#oltpolap-dw","text":"\u4e00\u822c\u4f86\u8aaa\uff0c\u8cc7\u6599\u5eab\u5c0d\u65bc\u670d\u52d9\u4f7f\u7528\u8005\u4f86\u8aaa\uff0c\u5373\u662f\u5728\u4e00\u7fa4\u8cc7\u6599\u4e2d\u627e\u51fa\u7279\u5b9a\u8cc7\u6599\uff0c\u505a\u8b80\u5beb\u7684\u52d5\u4f5c\u3002\u9019\u7a2e\u64cd\u4f5c\uff0c\u7a31\u70ba \u7dda\u4e0a\u4ea4\u6613\u8655\u7406 \uff08online transaction processing\uff0cOLTP\uff09\u3002 \u65e9\u671f\u8cc7\u6599\u5eab\u7684\u64cd\u4f5c\u5e7e\u4e4e\u662f\u5546\u52d9\u4ea4\u6613\uff0c\u6240\u4ee5\u4fdd\u7559\u820a\u7a31\u300c\u4ea4\u6613\u300d\uff08transaction\uff09\u3002 \u7136\u800c\uff0c\u96a8\u8457\u8cc7\u6599\u7684\u589e\u52a0\uff0c\u958b\u59cb\u9700\u8981\u5c0d\u8cc7\u6599\u5eab\u505a\u4e00\u4e9b\u5206\u6790\u3002\u5e6b\u52a9\u670d\u52d9\u7ba1\u7406\u8005\u53bb\u505a\u4e00\u4e9b\u7279\u5b9a\u7684\u6c7a\u7b56\uff0c\u4f8b\u5982\uff1a \u8cfc\u7269\u8005\u5728\u4e00\u5929\u4e2d\u8cfc\u8cb7\u7684\u6642\u9593\u5206\u4f48 \u54ea\u500b\u5546\u54c1\u8ce3\u6700\u597d \u9019\u4e00\u985e\u7684\u884c\u70ba\uff0c\u5e38\u5e38\u9700\u8981\u91dd\u5c0d\u6240\u6709\u7684\u8cc7\u6599\u505a\u8b80\u53d6\uff0c\u800c\u4e0d\u9700\u8981\u5beb\u5165\u3002\u6211\u5011\u7a31\u4e4b\u70ba \u7dda\u4e0a\u5206\u6790\u8655\u7406 \uff08online analytic processing\uff0cOLAP\uff09\u3002 \u91dd\u5c0d\u9019\u7a2e\u548c OLTP \u7684\u64cd\u4f5c\u6709\u5f88\u5927\u5dee\u7570\u7684\u8cc7\u6599\uff0c\u800c\u53bb\u505a\u8a2d\u8a08\u7684\u8cc7\u6599\u5eab\uff0c\u6211\u5011\u7a31\u4e4b\u70ba\u8cc7\u6599\u5132\u5009\uff08Data Warehouse\uff0cDW\uff09\u3002 \u6709\u6642\u5019\u4e26\u4e0d\u662f\u90a3\u9ebc\u6e05\u695a\u5c31\u53ef\u4ee5\u5340\u5206 OLTP \u548c OLAP\uff0c\u4f46\u662f\u4ecd\u6709\u4e00\u4e9b\u4e3b\u8981\u7684\u5dee\u7570\uff1a \u5c6c\u6027 OLTP OLAP \u4e3b\u8981\u7684\u8b80\u53d6\u6a21\u5f0f \u5c0f\u91cf\u8cc7\u6599\uff0c\u4e14\u900f\u904e key \u7be9\u9078 \u805a\u5408\uff08aggregate\uff09\u5927\u91cf\u8cc7\u6599 \u4e3b\u8981\u7684\u5beb\u5165\u6a21\u5f0f \u4f4e\u6f5b\u6642\uff08latency \uff09\uff0c\u4e14\u96a8\u6a5f\u5beb\u5165 \u4e00\u6b21\u6027\u5927\u91cf\u5beb\u5165\uff0c\u6216\u900f\u904e\u4e8b\u4ef6\u6d41\u5165 \u4e3b\u8981\u4f7f\u7528\u65bc \u900f\u904e\u7db2\u8def\u6e9d\u901a\u7684\u670d\u52d9\u4f7f\u7528\u8005 \u5167\u90e8\u5206\u6790\u5e2b\uff0c\u5e6b\u52a9\u6c7a\u7b56 \u8cc7\u6599\u4ee3\u8868\u4ec0\u9ebc \u6700\u65b0\u72c0\u614b \u4e8b\u4ef6\u7684\u6b77\u53f2\u7d00\u9304 \u8cc7\u6599\u5eab\u5927\u5c0f GB~TB TB~PB","title":"\u4ec0\u9ebc\u662f OLTP\u3001OLAP \u548c DW"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_1","text":"OLTP \u985e\u578b\u8cc7\u6599\u5eab\u901a\u5e38\u662f\u670d\u52d9\u4f7f\u7528\u8005\u76f4\u63a5\u63a5\u89f8\u7684\u3002\u9019\u4ee3\u8868\u5927\u91cf\u7684\u8acb\u6c42\u6703\u88ab\u9700\u8981\u8655\u7406\uff0c\u70ba\u4e86\u8655\u7406\u9019\u985e\u9700\u6c42\uff0c\u8acb\u6c42\u901a\u5e38\u53ea\u6703\u63a5\u89f8\u8cc7\u6599\u5eab\u4e2d\u4e00\u90e8\u4efd\u8cc7\u6599\u3002\u61c9\u7528\u7a0b\u5f0f\u53ef\u80fd\u6703\u900f\u904e\u7d22\u5f15\uff08index\uff09\u4f86\u52a0\u901f\u641c\u5c0b\u3002\u9019\u985e\u7684\u8cc7\u6599\u5eab\u901a\u5e38\u6ce8\u91cd\u5f9e\u78c1\u789f\u4e2d\u627e\u5c0b\u7684\u901f\u5ea6\uff08 seek time \uff0c\u627e\u5c0b\u7279\u5b9a\u8cc7\u6599\u4f4d\u7f6e\u7684\u901f\u5ea6\uff09\u3002 OLAP \u985e\u578b\u8cc7\u6599\u5eab\u8f03\u5c11\u88ab\u77e5\u9053\uff0c\u56e0\u70ba\u9019\u985e\u578b\u8cc7\u6599\u5eab\u662f\u7528\u4f86\u505a\u5206\u6790\uff0c\u800c\u975e\u8b93\u670d\u52d9\u4f7f\u7528\u8005\u76f4\u63a5\u5b58\u53d6\u3002\u96d6\u7136\u8acb\u6c42\u91cf\u6bd4 OLTP \u4f4e\uff0c\u4f46\u662f\u6bcf\u6b21\u8acb\u6c42\u53ef\u80fd\u90fd\u9700\u8981\u904d\u6b77\u8cc7\u6599\u5eab\u4f86\u53d6\u5f97\u7279\u5b9a\u5206\u6790\u7d50\u679c\u3002\u9019\u985e\u7684\u8cc7\u6599\u5eab\u901a\u5e38\u6ce8\u91cd\u5f9e\u78c1\u789f\u4e2d\u7684\u983b\u5bec\uff08 bandwidth \uff0c\u8b80\u53d6\u5927\u91cf\u8cc7\u6599\u7684\u901f\u5ea6\uff09\u3002","title":"\u6bd4\u8f03"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#data-warehouse","text":"\u5c0d\u65bc\u516c\u53f8\u4f86\u8aaa\u53ef\u80fd\u6703\u6709\u5f88\u591a\u8cc7\u6599\u5eab\u53bb\u6eff\u8db3\u5404\u500b\u55ae\u4f4d\u7684\u9700\u6c42\u3002\u9019\u4e9b\u8cc7\u6599\u5eab\u5f88\u53ef\u80fd\u5f7c\u6b64\u662f\u5404\u81ea\u7368\u7acb\u7684\uff0c\u4f46\u537b\u90fd\u662f\u5728\u66ff\u540c\u4e00\u7fa4\u4f7f\u7528\u8005\u3002\u4f8b\u5982\uff1a\u4eba\u529b\u9280\u884c\u7684 \u6c42\u8077\u8005\u5c65\u6b77\u8cc7\u6599\u5eab \u6c42\u8077\u8005\u7684\u6027\u5411\u6e2c\u9a57 \u9664\u6b64\u4e4b\u5916\uff0c\u9019\u4e9b\u8cc7\u6599\u5eab\u70ba\u4e86\u6eff\u8db3 OLTP \u4f4e\u6f5b\u6642\u6027\uff0c\u7576\u4f60\u8981\u4e0b\u6307\u4ee4\u53bb\u641c\u96c6\u5168\u57df\u7684\u8cc7\u8a0a\u6642\uff0c\u4f60\u5f88\u53ef\u80fd\u6703\u88ab DBA \u62d2\u7d55\u3002\u70ba\u4e86\u540c\u6642\u6eff\u8db3\u7dda\u4e0a\u4f7f\u7528\u8005\u9ad8\u6548\u7387\u7684\u904b\u4f5c\u548c\u5206\u6790\u5e2b\u7684\u6578\u64da\u722c\u53d6\uff0c\u9019\u6642\u8cc7\u6599\u5132\u5009\uff08Data Warehouse\uff0cDW\uff09\u4fbf\u51fa\u73fe\u4e86\u3002 \u5176\u7279\u6027\u6703\u628a\u6240\u6709\u4e0d\u540c\u670d\u52d9\u7684\u8cc7\u6599\uff0c\u5b9a\u6642\uff08periodic data dump\uff09\u6216\u6301\u7e8c\uff08continuous stream of updates\uff09\u5f9e\u8cc7\u6599\u5eab\u4e2d\u64f7\u53d6\u8cc7\u6599\u3002\u4e26\u5b58\u5165\u9069\u5408\u5206\u6790\u7684\u7db1\u76ee\uff08schema\uff09\uff0c\u505a\u4e00\u4e9b\u91cd\u8907\u8cc7\u6599\u7684\u6e05\u7406\u7b49\u7b49\u3002\u9019\u4e00\u7cfb\u5217\u7684\u884c\u70ba\u7a31\u4f5c\u8403\u53d6\u3001\u8b8a\u63db\u53ca\u8f09\u5165\uff08Extract\u2013Transform\u2013Load\uff0cETL\uff09\u3002 \u6211\u5011\u4e4b\u524d\u5b78\u5230\u7684\u7d22\u5f15\uff08index\uff09\u6f14\u7b97\u6cd5\uff0c\u4e26\u4e0d\u9069\u5408\u9019\u985e\u5206\u6790\u6027\u7684\u884c\u70ba\u3002\u6240\u4ee5\u96d6\u7136\u5927\u90e8\u5206 DW \u90fd\u662f\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\uff0c\u5176\u5167\u90e8\u904b\u7b97\u908f\u8f2f\u537b\u548c\u5e38\u898b\u7684 OLTP \u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u4e0d\u540c\u3002\u76ee\u524d\u4e5f\u8d8a\u4f86\u8d8a\u591a\u8cc7\u6599\u5eab\u91dd\u5c0d\u4e0d\u540c\u5834\u57df\u505a\u7279\u5b9a\u7684\u512a\u5316\uff0c\u4e5f\u5c31\u662f\u5f88\u5c11\u6703\u770b\u5230\u4e00\u500b\u8cc7\u6599\u5eab\u540c\u6642\u6eff\u8db3 OLTP \u548c OLAP\u3002","title":"Data Warehouse"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#dw","text":"\u6536\u8cbb\u7684 Teradata Vertica SAP HANA ParAccel Amazon Redshift based on ParAccel and PostgreSQL \u958b\u6e90\u7684 SQL-on-Hadoop \u5c08\u6848 Google's Dremel paper Apache Hive Apache Spark Cloudera Impala Facebook Presto Apache Drill","title":"\u4e00\u4e9b DW \u8cc7\u6599\u5eab"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_2","text":"DW \u53ef\u80fd\u7684\u7db1\u76ee\uff08schema\uff09\u8a2d\u8a08\u6709\u5169\u7a2e\uff1a \u661f\u72c0\u7db1\u76ee\uff08star schema\uff09 DW \u7684\u8cc7\u6599\u548c\u5176\u4ed6\u8cc7\u6599\u5eab\u7684\u8cc7\u91cf\u95dc\u7cfb\uff0c\u6a23\u5b50\u5c31\u597d\u50cf\u661f\u661f\u767c\u51fa\u4f86\u7684\u5149\u4e00\u6a23 \u96ea\u82b1\u7db1\u76ee\uff08snowflake schema\uff09 \u8cc7\u6599\u548c\u8cc7\u6599\u7684\u95dc\u4fc2\u5c64\u5c64\u4ea4\u758a","title":"\u7db1\u76ee"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_3","text":"\u4ee5\u66f8\u4e2d\u7bc4\u4f8b\u505a\u4ecb\u7d39\uff1a \u5728\u7d30\u770b\u9019\u4e9b\u8cc7\u6599\u4ee3\u8868\u7684\u610f\u7fa9\u4e4b\u524d\uff0c\u5148\u6ce8\u610f\u5230\u8868\uff08table\uff09\u7684\u524d\u7db4\u8a5e\u6709\u5169\u7a2e\uff1a dim \u5c0d\u8cc7\u6599\u63d0\u4f9b\u7dad\u5ea6\uff08dimension\uff09\u7684\u8868 fact \u5c55\u793a\u6240\u6709\u72c0\u614b\u7684\u8868\uff0c\u4e8b\u5be6\u8868 \u4ee5\u4e0a\u8ff0\u5716\u7247\u70ba\u4f8b\u5b50\uff0c\u7522\u54c1\u3001\u5546\u5e97\u3001\u9867\u5ba2\u3001\u65e5\u671f\u3001\u63a8\u5ee3\u6d3b\u52d5\u7b49\u7b49\u5c31\u662f\u63d0\u9ad8\u4e8b\u5be6\u8868\u7dad\u5ea6\u7684\u8cc7\u6599\u5eab\u3002\u800c fact_sales \u5c31\u662f\u92b7\u552e\u76f8\u95dc\u7684\u4e8b\u5be6\u8868\uff0c\u6216\u8005\u8aaa\u8a72\u8868\u7d00\u9304\u4e86\u6240\u6709\u92b7\u552e\u76f8\u95dc\u7684\u884c\u70ba\uff08\u4e8b\u4ef6\uff09\u3002 \u5118\u7ba1\u6709\u4e9b\u662f\u5c0d\u7167\u5176\u4ed6\u8868\u7684\u5916\u5340\u9375\uff08foreign key\uff09\uff0c\u4f46\u4ecd\u6709\u5f88\u591a\u6b04\u4f4d\u662f\u76f8\u95dc\u884c\u70ba\uff08\u4e8b\u4ef6\uff09\u7684\u5c6c\u6027\uff0c\u4f8b\u5982\uff1a\u8a72\u300c\u9867\u5ba2\u300d\u65bc\u8a72\u300c\u5546\u5e97\u300d\u8cfc\u8cb7\u8a72\u300c\u7522\u54c1\u300d\u7684\u6578\u91cf\u3001\u539f\u50f9\u3001\u552e\u50f9\u7b49\u7b49\u3002\u7531\u6b64\u53ef\u77e5\uff0c\u82e5\u63d0\u4f9b\u7d30\u7bc0\u4fe1\u606f\uff0c\u8a72\u8868\u683c\u5c07\u6703\u6709\u975e\u5e38\u591a\u7684\u6b04\u4f4d\uff0c\u6216\u8005\u8aaa\u5c6c\u6027\uff08property\uff09\uff0c\u751a\u81f3\u53ef\u80fd\u5230\u6578\u767e\u7a2e\u5c6c\u6027\u3002","title":"\u661f\u72c0\u7db1\u76ee"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_4","text":"\u985e\u4f3c\u65bc\u661f\u72c0\u7db1\u76ee\uff0c\u53ea\u662f\u4ed6\u7684\u7dad\u5ea6\u8868\u53ef\u80fd\u6703\u6709\u5f88\u591a\u5c64\uff0c\u4f8b\u5982\uff1a\u300c\u7522\u54c1\u8868\u300d\u53c8\u6703\u6709\u5916\u5340\u9375\u9023\u5230\u300c\u54c1\u724c\u8868\u300d\u548c\u300c\u7a2e\u985e\u8868\u300d\u3002","title":"\u96ea\u82b1\u7db1\u76ee"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_5","text":"\u5927\u90e8\u5206\u8cc7\u6599\u5eab\u9078\u64c7\u4f7f\u7528\u661f\u72c0\u7db1\u76ee\uff0c\u56e0\u70ba\u5176 \u597d\u64f4\u5145\uff0c\u4f8b\u5982\uff1a\u7576\u6709\u65b0\u7684\u7a2e\u985e\uff0c\u5c31\u4e0d\u7528\u540c\u6642\u53bb\u6539\u7a2e\u985e\u8868\u548c\u7522\u54c1\u8868 \u9069\u5408\u58d3\u7e2e\u548c\u512a\u5316\u641c\u5c0b\u901f\u5ea6\uff08\u900f\u904e Bitmap Index\uff09\uff0c\u5f8c\u9762\u6703\u4ecb\u7d39 \u597d\u8abf\u6574\uff0c\u65b0\u589e\u5c6c\u6027\u6642\uff0c\u4e0d\u9700\u8981\u8003\u616e\u653e\u5728\u54ea\u500b\u8868\u6bd4\u8f03\u9069\u5408 \u8f03\u597d\u7406\u89e3\uff0c\u4e0d\u7528\u5c64\u5c64\u5806\u780c\uff0c\u5c64\u5c64\u89e3\u6790","title":"\u6bd4\u8f03"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_6","text":"\u5728\u4e00\u822c OLAP \u4e2d\uff0c\u53ea\u6703\u8b80\u53d6\u90e8\u5206\u6b04\u4f4d\uff0c\u4ee5\u4e0a\u8ff0\u8868\u683c\u70ba\u4f8b\uff1a\u5728\u5047\u65e5\u8cfc\u8cb7\u7279\u5b9a\u7a2e\u985e\u7684\u6578\u91cf\uff1a SELECT dim_date . weekday , dim_product . category , SUM ( fact_sales . quantity ) AS quantity_sold FROM fact_sales JOIN dim_date ON fact_sales . date_key = dim_date . date_key JOIN dim_product ON fact_sales . product_sk = dim_product . product_sk WHERE dim_date . year = 2013 AND dim_product . category IN ( 'Fresh fruit' , 'Candy' ) GROUP BY dim_date . weekday , dim_product . category ; \u7531\u6b64\u4f8b\u53ef\u77e5\uff0c\u5728\u8a72\u7279\u6027\u4e0b\uff0c\u82e5\u6bcf\u6b21\u64cd\u4f5c\u50c5\u62ff\u53d6\u90e8\u5206\u8cc7\u6599\u505a\u904b\u7b97\uff0c\u662f\u5426\u6709\u5fc5\u8981\u505a\u529f\u8b93\u5176\u4ed6\u6b04\u4f4d\u7684\u8cc7\u6599\u4e00\u8d77\u5f9e\u78c1\u789f\uff08disk\uff09\u4e2d\u8b80\u53d6\u51fa\u4f86\uff1f \u5c24\u5176\u662f\u5728\u8cc7\u6599\u91cf\u6709\u597d\u5e7e PB\uff0c\u800c\u6bcf\u4e00\u884c\u53ef\u80fd\u6709\u597d\u5e7e\u767e\u500b\u5c6c\u6027\u6642\uff0c\u9019\u985e\u300c\u5c0f\u7f3a\u9ede\u300d\u5c07\u6703\u88ab\u653e\u5927\u3002 \u5217\u5f0f\u8cc7\u6599\u5eab\uff08column-oriented storage\uff09\u7684\u6982\u5ff5\u5c31\u662f\u7531\u6b64\u800c\u751f\uff0c\u6211\u4e0d\u4ee5\u6bcf\u5217\u70ba\u55ae\u4f4d\u505a\u5132\u5b58\uff0c\u800c\u662f\u6539\u70ba\u6bcf\u6b04\u70ba\u55ae\u4f4d\u3002\u9019\u6a23\u5728\u8b80\u53d6\u6642\uff0c\u5c31\u53ea\u9700\u8981\u8b80\u53d6\u5c11\u90e8\u5206\u7684\u8cc7\u6599\u3002 \u4e26\u975e\u53ea\u6709\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u9069\u5408\u505a\u5217\u5f0f\u8cc7\u6599\u5eab\uff0c\u50c5\u50c5\u56e0\u70ba\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u5728\u8b1b\u89e3\u4e0a\u662f\u6700\u597d\u7406\u89e3\u7684\u3002 Parquet \u5c31\u662f\u4e00\u500b\u4ee5 Google's Dremel paper \u70ba\u57fa\u790e\u7684\u6587\u4ef6\u5f0f\u8cc7\u6599\u5eab\u3002 \u9019\u540c\u6642\u4e5f\u4ee3\u8868\uff0c\u6bcf\u4e00\u6b04\u4f4d\u90fd\u9700\u8981\u64c1\u6709\u76f8\u540c\u9806\u5e8f\u548c\u6578\u91cf\u7684\u884c\u4f4d\uff0c\u800c\u9019\u689d\u4ef6\u5728 OLAP \u662f\u7b26\u5408\u7684\uff0c\u56e0\u70ba\u5176\u4e0d\u6703\u522a\u9664\u4efb\u4e00\u884c\u8cc7\u6599\u3002","title":"\u5217\u5f0f\u8cc7\u6599\u5eab"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_7","text":"\u597d\u7684\u8cc7\u6599\u58d3\u7e2e\uff0c\u53ef\u4ee5\u964d\u4f4e\u5728\u8b80\u53d6\u6d77\u91cf\u8cc7\u6599\u7684\u6642\u9593\uff0c\u800c OLAP \u9084\u6709\u500b\u7279\u6027\uff0c\u5c31\u662f\u6b04\u4f4d\u53ef\u80fd\u7684\u503c\u662f\u6709\u9650\u7684\u3002\u4f8b\u5982\uff1a\u7522\u54c1\u6578\u91cf\u53ef\u80fd\u53ea\u6709\u6578\u842c\u6216\u6578\u5341\u842c\u500b\uff0c\u4f46\u662f\u8cfc\u7269\u64cd\u4f5c\u537b\u53ef\u80fd\u6bcf\u5e74\u6709\u597d\u5e7e\u5104\u7b46\u3002 \u56e0\u6b64\uff0c\u4ee5\u64cd\u4f5c\u70ba\u6b04\uff0c\u7522\u54c1\u7de8\u865f\u70ba\u5217\uff0c\u53ef\u5f97\u4e0b\u8868\uff1a \u7522\u54c1\u7de8\u865f \u64cd\u4f5c 1 \u64cd\u4f5c 2 \u64cd\u4f5c 3 ... 1 1 0 1 ... 2 0 1 0 ... 3 0 0 0 ... ... - - - ... \u5176\u610f\u7fa9\u4ee3\u8868\uff1a \u64cd\u4f5c 1 \u8cfc\u8cb7 \u7522\u54c1 1 \u64cd\u4f5c 2 \u8cfc\u8cb7 \u7522\u54c1 2 \u64cd\u4f5c 3 \u8cfc\u8cb7 \u7522\u54c1 1 ... \u6b64\u6642\u4e26\u4e0d\u80fd\u58d3\u7e2e\u8cc7\u6599\uff0c\u4e8b\u5be6\u4e0a\uff0c\u4ed6\u53ea\u662f\u628a\u5404\u64cd\u4f5c\u7684\u5404\u7522\u54c1\u7de8\u865f\uff0c\u5c55\u958b\u6210\u4e8c\u9032\u4f4d\u800c\u5df2\u3002\u4e5f\u5c31\u662f\uff0c\u4f4d\u5143\u6620\u5c04\uff08 bitmap encoding \uff09\u3002\u7136\u800c\uff0c\u56e0\u70ba OLAP \u7684\u7279\u6027\u8b93\u6bcf\u5217\u6709\u591a\u500b\u70ba 0 \u7684\u6b04\u4f4d\uff0c\u6b64\u6642\u5c31\u53ef\u4ee5\u900f\u904e\u57f7\u884c\u9577\u5ea6\u7de8\u78bc\uff08 run-length encoded \uff09\u9032\u884c\u58d3\u7e2e\u3002 \u800c\u5c55\u958b\u6210\u4e8c\u9032\u4f4d\u7684\u683c\u5f0f\uff0c\u4e0d\u6b62\u5229\u65bc\u58d3\u7e2e\uff0c\u5728\u8a08\u7b97\u6642\uff0c\u4e5f\u53ef\u4ee5\u55ae\u7d14\u900f\u904e OR AND \u53bb\u505a\u8a08\u7b97\u3002\u4f8b\u5982\uff1a WHERE product_sk IN ( 30 , 68 , 69 ) \u6211\u5011\u8b80\u53d6\u7522\u54c1\u7684\u4f4d\u5143\u6620\u5c04\u8868\u4e2d\u7684\u7b2c 30 \uff0c 68 \u548c 69 \u884c\uff0c\u7136\u5f8c\u62ff\u51fa\u4e09\u6bb5\u4f4d\u5143\u5411\u91cf\uff08bit vector\uff09\u505a\u4f4d\u5143\u9593\u7684 OR \u904b\u7b97\u3002 WHERE product_sk = 31 AND store_sk = 3 \u6211\u5011\u8b80\u53d6\u4f4d\u7522\u54c1\u7684\u5143\u6620\u5c04\u8868\u4e2d\u7684\u7b2c 31 \u884c\uff0c\u7136\u5f8c\u8b80\u53d6\u5546\u5e97\u7684\u5143\u6620\u5c04\u8868\u4e2d\u7684\u7b2c 3 \u884c\u505a\u4f4d\u5143\u9593\u7684 AND \u904b\u7b97\u3002 \u9019\u985e\u64cd\u4f5c\u4e4b\u6240\u4ee5\u53ef\u4ee5\u904b\u4f5c\uff0c\u5c31\u662f\u56e0\u70ba\u6211\u5011\u5728\u5132\u5b58\u6b04\u4f4d\u6642\uff0c\u540c\u6b65\u6240\u6709\u5217\u7684\u6578\u91cf\u548c\u9806\u5e8f\u3002 \u82e5\u9700\u8981\u67e5\u770b\u66f4\u591a\u58d3\u7e2e\u7684\u6f14\u7b97\u6cd5\uff0c\u53ef\u4ee5\u67e5\u770b The Design and Implementation of Modern Column-Oriented Database Systems. Ct4-2 \u3002 Column Family \u548c Column Oriented \u662f\u4e0d\u540c\u7684\u6982\u5ff5\uff0c\u5176\u88ab\u61c9\u7528\u65bc\u57fa\u65bc Bigtable \u67b6\u69cb\u7684\u8cc7\u6599\u5eab Cassandra \u548c HBase \u4e2d\u3002\u5176\u539f\u7406\u662f\u628a\u90e8\u5206\u5217\uff08column\uff09\u5f9e\u884c\uff08row\uff09\u4e2d\u62c9\u51fa\u6574\u5408\u6210\u4e00\u500b\u55ae\u4f4d\uff0c\u985e\u4f3c\u65bc\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u7684\u8868\uff08table\uff09\uff0c\u4e26\u4e14\u4e0d\u6703\u5c0d\u9019\u55ae\u4f4d\u9032\u884c\u5217\u58d3\u7e2e\uff08 column compression \uff09\uff0c\u56e0\u6b64\u8a72\u6a21\u578b\u4ecd\u4e3b\u8981\u662f\u4ee5\u884c\u5f0f\u8cc7\u6599\u5eab\uff08row-oriented\uff09\u70ba\u4e3b\u3002","title":"\u58d3\u7e2e"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_8","text":"\u7576\u9032\u884c\u904b\u7b97\u548c\u5206\u6790\u6642\uff0c\u7cfb\u7d71\u5fc5\u9808\u5f9e\u786c\u9ad4\u78c1\u789f\uff08disk\uff09\u4e2d\u8b80\u53d6\u8cc7\u6599\u4e26\u5b58\u9032\u8a18\u61b6\u9ad4\uff08memory\uff09\u4e2d\u3002\u9664\u4e86\u9019\u4e00\u6bb5\u7684\u983b\u5bec\u9700\u8981\u8003\u91cf\u5916\uff0c\u9084\u9700\u8981\u8003\u91cf\u8a18\u61b6\u9ad4\u9032\u5165 CPU \u5feb\u53d6\u4e2d\u7684\u983b\u5bec\u3002\u5728\u57f7\u884c\u9019\u4e9b\u884c\u70ba\u7684\u8a0a\u865f\u6642\uff0c\u76e1\u53ef\u80fd\u907f\u514d\u5feb\u53d6\u5c64\u7d1a\u7684\u8aa4\u5224\u548c\u6574\u5408\u9032\u55ae\u4e00 CPU \u904b\u884c\u7684\u5927\u5c0f\uff08page size\uff09\uff0c\u4e26\u4f7f\u7528\u73fe\u4ee3 CPU \u4e2d\u7684 SIMD\uff08single-instruction-multi-data\uff09 \u6307\u4ee4\u3002 \u6307\u4ee4 1/1,000,000,000 \u79d2 = 1 \u5948\u79d2 \u8b80\u53d6\u7b2c\u4e00\u5c64\u5feb\u53d6 0.5 ns \u5feb\u53d6\u5c64\u7d1a\u8aa4\u5224 5 ns \u8b80\u53d6\u7b2c\u4e8c\u5c64\u5feb\u53d6 7 ns \u4e92\u65a5\u9396\u7684\u52a0\u9396\u548c\u89e3\u9396 25 ns \u8b80\u53d6\u4e3b\u8a18\u61b6\u9ad4 100 ns \u5728 1Gbps \u7684\u7db2\u8def\u9001\u51fa 2KB \u7684\u8cc7\u6599 20,000 ns \u5f9e\u4e3b\u8a18\u61b6\u9ad4\u4e2d\u8b80\u53d6 1MB \u7684\u9023\u7e8c\u8cc7\u6599 250,000 ns \u53d6\u5f97\u78c1\u789f\u4e2d\u7684\u65b0\u4f4d\u7f6e\uff08\u9700\u8981\u641c\u5c0b\uff09 8,000,000 ns \u5f9e\u78c1\u789f\u4e2d\u8b80\u53d6 1MB \u7684\u9023\u7e8c\u8cc7\u6599 20,000,000 ns \u8b93\u4e00\u500b\u5c01\u5305\u5f9e\u7f8e\u570b\u5230\u6b50\u6d32\u4f86\u56de 150 ms = 150,000,000 ns \u53c3\u8003\uff1ahttps://hackmd.io/ysFkocN0RreKgzJk_7B-0g?view \u9664\u4e86\u76e1\u53ef\u80fd\u6e1b\u5c11\u62c9\u53d6\u7684\u8cc7\u6599\uff0c\u6bcf\u6b21\u62c9\u53d6\u6642\u4e5f\u9808\u6709\u6548\u7684\u914d\u5408 CPU \u7684\u9031\u671f\u3002\u4f8b\u5982\uff0c\u641c\u5c0b\u5f15\u64ce\u6703\u628a\u58d3\u7e2e\u5f8c\u7684\u5217\u5f0f\u8cc7\u6599\u5206\u6210\u597d\u5e7e\u6bb5\uff08chunk\uff09\uff0c\u4e26\u6301\u7e8c\u4e14\u7dca\u5bc6\u5730\uff08\u4e5f\u5c31\u662f\u904e\u7a0b\u4e2d\u4e0d\u547c\u53eb\u4efb\u4f55\u51fd\u793a\uff0c\u907f\u514d function call/jump\uff09\u653e\u9032 CPU \u7b2c\u4e00\u5c64\u5feb\u53d6\u4e2d\u3002\u9664\u6b64\u4e4b\u5916\u6bcf\u4e00\u6bb5\uff08chunk\uff09\u5f7c\u6b64\u9593\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u96fb\u6676\u9ad4\u53bb\u57f7\u884c AND \u6216 OR \u7b49\u908f\u8f2f\u904b\u7b97\u3002 \u9019\u4e00\u7cfb\u5217\u7684\u6280\u5de7\u7a31\u70ba\u5411\u91cf\u8655\u7406\uff08vectorized processing\uff09\u3002","title":"\u786c\u9ad4\u9762\u512a\u5316"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_9","text":"\u628a\u8cc7\u6599\u7d93\u904e\u6392\u5e8f\u5f8c\u518d\u5132\u5b58\u9664\u4e86\u52a0\u901f\u641c\u5c0b\u4e5f\u53ef\u4ee5\u8b93\u9577\u5ea6\u7de8\u78bc\uff08run-length encoded\uff09\u66f4\u7dca\u5bc6\u3002\u4f8b\u5982 00001000100 \u6392\u5e8f\u5f8c\u8b8a\u6210 1,2,0,9 \u3002 \u53ef\u4ee5\u900f\u904e\u4e4b\u524d\u63d0\u904e\u7684 SSTable \u4f86\u505a\u6392\u5e8f\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u96d6\u7136\u662f\u628a\u6bcf\u5217\u4f5c\u70ba\u5132\u5b58\u55ae\u4f4d\uff0c\u5728\u6392\u5e8f\u6642\u4ecd\u8981\u8b93\u8a72\u884c\u7684\u5404\u5217\u8cc7\u6599\u540c\u6642\u4fdd\u6301\u76f8\u540c\u9806\u5e8f\u3002 \u4f46\u662f\uff0c\u6392\u5e8f\u7684\u6548\u679c\u50c5\u5728\u505a\u7b2c\u4e00\u7d44\u8cc7\u6599\u6392\u5e8f\u6700\u6709\u6548\uff0c\u4f8b\u5982\uff1a \u82e5\u767c\u73fe\u5e38\u5e38\u4f7f\u7528\u65e5\u671f\u55ae\u4f4d\u505a\u641c\u5c0b\uff0c\u5982\u6bcf\u6708\u7684\u8cfc\u8cb7\u7522\u54c1\u7e3d\u6578\uff0c\u5247\u53ef\u4ee5\u4f7f\u7528 date_key \u3002\u4f46\u662f\u5c0d\u65bc\u4ee5\u7522\u54c1\u70ba\u5e95\u7684\u641c\u5c0b\uff0c\u5982\u8cfc\u8cb7\u8a72\u7522\u54c1\u7684\u6703\u54e1\u5e74\u9f61\u5c31\u6c92\u6709\u4f7f\u7528\u5230\u6392\u5e8f\u7684\u597d\u8655\u3002\u9019\u6642\u5c31\u767c\u5c55\u51fa\u65b0\u7684\u5c0f\u6280\u5de7\u3002\u4f8b\u5982 Vertica \u7684\u8cc7\u6599\u5eab\uff1a \u53cd\u6b63\u8cc7\u6599\u90fd\u8981\u505a\u5099\u4efd\uff08\u548c HA\uff09\u8907\u88fd\u5230\u5404\u6a5f\u5668\uff0c\u4f60\u5c31\u53ef\u4ee5\u628a\u5404\u6a5f\u5668\u7684\u8cc7\u6599\u505a\u4e0d\u540c\u65b9\u5f0f\u53bb\u5132\u5b58\u3002\u4f8b\u5982\u8cc7\u6599\u5eab A \u4ee5\u65e5\u671f\u4f5c\u70ba sort key \uff0c\u8cc7\u6599\u5eab B \u4ee5\u7522\u54c1\u4f5c\u70ba sort key \u3002 \u53ef\u4ee5\u60f3\u50cf\u5176\u548c\u884c\u5f0f\u8cc7\u6599\u5eab\u7684\u591a\u7d22\u5f15\u7684\u5dee\u7570\u3002\u884c\u5f0f\u8cc7\u6599\u5eab\u5728\u591a\u7d22\u5f15\u4e2d\uff0c\u5e38\u5e38\u6703\u5728\u7d22\u5f15\u4e2d\u5132\u5b58\u6a94\u6848\u7684\u4f86\u6e90\uff0c\u4f8b\u5982 heap file \u7b49\u7b49 \u3002\u800c\u5217\u5f0f\u8cc7\u6599\u5eab\u5247\u76f4\u63a5\u5132\u5b58\u8cc7\u6599","title":"\u6392\u5e8f"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_10","text":"\u641c\u5c0b\u6642\uff0c\u5e38\u5e38\u6703\u7528\u5230\u805a\u5408\uff08aggregation\uff09\u8cc7\u6599\uff0c\u4f8b\u5982\u7e3d\u6578\uff08sum\uff09\u3001\u5e73\u5747\uff08avg\uff09\u7b49\u7b49\u3002\u800c\u9019\u985e\u64cd\u4f5c\u5e38\u5e38\u90fd\u9700\u8981\u904d\u6b77\u8cc7\u6599\u5eab\uff0c\u65e2\u7136\u9019\u4e9b\u8cc7\u6599\u5f88\u8017\u6642\u53c8\u9700\u8981\u5e38\u5e38\u7528\u5230\uff0c\u5c31\u66ab\u5b58\u4ed6\u5427\u3002\u9019\u985e\u66ab\u5b58\u5f8c\u7684\u805a\u5408\u8cc7\u6599\uff0c\u7a31\u70ba\u7269\u5316\u805a\u5408\uff08materialized aggregates\uff09\uff0c\u800c\u5c55\u793a\u9019\u985e\u8cc7\u6599\u7684\u5716\u6216\u8868\uff08table\uff09\u7a31\u70ba\u7269\u5316\u8996\u5716\uff08materialized view\uff09\u3002 \u7269\u5316\u8996\u5716\u548c\u95dc\u9023\u5f0f\u8cc7\u6599\u5eab\u5e38\u898b\u7684\u6a19\u6e96\u8996\u5716\uff08standard/virtual view\uff09\u6709\u6240\u5dee\u7570\uff0c\u6a19\u6e96\u8996\u5716\u53ea\u662f\u628a\u67e5\u8a62\u8a18\u9304\u6574\u5408\u5728\u4e00\u8d77\uff0c\u7576\u88ab\u4f7f\u7528\u6642\uff0c\u4ecd\u7136\u6703\u57f7\u884c\u5176\u4e2d\u4e00\u7cfb\u5217\u7684\u67e5\u8a62\u3002 \u5716\u4e2d\u5c55\u793a\uff0c\u4e8c\u7dad\u8cc7\u6599\u5728\u505a\u7269\u5316\u6574\u5408\u6642\u7684\u65b9\u5f0f\u3002\u6bcf\u4e00\u500b\u55ae\u5143\uff08cell\uff09\u5132\u5b58\u67d0\u4e00\u5929\u7684\u67d0\u4e00\u500b\u7522\u54c1\u92b7\u552e\u7e3d\u984d\uff0c\u884c\u5c3e\u5132\u5b58\u67d0\u4e00\u5929\u7684\u6240\u6709\u7522\u54c1\u92b7\u552e\u7e3d\u984d\uff0c\u5217\u5c3e\u5132\u5b58\u67d0\u4e00\u7522\u54c1\u7684\u6240\u6709\u92b7\u552e\u7e3d\u984d\u3002 \u7576\u7136\uff0c\u8cc7\u6599\u66f4\u53ef\u80fd\u88ab\u9032\u884c\u591a\u7dad\u5ea6\u7684\u5132\u5b58\uff0c\u4f8b\u5982\u8cfc\u7269\u8005\u7684\u5e74\u9f61\u7b49\u7b49\u3002","title":"\u66ab\u5b58\u805a\u5408"},{"location":"feedback/designing-data-intensive-applications/analytic-db/#_11","text":"\u4e0a\u8ff0\u63d0\u5230\u7684\u58d3\u7e2e\u3001\u786c\u9ad4\u512a\u5316\u3001\u6392\u5e8f\u3001\u66ab\u5b58\u805a\u5408\u90fd\u662f\u5728\u63d0\u9ad8\u8b80\u53d6\u6548\u7387\uff0c\u96d6\u7136\u9019\u5be6\u969b\u5c31\u662f\u8cc7\u6599\u5132\u5009\u5927\u90e8\u5206\u7684\u696d\u52d9\u9700\u6c42\uff0c\u4f46\u5728\u5f9e\u5404\u500b\u5b50\u8cc7\u6599\u5eab\u4e2d\u62c9\u53d6\u8cc7\u6599\u6642\u4ecd\u9700\u8981\u5beb\u5165\u3002\u8a72\u600e\u9ebc\u505a\u5230\u6709\u6548\u7684\u5beb\u5165\u5462\uff1f \u53ef\u4ee5\u900f\u904e\u5148\u524d\u63d0\u5230\u7684 LSM-Tree \uff0c\u5206\u6210\u78c1\u789f\u4e0a\u7684\u8cc7\u6599\u548c\u8a18\u61b6\u9ad4\u4e2d\u7684\u8cc7\u6599\uff0c\u8a18\u61b6\u9ad4\u7684\u8cc7\u6599\u65b9\u4fbf\u505a\u6392\u5e8f\u548c\u63d2\u5165\u3002\u7576\u8a18\u61b6\u9ad4\u9054\u5230\u4e00\u5b9a\u5927\u5c0f\u5f8c\uff0c\u5beb\u5165\u78c1\u789f\u4e2d\u3002\u800c\u78c1\u789f\u4e2d\u7684\u8cc7\u6599\u5b9a\u671f\u505a\u6574\u5408\u548c\u58d3\u7e2e\u3002 Vertica \u7684\u8cc7\u6599\u5eab\u4fbf\u662f\u4f9d\u6b64\u65b9\u5f0f\u3002 \u5f9e\u9019\u4e5f\u53ef\u4ee5\u770b\u5230 LSM-Tree \u5c0d\u65bc\u8cc7\u6599\u5eab\u7684\u6f14\u7b97\u6cd5\u6709\u5f88\u91cd\u5927\u7684\u5f71\u97ff\u3002","title":"\u5beb\u5165"},{"location":"feedback/designing-data-intensive-applications/data-model/","text":"\u56db\u7a2e\u8cc7\u6599\u5eab\u7d50\u69cb Relational model Document model Graph-like model Triple-stores \u4e00\u958b\u59cb\u8cc7\u6599\u5132\u5b58\u50c5\u4ee5 Hierarchical Tree \u7684\u5f62\u5f0f\u5132\u5b58\u8cc7\u6599\uff0c\u4f46\u662f\u7576\u9700\u8981\u8003\u616e\u5230\u591a\u5c0d\u591a\uff08many-to-many\uff09\u7684\u95dc\u4fc2\u6642\uff0c\u5c31\u958b\u59cb\u51fa\u73fe\u56f0\u5883\u3002\u5229\u5982\uff1a post \u5c0d\u61c9 tag \uff0c\u7576\u628a tag \u5132\u5b58\u9032 post \u8cc7\u6599\u6642\uff0c\u5982\u679c\u8981\u627e\u7279\u5b9a tag \u54ea\u4e9b post \u6301\u6709\uff1f \u9019\u6642\u4fbf\u51fa\u73fe Relational model\uff0c\u7136\u800c\u6709\u4e9b\u60c5\u5883\u537b\u4e0d\u592a\u9069\u5408\u4f7f\u7528\u8a72\u6a21\u578b\uff0c\u5f9e\u800c\u767c\u5c55\u51fa\u300cNoSQL\u300d\uff1a Document model \u5132\u5b58\u7d50\u69cb\u9ad8\u8b8a\u52d5\u4e14 document \u548c document \u4e4b\u9593\u9023\u7d50\u8f03\u5c11\u7684\u6a21\u578b\u3002\u4f8b\u5982\uff1a\u5de5\u4f5c\u985e\u578b\u3002 Graph model \u548c Document model \u8d70\u7684\u65b9\u5411\u76f8\u53cd\uff0c\u9069\u5408\u6240\u6709\u8cc7\u6599\u90fd\u80fd\u548c\u4efb\u4f55\u5176\u4ed6\u8cc7\u6599\u6709\u6240\u9023\u7d50\u7684\u6a21\u578b\u3002\u4f8b\u5982\uff1a\u4eba\u969b\u95dc\u4fc2\u3002 Relational vs Document \u5132\u5b58\u8cc7\u6599\u65b9\u5f0f one-to-many many-to-many one-to-one one-to-many Document \u5132\u5b58\u968e\u5c64\u5f0f\u7d50\u69cb\u9032\u7bc0\u9ede\u800c\u975e\u53e6\u5916\u958b\u4e00\u500b\u8868\u55ae post -> comment1 -> comment2 -> comment3 Relational \u95dc\u4fc2\u5957\u7528\u81f3\u5404\u500b\u8868\u55ae post -> comment_id1 -> comment_id2 -> comment_id3 many-to-many Document base \u5728\u9019\u88e1\u8f03\u5403\u8667\uff0c\u56e0\u70ba\u9700\u8981\u624b\u52d5\u505a\u9023\u7d50\u3002 \u53cd\u4e4b\uff0c Relational based \u53ef\u4ee5\u900f\u904e join \u628a\u8907\u96dc\u5ea6\u4ea4\u7d66\u8cc7\u6599\u5eab\u8655\u7406 post1 -> tag1 -> tag2 post2 -> tag1 -> tag3 \u82e5\u95dc\u4fc2\u5f88\u8907\u96dc\uff0c\u4f8b\u5982\u4eba\u969b\u95dc\u4fc2\u3001\u9053\u8def\u9593\u63a5\u89f8\u7684\u7db2\u7d61\uff1a graph 1[user 1] -- known --> 2[user 2] 1 -- known --> 3[user 3] 2 -- known --> 4[user 4] 3 -- known --> 4 2 -- known --> 3 1 -- known --> 4 \u50c5\u6709 4 \u500b\u4eba\u5c31\u6709 6 x 2\uff08\u96d9\u5411\u4ee3\u8868\u5f7c\u6b64\u8a8d\u8b58\u3001\u55ae\u5411\u4ee3\u8868 A \u77e5\u9053 B\uff09\u689d\u7dda\uff0c\u82e5\u662f\u540c\u6a23\u4f7f\u7528 Relational based \u6703\u8b93\u8cc7\u6599\u6578\u91cf\u8b8a\u6210\u975e\u5e38\u5de8\u5927\uff0c\u9019\u6642\u5019\u5c31\u53ef\u4ee5\u4f7f\u7528 Graph-like model one-to-one Document base is similar to Relational based post -> post_detail \u5176\u4ed6\u6bd4\u8f03 Schema Document based \u5f88\u597d\u66f4\u65b0\uff0c\u4e14\u80fd\u964d\u4f4e\u628a\u5404\u500b\u8cc7\u8a0a\u5206\u958b\u653e\uff08\u591a\u500b table\uff09\u6240\u9020\u6210\u7684\u8907\u96dc\u5ea6\u3002 \u7136\u800c\u9019\u4e26\u4e0d\u4ee3\u8868 NoSQL \u4e0d\u9700\u8981 Schema\u3002\u4e8b\u5be6\u4e0a\uff0c\u6240\u6709\u985e\u578b\u7684\u8cc7\u6599\u5132\u5b58\u90fd\u9700\u8981\u4e00\u5b9a\u7684\u898f\u5247\uff0c\u53ea\u662f\u6709\u5340\u5206\u986f\u6027\uff08implicit\uff09\u6216\u96b1\u6027\uff08implicit\uff09\u3002 \u986f\u6027\u4ee3\u8868\u5728 write \u7684\u6642\u5019\u5fc5\u9808\u9075\u5b88\u8a72\u898f\u5247 \u96b1\u6027\u4ee3\u8868\u5728 read \u7684\u6642\u5019\u9810\u671f\u8a72\u8cc7\u6599\u6709\u7279\u5b9a\u7684 property \u7372\u5f97\u7279\u5b9a\u8cc7\u6599 Document based \u6c92\u8fa6\u6cd5\u53ea\u53d6\u5f97\u7279\u5b9a\u968e\u5c64\u7684\u8cc7\u6599\uff0c\u5fc5\u9808\u5b8c\u6574\u53d6\u5f97\u5f8c\u628a\u7279\u5b9a\u8cc7\u6599\u9078\u51fa\u4f86\uff0c\u4f8b\u5982\uff1a \u627e\u5230\u7279\u5b9a\u5de5\u4f5c\u7684\u5e73\u5747\u85aa\u8cc7\uff0cDocument based \u9700\u8981\u628a\u8cc7\u6599\u90fd\u8b80\u51fa\u4f86\u518d\u7be9\u9078 user -> job -> salary -> hours Relational based \u7684\u8cc7\u6599\u6703\u9577\u9019\u6a23 user -> job_id job_id -> salary -> hours Query \u8a9e\u6cd5 [ { \"observated_at\" : \"Mon, 25 Dec 1995 12:34:56 GMT\" , \"family\" : \"Sharks\" , \"species\" : \"Carcharodon carcharias\" , \"num\" : 3 }, { \"observated_at\" : \"Tue, 12 Dec 1995 16:17:18 GMT\" , \"family\" : \"Sharks\" , \"species\" : \"Carcharias taurus\" , \"num\" : 4 } ] SQL \u5ba3\u544a\u5f0f\u8a9e\u6cd5 SELECT date_trunc ( 'month' , observated_at ) AS month , sum ( num ) AS total FROM observations WHERE family = 'Sharks' GROUP BY month ; MapReduce \u547d\u4ee4\u5217\u5f0f\u8a9e\u6cd5 db . observations . mapReduce ( function map () { var year = this . observated_at . getFullYear (); var month = this . observated_at . getMonth () + 1 ; emit ( year + \"-\" + month , this . num ); }, function reduce ( key , values ) { return Array . sum ( values ); }, { query : { family : \"Sharks\" }, out : \"monthlySharkReport\" , } ); MongoDB\u2019s aggregation pipeline \u4e0a\u8ff0\u5169\u8005\u4e2d\u9593 db . observations . aggregate ([ { $match : { family : \"Sharks\" } }, { $group : { _id : { year : { $year : \"observated_at\" }, month : { $month : \"observated_at\" }, }, totalAnimals : { $sum : \"num\" }, }, }, ]); \u5176\u4ed6\u8a9e\u6cd5\u985e\u578b\u5728\u4e0b\u9762\u4ecb\u7d39 Graph-like model \u5f8c\u8a0e\u8ad6\u3002 Graph-like model \u4e0a\u8ff0\u63d0\u5230 \u7684\u4eba\u969b\u95dc\u4fc2\uff0c\u6bcf\u500b\u9ede\u90fd\u4ee3\u8868\u540c\u985e\u578b\u7684\u8cc7\u6599\uff1a\u4eba\u3002\u4f46\u662f\u6b64\u6a21\u578b\u4e0d\u50c5\u53ef\u7d00\u9304\u985e\u578b\u76f8\u540c\u7684\u8cc7\u6599\uff0c\u4f8b\u5982 Facebook \u5c31\u628a\u8a31\u591a\u4e0d\u540c\u985e\u578b\u7684\u8cc7\u6599\u8a18\u9304\u5728 \u540c\u4e00\u5f35\u5927\u8868 \uff1a \u9ede\uff1a \u4eba \u4f4d\u7f6e \u767c\u6587 \u4e8b\u4ef6 \u6253\u5361 \u4f7f\u7528\u8005\u7559\u8a00 \u7dda\uff1a \u4eba\u548c\u4eba\u4e4b\u9593\u7684\u95dc\u4fc2 \u6253\u5361\u7684\u4f4d\u7f6e \u8ab0\u7559\u8a00\u54ea\u7bc7\u767c\u6587 \u8ab0\u53c3\u52a0\u54ea\u500b\u4e8b\u4ef6 \u5efa\u7acb Graph-like model \u5efa\u7acb\u4e00\u500b Graph-like model \u4e26\u4ee5 Relational based model \u7684 schema \u70ba\u8aaa\u660e\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a CREATE TABLE vertices ( vertex_id integer PRIMARY KEY , properties json ); CREATE TABLE edges ( edge_id integer PRIMARY KEY , tail_vertex integer REFERENCES vertices ( vertex_id ), head_vertex integer REFERENCES vertices ( vertex_id ), label text , properties json ); CREATE INDEX edges_tails ON edges ( tail_vertex ); CREATE INDEX edges_heads ON edges ( head_vertex ); \u4ee5 Neo4j \u9019\u500b\u8cc7\u6599\u5eab\u70ba\u4f8b\uff0c\u5efa\u7acb\u4e0b\u5716\u7684\u95dc\u4fc2\u7db2\u7d61\u9700\u8981\uff1a CREATE ( NAmerica : Location { name : ' North America ' , type : ' continent ' }), ( us : Location { name : ' United States ' , type : ' country ' }), ( Idaho : Location { name : ' Idaho ' , type : ' state ' }), ( Lucy : Person { name : ' Lucy ' }), ( Idaho ) -[ : WITHIN ]-> ( USA ) -[ : WITHIN ]-> ( NAmerica ), ( Lucy ) -[ : BORN_IN ]-> ( Idaho ) Cypher \u662f Neo4j \u4f7f\u7528\u7684\u5ba3\u544a\u5f0f\u8a9e\u8a00\uff0c\u548c\u5bc6\u78bc\u5b78\u7684 cipher/cypher \u6c92\u95dc\u4fc2 query \u73fe\u5728\u82e5\u8981\u627e\u300c\u6240\u6709\u5f9e\u7f8e\u570b\u79fb\u6c11\u5230\u6b50\u6d32\u7684\u4eba\u7684\u540d\u5b57\u300d\u9019\u8cc7\u6599\u5c31\u53ef\u4ee5\u4e0b\u76f8\u95dc query\uff1a MATCH ( person ) -[ : BORN_IN ]-> () -[ : WITHIN * 0 .. ]-> ( us : Location { name : ' United States ' }), ( person ) -[ : LIVES_IN ]-> () -[ : WITHIN * 0 .. ]-> ( eu : Location { name : ' Europe ' }) RETURN person . name \u5982\u540c Relational based model \u4e00\u6a23\uff0c\u4e0b\u5b8c\u8a72\u8a9e\u6cd5\u5f8c\uff0c\u8cc7\u6599\u5eab\u6703\u81ea\u884c\u5224\u65b7\u8a72\u7528\u4f55\u7a2e\u6f14\u7b97\u6cd5\u53bb\u57f7\u884c\u641c\u5c0b\uff0c\u53ef\u80fd\u5f9e persion \u5f80 location \u627e\uff0c\u4e5f\u53ef\u80fd\u76f8\u53cd\u3002 \u4ee5 Relational based \u7684\u65b9\u5f0f\u5efa\u7acb Graph-like model PostgreSQL WITH RECURSIVE -- in_usa is the set of vertex IDs of all locations within the United States in_usa ( vertex_id ) AS ( SELECT vertex_id FROM vertices WHERE properties ->> 'name' = 'United States' UNION SELECT edges . tail_vertex FROM edges JOIN in_usa ON edges . head_vertex = in_usa . vertex_id WHERE edges . label = 'within' ), -- in_europe is the set of vertex IDs of all locations within Europe in_europe ( vertex_id ) AS ( SELECT vertex_id FROM vertices WHERE properties ->> 'name' = 'Europe' UNION SELECT edges . tail_vertex FROM edges JOIN in_europe ON edges . head_vertex = in_europe . vertex_id WHERE edges . label = 'within' ), -- born_in_usa is the set of vertex IDs of all people born in the US born_in_usa ( vertex_id ) AS ( SELECT edges . tail_vertex FROM edges JOIN in_usa ON edges . head_vertex = in_usa . vertex_id WHERE edges . label = 'born_in' ), -- lives_in_europe is the set of vertex IDs of all people living in Europe lives_in_europe ( vertex_id ) AS ( SELECT edges . tail_vertex FROM edges JOIN in_europe ON edges . head_vertex = in_europe . vertex_id WHERE edges . label = 'lives_in' ) SELECT vertices . properties ->> 'name' FROM vertices -- join to find those people who were both born in the US *and* live in Europe JOIN born_in_usa ON vertices . vertex_id = born_in_usa . vertex_id JOIN lives_in_europe ON vertices . vertex_id = lives_in_europe . vertex_id ; Triple-store \u6bcf\u6b21\u5132\u5b58\u7684 row \u50c5\u6709\u4e09\u500b\u503c\uff1a subject - \u4e3b\u8a5e predicate - \u52d5\u8a5e\u3001\u8ff0\u8a9e object - \u5b9a\u503c\u6216\u662f\u53e6\u4e00\u500b subject \u4f8b\u5982\uff1a \u5c0f\u660e - \u5e74\u9f61 - \u5341\u516b \u5c0f\u660e - \u559c\u6b61 - \u5c0f\u7f8e \u7531\u4e0a\u7bc4\u4f8b\u53ef\u77e5\uff0c\u5176\u5be6\u5979\u5f88\u985e\u4f3c Graph-like\u3002 Turtle triples @prefix : <urn:example:>. _:lucy a :Person. _:lucy :name \"Lucy\". _:lucy :bornIn _:idaho. _:idaho a :Location. _:idaho :name \"Idaho\". _:idaho :type \"state\". _:idaho :within _:usa. _:usa a :Location. _:usa :name \"United States\". _:usa :type \"country\". _:usa :within _:namerica. _:namerica a :Location. _:namerica :name \"North America\". _:namerica :type \"continent\". _ \u958b\u982d\u7684\u90fd\u662f subject Dataomic \u5c31\u662f\u4f7f\u7528\u6b64\u6a21\u578b\u3002 query SPARQL\uff08sparkle\uff09\uff0c \u53ef\u4ee5\u5230\u9ad8\u96c4\u5e02\u8cc7\u6599\u5e73\u53f0\u73a9\u73a9\u770b PREFIX : <urn:example:> SELECT ?personName WHERE { ?person : name ?personName . ?person : bornIn / : within * / : name \"United States\" . ?person : livesIn / : within * / : name \"Europe\" . } \u4e0a\u8ff0\u63d0\u5230\u7684 Cypher \u4fbf\u662f\u501f\u93e1 SPARQL \u7684\u6a21\u5f0f\uff0c\u6240\u4ee5\u5169\u500b\u8a9e\u6cd5\u5f88\u76f8\u50cf ( person ) -[ : BORN_IN ]-> () -[ : WITHIN * 0 .. ]-> ( location ) # Cypher ? person : bornIn / : within * ? location . # SPARQL Datalog \u5982\u540c SQL \u662f\u4e00\u7a2e\u8a9e\u8a00\u5354\u5b9a\u4e00\u822c\uff0cDatalog \u4e5f\u662f\u4e00\u7a2e\u8a9e\u8a00\u5354\u5b9a\uff0c\u5be6\u8e10\u5176\u5354\u5b9a\u7684\u8a9e\u6cd5\u6709 Cascalog - Hadoop Datalog - Datomic \u5176\u7279\u6027\u548c Prolog \u5f88\u50cf\uff0c\u90fd\u662f\u4ee5\u908f\u8f2f\u70ba\u4e3b\uff0c\u800c\u975e\u50cf\u5176\u4ed6\u5e38\u898b\u7684\u8a9e\u6cd5\u662f\u4ee5\u72c0\u614b\u548c\u8a08\u7b97\u70ba\u4e3b within_recursive ( Location , Name ) :- name ( Location , Name ). /* Rule 1 */ within_recursive ( Location , Name ) :- within ( Location , Via ), /* Rule 2 */ within_recursive ( Via , Name ). migrated ( Name , BornIn , LivingIn ) :- name ( Person , Name ), /* Rule 3 */ born_in ( Person , BornLoc ), within_recursive ( BornLoc , BornIn ), lives_in ( Person , LivingLoc ), within_recursive ( LivingLoc , LivingIn ). ?- migrated ( Who , 'United States' , 'Europe' ). /* Who = 'Lucy'. */ Summary \u9084\u6709\u5f88\u591a\u5176\u4ed6\u985e\u578b\u7684\u8cc7\u6599\u5eab\uff0c\u4f8b\u5982\uff1a \u5132\u5b58\u8d85\u9577\u5b57\u4e32\uff08DNA\uff09\u4e26\u627e\u51fa\u548c\u5176\u4ed6\u8d85\u9577\u5b57\u4e32\u76f8\u7570\u4e4b\u8655 - GenBank \u5132\u5b58\u8d85\u5927\u91cf\u8cc7\u6599\uff08\u5929\u6587\u6578\u64da\u3001\u5927\u578b\u5f37\u5c0d\u649e\u6a5f\u7b49\u7b49\uff09\uff0cEB \u7b49\u7d1a\u7684\u8cc7\u6599\u91cf\u8655\u7406 - ROOT \u5168\u6587\u6aa2\u7d22\uff0c\u91dd\u5c0d\u8cc7\u8a0a\u64f7\u53d6\u7684\u7279\u6b8a\u8cc7\u6599\u6a21\u578b\u3002","title":"\u8cc7\u6599\u6a21\u578b\u548c\u8a9e\u6cd5"},{"location":"feedback/designing-data-intensive-applications/data-model/#relational-vs-document","text":"","title":"Relational vs Document"},{"location":"feedback/designing-data-intensive-applications/data-model/#_1","text":"one-to-many many-to-many one-to-one","title":"\u5132\u5b58\u8cc7\u6599\u65b9\u5f0f"},{"location":"feedback/designing-data-intensive-applications/data-model/#one-to-many","text":"Document \u5132\u5b58\u968e\u5c64\u5f0f\u7d50\u69cb\u9032\u7bc0\u9ede\u800c\u975e\u53e6\u5916\u958b\u4e00\u500b\u8868\u55ae post -> comment1 -> comment2 -> comment3 Relational \u95dc\u4fc2\u5957\u7528\u81f3\u5404\u500b\u8868\u55ae post -> comment_id1 -> comment_id2 -> comment_id3","title":"one-to-many"},{"location":"feedback/designing-data-intensive-applications/data-model/#many-to-many","text":"Document base \u5728\u9019\u88e1\u8f03\u5403\u8667\uff0c\u56e0\u70ba\u9700\u8981\u624b\u52d5\u505a\u9023\u7d50\u3002 \u53cd\u4e4b\uff0c Relational based \u53ef\u4ee5\u900f\u904e join \u628a\u8907\u96dc\u5ea6\u4ea4\u7d66\u8cc7\u6599\u5eab\u8655\u7406 post1 -> tag1 -> tag2 post2 -> tag1 -> tag3 \u82e5\u95dc\u4fc2\u5f88\u8907\u96dc\uff0c\u4f8b\u5982\u4eba\u969b\u95dc\u4fc2\u3001\u9053\u8def\u9593\u63a5\u89f8\u7684\u7db2\u7d61\uff1a graph 1[user 1] -- known --> 2[user 2] 1 -- known --> 3[user 3] 2 -- known --> 4[user 4] 3 -- known --> 4 2 -- known --> 3 1 -- known --> 4 \u50c5\u6709 4 \u500b\u4eba\u5c31\u6709 6 x 2\uff08\u96d9\u5411\u4ee3\u8868\u5f7c\u6b64\u8a8d\u8b58\u3001\u55ae\u5411\u4ee3\u8868 A \u77e5\u9053 B\uff09\u689d\u7dda\uff0c\u82e5\u662f\u540c\u6a23\u4f7f\u7528 Relational based \u6703\u8b93\u8cc7\u6599\u6578\u91cf\u8b8a\u6210\u975e\u5e38\u5de8\u5927\uff0c\u9019\u6642\u5019\u5c31\u53ef\u4ee5\u4f7f\u7528 Graph-like model","title":"many-to-many"},{"location":"feedback/designing-data-intensive-applications/data-model/#one-to-one","text":"Document base is similar to Relational based post -> post_detail","title":"one-to-one"},{"location":"feedback/designing-data-intensive-applications/data-model/#_2","text":"","title":"\u5176\u4ed6\u6bd4\u8f03"},{"location":"feedback/designing-data-intensive-applications/data-model/#schema","text":"Document based \u5f88\u597d\u66f4\u65b0\uff0c\u4e14\u80fd\u964d\u4f4e\u628a\u5404\u500b\u8cc7\u8a0a\u5206\u958b\u653e\uff08\u591a\u500b table\uff09\u6240\u9020\u6210\u7684\u8907\u96dc\u5ea6\u3002 \u7136\u800c\u9019\u4e26\u4e0d\u4ee3\u8868 NoSQL \u4e0d\u9700\u8981 Schema\u3002\u4e8b\u5be6\u4e0a\uff0c\u6240\u6709\u985e\u578b\u7684\u8cc7\u6599\u5132\u5b58\u90fd\u9700\u8981\u4e00\u5b9a\u7684\u898f\u5247\uff0c\u53ea\u662f\u6709\u5340\u5206\u986f\u6027\uff08implicit\uff09\u6216\u96b1\u6027\uff08implicit\uff09\u3002 \u986f\u6027\u4ee3\u8868\u5728 write \u7684\u6642\u5019\u5fc5\u9808\u9075\u5b88\u8a72\u898f\u5247 \u96b1\u6027\u4ee3\u8868\u5728 read \u7684\u6642\u5019\u9810\u671f\u8a72\u8cc7\u6599\u6709\u7279\u5b9a\u7684 property","title":"Schema"},{"location":"feedback/designing-data-intensive-applications/data-model/#_3","text":"Document based \u6c92\u8fa6\u6cd5\u53ea\u53d6\u5f97\u7279\u5b9a\u968e\u5c64\u7684\u8cc7\u6599\uff0c\u5fc5\u9808\u5b8c\u6574\u53d6\u5f97\u5f8c\u628a\u7279\u5b9a\u8cc7\u6599\u9078\u51fa\u4f86\uff0c\u4f8b\u5982\uff1a \u627e\u5230\u7279\u5b9a\u5de5\u4f5c\u7684\u5e73\u5747\u85aa\u8cc7\uff0cDocument based \u9700\u8981\u628a\u8cc7\u6599\u90fd\u8b80\u51fa\u4f86\u518d\u7be9\u9078 user -> job -> salary -> hours Relational based \u7684\u8cc7\u6599\u6703\u9577\u9019\u6a23 user -> job_id job_id -> salary -> hours","title":"\u7372\u5f97\u7279\u5b9a\u8cc7\u6599"},{"location":"feedback/designing-data-intensive-applications/data-model/#query","text":"[ { \"observated_at\" : \"Mon, 25 Dec 1995 12:34:56 GMT\" , \"family\" : \"Sharks\" , \"species\" : \"Carcharodon carcharias\" , \"num\" : 3 }, { \"observated_at\" : \"Tue, 12 Dec 1995 16:17:18 GMT\" , \"family\" : \"Sharks\" , \"species\" : \"Carcharias taurus\" , \"num\" : 4 } ] SQL \u5ba3\u544a\u5f0f\u8a9e\u6cd5 SELECT date_trunc ( 'month' , observated_at ) AS month , sum ( num ) AS total FROM observations WHERE family = 'Sharks' GROUP BY month ; MapReduce \u547d\u4ee4\u5217\u5f0f\u8a9e\u6cd5 db . observations . mapReduce ( function map () { var year = this . observated_at . getFullYear (); var month = this . observated_at . getMonth () + 1 ; emit ( year + \"-\" + month , this . num ); }, function reduce ( key , values ) { return Array . sum ( values ); }, { query : { family : \"Sharks\" }, out : \"monthlySharkReport\" , } ); MongoDB\u2019s aggregation pipeline \u4e0a\u8ff0\u5169\u8005\u4e2d\u9593 db . observations . aggregate ([ { $match : { family : \"Sharks\" } }, { $group : { _id : { year : { $year : \"observated_at\" }, month : { $month : \"observated_at\" }, }, totalAnimals : { $sum : \"num\" }, }, }, ]); \u5176\u4ed6\u8a9e\u6cd5\u985e\u578b\u5728\u4e0b\u9762\u4ecb\u7d39 Graph-like model \u5f8c\u8a0e\u8ad6\u3002","title":"Query \u8a9e\u6cd5"},{"location":"feedback/designing-data-intensive-applications/data-model/#graph-like-model","text":"\u4e0a\u8ff0\u63d0\u5230 \u7684\u4eba\u969b\u95dc\u4fc2\uff0c\u6bcf\u500b\u9ede\u90fd\u4ee3\u8868\u540c\u985e\u578b\u7684\u8cc7\u6599\uff1a\u4eba\u3002\u4f46\u662f\u6b64\u6a21\u578b\u4e0d\u50c5\u53ef\u7d00\u9304\u985e\u578b\u76f8\u540c\u7684\u8cc7\u6599\uff0c\u4f8b\u5982 Facebook \u5c31\u628a\u8a31\u591a\u4e0d\u540c\u985e\u578b\u7684\u8cc7\u6599\u8a18\u9304\u5728 \u540c\u4e00\u5f35\u5927\u8868 \uff1a \u9ede\uff1a \u4eba \u4f4d\u7f6e \u767c\u6587 \u4e8b\u4ef6 \u6253\u5361 \u4f7f\u7528\u8005\u7559\u8a00 \u7dda\uff1a \u4eba\u548c\u4eba\u4e4b\u9593\u7684\u95dc\u4fc2 \u6253\u5361\u7684\u4f4d\u7f6e \u8ab0\u7559\u8a00\u54ea\u7bc7\u767c\u6587 \u8ab0\u53c3\u52a0\u54ea\u500b\u4e8b\u4ef6","title":"Graph-like model"},{"location":"feedback/designing-data-intensive-applications/data-model/#graph-like-model_1","text":"\u5efa\u7acb\u4e00\u500b Graph-like model \u4e26\u4ee5 Relational based model \u7684 schema \u70ba\u8aaa\u660e\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a CREATE TABLE vertices ( vertex_id integer PRIMARY KEY , properties json ); CREATE TABLE edges ( edge_id integer PRIMARY KEY , tail_vertex integer REFERENCES vertices ( vertex_id ), head_vertex integer REFERENCES vertices ( vertex_id ), label text , properties json ); CREATE INDEX edges_tails ON edges ( tail_vertex ); CREATE INDEX edges_heads ON edges ( head_vertex ); \u4ee5 Neo4j \u9019\u500b\u8cc7\u6599\u5eab\u70ba\u4f8b\uff0c\u5efa\u7acb\u4e0b\u5716\u7684\u95dc\u4fc2\u7db2\u7d61\u9700\u8981\uff1a CREATE ( NAmerica : Location { name : ' North America ' , type : ' continent ' }), ( us : Location { name : ' United States ' , type : ' country ' }), ( Idaho : Location { name : ' Idaho ' , type : ' state ' }), ( Lucy : Person { name : ' Lucy ' }), ( Idaho ) -[ : WITHIN ]-> ( USA ) -[ : WITHIN ]-> ( NAmerica ), ( Lucy ) -[ : BORN_IN ]-> ( Idaho ) Cypher \u662f Neo4j \u4f7f\u7528\u7684\u5ba3\u544a\u5f0f\u8a9e\u8a00\uff0c\u548c\u5bc6\u78bc\u5b78\u7684 cipher/cypher \u6c92\u95dc\u4fc2","title":"\u5efa\u7acb Graph-like model"},{"location":"feedback/designing-data-intensive-applications/data-model/#query_1","text":"\u73fe\u5728\u82e5\u8981\u627e\u300c\u6240\u6709\u5f9e\u7f8e\u570b\u79fb\u6c11\u5230\u6b50\u6d32\u7684\u4eba\u7684\u540d\u5b57\u300d\u9019\u8cc7\u6599\u5c31\u53ef\u4ee5\u4e0b\u76f8\u95dc query\uff1a MATCH ( person ) -[ : BORN_IN ]-> () -[ : WITHIN * 0 .. ]-> ( us : Location { name : ' United States ' }), ( person ) -[ : LIVES_IN ]-> () -[ : WITHIN * 0 .. ]-> ( eu : Location { name : ' Europe ' }) RETURN person . name \u5982\u540c Relational based model \u4e00\u6a23\uff0c\u4e0b\u5b8c\u8a72\u8a9e\u6cd5\u5f8c\uff0c\u8cc7\u6599\u5eab\u6703\u81ea\u884c\u5224\u65b7\u8a72\u7528\u4f55\u7a2e\u6f14\u7b97\u6cd5\u53bb\u57f7\u884c\u641c\u5c0b\uff0c\u53ef\u80fd\u5f9e persion \u5f80 location \u627e\uff0c\u4e5f\u53ef\u80fd\u76f8\u53cd\u3002","title":"query"},{"location":"feedback/designing-data-intensive-applications/data-model/#relational-based-graph-like-model","text":"PostgreSQL WITH RECURSIVE -- in_usa is the set of vertex IDs of all locations within the United States in_usa ( vertex_id ) AS ( SELECT vertex_id FROM vertices WHERE properties ->> 'name' = 'United States' UNION SELECT edges . tail_vertex FROM edges JOIN in_usa ON edges . head_vertex = in_usa . vertex_id WHERE edges . label = 'within' ), -- in_europe is the set of vertex IDs of all locations within Europe in_europe ( vertex_id ) AS ( SELECT vertex_id FROM vertices WHERE properties ->> 'name' = 'Europe' UNION SELECT edges . tail_vertex FROM edges JOIN in_europe ON edges . head_vertex = in_europe . vertex_id WHERE edges . label = 'within' ), -- born_in_usa is the set of vertex IDs of all people born in the US born_in_usa ( vertex_id ) AS ( SELECT edges . tail_vertex FROM edges JOIN in_usa ON edges . head_vertex = in_usa . vertex_id WHERE edges . label = 'born_in' ), -- lives_in_europe is the set of vertex IDs of all people living in Europe lives_in_europe ( vertex_id ) AS ( SELECT edges . tail_vertex FROM edges JOIN in_europe ON edges . head_vertex = in_europe . vertex_id WHERE edges . label = 'lives_in' ) SELECT vertices . properties ->> 'name' FROM vertices -- join to find those people who were both born in the US *and* live in Europe JOIN born_in_usa ON vertices . vertex_id = born_in_usa . vertex_id JOIN lives_in_europe ON vertices . vertex_id = lives_in_europe . vertex_id ;","title":"\u4ee5 Relational based \u7684\u65b9\u5f0f\u5efa\u7acb Graph-like model"},{"location":"feedback/designing-data-intensive-applications/data-model/#triple-store","text":"\u6bcf\u6b21\u5132\u5b58\u7684 row \u50c5\u6709\u4e09\u500b\u503c\uff1a subject - \u4e3b\u8a5e predicate - \u52d5\u8a5e\u3001\u8ff0\u8a9e object - \u5b9a\u503c\u6216\u662f\u53e6\u4e00\u500b subject \u4f8b\u5982\uff1a \u5c0f\u660e - \u5e74\u9f61 - \u5341\u516b \u5c0f\u660e - \u559c\u6b61 - \u5c0f\u7f8e \u7531\u4e0a\u7bc4\u4f8b\u53ef\u77e5\uff0c\u5176\u5be6\u5979\u5f88\u985e\u4f3c Graph-like\u3002 Turtle triples @prefix : <urn:example:>. _:lucy a :Person. _:lucy :name \"Lucy\". _:lucy :bornIn _:idaho. _:idaho a :Location. _:idaho :name \"Idaho\". _:idaho :type \"state\". _:idaho :within _:usa. _:usa a :Location. _:usa :name \"United States\". _:usa :type \"country\". _:usa :within _:namerica. _:namerica a :Location. _:namerica :name \"North America\". _:namerica :type \"continent\". _ \u958b\u982d\u7684\u90fd\u662f subject Dataomic \u5c31\u662f\u4f7f\u7528\u6b64\u6a21\u578b\u3002","title":"Triple-store"},{"location":"feedback/designing-data-intensive-applications/data-model/#query_2","text":"SPARQL\uff08sparkle\uff09\uff0c \u53ef\u4ee5\u5230\u9ad8\u96c4\u5e02\u8cc7\u6599\u5e73\u53f0\u73a9\u73a9\u770b PREFIX : <urn:example:> SELECT ?personName WHERE { ?person : name ?personName . ?person : bornIn / : within * / : name \"United States\" . ?person : livesIn / : within * / : name \"Europe\" . } \u4e0a\u8ff0\u63d0\u5230\u7684 Cypher \u4fbf\u662f\u501f\u93e1 SPARQL \u7684\u6a21\u5f0f\uff0c\u6240\u4ee5\u5169\u500b\u8a9e\u6cd5\u5f88\u76f8\u50cf ( person ) -[ : BORN_IN ]-> () -[ : WITHIN * 0 .. ]-> ( location ) # Cypher ? person : bornIn / : within * ? location . # SPARQL","title":"query"},{"location":"feedback/designing-data-intensive-applications/data-model/#datalog","text":"\u5982\u540c SQL \u662f\u4e00\u7a2e\u8a9e\u8a00\u5354\u5b9a\u4e00\u822c\uff0cDatalog \u4e5f\u662f\u4e00\u7a2e\u8a9e\u8a00\u5354\u5b9a\uff0c\u5be6\u8e10\u5176\u5354\u5b9a\u7684\u8a9e\u6cd5\u6709 Cascalog - Hadoop Datalog - Datomic \u5176\u7279\u6027\u548c Prolog \u5f88\u50cf\uff0c\u90fd\u662f\u4ee5\u908f\u8f2f\u70ba\u4e3b\uff0c\u800c\u975e\u50cf\u5176\u4ed6\u5e38\u898b\u7684\u8a9e\u6cd5\u662f\u4ee5\u72c0\u614b\u548c\u8a08\u7b97\u70ba\u4e3b within_recursive ( Location , Name ) :- name ( Location , Name ). /* Rule 1 */ within_recursive ( Location , Name ) :- within ( Location , Via ), /* Rule 2 */ within_recursive ( Via , Name ). migrated ( Name , BornIn , LivingIn ) :- name ( Person , Name ), /* Rule 3 */ born_in ( Person , BornLoc ), within_recursive ( BornLoc , BornIn ), lives_in ( Person , LivingLoc ), within_recursive ( LivingLoc , LivingIn ). ?- migrated ( Who , 'United States' , 'Europe' ). /* Who = 'Lucy'. */","title":"Datalog"},{"location":"feedback/designing-data-intensive-applications/data-model/#summary","text":"\u9084\u6709\u5f88\u591a\u5176\u4ed6\u985e\u578b\u7684\u8cc7\u6599\u5eab\uff0c\u4f8b\u5982\uff1a \u5132\u5b58\u8d85\u9577\u5b57\u4e32\uff08DNA\uff09\u4e26\u627e\u51fa\u548c\u5176\u4ed6\u8d85\u9577\u5b57\u4e32\u76f8\u7570\u4e4b\u8655 - GenBank \u5132\u5b58\u8d85\u5927\u91cf\u8cc7\u6599\uff08\u5929\u6587\u6578\u64da\u3001\u5927\u578b\u5f37\u5c0d\u649e\u6a5f\u7b49\u7b49\uff09\uff0cEB \u7b49\u7d1a\u7684\u8cc7\u6599\u91cf\u8655\u7406 - ROOT \u5168\u6587\u6aa2\u7d22\uff0c\u91dd\u5c0d\u8cc7\u8a0a\u64f7\u53d6\u7684\u7279\u6b8a\u8cc7\u6599\u6a21\u578b\u3002","title":"Summary"},{"location":"feedback/designing-data-intensive-applications/db-index/","text":"\u5728\u958b\u59cb\u8b1b Index \u524d\uff0c\u6211\u5011\u53ef\u4ee5\u5148\u770b\u4e00\u4e0b\u4e00\u500b\u55ae\u7d14\u7528 bash \u5efa\u7acb\u7684\u8cc7\u6599\u5eab\uff0c\u4e26\u767c\u73fe\u5176\u5b58\u5728\u7684\u554f\u984c\uff1a db_set () { echo \" $1 , $2 \" >> database } db_get () { grep \"^ $1 ,\" database | sed -e \"s/^ $1 ,//\" | tail -n 1 } \u53ef\u4ee5\u770b\u5230\u9019\u500b\u8cc7\u6599\u5eab\u5728\u5beb\u5165\u6642\uff0c\u64c1\u6709\u8d85\u9ad8\u6548\u80fd\uff0c\u751a\u81f3\u53ef\u4ee5\u8aaa\u4e0d\u6703\u518d\u6709\u6bd4\u4ed6\u66f4\u6709\u6548\u7387\uff08\u8edf\u9ad4\u9762\uff09\u7684\u5132\u5b58\u65b9\u5f0f\u4e86\u3002 \u9019\u7a2e\u5132\u5b58\u65b9\u5f0f\u7a31\u70ba log \uff0c\u9644\u52a0\uff08append\uff09\u6587\u5b57\u81f3\u6a94\u6848\u4e2d\u3002\u9019\u7a2e\u65b9\u5f0f\u4e0d\u6703\u8003\u616e\u4e4b\u524d\u6709\u6c92\u6709\u5132\u5b58\u904e\u8a72\u8cc7\u6599\uff0c\u800c\u662f\u76f4\u63a5\u65b0\u589e\u81f3\u6a94\u6848\u5c3e\u8655\u3002\u6240\u4ee5\u4e26\u4e0d\u6703\u6e05\u9664\u6b77\u53f2\u7d00\u9304\u3002 \u9019\u500b\u65b9\u5f0f\u4e26\u672a\u8003\u616e\u8a31\u591a\u554f\u984c\uff0c\u4f8b\u5982\uff1a\u591a\u5de5\u8655\u7406\u3001\u6e05\u9664\u6b77\u53f2\u7d00\u9304\u3001\u5bb9\u932f\u3001\u8cc7\u6599\u6bc0\u640d \u7136\u800c\uff0c\u7576\u4ed6\u8b80\u53d6\u6642\uff0c\u537b\u9700\u8981\u628a\u6240\u6709\u6587\u4ef6\u90fd\u8b80\u904e\u4e00\u904d\u3002\u7576\u8cc7\u6599\u9577\u5169\u500d\u6642\uff0c\u53ef\u4ee5\u9810\u671f\u4ed6\u9700\u8981\u57f7\u884c\u7684\u6642\u9593\u4e5f\u6703\u63d0\u5347\u81f3\u5169\u500d\u4ee5\u4e0a\u3002\u70ba\u4e86\u89e3\u6c7a\u9019\u554f\u984c\uff0cIndex \u51fa\u73fe\u4e86\u3002 Index \u7d22\u5f15\uff08Index\uff09\u901a\u5e38\u662f\u5728\u4e3b\u8981\u8cc7\u6599\u4e0b \u984d\u5916 \u5efa\u7acb\u7684 metadata\uff0c\u4e26\u7576\u6709\u8cc7\u6599\u9700\u8981\u300c\u5beb\u5165\u300d\u6642\uff0c\u66f4\u65b0\u9019\u4efd metadata\u3002 \u7531\u6b64\u53ef\u77e5\uff0c\u5728\u63d0\u5347\u300c\u8b80\u53d6\u300d\u6548\u80fd\u7684\u540c\u6642\uff0c\u4fbf\u9700\u8981\u72a7\u7272\u90e8\u5206\u300c\u5beb\u5165\u300d\u6548\u80fd\u3002 \u5de5\u5177\u7684\u9078\u64c7\u5e38\u5e38\u90fd\u662f\u5728\u505a\u6b0a\u8861\uff0c\u82e5\u60c5\u5883\u9700\u8981\u9ad8\u6548\u80fd\u7684\u8b80\u53d6\uff0c\u90a3\u6216\u8a31\u5c31\u61c9\u8a72\u8003\u616e\u6dfb\u52a0 Index\u3002 \u4ee5\u4e0b\u7684 index \u90fd\u4ee3\u8868 key-value \u4e2d\u7684 key \u6216\u8005\u8aaa RMDBS \u4e2d\u7684 primary key \u5927\u5bb6\u53ef\u80fd\u5f88\u5e38\u4f7f\u7528\u5230 Index\uff0c\u4f8b\u5982\uff1a user \u8868\u683c\u4e2d\u5e74\u7d00\u5c0f\u65bc 30 \u6b72\u4e14\u6708\u6536\u5165\u5927\u65bc 500 \u584a\u7684 user\u3002 \u6211\u5011\u8a2d\u8a08\u4e86\u5169\u500b index \u5206\u5225\u662f\u5e74\u9f61\u548c\u6536\u5165\uff0c\u4f46 \u70ba\u4ec0\u9ebc query \u6642\u53ea\u91dd\u5c0d\u55ae\u4e00\u500b index \u4f5c\u641c\u5c0b\u5462\uff1f \u540c\u6642\u4f7f\u7528\u5169\u500b index \u53bb\u505a\u641c\u5c0b\u4e0d\u662f\u975e\u5e38\u76f4\u89c0\u55ce\uff1f Index \u7684\u610f\u7fa9\u901a\u5e38\u662f\u8b93\u641c\u5c0b\u7684\u6b21\u6578\u5f9e n \uff08\u8cc7\u6599\u7e3d\u6578\uff0c\u4f8b\u5982\u4e00\u767e\u842c\uff09\u8b8a\u6210 ln(n) \uff08\u641c\u5c0b\u6b21\u6578\uff0c\u4f8b\u5982\u4e09\u6b21\uff09\uff0c\u5728\u627e\u5230\u7279\u5b9a\u7684\u8cc7\u6599\uff08\u7fa4\uff09\u4e4b\u5f8c\u4fbf\u7121\u6cd5\u4f7f\u7528 index\uff0c\u56e0\u70ba index \u8868\u683c\u7684\u5efa\u7acb\u90fd\u662f\u4ee5\u5168\u90e8\u8cc7\u6599\u70ba\u57fa\u790e\u3002 \u7576\u7136\uff0c\u6709\u4e9b\u6a39\u72c0\u7d50\u69cb\uff08R-Tree\uff09\u5141\u8a31\u591a\u4f4d\u5143\u7684\u641c\u5c0b\uff0c\u4e0b\u9762\u6703\u505a\u4ecb\u7d39\u3002 [1,5,10] [1,3,5] [6,8,10] [1,2,3] [4,5] [6,7,8] [9,10] \u4f8b\u5982\u4e0a\u8ff0\uff0c\u627e\u5230 1~3 \u4e4b\u5f8c\uff0c\u82e5\u9700\u8981\u5728\u505a filter\uff0c\u5247\u9700\u8981\u904d\u6b77\u8cc7\u6599\u624d\u80fd\u9054\u5230\u76ee\u7684\u3002 Hash index \u4ee5 in-memory \u7684\u65b9\u5f0f\u7d00\u9304 key \u4f4d\u7f6e\uff1a key offset 1 411 42 393 1,{\"a\":\"b\"} 2,{\"c\":\"d\"} ... 42,{\"e\":\"f\"} 1,{\"g\":\"h\"} \u6bcf\u6b21\u66f4\u65b0\u6216\u65b0\u589e key-value \u6642\uff0c\u540c\u6642\u66f4\u65b0\u8a72 hash index\u3002 \u554f\u984c \u56e0\u70ba\u662f\u4e00\u76f4\u65b0\u589e\u8cc7\u6599\u5230\u6a94\u6848\u5c3e\u90e8\uff0c\u5982\u4f55\u907f\u514d\u7121\u9650\u5236\u7684\u6a94\u6848\u5927\u5c0f\u589e\u9577 \u6a94\u6848\u683c\u5f0f \u4f7f\u7528\u4e8c\u9032\u4f4d\u7684\u8f49\u63db\uff0c\u964d\u4f4e\u5b57\u4e32\u3001\u6578\u5b57\u7b49\u7b49\u591a\u6a23\u7684\u8b8a\u6578\u683c\u5f0f\u8f49\u63db\uff0c\u4f8b\u5982\u8868\u60c5\u7b26\u865f\u3002 \u5982\u4f55\u522a\u9664\u6307\u5b9a\u8cc7\u6599 \u9700\u8981\u5728\u8a72 key \u4e2d\u7d66\u4e88\u7279\u5b9a\u503c\uff08tombstone\uff09\uff0c\u7576 compaction \u548c merge segment \u5f8c\uff0c\u6703\u81ea\u52d5\u6368\u68c4\u8a72\u9375\u503c\u3002 \u6a5f\u5668\u91cd\u555f\u6642\uff0c\u91cd\u65b0\u7372\u5f97 hash index \u9700\u8981\u5168\u6587\u8b80\u53d6\uff0c\u975e\u5e38\u8017\u6642 \u6703\u5b9a\u6642\u5b9a\u91cf\u5feb\u7167\uff08snapshot\uff09hash index \u9032\u6a94\u6848\uff0c\u907f\u514d\u6a5f\u5668\u91cd\u555f\u6642\u7684\u5168\u6587\u6aa2\u7d22\u3002 \u5beb\u5165\u8cc7\u6599\u5230\u4e00\u534a\u6642\uff0c\u6a5f\u5668\u58de\u6389 \u5efa\u7acb\u6838\u5c0d\u548c\uff08checksums\uff09\uff0c\u82e5\u6838\u5c0d\u548c\u6709\u932f\uff0c\u5247\u4e0d\u4f7f\u7528\u8a72\u503c\u3002 \u5982\u4f55\u78ba\u4fdd\u540c\u6b65\u63a7\u5236\uff08Concurrency Control\uff09\u6642\u9020\u6210\u7684\u932f\u8aa4\uff0c\u4f8b\u5982 A \u8cc7\u6599\u5beb\u5230\u4e00\u534a\u6642\uff0cB \u8cc7\u6599\u8981\u958b\u59cb\u5beb\u5165\u4e86\uff0cB \u8981\u5982\u4f55\u7b49 A \u5beb\u5b8c \u50c5\u958b\u653e\u4e00\u500b\u5beb\u5165\u7684\u7dda\u7a0b\uff08thread\uff09\u3002 \u6a94\u6848\u58d3\u7e2e\u6574\u5408 \u7576\u6a94\u6848\u9054\u5230\u4e00\u5b9a\u5927\u5c0f\u6642\uff1a \u628a\u6a94\u6848\u5340\u5206\u6210\u597d\u5e7e\u584a\uff08segment\uff09\uff0c\u6bcf\u500b\u5340\u584a\u7368\u81ea\u7d00\u9304\u4ed6\u5011\u7684 hash index\u3002 \u7576\u5340\u584a\u592a\u5927\u6642\uff0c\u958b\u59cb\u9032\u884c\u58d3\u7e2e\uff08compaction\uff09\uff0c\u628a\u820a\u7684 key-value \u6368\u68c4\uff0c\u4e26\u628a\u6709\u6548\u8cc7\u6599\u5beb\u5165\u65b0\u7684\u6a94\u6848\u3002 \u5169\u500b\u5c0f\u5340\u584a\u53ef\u4ee5\u9032\u884c\u6574\u5408\uff08merge\uff09\u3002 \u6b64\u884c\u70ba\u662f\u5728\u80cc\u666f\u57f7\u884c\uff0c\u82e5\u57f7\u884c\u5230\u4e00\u534a\u6709\u8b80\u5beb\u7684\u8acb\u6c42\uff0c\u6703\u7e7c\u7e8c\u4f7f\u7528\u820a\u7684 segment\uff0c\u6700\u5f8c\u58d3\u7e2e\u6574\u5408\u5b8c\u7562\u5f8c\u624d\u4f7f\u7528\u65b0\u7684 segment\uff0c\u4e26\u628a\u820a\u7684 segment \u522a\u9664\u3002 \u641c\u5c0b\u6642\uff0c\u82e5\u5728 segment 1 \u4e2d\u7684 hash index \u627e\u4e0d\u5230\u8a72 key\uff0c\u5c31\u5f80\u4e0b\u4e00\u500b segment \u627e\u3002 \u7f3a\u9ede Hash index \u82e5\u904e\u5927\uff0c\u6216\u8005\u8aac key \u904e\u591a\uff0c\u52e2\u5fc5\u6703\u5927\u5927\u5f71\u97ff\u6548\u80fd\u3002 \u6c92\u8fa6\u6cd5\u5feb\u901f\u67e5\u8a62\u7bc4\u570d\u7684 key\uff0c\u4f8b\u5982\u60f3\u77e5\u9053\u4ee5 animal \u70ba\u958b\u982d\u7684\u9375\u503c\u6578\u91cf\u3002 \u61c9\u7528 Bitcask SSTables \u8a72\u67b6\u69cb\u539f\u5148\u7a31 Log-Structured Merge-Tree\uff08LSM-Tree\uff09\uff0c\u5f8c\u4fee\u6b63\u90e8\u5206\u884c\u70ba\u5f8c\u65bc \u8ad6\u6587 \u4e2d\uff0c\u91cd\u65b0\u547d\u540d\u70ba Sorted String Tables\uff08SSTables\uff09\u3002 \u5982\u540c\u4e0a\u8ff0\u7684 Hash index\uff0c\u6703\u628a index \u5206\u6210\u597d\u5e7e\u500b segment \u6a94\u6848\u3002SSTable \u5728\u5206\u6210\u4e0d\u540c segment \u7684\u540c\u6642\uff0c\u6703\u78ba\u4fdd\u6bcf\u500b segment \u7684 key \u662f\u7368\u7acb\uff08non-overlapping\uff09\u4e14\u6392\u5e8f\uff08sorted\uff09\u7684\u3002\u9019\u6a23\u80fd\u78ba\u4fdd\u4ee5\u4e0b\u7279\u6027\uff1a \u5728\u505a merge \u7684\u904e\u7a0b\uff0c\u53ef\u4ee5\u975e\u5e38\u6709\u6548\u7387\u4e14\u7701\u7a7a\u9593\uff1a File1 File2 File3 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Apple \u2502 \u2502 Apple \u2502 \u2502 Avocado \u2502 \u2502 Apricot \u2502 \u2502 Banana \u2502 \u2502 Berry \u2502 \u2502 Banana \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Step1 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Apple \u2502 \u2502 Apple * \u2502 \u2502 Avocado \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534 Step2 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Apricot * \u2502 \u2502 Banana \u2502 \u2502 Avocado \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Step3 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Banana \u2502 \u2502 Banana \u2502 \u2502 Avocado * \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Step4 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Banana \u2502 \u2502 Banana * \u2502 \u2502 Berry \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u5132\u5b58 index \u6642\uff0c\u4e0d\u518d\u9700\u8981\u628a\u6bcf\u500b key \u90fd\u5b58\u8d77\u4f86\uff0c\u56e0\u70ba\u662f\u6392\u5e8f\u904e\u5f8c\u7684\uff0c\u5b58\u7279\u5b9a\u5e7e\u500b key \u518d\u5f9e\u4e2d\u9593\u627e\u5c31\u597d\uff1a key offset 1 0 42 393 \u7576\u6211\u8981\u627e key 30 \u7684\u8cc7\u6599\u6642\uff0c\u53ea\u9700\u8981\u627e 0 \u5230 393 \u5373\u53ef\u3002 \u56e0\u70ba\u5132\u5b58\u7684 index \u662f\u758f\u6563\uff08sparse\uff09\u7684\uff0c\u6240\u4ee5\u5728 key \u548c key \u4e4b\u9593\u7684\u8cc7\u6599\u53ef\u4ee5\u9032\u884c\u58d3\u7e2e\uff1a \u4ee5\u4e0a\u8ff0\u7684\u8868\u683c\u70ba\u4f8b\uff0c key 1 \u5230 key 42 \u4e4b\u9593\u7684\u8cc7\u6599\u9032\u884c\u58d3\u7e2e\uff08compress\uff09\u3002 \u7b56\u7565 \u7531\u4e0a\u8ff0\u7684\u4e00\u4e9b\u7279\u6027\uff0c\u53ef\u4ee5\u7e3d\u7d50 SSTables \u5728\u5be6\u4f5c\u4e0a\u7684\u932f\u7565\u5982\u4e0b\uff1a \u6bcf\u6b21\u8cc7\u6599\u9032\u4f86\uff0c\u5b58\u9032 in-memory \u7684\u6a39\u72c0\u7d50\u69cb\uff08red-black tree \u6216 AVL tree\uff09\uff0c\u8a72\u6a39\u72c0\u7d50\u69cb\u53ef\u4ee5\u4fdd\u8b49\u65b0\u7684\u8cc7\u6599\u6703\u4ee5\u6392\u5e8f\u904e\u7684\u65b9\u5f0f\u5b58\u9032\u7d50\u69cb\u4e2d\u3002 \u7576\u6a39\u72c0\u7d50\u69cb\u8d8a\u4f86\u8d8a\u5927\uff0c\u8d85\u904e\u95a5\u503c\uff08\u901a\u5e38\u6578\u500b MB\uff09\uff0c\u5b58\u9032\u6a94\u6848\uff08segment\uff09\u88e1\u3002\u56e0\u70ba\u5df2\u7d93\u6392\u5e8f\u904e\uff0c\u6240\u4ee5\u5132\u5b58\u7684\u6548\u7387\u6a5f\u6236\u7b49\u65bc I/O \u7684\u6548\u7387 \u7576\u6709\u8b80\u53d6\u7684\u8acb\u6c42\u6642\uff0c\u5148\u8b80\u53d6 in-memory \u518d\u5f9e\u6700\u65b0\u7684\u6a94\u6848\u4f9d\u5e8f\u8b80\u53d6\u3002 \u96a8\u8457\u6642\u9593\u9032\u884c\uff0c\u6301\u7e8c\u9032\u884c\u6574\u5408\uff08merging\uff09\u8207\u58d3\u7e2e\uff08compaction\uff09\u3002 \u7576\u6a5f\u5668\u58de\u6389\u6642\uff0cin-memory \u7684\u8cc7\u6599\u5c31\u6703\u907a\u5931\uff1f \u6bcf\u6b21\u65b0\u7684\u5beb\u5165\u9700\u6c42\uff0c\u90fd\u5373\u6642 append \u5230\u4e00\u500b\u7279\u6b8a\u6a94\u6848\u4e2d\uff0c\u4e14\u4e0d\u9700\u6392\u5e8f\uff0c\u6b64\u6a94\u6848\u6bcf\u6b21 in-memory \u88ab\u6e05\u7a7a\u6642\uff0c\u90fd\u6703\u8ddf\u8457\u6e05\u7a7a\u3002\u6b64\u6a94\u6848\u7684\u529f\u80fd\u53ea\u7528\u4f86\u7576\u6a5f\u5668\u91cd\u555f\u6642\uff0c\u91cd\u65b0\u653e\u9032 in-memory \u7684\u6a39\u72c0\u7d50\u69cb\u3002 \u61c9\u7528 Google LevelDB Facebook RocksDB - based on LevelDB Apache Cassandra (\u985e\u4f3c) - based on Big Table paper Apache HBase (\u985e\u4f3c) - based on Big Table paper Lucene \uff08\u88ab Elasticsearch \u548c Solr \u4f7f\u7528\uff09 - term dictionaries \u96d6\u7136 Lucene \u662f\u63d0\u4f9b\u5168\u6587\u6aa2\u7d22\u7684\u5f15\u64ce\uff0c\u5168\u6587\u6aa2\u7d22\u6bd4\u8d77 key-value \u7684\u6aa2\u7d22\u8981\u66f4\u70ba\u8907\u96dc\uff0c\u4f46\u5176\u908f\u8f2f\u985e\u4f3c\uff1a\u4ee5 search words \u4f5c\u70ba key\uff0c\u6587\u7ae0\u7684 ID \u4f5c\u70ba value\u3002 \u88dc\u5145 \u82e5\u641c\u5c0b\u7684\u8cc7\u6599\u662f\u4e0d\u5b58\u5728\u7684\uff08non-exist key\uff09\uff0c\u5c31\u9700\u8981\u6240\u6709\u6a94\u6848\u90fd\u95b1\u6b77\u5f8c\u624d\u80fd\u5224\u65b7\u3002 Bloom filters \u7279\u6b8a\u7d50\u69cb\u7684\u6a94\u6848\uff0c\u6703\u5927\u7565\u63cf\u8ff0\u8cc7\u6599\u5eab\u7684\u72c0\u614b\uff0c\u4e26\u544a\u8a34\u4f60\u8a72\u9375\u503c\u662f\u5426\u5b58\u5728 \u8a72\u4ee5\u4f55\u7a2e\u9806\u5e8f\u548c\u6642\u9593\u9ede\u9032\u884c\u6574\u5408\uff08merging\uff09\u8207\u58d3\u7e2e\uff08compaction\uff09\u3002 size-tiered - \u65b0\u7684\u548c\u5c0f\u7684 segment \u6703\u88ab\u6574\u5408\u58d3\u7e2e\u9032\u820a\u7684\u3002 segment \u6578\u91cf\u5c11 segment \u5927\u5c0f\u6703\u662f 4/16/64... \u65b9\u5f0f\u500d\u589e segment \u9593\u6703\u6709 overlapping \u7684\u72c0\u6cc1 leveled compaction - \u6bcf\u4e00\u5c64\u5728\u5347\u7d1a\u6642\u6703\u505a\u6574\u5c64\u7684\u58d3\u7e2e segment \u6578\u91cf\u591a\uff0c\u7b2c\u4e00\u5c64\u6a94\u6848\u6578 10 \u500b\uff0c\u7b2c\u4e8c\u5c64\u662f 100 \u500b segment \u5927\u5c0f\u662f\u56fa\u5b9a\u7684 \u6bcf\u4e00\u5c64\uff08level\uff09\u7684 segment \u9593\u4e0d\u6703\u6709 overlapping \u7684\u72c0\u6cc1 \u66f8\u4e2d\u63d0\u51fa\u5169\u7a2e\u65b9\u5f0f\uff0c\u6709\u8208\u8da3\u53ef\u4ee5\u5230 \u9019\u88e1 \u67e5\u770b\u66f4\u591a\u7b56\u7565\u3002 \u66f4\u591a\u8a73\u60c5\u53ef\u4ee5\u53c3\u8003 LevelDB \u7684 \u5be6\u4f5c\u6587\u4ef6 \u3002 B-Tree 1970 \u5e74\u5c31\u8a2d\u8a08\u51fa\u7684\u6f14\u7b97\u6cd5\uff0c\u4e26\u88ab\u61c9\u7528\u65bc\u8cc7\u6599\u5eab\u4e2d\u3002\u800c\u9019\u4e5f\u662f\u8fd1\u4ee3\u8cc7\u6599\u5eab\u5728\u505a Index \u6642\u6700\u5e38\u4f7f\u7528\u7684\u6f14\u7b97\u6cd5\u3002 \u4e0a\u8ff0\u63d0\u5230\u7684\u65b9\u6cd5\u4e26\u4e0d\u6703\u53bb\u66f4\u65b0\u820a\u6709\u8cc7\u6599\uff0c\u53cd\u4e4b B-Tree \u5247\u6703\u53bb\u66f4\u65b0\u3002 \u4e5f\u5c31\u662f\u4ed6\u4e0d\u9700\u8981\u505a\u58d3\u7e2e\u548c\u6574\u5408\u7684\u52d5\u4f5c \u628a\u8cc7\u6599\u5340\u5206\u6210\u591a\u500b\u5c0f\u584a\uff08 blocks / page \uff09 \u6bcf\u500b\u5340\u584a\u7684\u5927\u5c0f\u901a\u5e38\u70ba 4KB\uff0c\u4e0d\u904e\u5be6\u969b\u4e0a\u4ecd\u8981\u8003\u616e\u786c\u9ad4\u7684\u914d\u7f6e\u3002 \u6bcf\u500b\u5340\u584a\u90fd\u6703\u6709\u4e00\u500b\u5730\u5740\u53bb\u4ee3\u8868\u4ed6\uff08\u985e\u4f3c\u7a0b\u5f0f\u78bc\u4e2d\u7684 pointer\uff0c\u6a94\u540d\uff09\u3002 \u6709\u4e00\u500b\u7279\u6b8a\u5340\u584a\u7a31\u70ba root\uff0c\u6bcf\u6b21\u641c\u5c0b\u90fd\u5148\u7d93\u904e\u8a72\u5340\u584a\u3002 \u5340\u584a\u5206\u5169\u7a2e \u8def\u5f91\u5340\u584a - \u7528\u4f86\u5c0e\u5f15\u81f3\u5404\u500b\u5340\u584a\uff0c\u5169\u500b key \u4e4b\u9593\u7684\u8cc7\u6599\u5373\u662f\u5b58\u653e\u9019\u5169\u8005\u4e4b\u9593\u7684\u8cc7\u6599\u4f4d\u7f6e \u8cc7\u6599\u5340\u584a - \u7528\u4f86\u5132\u5b58 key-value ref \u6578\u91cf\u4ee3\u8868 branching factor \uff0c\u4ee5\u4e0a\u5716\u70ba\u4f8b\u5373\u662f 6\uff0c\u901a\u5e38\u6578\u91cf\u70ba\u6578\u767e\u3002 \u6bcf\u584a 4 KB\uff0c branching factor 500\uff0c\u5171 4 \u5c64\uff0c\u53ef\u4ee5\u5b58 256 TB \u7684\u8cc7\u6599\u91cf \u65b0\u589e\u6216\u7de8\u8f2f\u8cc7\u8a0a\u6642\uff0c\u76f4\u63a5\u53bb\u5230\u8a72 val \u66f4\u65b0\u5373\u53ef\u3002 \u7576\u8d85\u904e branching factor \u7684\u5927\u5c0f\u6642\uff0c\u5c31\u6703\u5c0d\u534a\u62c6\u958b\u5f80\u4e0b\u4e00\u5c64\u653e\uff1a \u7531\u4e0a\u8ff0\u4e5f\u5f88\u6e05\u695a\u53ef\u4ee5\u77e5\u9053\uff0c\u76f8\u6bd4\u65bc Log-Structure \u7684\u65b9\u5f0f\uff0cwrite \u7684\u6548\u7387\u6703\u8f03\u4f4e\u3002 \u5982\u4f55\u589e\u52a0\u7a69\u5b9a\u5ea6 \u7531\u65bc B-Tree \u6703\u8986\u84cb\u5148\u524d\u5132\u5b58\u7684\u503c\uff0c\u9019\u6642\u5c31\u9700\u8981\u8003\u616e\u5230\u786c\u9ad4\u662f\u600e\u9ebc\u505a\u8986\u5beb\u7684\uff1f \u6a5f\u68b0\u5f0f\u78c1\u789f\uff0c\u7b49\u5f85\u8b80\u5beb\u982d\u9047\u5230\u6b63\u78ba\u4f4d\u7f6e\uff0c\u958b\u59cb\u8986\u5beb \u56fa\u614b\u786c\u789f\uff0c\u4ee5\u56fa\u5b9a\u55ae\u4f4d\u5927\u5c0f\u5beb\u5165\uff0c\u9700\u914d\u5408\u8edf\u9ad4 \u7c21\u800c\u8a00\u4e4b\uff0c\u591a\u4e00\u7a2e\u52d5\u4f5c\uff0c\u591a\u4e00\u5c64\u8003\u616e \u7576\u66f4\u65b0\u8cc7\u6599\u6642\uff0c\u53ef\u80fd\u6703\u628a page \u62c6\u5206\u5169\u500b\uff0c\u6216\u5f71\u97ff\u73fe\u6709\u8cc7\u6599\u3002\u505a\u5230\u4e00\u534a\u6642\uff0c\u6a5f\u5668\u58de\u4e86\u600e\u9ebc\u8fa6\uff1f write-ahead log\uff08WAL \u6216\u7a31 redo log \uff09\u6703\u7d00\u9304\u820a\u8cc7\u6599\uff0c\u4f5c\u70ba\u707d\u96e3\u5fa9\u539f\u7528\u3002 \u7576\u9700\u8981\u8655\u7406\u591a\u5de5\uff08concurrency control\uff09\uff0c\u4e00\u500b\u5de5\u4eba\u5728\u8b80\u53d6\u6642\uff0c\u6a39\u72c0\u7d50\u69cb\u53ef\u80fd\u662f\u4e0d\u7a69\u5b9a\u7684\uff08\u6b63\u5728\u8abf\u6574 B-Tree\uff09 \u9700\u8981\u5229\u7528 latches \u6f14\u7b97\u6cd5\u4f86\u9396\u5b9a\u5340\u584a\u4e0d\u88ab\u8b80\u53d6\u3002 \u7531\u6b64\u4e5f\u53ef\u4ee5\u770b\u51fa SSTable \u548c B-Tree \u5728\u8655\u7406\u9019\u554f\u984c\u7684\u96e3\u6613\u7a0b\u5ea6\uff0cSSTable \u5728\u58d3\u7e2e\u6574\u5408\u7684\u904e\u7a0b\u90fd\u662f\u80cc\u666f\u57f7\u884c\u7684\uff0c\u800c\u4e0d\u5f71\u97ff\u73fe\u6709\u8cc7\u6599\uff0c\u6700\u7d42\u57f7\u884c\u5b8c\u7562\u624d\u6703\u505a\u66f4\u65b0\u3002 \u5982\u4f55\u512a\u5316 1970 \u5e74\u5230\u73fe\u5728\uff0c\u4e5f\u505a\u4e86\u5f88\u591a\u512a\u5316\uff1a \u707d\u96e3\u5fa9\u539f\u6642 WAF \u4e4b\u5916\uff0c\u6709\u4e9b\u4e5f\u5229\u7528\u5feb\u7167\u7684\u65b9\u5f0f\uff0c\u5efa\u7acb\u526f\u672c\uff0c\u8b93\u8b80\u53d6\u6642\u4e0d\u5fc5\u9396\u5b9a\u8a72\u6a39\u3002 \u4e0d\u5fc5\u4f7f\u7528\u5b8c\u6574\u7684 key\uff0c\u800c\u662f\u5728\u78ba\u4fdd\u7368\u7acb\u6027\u7684\u540c\u6642\uff0c\u53d6\u7528\u7e2e\u5beb\u5373\u53ef\u3002 \u8b93\u76f8\u8fd1\u7684 page \u653e\u5728 filesystem \u7684\u9644\u8fd1\uff0c\u4f46\u662f\u7576\u6a39\u72c0\u7d50\u69cb\u88ab\u66f4\u65b0\uff0c\u5c31\u9700\u8981\u66f4\u6df1\u4e00\u5c64\u7684\u6f14\u7b97\u6cd5\u3002 \u589e\u52a0\u540c\u5c64\u9644\u8fd1 page \u7684\u5730\u5740\uff0c\u52a0\u901f\u641c\u5c0b \u4e00\u4e9b\u8b8a\u5f62\u7684 B-Tree \u6703\u6574\u5408 Log-Structure \u7684\u529f\u80fd\u53bb\u505a\u52a0\u901f ... SSTable vs B-Tree \u8cc7\u6599\u5eab\u6548\u80fd\u548c\u61c9\u7528\u7a0b\u5f0f\u7684\u985e\u578b\u6709\u975e\u5e38\u5bc6\u5207\u7684\u95dc\u4fc2\uff0c\u6240\u4ee5\u5217\u51fa\u4e00\u4e9b\u9ede\u53ef\u4ee5\u505a\u53c3\u8003\uff1a SSTable \u9069\u5408\u5beb\u5165\uff0cB-Tree \u9069\u5408\u8b80\u53d6\u3002 B-Tree \u8f03\u6210\u719f\u7a69\u5b9a\u4f46\u662f SSTable \u6b63\u9010\u6f38\u63d0\u5347\u4f7f\u7528\u6bd4\u4f8b\u3002 \u7d30\u7bc0\uff1a \u5beb\u5165\uff1a\u6bcf\u6b21\u5beb\u5165\u9032\u8cc7\u6599\u5eab\u7684\u8cc7\u6599\uff0c\u5176\u4e00\u751f\u88ab\u91cd\u8907\u5beb\u5165\u786c\u9ad4\u7684\u6b21\u6578\u7a31\u70ba write amplification B-Tree \u6bcf\u6b21\u5beb\u5165\u9032\u8cc7\u6599\u5eab\u6642\u6642\uff0c\u90fd\u6703\u5beb\u5165\u81f3\u5c11\u5169\u904d\uff08WAL\uff09\uff0c\u4e14\u6bcf\u6b21\u66f4\u65b0 page \u7684\u4e9b\u5fae\u8cc7\u6599\uff0c\u90fd\u9700\u8981\u5b8c\u6574\u91cd\u65b0\u5beb\u5165\uff08\u56e0\u70ba\u662f\u6539\u52d5\u820a\u8cc7\u6599\uff09 SSTable write amplification \u901a\u5e38\u8f03\u4f4e\uff0c\u4f46\u53d7\u58d3\u7e2e\u548c\u6574\u5408\u7684\u6f14\u7b97\u6cd5\u6216\u4f7f\u7528\u8005\u8a2d\u5b9a\u5f71\u97ff\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u5176 append \u7684\u65b9\u5f0f\u4ecd\u8b93\u4ed6\u6709\u8f03\u9ad8\u7684\u5beb\u5165\u6548\u80fd \u6a5f\u68b0\u5f0f\u786c\u789f\uff08\u78c1\u789f\uff09\u5728\u6709\u9806\u5e8f\u6027\u7684\u5beb\u5165\uff08append\uff09\u6703\u6709\u8f03\u9ad8\u7684\u6548\u80fd \u56fa\u614b\u786c\u789f\u56e0\u5176\u662f\u5beb\u9032\u6676\u7247\u88e1\uff0c\u9069\u5408\u7dca\u5bc6\u7684\u8cc7\u6599\u5beb\u5165\u3002\uff08\u96d6\u7136\u97cc\u9ad4\u6703\u76e1\u91cf\u8b93\u5beb\u5165\u4fdd\u6301\u7dca\u5bc6\uff09 \u8a18\u61b6\u9ad4 B-Tree \u901a\u5e38\u9700\u8981\u8f03\u591a\u8a18\u61b6\u9ad4\uff0c\u56e0\u70ba\u6bcf\u500b page \u90fd\u662f\u56fa\u5b9a\u5927\u5c0f\uff0c\u4ee3\u8868\u53ef\u80fd\u6703\u6709\u5f88\u591a\u9592\u7f6e\u7a7a\u9593 SSTable \u900f\u904e\u53cd\u8986\u58d3\u7e2e\u6574\u5408\uff0c\u901a\u5e38\u4f7f\u7528\u8f03\u5c11\u8a18\u61b6\u9ad4\u3002\u4f46\u662f\u82e5\u662f\u904e\u5927\u7684\u5beb\u5165\u91cf\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u58d3\u7e2e\u6574\u5408\u7684\u901f\u5ea6\u4f86\u4e0d\u53ca\u914d\u5408\uff0c\u9032\u800c\u7121\u9650\u91cf\u7684\u589e\u9577\u8a18\u61b6\u9ad4\uff0c\u6700\u7d42\u5d29\u6f70\uff0c\u9700\u8981\u66ff\u4ed6\u6e96\u5099\u76e3\u63a7\u7cfb\u7d71\u3002 \u6709\u6548\u6027 SSTable \u56e0\u5176\u53ef\u80fd\u6703\u9700\u8981\u53cd\u8986\u58d3\u7e2e\u6574\u5408\uff0c\u5118\u7ba1\u662f\u80cc\u666f\u57f7\u884c\uff0c\u4ecd\u6703\u5403\u6389\u6a5f\u5668\u7684 CPU\uff0c\u5c0e\u81f4\u901f\u5ea6\u964d\u4f4e B-Tree \u5176 latency \u901a\u5e38\u8f03\u7a69\u5b9a \u6bcf\u53f0\u6a5f\u5668\u6bcf\u79d2\u80fd\u5beb\u5165\u7684\u91cf\u6709\u9650\uff0cSSTable \u9700\u8981\u58d3\u7e2e\u6574\u5408\uff0c\u6bcf\u6b21\u66ab\u5b58\u7684\u6700\u65b0\u8cc7\u6599\u584a\u53c8\u9700\u8981\u8db3\u5920\u4efd\u91cf\u7684\u5beb\u5165\uff0c\u5c0e\u81f4\u4e92\u76f8\u7af6\u722d\uff0c\u62d6\u6162\u901f\u5ea6\u3002 \u539f\u5b50\u6027 B-Tree \u4e2d\uff0c\u6bcf\u500b key \u53ea\u6703\u6709\u4e00\u500b value\uff0c\u53ef\u900f\u904e\u9396\u5b9a\u7279\u5b9a page \u4f86\u4fdd\u6301\u539f\u5b50\u6027\u3002 SSTable \u540c\u4e00\u500b key \u53ef\u80fd\u5b58\u5728\u591a\u500b\u8cc7\u6599\uff0c\u5728\u8655\u7406\u539f\u5b50\u6027\u6642\u6703\u9700\u8981\u8f03\u8cbb\u5de5\u7684\u6f14\u7b97\u6cd5 Index \u6392\u5e8f \u5f88\u591a\u60c5\u6cc1\u6211\u5011\u6703\u9700\u8981\u589e\u52a0\u9664\u4e86\u4e3b\u8981 index \u5916\u7684 index\uff08 secondary indexes \uff09\uff0c\u800c\u9019\u985e\u7684 index \u4e0d\u4e00\u5b9a\u9700\u8981 unique\uff0c\u4f8b\u5982\u4e0a\u8ff0\u4f8b\u5b50\u4e2d\u7684\u5e74\u9f61\u6216\u6708\u6536\u5165\u3002 \u9019\u7a2e\u60c5\u6cc1\u6709\u5169\u7a2e\u65b9\u5f0f\u53ef\u4ee5\u89e3\u6c7a\u53ef\u91cd\u8907\u6027\u7684 index\u3002 key-value \u4e2d\u7684 value \u4ee3\u8868\u591a\u500b primary index \u3002\u4f8b\u5982\uff0c\u5e74\u9f61 20 \u7684 value \u6709 [user-1, user-10] \u7528 primary index \u53bb\u6574\u5408 secondary-key \u3002\u4f8b\u5982\uff0c\u624b\u6a5f\u70ba 09123 \u7684 key-value \u70ba 1_09123-*user data* \u9664\u6b64\u4e4b\u5916\uff0c\u907f\u514d\u540c\u6b65\u7684\u56f0\u96e3\uff0c\u90fd\u4e0d\u6703\u628a\u5b8c\u6574\u8cc7\u6599\u653e\u5728\u591a\u500b index \u7684 tree \u4e2d\uff0c\u800c\u662f\u5b58\u9032 heap file clustered index covering index heap file \u6240\u8b02\u7684 heap file \u5c31\u662f\u5b58\u653e\u591a\u500b\u540c secondary index \u7684\u6a94\u6848\u3002 \u9019\u65b9\u6cd5\u4f7f\u7528\u8d77\u4f86\u5f88\u55ae\u7d14\uff0c\u56e0\u70ba\u7576\u6a94\u6848\u6709\u591a\u500b\u8cc7\u6599\u3002\u4f8b\u5982\u4e0a\u8ff0\u4e2d\u7684 [user-1, user-10] \uff0c\u5c31\u76f4\u63a5\u4ee5\u4e0b\u5217\u7684\u65b9\u5f0f\u505a\u5132\u5b58 # ID,Name,Year,Salary 1,John,20,500 10,Marry,20,550 \u800c primary index \u7684\u6a39\u72c0\u7d50\u69cb\u4ecd\u7136\u53ef\u4ee5\u5132\u5b58 heap file \u7684\u4f4d\u7f6e\u8cc7\u8a0a\u3002\u4f8b\u5982 user-10 \u7684 value \u53ef\u80fd\u5c31\u662f 40\uff08\u7b2c 40 \u500b byte \u958b\u59cb\u7b97\u8d77\uff09\u3002\u4f46\u662f\u7576\u8cc7\u6599\u66f4\u65b0\u6642\uff0c\u5c31\u9700\u8981 \u628a\u6240\u6709 index \u7684\u8cc7\u6599\u5eab\u90fd\u66f4\u65b0\u6a94\u6848\u4f4d\u7f6e\u3002 \u6216\u628a\u820a\u7684 heap file \u5b58\u653e\u65b0\u7684 heap file \u4f4d\u7f6e\uff0c\u9019\u6a23\u641c\u5c0b\u6642\u9593\u6703\u8d8a\u4f86\u8d8a\u9577 clustered index clustered index \u985e\u4f3c\u65bc primary index \uff0c\u5176\u610f\u7fa9\u4ee3\u8868\u5b58\u653e\u8cc7\u6599\u7684 index\u3002\u7576\u900f\u904e secondary indexes \u627e\u5230\u7279\u5b9a\u8cc7\u6599\u7684 clustered index \u6642\uff0c\u518d\u5229\u7528\u5176\u627e\u5230\u8cc7\u6599\u3002 \u4f46\u662f\u9019\u7a2e\u65b9\u5f0f\u6703\u9700\u8981\uff1a \u984d\u5916\u7684\u5132\u5b58\u7a7a\u9593\uff08\u591a\u958b\u4e00\u500b Index Tree \u53bb\u5b58\uff09\u3002 \u800c\u4e14\u9700\u8981\u82b1\u4e00\u4e9b\u529f\u53bb\u7dad\u6301\u539f\u5b50\u6027 \u4e0d\u50cf heap file \u76f4\u63a5\u5beb\u4e00\u500b\u65b0\u7684\u6a94\u6848\u5c31\u53ef\u4ee5\u3002 \u6bcf\u6b21\u66f4\u65b0 secondary indexes \u90fd\u6703\u5f71\u97ff\u540c\u6642\u9593\u5176\u4ed6\u4eba\u641c\u5c0b\u8a72\u8cc7\u6599\u7684\u7d50\u679c\u3002 covering index covering index \u4e0d\u540c\u65bc clustered index \u6703\u628a\u8cc7\u6599 \u5168\u90e8 \u5b58\u9032 index \u4e2d\uff0c\u800c\u662f\u628a\u90e8\u5206\uff08\u82e5\u751a\u81f3\u5b8c\u5168\u6c92\u6709\uff09\u7684\u8cc7\u6599\u5b58\u9032\u5b58\u9032 index \u4e2d\u3002\u4e26\u628a\u5b8c\u6574\u8cc7\u6599\u7684\u4f4d\u7f6e\u5b58\u9032 index \u4e2d\u3002 cover \u4ee3\u8868\u7684\u610f\u601d\u5c31\u662f\uff0c\u96d6\u5132\u5b58\u90e8\u5206\u8cc7\u6599\uff0c\u4ed6\u537b\u53ef\u4ee5 cover \u5e38\u5b58\u53d6\u7684 column\u3002 HyperDex \u4e0a\u8ff0\u6709\u63d0\u5230\u6bcf\u6b21 query \u53ea\u6703\u53c3\u8003\u4e00\u500b index\u3002\u4f46\u662f\u591a\u500b index \u53bb\u505a\u7be9\u9078\u6703\u5927\u5927\u52a0\u901f\u641c\u5c0b\u7684\u901f\u5ea6\uff0c\u8a72\u600e\u9ebc\u8fa6\uff1f \u4f8b\u5982\uff1a\u6211\u8981\u641c\u5c0b\u7d93\u7def\u5ea6\u5728 51.5151 122.122122 \u7684\u5546\u5e97\u3002\u82e5\u662f\u4f7f\u7528\u55ae\u4e00\u628a\u7def\u5ea6\u4f5c index\uff0c\u5247\u53ef\u80fd\u641c\u5c0b\u5230\u6240\u6709\u7d93\u5ea6\u5728 -180~180 \u7bc4\u570d\u5167\u7684\u8cc7\u8a0a\uff0c\u641e\u5f97\u6709 index \u8ddf\u6c92 index \u4e00\u6a23\u3002 \u7c21\u55ae\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 concatenated index \uff0c\u4e5f\u5c31\u662f\u628a\u5169\u500b index \u6574\u5408\u518d\u4e00\u8d77\u3002\u4f8b\u5982\uff0c\u9700\u8981\u641c\u5c0b\u59d3\u548c\u540d\u4e00\u6a23\u7684\u4f7f\u7528\u8005\uff0c\u641c\u5c0b\u59d3\u548c\u540d\u7684 concatenated index \uff1a \u738b \u5c0f\u660e \uff0c\u4f46\u662f\u7576\u641c\u5c0b\u689d\u4ef6\u6539\u6210 \u5c0f\u660e \u738b \uff1f \u6bd4\u8d77 concatenated index \uff0c\u66f4\u5e38\u4f7f\u7528\u7684\u65b9\u5f0f\u662f\u91cd\u65b0\u8a2d\u8a08\u4e00\u500b\u5132\u5b58 index \u7684\u6a39\u72c0\u7d50\u69cb\uff1a R-Tree \u3002 \u5176\u4ed6\u53ef\u80fd\u9700\u8981\u591a\u7dad\u5ea6\u7684 index \u5834\u666f\u6709\uff1a \u96fb\u5546\u9700\u8981\u641c\u5c0b\u9577\u3001\u5bec\u3001\u9ad8\u7684\u5546\u54c1 \u4eba\u529b\u9280\u884c\u9700\u8981\u641c\u5c0b\u85aa\u8cc7\u3001\u8ddd\u96e2\u65b0\u5e97\u6700\u8fd1\u7684\u5de5\u4f5c Fuzzy Index \u6709\u6642\u8981\u641c\u5c0b\u7684 Index \u662f\u6587\u5b57\uff0c\u800c\u9019\u4e32\u6587\u5b57\u53c8\u662f\u4eba\u985e\u8a9e\u8a00\uff0c\u9019\u6642\u5728\u505a\u641c\u5c0b\u6642\u5c31\u53ef\u80fd\u9700\u8981\u8003\u616e\uff1a \u62fc\u932f\u3002 \u6587\u6cd5\u8f49\u63db\u3002\u5982\uff1a\u904e\u53bb\u5f0f\u3001\u73fe\u5728\u5f0f\u3002 \u540c\u7fa9\u8a5e\u3002 \u8a72\u8a5e\u5f59\u9577\u642d\u914d\u7684\u8a5e\u3002\u5982\uff1a\u6e1b\u80a5\u3001\u904b\u52d5\u3002 \u5982\u540c SSTable \u6703\u5229\u7528\u7a00\u758f\u7684\u9375\uff08sparse keys\uff09\u53bb\u6e1b\u5c11 Index \u7684\u5132\u5b58\u91cf\uff0cLucene \u7684\u5168\u6587\u6aa2\u7d22\u8cc7\u6599\u5eab\u4e5f\u6703\u628a\u5b57\u8a5e\u7684\u90e8\u5206\u5b57\u5143\u4f5c\u70ba\u7a00\u758f\u7684\u9375\uff08\u985e\u4f3c trie \u6a39\u72c0\u7d50\u69cb\uff09 1 \uff0c\u52a0\u901f\u6a21\u7cca\u641c\u5c0b\uff08fuzzy search\uff09\u3002 \u5176\u4ed6\u985e\u578b\u7684 fuzzy index \u7684\u6f14\u7b97\u6cd5\u53ef\u80fd\u70ba\u6587\u7ae0\u5206\u985e\u3001\u6a5f\u5668\u5b78\u7fd2\u7b49\u3002 \u5167\u5b58\u8cc7\u6599\u5eab \u628a\u8cc7\u6599\u5b58\u9032\u6a94\u6848\uff08filesystem\uff09\u548c\u628a\u8cc7\u6599\u90fd\u5b58\u9032\u5167\u5b58\u8a18\u61b6\u9ad4\uff08RAM\uff09\u6bd4\uff0c\u6709\u5169\u500b\u597d\u8655 \u7576\u96fb\u6e90\u5207\u65b7\uff0c\u8a18\u61b6\u9ad4\u7684\u8cc7\u6599\u5c31\u6c92\u4e86 \u4fbf\u5b9c \u4f46\u662f\u70ba\u4e86\u89e3\u6c7a filesystem \u5728\u8b80\u5beb\u7684\u6548\u7387\u5e73\u8861\uff0c\u767c\u5c55\u4e86\u5f88\u591a\u6a5f\u5236\uff1aIndex\u3001File \u5927\u5c0f\u548c\u6578\u91cf\u7b49\u7b49\u3002 \u8fd1\u4f86 RAM \u8d8a\u4f86\u8d8a\u4fbf\u5b9c\uff0c\u4e14\u82e5\u8cc7\u6599\u5eab\u4e26\u4e0d\u9700\u8981\u5132\u5b58\u5927\u578b\u8cc7\u6599\uff0c\u9019\u6642\u4fbf\u767c\u5c55\u51fa\u5167\u5b58\u8cc7\u6599\u5eab\uff08in-memory database\uff09\uff0c\u5176\u7a2e\u985e\u5927\u81f4\u5206\u5169\u7a2e\uff1a \u4e0d\u5728\u4e4e\u7576\u96fb\u6e90\u5207\u65b7\uff0c\u662f\u5426\u9700\u8981\u7dad\u6301\u8cc7\u6599\uff1a Memcached \u9700\u8981\u7dad\u6301\u8cc7\u6599\uff1a VoltDB \u3001 MemSQL \u3001 Oracle TimesTen \u3001 Redis \u3001 Couchbase \u900f\u904e\u7279\u6b8a\u786c\u9ad4\uff08\u4e0d\u65b7\u96fb\u7cfb\u7d71\uff09 \u5beb Log\uff0c\u9019\u65b9\u6cd5\u9664\u7dad\u6301\u8cc7\u6599\uff0c\u4e5f\u64c1\u6709\u63d0\u4f9b\u5099\u4efd\u3001\u65b9\u4fbf\u5206\u6790\u7b49\u597d\u8655\u3002 \u5b9a\u6642\u5feb\u7167\u3002 \u900f\u904e\u5176\u4ed6\u6a5f\u5668\u8907\u88fd\u8cc7\u6599\uff08replicate\uff09 \u5167\u5b58\u8cc7\u6599\u5eab\u4e0d\u50c5\u50c5\u56e0\u70ba\u8b80\u53d6\u6642\u4e0d\u63a5\u89f8 filesystem\uff0c\u5176\u5132\u5b58\u7684\u6a94\u6848\u683c\u5f0f\u5df2\u7d93\u7d93\u904e\u89e3\u6790\uff08parse\uff09\uff0c\u964d\u4f4e\u4e86\u89e3\u6790\u6240\u9700\u6d88\u8017\u7684\u6548\u80fd\u3002\u9019\u540c\u6642\u4e5f\u8b93\u5167\u5b58\u8cc7\u6599\u5eab\u5141\u8a31\u66f4\u591a\u7a2e\u985e\u7684\u5132\u5b58\uff0c\u4f8b\u5982\u4f47\u5217\uff08queue\uff09\u6216\u53e2\u96c6\uff08set\uff09\u3002 \u9664\u6b64\u4e4b\u5916\uff0c\u8fd1\u4f86\u4e5f\u6709\u9700\u591a\u7814\u7a76\uff0c\u8b93\u5167\u5b58\u8cc7\u6599\u5eab\u4e0d\u518d\u53d7\u9650\u65bc\u5167\u5b58\u8a18\u61b6\u9ad4\u7684\u5927\u5c0f\uff0c\u7576\u5927\u5c0f\u8d85\u51fa\u5176\u8ca0\u8377\u6642\uff0c\u8cc7\u6599\u5eab\u6703\u628a\u6700\u4e45\u6c92\u5b58\u53d6\u7684\u8cc7\u6599\u653e\u9032 filesystem \u4e2d\uff0c\u985e\u4f3c OS \u5728\u64cd\u4f5c\u5927\u578b\u8cc7\u6599\u6642\u7684\u505a\u6cd5\uff0c\u7136\u800c\u537b\u66f4\u70ba\u7cbe\u6e96\uff0c\u800c\u975e\u4e00\u6b21\u50c5\u80fd\u63a7\u5236\u4e00\u7d44\u8a18\u61b6\u9ad4\u5340\u584a\u3002 http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.16.652 \u21a9","title":"\u7d22\u5f15"},{"location":"feedback/designing-data-intensive-applications/db-index/#index","text":"\u7d22\u5f15\uff08Index\uff09\u901a\u5e38\u662f\u5728\u4e3b\u8981\u8cc7\u6599\u4e0b \u984d\u5916 \u5efa\u7acb\u7684 metadata\uff0c\u4e26\u7576\u6709\u8cc7\u6599\u9700\u8981\u300c\u5beb\u5165\u300d\u6642\uff0c\u66f4\u65b0\u9019\u4efd metadata\u3002 \u7531\u6b64\u53ef\u77e5\uff0c\u5728\u63d0\u5347\u300c\u8b80\u53d6\u300d\u6548\u80fd\u7684\u540c\u6642\uff0c\u4fbf\u9700\u8981\u72a7\u7272\u90e8\u5206\u300c\u5beb\u5165\u300d\u6548\u80fd\u3002 \u5de5\u5177\u7684\u9078\u64c7\u5e38\u5e38\u90fd\u662f\u5728\u505a\u6b0a\u8861\uff0c\u82e5\u60c5\u5883\u9700\u8981\u9ad8\u6548\u80fd\u7684\u8b80\u53d6\uff0c\u90a3\u6216\u8a31\u5c31\u61c9\u8a72\u8003\u616e\u6dfb\u52a0 Index\u3002 \u4ee5\u4e0b\u7684 index \u90fd\u4ee3\u8868 key-value \u4e2d\u7684 key \u6216\u8005\u8aaa RMDBS \u4e2d\u7684 primary key \u5927\u5bb6\u53ef\u80fd\u5f88\u5e38\u4f7f\u7528\u5230 Index\uff0c\u4f8b\u5982\uff1a user \u8868\u683c\u4e2d\u5e74\u7d00\u5c0f\u65bc 30 \u6b72\u4e14\u6708\u6536\u5165\u5927\u65bc 500 \u584a\u7684 user\u3002 \u6211\u5011\u8a2d\u8a08\u4e86\u5169\u500b index \u5206\u5225\u662f\u5e74\u9f61\u548c\u6536\u5165\uff0c\u4f46 \u70ba\u4ec0\u9ebc query \u6642\u53ea\u91dd\u5c0d\u55ae\u4e00\u500b index \u4f5c\u641c\u5c0b\u5462\uff1f \u540c\u6642\u4f7f\u7528\u5169\u500b index \u53bb\u505a\u641c\u5c0b\u4e0d\u662f\u975e\u5e38\u76f4\u89c0\u55ce\uff1f Index \u7684\u610f\u7fa9\u901a\u5e38\u662f\u8b93\u641c\u5c0b\u7684\u6b21\u6578\u5f9e n \uff08\u8cc7\u6599\u7e3d\u6578\uff0c\u4f8b\u5982\u4e00\u767e\u842c\uff09\u8b8a\u6210 ln(n) \uff08\u641c\u5c0b\u6b21\u6578\uff0c\u4f8b\u5982\u4e09\u6b21\uff09\uff0c\u5728\u627e\u5230\u7279\u5b9a\u7684\u8cc7\u6599\uff08\u7fa4\uff09\u4e4b\u5f8c\u4fbf\u7121\u6cd5\u4f7f\u7528 index\uff0c\u56e0\u70ba index \u8868\u683c\u7684\u5efa\u7acb\u90fd\u662f\u4ee5\u5168\u90e8\u8cc7\u6599\u70ba\u57fa\u790e\u3002 \u7576\u7136\uff0c\u6709\u4e9b\u6a39\u72c0\u7d50\u69cb\uff08R-Tree\uff09\u5141\u8a31\u591a\u4f4d\u5143\u7684\u641c\u5c0b\uff0c\u4e0b\u9762\u6703\u505a\u4ecb\u7d39\u3002 [1,5,10] [1,3,5] [6,8,10] [1,2,3] [4,5] [6,7,8] [9,10] \u4f8b\u5982\u4e0a\u8ff0\uff0c\u627e\u5230 1~3 \u4e4b\u5f8c\uff0c\u82e5\u9700\u8981\u5728\u505a filter\uff0c\u5247\u9700\u8981\u904d\u6b77\u8cc7\u6599\u624d\u80fd\u9054\u5230\u76ee\u7684\u3002","title":"Index"},{"location":"feedback/designing-data-intensive-applications/db-index/#hash-index","text":"\u4ee5 in-memory \u7684\u65b9\u5f0f\u7d00\u9304 key \u4f4d\u7f6e\uff1a key offset 1 411 42 393 1,{\"a\":\"b\"} 2,{\"c\":\"d\"} ... 42,{\"e\":\"f\"} 1,{\"g\":\"h\"} \u6bcf\u6b21\u66f4\u65b0\u6216\u65b0\u589e key-value \u6642\uff0c\u540c\u6642\u66f4\u65b0\u8a72 hash index\u3002","title":"Hash index"},{"location":"feedback/designing-data-intensive-applications/db-index/#_1","text":"\u56e0\u70ba\u662f\u4e00\u76f4\u65b0\u589e\u8cc7\u6599\u5230\u6a94\u6848\u5c3e\u90e8\uff0c\u5982\u4f55\u907f\u514d\u7121\u9650\u5236\u7684\u6a94\u6848\u5927\u5c0f\u589e\u9577 \u6a94\u6848\u683c\u5f0f \u4f7f\u7528\u4e8c\u9032\u4f4d\u7684\u8f49\u63db\uff0c\u964d\u4f4e\u5b57\u4e32\u3001\u6578\u5b57\u7b49\u7b49\u591a\u6a23\u7684\u8b8a\u6578\u683c\u5f0f\u8f49\u63db\uff0c\u4f8b\u5982\u8868\u60c5\u7b26\u865f\u3002 \u5982\u4f55\u522a\u9664\u6307\u5b9a\u8cc7\u6599 \u9700\u8981\u5728\u8a72 key \u4e2d\u7d66\u4e88\u7279\u5b9a\u503c\uff08tombstone\uff09\uff0c\u7576 compaction \u548c merge segment \u5f8c\uff0c\u6703\u81ea\u52d5\u6368\u68c4\u8a72\u9375\u503c\u3002 \u6a5f\u5668\u91cd\u555f\u6642\uff0c\u91cd\u65b0\u7372\u5f97 hash index \u9700\u8981\u5168\u6587\u8b80\u53d6\uff0c\u975e\u5e38\u8017\u6642 \u6703\u5b9a\u6642\u5b9a\u91cf\u5feb\u7167\uff08snapshot\uff09hash index \u9032\u6a94\u6848\uff0c\u907f\u514d\u6a5f\u5668\u91cd\u555f\u6642\u7684\u5168\u6587\u6aa2\u7d22\u3002 \u5beb\u5165\u8cc7\u6599\u5230\u4e00\u534a\u6642\uff0c\u6a5f\u5668\u58de\u6389 \u5efa\u7acb\u6838\u5c0d\u548c\uff08checksums\uff09\uff0c\u82e5\u6838\u5c0d\u548c\u6709\u932f\uff0c\u5247\u4e0d\u4f7f\u7528\u8a72\u503c\u3002 \u5982\u4f55\u78ba\u4fdd\u540c\u6b65\u63a7\u5236\uff08Concurrency Control\uff09\u6642\u9020\u6210\u7684\u932f\u8aa4\uff0c\u4f8b\u5982 A \u8cc7\u6599\u5beb\u5230\u4e00\u534a\u6642\uff0cB \u8cc7\u6599\u8981\u958b\u59cb\u5beb\u5165\u4e86\uff0cB \u8981\u5982\u4f55\u7b49 A \u5beb\u5b8c \u50c5\u958b\u653e\u4e00\u500b\u5beb\u5165\u7684\u7dda\u7a0b\uff08thread\uff09\u3002","title":"\u554f\u984c"},{"location":"feedback/designing-data-intensive-applications/db-index/#_2","text":"\u7576\u6a94\u6848\u9054\u5230\u4e00\u5b9a\u5927\u5c0f\u6642\uff1a \u628a\u6a94\u6848\u5340\u5206\u6210\u597d\u5e7e\u584a\uff08segment\uff09\uff0c\u6bcf\u500b\u5340\u584a\u7368\u81ea\u7d00\u9304\u4ed6\u5011\u7684 hash index\u3002 \u7576\u5340\u584a\u592a\u5927\u6642\uff0c\u958b\u59cb\u9032\u884c\u58d3\u7e2e\uff08compaction\uff09\uff0c\u628a\u820a\u7684 key-value \u6368\u68c4\uff0c\u4e26\u628a\u6709\u6548\u8cc7\u6599\u5beb\u5165\u65b0\u7684\u6a94\u6848\u3002 \u5169\u500b\u5c0f\u5340\u584a\u53ef\u4ee5\u9032\u884c\u6574\u5408\uff08merge\uff09\u3002 \u6b64\u884c\u70ba\u662f\u5728\u80cc\u666f\u57f7\u884c\uff0c\u82e5\u57f7\u884c\u5230\u4e00\u534a\u6709\u8b80\u5beb\u7684\u8acb\u6c42\uff0c\u6703\u7e7c\u7e8c\u4f7f\u7528\u820a\u7684 segment\uff0c\u6700\u5f8c\u58d3\u7e2e\u6574\u5408\u5b8c\u7562\u5f8c\u624d\u4f7f\u7528\u65b0\u7684 segment\uff0c\u4e26\u628a\u820a\u7684 segment \u522a\u9664\u3002 \u641c\u5c0b\u6642\uff0c\u82e5\u5728 segment 1 \u4e2d\u7684 hash index \u627e\u4e0d\u5230\u8a72 key\uff0c\u5c31\u5f80\u4e0b\u4e00\u500b segment \u627e\u3002","title":"\u6a94\u6848\u58d3\u7e2e\u6574\u5408"},{"location":"feedback/designing-data-intensive-applications/db-index/#_3","text":"Hash index \u82e5\u904e\u5927\uff0c\u6216\u8005\u8aac key \u904e\u591a\uff0c\u52e2\u5fc5\u6703\u5927\u5927\u5f71\u97ff\u6548\u80fd\u3002 \u6c92\u8fa6\u6cd5\u5feb\u901f\u67e5\u8a62\u7bc4\u570d\u7684 key\uff0c\u4f8b\u5982\u60f3\u77e5\u9053\u4ee5 animal \u70ba\u958b\u982d\u7684\u9375\u503c\u6578\u91cf\u3002","title":"\u7f3a\u9ede"},{"location":"feedback/designing-data-intensive-applications/db-index/#_4","text":"Bitcask","title":"\u61c9\u7528"},{"location":"feedback/designing-data-intensive-applications/db-index/#sstables","text":"\u8a72\u67b6\u69cb\u539f\u5148\u7a31 Log-Structured Merge-Tree\uff08LSM-Tree\uff09\uff0c\u5f8c\u4fee\u6b63\u90e8\u5206\u884c\u70ba\u5f8c\u65bc \u8ad6\u6587 \u4e2d\uff0c\u91cd\u65b0\u547d\u540d\u70ba Sorted String Tables\uff08SSTables\uff09\u3002 \u5982\u540c\u4e0a\u8ff0\u7684 Hash index\uff0c\u6703\u628a index \u5206\u6210\u597d\u5e7e\u500b segment \u6a94\u6848\u3002SSTable \u5728\u5206\u6210\u4e0d\u540c segment \u7684\u540c\u6642\uff0c\u6703\u78ba\u4fdd\u6bcf\u500b segment \u7684 key \u662f\u7368\u7acb\uff08non-overlapping\uff09\u4e14\u6392\u5e8f\uff08sorted\uff09\u7684\u3002\u9019\u6a23\u80fd\u78ba\u4fdd\u4ee5\u4e0b\u7279\u6027\uff1a \u5728\u505a merge \u7684\u904e\u7a0b\uff0c\u53ef\u4ee5\u975e\u5e38\u6709\u6548\u7387\u4e14\u7701\u7a7a\u9593\uff1a File1 File2 File3 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Apple \u2502 \u2502 Apple \u2502 \u2502 Avocado \u2502 \u2502 Apricot \u2502 \u2502 Banana \u2502 \u2502 Berry \u2502 \u2502 Banana \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Step1 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Apple \u2502 \u2502 Apple * \u2502 \u2502 Avocado \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534 Step2 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Apricot * \u2502 \u2502 Banana \u2502 \u2502 Avocado \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Step3 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Banana \u2502 \u2502 Banana \u2502 \u2502 Avocado * \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Step4 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Banana \u2502 \u2502 Banana * \u2502 \u2502 Berry \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u5132\u5b58 index \u6642\uff0c\u4e0d\u518d\u9700\u8981\u628a\u6bcf\u500b key \u90fd\u5b58\u8d77\u4f86\uff0c\u56e0\u70ba\u662f\u6392\u5e8f\u904e\u5f8c\u7684\uff0c\u5b58\u7279\u5b9a\u5e7e\u500b key \u518d\u5f9e\u4e2d\u9593\u627e\u5c31\u597d\uff1a key offset 1 0 42 393 \u7576\u6211\u8981\u627e key 30 \u7684\u8cc7\u6599\u6642\uff0c\u53ea\u9700\u8981\u627e 0 \u5230 393 \u5373\u53ef\u3002 \u56e0\u70ba\u5132\u5b58\u7684 index \u662f\u758f\u6563\uff08sparse\uff09\u7684\uff0c\u6240\u4ee5\u5728 key \u548c key \u4e4b\u9593\u7684\u8cc7\u6599\u53ef\u4ee5\u9032\u884c\u58d3\u7e2e\uff1a \u4ee5\u4e0a\u8ff0\u7684\u8868\u683c\u70ba\u4f8b\uff0c key 1 \u5230 key 42 \u4e4b\u9593\u7684\u8cc7\u6599\u9032\u884c\u58d3\u7e2e\uff08compress\uff09\u3002","title":"SSTables"},{"location":"feedback/designing-data-intensive-applications/db-index/#_5","text":"\u7531\u4e0a\u8ff0\u7684\u4e00\u4e9b\u7279\u6027\uff0c\u53ef\u4ee5\u7e3d\u7d50 SSTables \u5728\u5be6\u4f5c\u4e0a\u7684\u932f\u7565\u5982\u4e0b\uff1a \u6bcf\u6b21\u8cc7\u6599\u9032\u4f86\uff0c\u5b58\u9032 in-memory \u7684\u6a39\u72c0\u7d50\u69cb\uff08red-black tree \u6216 AVL tree\uff09\uff0c\u8a72\u6a39\u72c0\u7d50\u69cb\u53ef\u4ee5\u4fdd\u8b49\u65b0\u7684\u8cc7\u6599\u6703\u4ee5\u6392\u5e8f\u904e\u7684\u65b9\u5f0f\u5b58\u9032\u7d50\u69cb\u4e2d\u3002 \u7576\u6a39\u72c0\u7d50\u69cb\u8d8a\u4f86\u8d8a\u5927\uff0c\u8d85\u904e\u95a5\u503c\uff08\u901a\u5e38\u6578\u500b MB\uff09\uff0c\u5b58\u9032\u6a94\u6848\uff08segment\uff09\u88e1\u3002\u56e0\u70ba\u5df2\u7d93\u6392\u5e8f\u904e\uff0c\u6240\u4ee5\u5132\u5b58\u7684\u6548\u7387\u6a5f\u6236\u7b49\u65bc I/O \u7684\u6548\u7387 \u7576\u6709\u8b80\u53d6\u7684\u8acb\u6c42\u6642\uff0c\u5148\u8b80\u53d6 in-memory \u518d\u5f9e\u6700\u65b0\u7684\u6a94\u6848\u4f9d\u5e8f\u8b80\u53d6\u3002 \u96a8\u8457\u6642\u9593\u9032\u884c\uff0c\u6301\u7e8c\u9032\u884c\u6574\u5408\uff08merging\uff09\u8207\u58d3\u7e2e\uff08compaction\uff09\u3002 \u7576\u6a5f\u5668\u58de\u6389\u6642\uff0cin-memory \u7684\u8cc7\u6599\u5c31\u6703\u907a\u5931\uff1f \u6bcf\u6b21\u65b0\u7684\u5beb\u5165\u9700\u6c42\uff0c\u90fd\u5373\u6642 append \u5230\u4e00\u500b\u7279\u6b8a\u6a94\u6848\u4e2d\uff0c\u4e14\u4e0d\u9700\u6392\u5e8f\uff0c\u6b64\u6a94\u6848\u6bcf\u6b21 in-memory \u88ab\u6e05\u7a7a\u6642\uff0c\u90fd\u6703\u8ddf\u8457\u6e05\u7a7a\u3002\u6b64\u6a94\u6848\u7684\u529f\u80fd\u53ea\u7528\u4f86\u7576\u6a5f\u5668\u91cd\u555f\u6642\uff0c\u91cd\u65b0\u653e\u9032 in-memory \u7684\u6a39\u72c0\u7d50\u69cb\u3002","title":"\u7b56\u7565"},{"location":"feedback/designing-data-intensive-applications/db-index/#_6","text":"Google LevelDB Facebook RocksDB - based on LevelDB Apache Cassandra (\u985e\u4f3c) - based on Big Table paper Apache HBase (\u985e\u4f3c) - based on Big Table paper Lucene \uff08\u88ab Elasticsearch \u548c Solr \u4f7f\u7528\uff09 - term dictionaries \u96d6\u7136 Lucene \u662f\u63d0\u4f9b\u5168\u6587\u6aa2\u7d22\u7684\u5f15\u64ce\uff0c\u5168\u6587\u6aa2\u7d22\u6bd4\u8d77 key-value \u7684\u6aa2\u7d22\u8981\u66f4\u70ba\u8907\u96dc\uff0c\u4f46\u5176\u908f\u8f2f\u985e\u4f3c\uff1a\u4ee5 search words \u4f5c\u70ba key\uff0c\u6587\u7ae0\u7684 ID \u4f5c\u70ba value\u3002","title":"\u61c9\u7528"},{"location":"feedback/designing-data-intensive-applications/db-index/#_7","text":"\u82e5\u641c\u5c0b\u7684\u8cc7\u6599\u662f\u4e0d\u5b58\u5728\u7684\uff08non-exist key\uff09\uff0c\u5c31\u9700\u8981\u6240\u6709\u6a94\u6848\u90fd\u95b1\u6b77\u5f8c\u624d\u80fd\u5224\u65b7\u3002 Bloom filters \u7279\u6b8a\u7d50\u69cb\u7684\u6a94\u6848\uff0c\u6703\u5927\u7565\u63cf\u8ff0\u8cc7\u6599\u5eab\u7684\u72c0\u614b\uff0c\u4e26\u544a\u8a34\u4f60\u8a72\u9375\u503c\u662f\u5426\u5b58\u5728 \u8a72\u4ee5\u4f55\u7a2e\u9806\u5e8f\u548c\u6642\u9593\u9ede\u9032\u884c\u6574\u5408\uff08merging\uff09\u8207\u58d3\u7e2e\uff08compaction\uff09\u3002 size-tiered - \u65b0\u7684\u548c\u5c0f\u7684 segment \u6703\u88ab\u6574\u5408\u58d3\u7e2e\u9032\u820a\u7684\u3002 segment \u6578\u91cf\u5c11 segment \u5927\u5c0f\u6703\u662f 4/16/64... \u65b9\u5f0f\u500d\u589e segment \u9593\u6703\u6709 overlapping \u7684\u72c0\u6cc1 leveled compaction - \u6bcf\u4e00\u5c64\u5728\u5347\u7d1a\u6642\u6703\u505a\u6574\u5c64\u7684\u58d3\u7e2e segment \u6578\u91cf\u591a\uff0c\u7b2c\u4e00\u5c64\u6a94\u6848\u6578 10 \u500b\uff0c\u7b2c\u4e8c\u5c64\u662f 100 \u500b segment \u5927\u5c0f\u662f\u56fa\u5b9a\u7684 \u6bcf\u4e00\u5c64\uff08level\uff09\u7684 segment \u9593\u4e0d\u6703\u6709 overlapping \u7684\u72c0\u6cc1 \u66f8\u4e2d\u63d0\u51fa\u5169\u7a2e\u65b9\u5f0f\uff0c\u6709\u8208\u8da3\u53ef\u4ee5\u5230 \u9019\u88e1 \u67e5\u770b\u66f4\u591a\u7b56\u7565\u3002 \u66f4\u591a\u8a73\u60c5\u53ef\u4ee5\u53c3\u8003 LevelDB \u7684 \u5be6\u4f5c\u6587\u4ef6 \u3002","title":"\u88dc\u5145"},{"location":"feedback/designing-data-intensive-applications/db-index/#b-tree","text":"1970 \u5e74\u5c31\u8a2d\u8a08\u51fa\u7684\u6f14\u7b97\u6cd5\uff0c\u4e26\u88ab\u61c9\u7528\u65bc\u8cc7\u6599\u5eab\u4e2d\u3002\u800c\u9019\u4e5f\u662f\u8fd1\u4ee3\u8cc7\u6599\u5eab\u5728\u505a Index \u6642\u6700\u5e38\u4f7f\u7528\u7684\u6f14\u7b97\u6cd5\u3002 \u4e0a\u8ff0\u63d0\u5230\u7684\u65b9\u6cd5\u4e26\u4e0d\u6703\u53bb\u66f4\u65b0\u820a\u6709\u8cc7\u6599\uff0c\u53cd\u4e4b B-Tree \u5247\u6703\u53bb\u66f4\u65b0\u3002 \u4e5f\u5c31\u662f\u4ed6\u4e0d\u9700\u8981\u505a\u58d3\u7e2e\u548c\u6574\u5408\u7684\u52d5\u4f5c \u628a\u8cc7\u6599\u5340\u5206\u6210\u591a\u500b\u5c0f\u584a\uff08 blocks / page \uff09 \u6bcf\u500b\u5340\u584a\u7684\u5927\u5c0f\u901a\u5e38\u70ba 4KB\uff0c\u4e0d\u904e\u5be6\u969b\u4e0a\u4ecd\u8981\u8003\u616e\u786c\u9ad4\u7684\u914d\u7f6e\u3002 \u6bcf\u500b\u5340\u584a\u90fd\u6703\u6709\u4e00\u500b\u5730\u5740\u53bb\u4ee3\u8868\u4ed6\uff08\u985e\u4f3c\u7a0b\u5f0f\u78bc\u4e2d\u7684 pointer\uff0c\u6a94\u540d\uff09\u3002 \u6709\u4e00\u500b\u7279\u6b8a\u5340\u584a\u7a31\u70ba root\uff0c\u6bcf\u6b21\u641c\u5c0b\u90fd\u5148\u7d93\u904e\u8a72\u5340\u584a\u3002 \u5340\u584a\u5206\u5169\u7a2e \u8def\u5f91\u5340\u584a - \u7528\u4f86\u5c0e\u5f15\u81f3\u5404\u500b\u5340\u584a\uff0c\u5169\u500b key \u4e4b\u9593\u7684\u8cc7\u6599\u5373\u662f\u5b58\u653e\u9019\u5169\u8005\u4e4b\u9593\u7684\u8cc7\u6599\u4f4d\u7f6e \u8cc7\u6599\u5340\u584a - \u7528\u4f86\u5132\u5b58 key-value ref \u6578\u91cf\u4ee3\u8868 branching factor \uff0c\u4ee5\u4e0a\u5716\u70ba\u4f8b\u5373\u662f 6\uff0c\u901a\u5e38\u6578\u91cf\u70ba\u6578\u767e\u3002 \u6bcf\u584a 4 KB\uff0c branching factor 500\uff0c\u5171 4 \u5c64\uff0c\u53ef\u4ee5\u5b58 256 TB \u7684\u8cc7\u6599\u91cf \u65b0\u589e\u6216\u7de8\u8f2f\u8cc7\u8a0a\u6642\uff0c\u76f4\u63a5\u53bb\u5230\u8a72 val \u66f4\u65b0\u5373\u53ef\u3002 \u7576\u8d85\u904e branching factor \u7684\u5927\u5c0f\u6642\uff0c\u5c31\u6703\u5c0d\u534a\u62c6\u958b\u5f80\u4e0b\u4e00\u5c64\u653e\uff1a \u7531\u4e0a\u8ff0\u4e5f\u5f88\u6e05\u695a\u53ef\u4ee5\u77e5\u9053\uff0c\u76f8\u6bd4\u65bc Log-Structure \u7684\u65b9\u5f0f\uff0cwrite \u7684\u6548\u7387\u6703\u8f03\u4f4e\u3002","title":"B-Tree"},{"location":"feedback/designing-data-intensive-applications/db-index/#_8","text":"\u7531\u65bc B-Tree \u6703\u8986\u84cb\u5148\u524d\u5132\u5b58\u7684\u503c\uff0c\u9019\u6642\u5c31\u9700\u8981\u8003\u616e\u5230\u786c\u9ad4\u662f\u600e\u9ebc\u505a\u8986\u5beb\u7684\uff1f \u6a5f\u68b0\u5f0f\u78c1\u789f\uff0c\u7b49\u5f85\u8b80\u5beb\u982d\u9047\u5230\u6b63\u78ba\u4f4d\u7f6e\uff0c\u958b\u59cb\u8986\u5beb \u56fa\u614b\u786c\u789f\uff0c\u4ee5\u56fa\u5b9a\u55ae\u4f4d\u5927\u5c0f\u5beb\u5165\uff0c\u9700\u914d\u5408\u8edf\u9ad4 \u7c21\u800c\u8a00\u4e4b\uff0c\u591a\u4e00\u7a2e\u52d5\u4f5c\uff0c\u591a\u4e00\u5c64\u8003\u616e \u7576\u66f4\u65b0\u8cc7\u6599\u6642\uff0c\u53ef\u80fd\u6703\u628a page \u62c6\u5206\u5169\u500b\uff0c\u6216\u5f71\u97ff\u73fe\u6709\u8cc7\u6599\u3002\u505a\u5230\u4e00\u534a\u6642\uff0c\u6a5f\u5668\u58de\u4e86\u600e\u9ebc\u8fa6\uff1f write-ahead log\uff08WAL \u6216\u7a31 redo log \uff09\u6703\u7d00\u9304\u820a\u8cc7\u6599\uff0c\u4f5c\u70ba\u707d\u96e3\u5fa9\u539f\u7528\u3002 \u7576\u9700\u8981\u8655\u7406\u591a\u5de5\uff08concurrency control\uff09\uff0c\u4e00\u500b\u5de5\u4eba\u5728\u8b80\u53d6\u6642\uff0c\u6a39\u72c0\u7d50\u69cb\u53ef\u80fd\u662f\u4e0d\u7a69\u5b9a\u7684\uff08\u6b63\u5728\u8abf\u6574 B-Tree\uff09 \u9700\u8981\u5229\u7528 latches \u6f14\u7b97\u6cd5\u4f86\u9396\u5b9a\u5340\u584a\u4e0d\u88ab\u8b80\u53d6\u3002 \u7531\u6b64\u4e5f\u53ef\u4ee5\u770b\u51fa SSTable \u548c B-Tree \u5728\u8655\u7406\u9019\u554f\u984c\u7684\u96e3\u6613\u7a0b\u5ea6\uff0cSSTable \u5728\u58d3\u7e2e\u6574\u5408\u7684\u904e\u7a0b\u90fd\u662f\u80cc\u666f\u57f7\u884c\u7684\uff0c\u800c\u4e0d\u5f71\u97ff\u73fe\u6709\u8cc7\u6599\uff0c\u6700\u7d42\u57f7\u884c\u5b8c\u7562\u624d\u6703\u505a\u66f4\u65b0\u3002","title":"\u5982\u4f55\u589e\u52a0\u7a69\u5b9a\u5ea6"},{"location":"feedback/designing-data-intensive-applications/db-index/#_9","text":"1970 \u5e74\u5230\u73fe\u5728\uff0c\u4e5f\u505a\u4e86\u5f88\u591a\u512a\u5316\uff1a \u707d\u96e3\u5fa9\u539f\u6642 WAF \u4e4b\u5916\uff0c\u6709\u4e9b\u4e5f\u5229\u7528\u5feb\u7167\u7684\u65b9\u5f0f\uff0c\u5efa\u7acb\u526f\u672c\uff0c\u8b93\u8b80\u53d6\u6642\u4e0d\u5fc5\u9396\u5b9a\u8a72\u6a39\u3002 \u4e0d\u5fc5\u4f7f\u7528\u5b8c\u6574\u7684 key\uff0c\u800c\u662f\u5728\u78ba\u4fdd\u7368\u7acb\u6027\u7684\u540c\u6642\uff0c\u53d6\u7528\u7e2e\u5beb\u5373\u53ef\u3002 \u8b93\u76f8\u8fd1\u7684 page \u653e\u5728 filesystem \u7684\u9644\u8fd1\uff0c\u4f46\u662f\u7576\u6a39\u72c0\u7d50\u69cb\u88ab\u66f4\u65b0\uff0c\u5c31\u9700\u8981\u66f4\u6df1\u4e00\u5c64\u7684\u6f14\u7b97\u6cd5\u3002 \u589e\u52a0\u540c\u5c64\u9644\u8fd1 page \u7684\u5730\u5740\uff0c\u52a0\u901f\u641c\u5c0b \u4e00\u4e9b\u8b8a\u5f62\u7684 B-Tree \u6703\u6574\u5408 Log-Structure \u7684\u529f\u80fd\u53bb\u505a\u52a0\u901f ...","title":"\u5982\u4f55\u512a\u5316"},{"location":"feedback/designing-data-intensive-applications/db-index/#sstable-vs-b-tree","text":"\u8cc7\u6599\u5eab\u6548\u80fd\u548c\u61c9\u7528\u7a0b\u5f0f\u7684\u985e\u578b\u6709\u975e\u5e38\u5bc6\u5207\u7684\u95dc\u4fc2\uff0c\u6240\u4ee5\u5217\u51fa\u4e00\u4e9b\u9ede\u53ef\u4ee5\u505a\u53c3\u8003\uff1a SSTable \u9069\u5408\u5beb\u5165\uff0cB-Tree \u9069\u5408\u8b80\u53d6\u3002 B-Tree \u8f03\u6210\u719f\u7a69\u5b9a\u4f46\u662f SSTable \u6b63\u9010\u6f38\u63d0\u5347\u4f7f\u7528\u6bd4\u4f8b\u3002 \u7d30\u7bc0\uff1a \u5beb\u5165\uff1a\u6bcf\u6b21\u5beb\u5165\u9032\u8cc7\u6599\u5eab\u7684\u8cc7\u6599\uff0c\u5176\u4e00\u751f\u88ab\u91cd\u8907\u5beb\u5165\u786c\u9ad4\u7684\u6b21\u6578\u7a31\u70ba write amplification B-Tree \u6bcf\u6b21\u5beb\u5165\u9032\u8cc7\u6599\u5eab\u6642\u6642\uff0c\u90fd\u6703\u5beb\u5165\u81f3\u5c11\u5169\u904d\uff08WAL\uff09\uff0c\u4e14\u6bcf\u6b21\u66f4\u65b0 page \u7684\u4e9b\u5fae\u8cc7\u6599\uff0c\u90fd\u9700\u8981\u5b8c\u6574\u91cd\u65b0\u5beb\u5165\uff08\u56e0\u70ba\u662f\u6539\u52d5\u820a\u8cc7\u6599\uff09 SSTable write amplification \u901a\u5e38\u8f03\u4f4e\uff0c\u4f46\u53d7\u58d3\u7e2e\u548c\u6574\u5408\u7684\u6f14\u7b97\u6cd5\u6216\u4f7f\u7528\u8005\u8a2d\u5b9a\u5f71\u97ff\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u5176 append \u7684\u65b9\u5f0f\u4ecd\u8b93\u4ed6\u6709\u8f03\u9ad8\u7684\u5beb\u5165\u6548\u80fd \u6a5f\u68b0\u5f0f\u786c\u789f\uff08\u78c1\u789f\uff09\u5728\u6709\u9806\u5e8f\u6027\u7684\u5beb\u5165\uff08append\uff09\u6703\u6709\u8f03\u9ad8\u7684\u6548\u80fd \u56fa\u614b\u786c\u789f\u56e0\u5176\u662f\u5beb\u9032\u6676\u7247\u88e1\uff0c\u9069\u5408\u7dca\u5bc6\u7684\u8cc7\u6599\u5beb\u5165\u3002\uff08\u96d6\u7136\u97cc\u9ad4\u6703\u76e1\u91cf\u8b93\u5beb\u5165\u4fdd\u6301\u7dca\u5bc6\uff09 \u8a18\u61b6\u9ad4 B-Tree \u901a\u5e38\u9700\u8981\u8f03\u591a\u8a18\u61b6\u9ad4\uff0c\u56e0\u70ba\u6bcf\u500b page \u90fd\u662f\u56fa\u5b9a\u5927\u5c0f\uff0c\u4ee3\u8868\u53ef\u80fd\u6703\u6709\u5f88\u591a\u9592\u7f6e\u7a7a\u9593 SSTable \u900f\u904e\u53cd\u8986\u58d3\u7e2e\u6574\u5408\uff0c\u901a\u5e38\u4f7f\u7528\u8f03\u5c11\u8a18\u61b6\u9ad4\u3002\u4f46\u662f\u82e5\u662f\u904e\u5927\u7684\u5beb\u5165\u91cf\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u58d3\u7e2e\u6574\u5408\u7684\u901f\u5ea6\u4f86\u4e0d\u53ca\u914d\u5408\uff0c\u9032\u800c\u7121\u9650\u91cf\u7684\u589e\u9577\u8a18\u61b6\u9ad4\uff0c\u6700\u7d42\u5d29\u6f70\uff0c\u9700\u8981\u66ff\u4ed6\u6e96\u5099\u76e3\u63a7\u7cfb\u7d71\u3002 \u6709\u6548\u6027 SSTable \u56e0\u5176\u53ef\u80fd\u6703\u9700\u8981\u53cd\u8986\u58d3\u7e2e\u6574\u5408\uff0c\u5118\u7ba1\u662f\u80cc\u666f\u57f7\u884c\uff0c\u4ecd\u6703\u5403\u6389\u6a5f\u5668\u7684 CPU\uff0c\u5c0e\u81f4\u901f\u5ea6\u964d\u4f4e B-Tree \u5176 latency \u901a\u5e38\u8f03\u7a69\u5b9a \u6bcf\u53f0\u6a5f\u5668\u6bcf\u79d2\u80fd\u5beb\u5165\u7684\u91cf\u6709\u9650\uff0cSSTable \u9700\u8981\u58d3\u7e2e\u6574\u5408\uff0c\u6bcf\u6b21\u66ab\u5b58\u7684\u6700\u65b0\u8cc7\u6599\u584a\u53c8\u9700\u8981\u8db3\u5920\u4efd\u91cf\u7684\u5beb\u5165\uff0c\u5c0e\u81f4\u4e92\u76f8\u7af6\u722d\uff0c\u62d6\u6162\u901f\u5ea6\u3002 \u539f\u5b50\u6027 B-Tree \u4e2d\uff0c\u6bcf\u500b key \u53ea\u6703\u6709\u4e00\u500b value\uff0c\u53ef\u900f\u904e\u9396\u5b9a\u7279\u5b9a page \u4f86\u4fdd\u6301\u539f\u5b50\u6027\u3002 SSTable \u540c\u4e00\u500b key \u53ef\u80fd\u5b58\u5728\u591a\u500b\u8cc7\u6599\uff0c\u5728\u8655\u7406\u539f\u5b50\u6027\u6642\u6703\u9700\u8981\u8f03\u8cbb\u5de5\u7684\u6f14\u7b97\u6cd5","title":"SSTable vs B-Tree"},{"location":"feedback/designing-data-intensive-applications/db-index/#index_1","text":"\u5f88\u591a\u60c5\u6cc1\u6211\u5011\u6703\u9700\u8981\u589e\u52a0\u9664\u4e86\u4e3b\u8981 index \u5916\u7684 index\uff08 secondary indexes \uff09\uff0c\u800c\u9019\u985e\u7684 index \u4e0d\u4e00\u5b9a\u9700\u8981 unique\uff0c\u4f8b\u5982\u4e0a\u8ff0\u4f8b\u5b50\u4e2d\u7684\u5e74\u9f61\u6216\u6708\u6536\u5165\u3002 \u9019\u7a2e\u60c5\u6cc1\u6709\u5169\u7a2e\u65b9\u5f0f\u53ef\u4ee5\u89e3\u6c7a\u53ef\u91cd\u8907\u6027\u7684 index\u3002 key-value \u4e2d\u7684 value \u4ee3\u8868\u591a\u500b primary index \u3002\u4f8b\u5982\uff0c\u5e74\u9f61 20 \u7684 value \u6709 [user-1, user-10] \u7528 primary index \u53bb\u6574\u5408 secondary-key \u3002\u4f8b\u5982\uff0c\u624b\u6a5f\u70ba 09123 \u7684 key-value \u70ba 1_09123-*user data* \u9664\u6b64\u4e4b\u5916\uff0c\u907f\u514d\u540c\u6b65\u7684\u56f0\u96e3\uff0c\u90fd\u4e0d\u6703\u628a\u5b8c\u6574\u8cc7\u6599\u653e\u5728\u591a\u500b index \u7684 tree \u4e2d\uff0c\u800c\u662f\u5b58\u9032 heap file clustered index covering index","title":"Index \u6392\u5e8f"},{"location":"feedback/designing-data-intensive-applications/db-index/#heap-file","text":"\u6240\u8b02\u7684 heap file \u5c31\u662f\u5b58\u653e\u591a\u500b\u540c secondary index \u7684\u6a94\u6848\u3002 \u9019\u65b9\u6cd5\u4f7f\u7528\u8d77\u4f86\u5f88\u55ae\u7d14\uff0c\u56e0\u70ba\u7576\u6a94\u6848\u6709\u591a\u500b\u8cc7\u6599\u3002\u4f8b\u5982\u4e0a\u8ff0\u4e2d\u7684 [user-1, user-10] \uff0c\u5c31\u76f4\u63a5\u4ee5\u4e0b\u5217\u7684\u65b9\u5f0f\u505a\u5132\u5b58 # ID,Name,Year,Salary 1,John,20,500 10,Marry,20,550 \u800c primary index \u7684\u6a39\u72c0\u7d50\u69cb\u4ecd\u7136\u53ef\u4ee5\u5132\u5b58 heap file \u7684\u4f4d\u7f6e\u8cc7\u8a0a\u3002\u4f8b\u5982 user-10 \u7684 value \u53ef\u80fd\u5c31\u662f 40\uff08\u7b2c 40 \u500b byte \u958b\u59cb\u7b97\u8d77\uff09\u3002\u4f46\u662f\u7576\u8cc7\u6599\u66f4\u65b0\u6642\uff0c\u5c31\u9700\u8981 \u628a\u6240\u6709 index \u7684\u8cc7\u6599\u5eab\u90fd\u66f4\u65b0\u6a94\u6848\u4f4d\u7f6e\u3002 \u6216\u628a\u820a\u7684 heap file \u5b58\u653e\u65b0\u7684 heap file \u4f4d\u7f6e\uff0c\u9019\u6a23\u641c\u5c0b\u6642\u9593\u6703\u8d8a\u4f86\u8d8a\u9577","title":"heap file"},{"location":"feedback/designing-data-intensive-applications/db-index/#clustered-index","text":"clustered index \u985e\u4f3c\u65bc primary index \uff0c\u5176\u610f\u7fa9\u4ee3\u8868\u5b58\u653e\u8cc7\u6599\u7684 index\u3002\u7576\u900f\u904e secondary indexes \u627e\u5230\u7279\u5b9a\u8cc7\u6599\u7684 clustered index \u6642\uff0c\u518d\u5229\u7528\u5176\u627e\u5230\u8cc7\u6599\u3002 \u4f46\u662f\u9019\u7a2e\u65b9\u5f0f\u6703\u9700\u8981\uff1a \u984d\u5916\u7684\u5132\u5b58\u7a7a\u9593\uff08\u591a\u958b\u4e00\u500b Index Tree \u53bb\u5b58\uff09\u3002 \u800c\u4e14\u9700\u8981\u82b1\u4e00\u4e9b\u529f\u53bb\u7dad\u6301\u539f\u5b50\u6027 \u4e0d\u50cf heap file \u76f4\u63a5\u5beb\u4e00\u500b\u65b0\u7684\u6a94\u6848\u5c31\u53ef\u4ee5\u3002 \u6bcf\u6b21\u66f4\u65b0 secondary indexes \u90fd\u6703\u5f71\u97ff\u540c\u6642\u9593\u5176\u4ed6\u4eba\u641c\u5c0b\u8a72\u8cc7\u6599\u7684\u7d50\u679c\u3002","title":"clustered index"},{"location":"feedback/designing-data-intensive-applications/db-index/#covering-index","text":"covering index \u4e0d\u540c\u65bc clustered index \u6703\u628a\u8cc7\u6599 \u5168\u90e8 \u5b58\u9032 index \u4e2d\uff0c\u800c\u662f\u628a\u90e8\u5206\uff08\u82e5\u751a\u81f3\u5b8c\u5168\u6c92\u6709\uff09\u7684\u8cc7\u6599\u5b58\u9032\u5b58\u9032 index \u4e2d\u3002\u4e26\u628a\u5b8c\u6574\u8cc7\u6599\u7684\u4f4d\u7f6e\u5b58\u9032 index \u4e2d\u3002 cover \u4ee3\u8868\u7684\u610f\u601d\u5c31\u662f\uff0c\u96d6\u5132\u5b58\u90e8\u5206\u8cc7\u6599\uff0c\u4ed6\u537b\u53ef\u4ee5 cover \u5e38\u5b58\u53d6\u7684 column\u3002","title":"covering index"},{"location":"feedback/designing-data-intensive-applications/db-index/#hyperdex","text":"\u4e0a\u8ff0\u6709\u63d0\u5230\u6bcf\u6b21 query \u53ea\u6703\u53c3\u8003\u4e00\u500b index\u3002\u4f46\u662f\u591a\u500b index \u53bb\u505a\u7be9\u9078\u6703\u5927\u5927\u52a0\u901f\u641c\u5c0b\u7684\u901f\u5ea6\uff0c\u8a72\u600e\u9ebc\u8fa6\uff1f \u4f8b\u5982\uff1a\u6211\u8981\u641c\u5c0b\u7d93\u7def\u5ea6\u5728 51.5151 122.122122 \u7684\u5546\u5e97\u3002\u82e5\u662f\u4f7f\u7528\u55ae\u4e00\u628a\u7def\u5ea6\u4f5c index\uff0c\u5247\u53ef\u80fd\u641c\u5c0b\u5230\u6240\u6709\u7d93\u5ea6\u5728 -180~180 \u7bc4\u570d\u5167\u7684\u8cc7\u8a0a\uff0c\u641e\u5f97\u6709 index \u8ddf\u6c92 index \u4e00\u6a23\u3002 \u7c21\u55ae\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 concatenated index \uff0c\u4e5f\u5c31\u662f\u628a\u5169\u500b index \u6574\u5408\u518d\u4e00\u8d77\u3002\u4f8b\u5982\uff0c\u9700\u8981\u641c\u5c0b\u59d3\u548c\u540d\u4e00\u6a23\u7684\u4f7f\u7528\u8005\uff0c\u641c\u5c0b\u59d3\u548c\u540d\u7684 concatenated index \uff1a \u738b \u5c0f\u660e \uff0c\u4f46\u662f\u7576\u641c\u5c0b\u689d\u4ef6\u6539\u6210 \u5c0f\u660e \u738b \uff1f \u6bd4\u8d77 concatenated index \uff0c\u66f4\u5e38\u4f7f\u7528\u7684\u65b9\u5f0f\u662f\u91cd\u65b0\u8a2d\u8a08\u4e00\u500b\u5132\u5b58 index \u7684\u6a39\u72c0\u7d50\u69cb\uff1a R-Tree \u3002 \u5176\u4ed6\u53ef\u80fd\u9700\u8981\u591a\u7dad\u5ea6\u7684 index \u5834\u666f\u6709\uff1a \u96fb\u5546\u9700\u8981\u641c\u5c0b\u9577\u3001\u5bec\u3001\u9ad8\u7684\u5546\u54c1 \u4eba\u529b\u9280\u884c\u9700\u8981\u641c\u5c0b\u85aa\u8cc7\u3001\u8ddd\u96e2\u65b0\u5e97\u6700\u8fd1\u7684\u5de5\u4f5c","title":"HyperDex"},{"location":"feedback/designing-data-intensive-applications/db-index/#fuzzy-index","text":"\u6709\u6642\u8981\u641c\u5c0b\u7684 Index \u662f\u6587\u5b57\uff0c\u800c\u9019\u4e32\u6587\u5b57\u53c8\u662f\u4eba\u985e\u8a9e\u8a00\uff0c\u9019\u6642\u5728\u505a\u641c\u5c0b\u6642\u5c31\u53ef\u80fd\u9700\u8981\u8003\u616e\uff1a \u62fc\u932f\u3002 \u6587\u6cd5\u8f49\u63db\u3002\u5982\uff1a\u904e\u53bb\u5f0f\u3001\u73fe\u5728\u5f0f\u3002 \u540c\u7fa9\u8a5e\u3002 \u8a72\u8a5e\u5f59\u9577\u642d\u914d\u7684\u8a5e\u3002\u5982\uff1a\u6e1b\u80a5\u3001\u904b\u52d5\u3002 \u5982\u540c SSTable \u6703\u5229\u7528\u7a00\u758f\u7684\u9375\uff08sparse keys\uff09\u53bb\u6e1b\u5c11 Index \u7684\u5132\u5b58\u91cf\uff0cLucene \u7684\u5168\u6587\u6aa2\u7d22\u8cc7\u6599\u5eab\u4e5f\u6703\u628a\u5b57\u8a5e\u7684\u90e8\u5206\u5b57\u5143\u4f5c\u70ba\u7a00\u758f\u7684\u9375\uff08\u985e\u4f3c trie \u6a39\u72c0\u7d50\u69cb\uff09 1 \uff0c\u52a0\u901f\u6a21\u7cca\u641c\u5c0b\uff08fuzzy search\uff09\u3002 \u5176\u4ed6\u985e\u578b\u7684 fuzzy index \u7684\u6f14\u7b97\u6cd5\u53ef\u80fd\u70ba\u6587\u7ae0\u5206\u985e\u3001\u6a5f\u5668\u5b78\u7fd2\u7b49\u3002","title":"Fuzzy Index"},{"location":"feedback/designing-data-intensive-applications/db-index/#_10","text":"\u628a\u8cc7\u6599\u5b58\u9032\u6a94\u6848\uff08filesystem\uff09\u548c\u628a\u8cc7\u6599\u90fd\u5b58\u9032\u5167\u5b58\u8a18\u61b6\u9ad4\uff08RAM\uff09\u6bd4\uff0c\u6709\u5169\u500b\u597d\u8655 \u7576\u96fb\u6e90\u5207\u65b7\uff0c\u8a18\u61b6\u9ad4\u7684\u8cc7\u6599\u5c31\u6c92\u4e86 \u4fbf\u5b9c \u4f46\u662f\u70ba\u4e86\u89e3\u6c7a filesystem \u5728\u8b80\u5beb\u7684\u6548\u7387\u5e73\u8861\uff0c\u767c\u5c55\u4e86\u5f88\u591a\u6a5f\u5236\uff1aIndex\u3001File \u5927\u5c0f\u548c\u6578\u91cf\u7b49\u7b49\u3002 \u8fd1\u4f86 RAM \u8d8a\u4f86\u8d8a\u4fbf\u5b9c\uff0c\u4e14\u82e5\u8cc7\u6599\u5eab\u4e26\u4e0d\u9700\u8981\u5132\u5b58\u5927\u578b\u8cc7\u6599\uff0c\u9019\u6642\u4fbf\u767c\u5c55\u51fa\u5167\u5b58\u8cc7\u6599\u5eab\uff08in-memory database\uff09\uff0c\u5176\u7a2e\u985e\u5927\u81f4\u5206\u5169\u7a2e\uff1a \u4e0d\u5728\u4e4e\u7576\u96fb\u6e90\u5207\u65b7\uff0c\u662f\u5426\u9700\u8981\u7dad\u6301\u8cc7\u6599\uff1a Memcached \u9700\u8981\u7dad\u6301\u8cc7\u6599\uff1a VoltDB \u3001 MemSQL \u3001 Oracle TimesTen \u3001 Redis \u3001 Couchbase \u900f\u904e\u7279\u6b8a\u786c\u9ad4\uff08\u4e0d\u65b7\u96fb\u7cfb\u7d71\uff09 \u5beb Log\uff0c\u9019\u65b9\u6cd5\u9664\u7dad\u6301\u8cc7\u6599\uff0c\u4e5f\u64c1\u6709\u63d0\u4f9b\u5099\u4efd\u3001\u65b9\u4fbf\u5206\u6790\u7b49\u597d\u8655\u3002 \u5b9a\u6642\u5feb\u7167\u3002 \u900f\u904e\u5176\u4ed6\u6a5f\u5668\u8907\u88fd\u8cc7\u6599\uff08replicate\uff09 \u5167\u5b58\u8cc7\u6599\u5eab\u4e0d\u50c5\u50c5\u56e0\u70ba\u8b80\u53d6\u6642\u4e0d\u63a5\u89f8 filesystem\uff0c\u5176\u5132\u5b58\u7684\u6a94\u6848\u683c\u5f0f\u5df2\u7d93\u7d93\u904e\u89e3\u6790\uff08parse\uff09\uff0c\u964d\u4f4e\u4e86\u89e3\u6790\u6240\u9700\u6d88\u8017\u7684\u6548\u80fd\u3002\u9019\u540c\u6642\u4e5f\u8b93\u5167\u5b58\u8cc7\u6599\u5eab\u5141\u8a31\u66f4\u591a\u7a2e\u985e\u7684\u5132\u5b58\uff0c\u4f8b\u5982\u4f47\u5217\uff08queue\uff09\u6216\u53e2\u96c6\uff08set\uff09\u3002 \u9664\u6b64\u4e4b\u5916\uff0c\u8fd1\u4f86\u4e5f\u6709\u9700\u591a\u7814\u7a76\uff0c\u8b93\u5167\u5b58\u8cc7\u6599\u5eab\u4e0d\u518d\u53d7\u9650\u65bc\u5167\u5b58\u8a18\u61b6\u9ad4\u7684\u5927\u5c0f\uff0c\u7576\u5927\u5c0f\u8d85\u51fa\u5176\u8ca0\u8377\u6642\uff0c\u8cc7\u6599\u5eab\u6703\u628a\u6700\u4e45\u6c92\u5b58\u53d6\u7684\u8cc7\u6599\u653e\u9032 filesystem \u4e2d\uff0c\u985e\u4f3c OS \u5728\u64cd\u4f5c\u5927\u578b\u8cc7\u6599\u6642\u7684\u505a\u6cd5\uff0c\u7136\u800c\u537b\u66f4\u70ba\u7cbe\u6e96\uff0c\u800c\u975e\u4e00\u6b21\u50c5\u80fd\u63a7\u5236\u4e00\u7d44\u8a18\u61b6\u9ad4\u5340\u584a\u3002 http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.16.652 \u21a9","title":"\u5167\u5b58\u8cc7\u6599\u5eab"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/","text":"\u8cc7\u6599\u5728\u505a\u5132\u5b58\u6216\u8f38\u51fa\u7684\u6642\u5019\u662f\u9700\u8981\u7de8\u78bc\uff08encoding\uff09\u7684\uff0c\u9664\u4e86\u53ef\u4ee5\u5e6b\u52a9\u58d3\u7e2e\u8cc7\u6599\u91cf\uff0c\u597d\u7684\u7de8\u78bc\u65b9\u5f0f\u6703\u5728\u7db1\u76ee\uff08Schema\uff09\u8abf\u6574\u5f8c\uff0c\u4ecd\u80fd\u505a\u7de8\uff08\u89e3\uff09\u78bc\uff0c\u4e5f\u5c31\u662f\u7db1\u76ee\u6f14\u8b8a\uff08schema evolution\uff09\u5f8c\uff0c\u4ecd\u80fd\u4fdd\u6301\u524d\u5f8c\u76f8\u5bb9\u3002 \u7576\u4f60\u628a\u8cc7\u6599\u5b58\u9032\u8a18\u61b6\u9ad4\u4e2d\uff0c\u53ef\u4ee5\u900f\u904e\u5404\u7a2e\u8cc7\u6599\u578b\u5225\u53bb\u5c0d\u8cc7\u6599\u9032\u884c\u64cd\u4f5c\uff0c\u4f8b\u5982\u9663\u5217\u3001\u7269\u4ef6\u7b49\u7b49\u3002\u7136\u800c\u7576\u628a\u8cc7\u6599\u5b58\u9032\u78c1\u789f\uff08filesystem\uff09\u4e2d\u6216\u8005\u900f\u904e\u7db2\u8def\u50b3\u9001\u7d66\u5176\u4ed6\u670d\u52d9\u6642\uff0c\u5c31\u9700\u8981\u4ee5\u7de8\u78bc\u5f8c\u7684\u8cc7\u6599\uff08\u4f8b\u5982 JSON \u683c\u5f0f\uff09\u4f86\u5132\u5b58\u6216\u8f38\u51fa\u3002 \u7a0b\u5f0f\u78bc\u5167\u5efa\u7de8\u78bc\u65b9\u5f0f \u6211\u5011\u90fd\u6703\u900f\u904e\u7a0b\u5f0f\u8a9e\u8a00\u4f86\u548c\u8a18\u61b6\u9ad4\u6e9d\u901a\uff0c\u4e0d\u540c\u7a0b\u5f0f\u8a9e\u8a00\u9810\u8a2d\u5c31\u6709\u4e9b\u7de8\u78bc\u65b9\u5f0f\uff0cJava\uff1a java.io.Serializable \u3001Ruby\uff1a Marshal \u3001Python\uff1a pickle \uff0c\u7136\u800c \u901a\u5e38\u4e0d\u540c\u8a9e\u8a00\u4e4b\u9593\u662f\u7121\u6cd5\u4e92\u76f8\u63a5\u901a\u7684 \u53ef\u80fd\u6703\u89f8\u767c\u7269\u4ef6\u7684\u5efa\u7f6e\uff0c\u6709\u5b89\u5168\u6027\u7591\u616e \u8f03\u5c11\u8003\u616e\u524d\u5f8c\u76f8\u5bb9 \u6548\u7387\u901a\u5e38\u5f88\u5dee \u65b9\u4fbf\u4eba\u985e\u95b1\u8b80\u7684\u683c\u5f0f JSON\u3001XML\u3001CSV\uff0c\u9019\u4e9b\u683c\u5f0f\u90fd\u5f88\u5e38\u898b\uff0c\u4e0d\u9700\u8981\u7db1\u76ee\u5c31\u80fd\u89e3\u78bc\u3002\u7136\u800c \u7121\u6cd5\u5132\u5b58\u4e8c\u9032\u4f4d\u6587\u5b57\uff0c\u96d6\u7136\u53ef\u4ee5\u4f7f\u7528 Base64 \u628a\u4e8c\u9032\u4f4d\u8f49\u63db\u6210 Unicode \u6587\u5b57\uff0c\u7f3a\u9700\u8981\u984d\u5916\u7684\u6548\u80fd\u548c\u9ad4\u7a4d Base64 \u6bcf 6 \u500b bit \u8f49\u6210\u4e00\u500b ASCII \u5b57\u5143\uff081 \u500b byte\uff09\uff0c\u6240\u4ee5\u9ad4\u7a4d\u6703\u6bd4\u76f4\u63a5\u505a\u4e8c\u9032\u4f4d\u8f49\u63db\u5927 1.3 \u500d \u6c92\u6709\u7db1\u76ee\uff0c\u82b1\u6642\u9593\u7406\u89e3\u548c\u7ba1\u7406 \u5927\u6578\u5b57\u4e0d\u597d\u5132\u5b58\uff0c\u6574\u6578\u3001\u5c0f\u6578\u7684\u5340\u5206 \u7136\u800c\u9019\u4e9b\u4ecd\u662f\u4e3b\u8981\u7684\u7de8\u78bc\u65b9\u5f0f\uff0c\u4e5f\u56e0\u70ba\u5927\u5bb6\u5f88\u7fd2\u6163\u9019\u4e9b\u65b9\u5f0f\u7684\u7de8\u78bc\uff0c\u5c0e\u81f4\u66f4\u6709\u6548\u548c\u66f4\u65b9\u4fbf\u7ba1\u7406\u7684\u7de8\u78bc\u65b9\u5f0f\u5f88\u96e3\u5438\u5f15\u5230\u5927\u5bb6\u7684\u76ee\u5149\u3002 \u4e8c\u9032\u4f4d JSON \u6709\u4e9b\u683c\u5f0f\u662f\u4ee5 JSON \u70ba\u57fa\u790e\u505a\u6f14\u5316\u7684\uff0c\u5176\u5617\u8a66\u89e3\u6c7a\u4e0a\u8ff0\u554f\u984c\uff0c\u4f46\u662f\u6548\u7387\u4ecd\u7121\u6cd5\u8d0f\u904e\u5c08\u9580\u7684\u4e8c\u9032\u4f4d\u7de8\u78bc\uff0c\u4ee5\u4e0b\u5716\u70ba\u7bc4\u4f8b\uff1a \u539f\u59cb JSON \u8cc7\u6599\uff1a { \"userName\" : \"Martin\" , \"favoriteNumber\" : 1337 , \"interests\" : [ \"daydreaming\" , \"hacking\" ] } \u6211\u5011\u53ef\u4ee5\u5f97\u5230 66 Bytes \u7684\u8cc7\u6599\uff0c\u78ba\u5be6\u6bd4\u539f\u672c 88 Bytes \u597d\uff0c\u4f46\u662f\u548c\u5f85\u6703\u6211\u5011\u53ef\u4ee5\u770b\u5230\u6e1b\u5c11\u5230 32 Bytes \u7684\u65b9\u5f0f\u4ecd\u6709\u5dee\u7570\u3002 \u4e8c\u9032\u4f4d\u7de8\u78bc \u4e8c\u9032\u4f4d\u7de8\u78bc\u4e26\u4e0d\u662f\u65b0\u6771\u897f\uff0c\u65e9\u5728 1984 \u5e74\u5c31\u6709\u5354\u5b9a ASN.1 \u95e1\u8ff0\u5982\u4f55\u9032\u884c\u4e8c\u9032\u4f4d\u7de8\u78bc\uff0c\u4ed6\u548c Thrift \u3001 Protocol Buffer \u4e00\u6a23\u90fd\u4f7f\u7528 tag ID\u3002\u4e14\u5176\u61c9\u7528\uff08DER\uff09\u5982\u4eca\u4ecd\u88ab\u5927\u91cf\u4f7f\u7528\u65bc X.509\u3002 \u4f46\u662f\u4ed6\u537b\u6709\u904e\u65bc\u8907\u96dc\u4e14\u7db1\u76ee\uff08Schema\uff09\u5efa\u7f6e\u56f0\u96e3\u7684\u7f3a\u9ede\uff0c\u7531\u6b64\u767c\u5c55\u51fa\u4ee5\u4e0b\u5e7e\u500b\u8f03\u65b0\u7684\u65b9\u5f0f\u3002 Apache Thrift - \u521d\u59cb\u65bc Facebook Protocol Buffer - Google Apache Avro \u4e0a\u8ff0\u65b9\u5f0f\u53ef\u4ee5\u964d\u4f4e\u78c1\u789f\u7684\u4f7f\u7528\u91cf\u3001\u9ad8\u6548\u80fd\u7de8\uff08\u89e3\uff09\u78bc\u3001\u6709\u6548\u88fd\u4f5c\u6587\u4ef6\u6a94\uff0c\u4f46\u7f3a\u9ede\u5c31\u662f\u9700\u8981\u89e3\u78bc\u624d\u80fd\u8b93\u4eba\u985e\u8b80\u61c2\u8a0a\u606f\u3002 \u524d\u5f8c\u76f8\u5bb9 \u5728\u505a\u7de8\u78bc\u6642\u90fd\u9700\u8981\u53bb\u8003\u616e\u524d\u5f8c\u76f8\u5bb9\uff1a \u5411\u5f8c\u76f8\u5bb9\uff1a\u820a\u7684\u7a0b\u5f0f\u78bc\u8b80\u5230\u7684\u8cc7\u6599\u542b\u6709\u65b0\u7684\u7db1\u76ee\u5b9a\u7fa9\u7684\u6b04\u4f4d\u6642\uff0c\u4ecd\u7136\u53ef\u4ee5\u904b\u884c \u5411\u524d\u76f8\u5bb9\uff1a\u65b0\u7684\u7a0b\u5f0f\u78bc\u8b80\u5230\u7684\u8cc7\u6599\u542b\u6709\u5df2\u7d93\u88ab\u522a\u9664\u7684\u6b04\u4f4d\u6642\uff0c\u4ecd\u7136\u53ef\u4ee5\u904b\u884c \u7531\u6b64\u53ef\u77e5\uff0cJSON \u9019\u985e\u7de8\u78bc\u65b9\u5f0f\u65b0\u820a\u7248\u672c\u90fd\u53ef\u4ee5\u505a\u89e3\u78bc\uff0c\u53ea\u8981\u5728\u7a0b\u5f0f\u908f\u8f2f\u4e0a\u6ce8\u610f\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4fdd\u6301\u524d\u5f8c\u76f8\u5bb9\u3002 \u9664\u6b64\u4e4b\u5916\u9084\u9700\u8981\u6ce8\u610f\u65b0\u7684\u7a0b\u5f0f\u78bc\u64b0\u5beb\u8cc7\u6599\u6642\uff0c\u88ab\u540c\u6642\u5b58\u5728\u7684\u820a\u7a0b\u5f0f\u78bc\u8986\u84cb\u6389\uff1a \u5728\u8cc7\u6599\u6e96\u5099\u8981\u9001\u5230\u8cc7\u6599\u5132\u5009\uff08warehouse\uff09\u6642\uff0c\u4e5f\u9700\u8981\u7de8\u78bc\uff0c\u9019\u6642\u5019\u53ef\u4ee5\u628a\u8cc7\u6599\u8f49\u63db\u6210\u53cb\u5584\u65bc\u5217\u5f0f\u8cc7\u6599\u5eab\uff08column-oriented database\uff09\u7684\u683c\u5f0f\uff0c\u4f8b\u5982 Parquet \u3002 Thrift \u7db1\u76ee\uff1a struct Person { 1: required string userName, 2: optional i64 favoriteNumber, 3: optional list<string> interests } BinaryProtocol 59 Bytes CompactProtocol 34 Bytes Protocol Buffer \u7db1\u76ee\uff1a message Person { required string user_name = 1; optional int64 favorite_number = 2; repeated string interests = 3; } 33 Bytes \u8a3b required \u548c optional \u5728\u7de8\u78bc\u6642\uff0c\u4e0d\u5f71\u97ff\u7d50\u679c\uff0c\u50c5\u6703\u5728\u505a\u89e3\u78bc\u6642 runtime \u8f38\u51fa\u932f\u8aa4\u3002 \u6bcf\u500b tag ID \u4e0d\u53bb\u66f4\u52d5\u4f86\u4fdd\u6301\u524d\u5f8c\u76f8\u5bb9\u3002\u7576\u4f7f\u7528\u820a\u7684\u7db1\u76ee\u53bb\u8b80\u53d6\u672a\u77e5\u6b04\u4f4d\u6642\uff0c\u7701\u7565\u4e4b\u3002 \u65b0\u589e\u6b04\u4f4d\u6642\u82e5\u8a2d\u5b9a required \u6703\u8b93\u820a\u7a0b\u5f0f\u78bc\u8f38\u51fa\u932f\u8aa4\uff0c\u9700\u8981\u7d66\u5b9a\u9810\u8a2d\u503c\u3002 \u8b8a\u66f4\u6a94\u6848\u683c\u5f0f\u53ef\u80fd\u5c0e\u81f4\u8cc7\u6599\u4e0d\u5b8c\u5168\uff0c\u4f8b\u5982 int8 \u8f49\u5230 int16 ProtocolBuffers \u6c92\u6709 list \u8cc7\u6599\u578b\u614b\uff0c\u8b93\u4ed6\u5f88\u597d\u5f9e repeated \u8f49\u5230 optional \uff0c\u4f46\u5de2\u72c0\u7d50\u69cb\u5c31\u6703\u9700\u8981\u984d\u5916\u529f\u4f86\u9054\u6210\u3002 Avro \u7db1\u76ee\uff1a record Person { string userName; union { null, long } favoriteNumber = null; array < string > interests; } \u9019\u88e1\u591a\u4e86\u4e00\u500b union\uff0c\u5230\u6642\u5019\u5728 encoding \u6642\u9700\u8981\u8a2d\u5b9a\u4ee5\u8aaa\u660e\u8a72\u503c\u5c6c\u65bc\u54ea\u7a2e\u578b\u5225\u3002 32 Bytes \u6bd4\u8f03 Avro \u4e26\u6c92\u6709\u4f7f\u7528 tag ID \u4f86\u8fa8\u8a8d\u6bcf\u500b\u8cc7\u6599\u7684\u4f4d\u7f6e\uff0c\u800c\u662f\u900f\u904e\u7db1\u76ee\u4e0d\u540c\u7248\u672c\u9593\u7684\u8f49\u63db\uff1a \u56e0\u6b64\u8b80\u53d6\u8cc7\u6599\u6642\uff0c\u9700\u8981\u5148\u78ba\u4fdd\u64b0\u5beb\u8cc7\u6599\u6240\u4f7f\u7528\u7684\u7db1\u76ee\u7248\u672c\u3002 Avro \u4e5f\u5229\u7528 union { null, int } \u4f86\u7576\u4f5c\u8cc7\u6599\u7684 required/optional \uff0c\u540c\u6642\u7d66\u4e88\u9810\u8a2d\u503c\u4f86\u6eff\u8db3\u5411\u5f8c\uff08\u524d\uff09\u76f8\u5bb9\u3002 \u9664\u6b64\u4e4b\u5916\uff0cAvro \u9084\u5141\u8a31\u66f4\u6539\u8cc7\u6599\u7684 \u578b\u5225 \u548c \u540d\u7a31 \uff0c\u4f46\u53ea\u80fd\u6eff\u8db3\u5411\u5f8c\u76f8\u5bb9\uff1a \u63d0\u4f9b \u578b\u5225 \u7684\u8f49\u63db\u5668 \u8a2d\u5b9a alias \u4f86\u6eff\u8db3\u540d\u7a31\u7684\u8f49\u63db \u5982\u4f55\u77e5\u9053\u64b0\u5beb\u8005\u7684\u7db1\u76ee\u7248\u672c \u6839\u64da\u61c9\u7528\u7a0b\u5f0f\u800c\u6709\u5dee\u7570\uff1a \u82e5\u8cc7\u6599\u5eab\u662f\u5728 Hadoop \u67b6\u69cb\u4e4b\u4e0a\uff0c\u5c31\u53ef\u4ee5\u5728\u6bcf\u4efd\u6a94\u6848\u524d\u9762\u6dfb\u52a0\u7db1\u76ee\u7248\u672c\u3002 \u82e5\u8cc7\u6599\u5eab\u7684\u6bcf\u7b46\u8cc7\u6599\u90fd\u53ef\u80fd\u6703\u6709\u4e0d\u540c\u7684\u7248\u672c\uff0c\u5c31\u9700\u8981\u5728\u6bcf\u7b46\u8cc7\u6599\u524d\u8a2d\u5b9a\u7248\u672c\uff0c\u5982 Espresso \u3002 \u82e5\u662f\u5728\u7db2\u8def\u4e0a\u9032\u884c\u96d9\u5411\u6e9d\u901a\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u53ef\u4ee5\u5354\u5546\u51fa\u5f7c\u6b64\u7684\u7248\u672c\uff0c\u5982 Avro RPC \u4e0d\u9700\u8981\u4f7f\u7528 tag ID \u6709\u4ec0\u9ebc\u597d\u8655 \u8cc7\u6599\u8f38\u51fa\u6210\u6a94\u6848\u6642\uff08Hadoop \u67b6\u69cb\u4e0b\u7684\u8cc7\u6599\u5eab\u5e38\u505a\u7684\u4e8b\uff09\uff0c\u6211\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5f9e\u8cc7\u6599\u5eab\u7684\u7db1\u76ee\u8f49\u63db\u6210 Avro Schema\uff0c\u7136\u5f8c\u628a\u6a94\u6848\u64b0\u5beb\u6210\u4e8c\u4f4d\u5143\u3002\u540c\u6a23\u7684\uff0c\u7576\u8cc7\u6599\u5eab\u7684\u7db1\u76ee\u66f4\u65b0\u6642\uff0c\u5df2\u7d93\u8f38\u51fa\u904e\u7684\u6a94\u6848\u5c31\u4e0d\u518d\u9700\u8981\u8f49\u63db\uff0c\u800c\u662f\u900f\u904e\u4e0a\u8ff0\u7248\u672c\u8f49\u63db\u6a5f\u5236\u3002 \u76f8\u53cd\u7684\uff0c\u7528 Protocol Buffers \u6216 Thrift \u5c31\u9700\u8981\u8b39\u614e\u4f7f\u7528 tag ID \u4f86\u907f\u514d\u4efb\u4f55\u885d\u7a81\u3002 Protocol Buffers\u3001Thrift \u4e26\u4e0d\u662f\u70ba\u4e86\u9019\u985e\u64cd\u4f5c\u800c\u8a2d\u8a08\u7684\u7de8\u78bc\u683c\u5f0f \u5f31\u578b\u5225\u8a9e\u8a00\u4e0a\u7684\u61c9\u7528 Protocol Buffers\u3001Thrift \u5728\u5f37\u578b\u5225\u7684\u8a9e\u8a00\uff08Java\u3001C++\u3001Dart\uff09\u4e0a\u5f88\u597d\u7528\uff0c\u56e0\u7232\u53ef\u4ee5\u900f\u904e\u7db1\u76ee\u53bb\u7522\u751f\u7de8\u78bc\u5f8c\u7684\u7a0b\u5f0f\u78bc\uff0c\u4e26\u57f7\u884c\u4e8c\u4f4d\u5143\u7de8\u78bc\u7684\u89e3\u78bc\u3002\u4f46\u662f\u5728\u5f31\u578b\u5225\u7684\u8a9e\u8a00\uff08JavaScript\u3001Python\u3001Ruby\u3001PHP\uff09\u4e0a\u5c31\u9700\u8981\u505a\u984d\u5916\u7684\u529f\uff0c\u5982 TypeScript\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u52d5\u614b\u7522\u751f\u7684\u7db1\u76ee\uff0c\u5982\u900f\u904e\u8cc7\u6599\u5eab\u7684\u7db1\u76ee\u7522\u751f Avro Schema\uff0c\u5c0d\u65bc\u5f31\u578b\u5225\u7684\u8a9e\u8a00\u5c31\u66f4\u9ebb\u7169\u3002 Avro \u63d0\u4f9b\u4e00\u4e9b\u624b\u6bb5\u6e1b\u5c11\u9019\u985e\u56f0\u64fe\uff0c\u4f8b\u5982\u5728 Hadoop \u67b6\u69cb\u4e4b\u4e0a\u7684\u6a94\u6848\uff0c\u90fd\u5305\u542b\u7db1\u76ee\uff0c\u4e5f\u5c31\u662f\u8b93\u9019\u4efd\u6a94\u6848\u80fd\u5920\u81ea\u63cf\u8ff0\uff08self-describing\uff09\u3002\u4f60\u53ef\u4ee5\u76f4\u63a5\u900f\u904e\u7a0b\u5f0f\u5eab\u6253\u958b\u9019\u4efd\u6a94\u6848\uff0c\u4e26\u4e14\u64cd\u4f5c\u4e0a\u5982\u540c JSON \u683c\u5f0f\u7684\u8cc7\u6599\u3002 \u5206\u6790\u5de5\u5177 Apache Pig \u5c31\u662f\u904b\u7528\u9019\u7279\u6027\uff0c\u8b93\u4f7f\u7528\u8005\u76f4\u63a5\u900f\u904e SQL \u8a9e\u6cd5\u5728 Hadoop \u67b6\u69cb\u4e4b\u4e0a\u7684\u8cc7\u6599\u5eab\u9032\u884c\u5206\u6790\uff0c\u800c\u4e0d\u9700\u8981\u8003\u616e\u4efb\u4f55\u7db1\u76ee\u4e0a\u7684\u554f\u984c\u3002 \u8907\u7fd2\u5dee\u7570 JSON\uff08Schema-less \u7de8\u78bc\uff09\u53ef\u4ee5\u900f\u904e\u6587\u4ef6\u65b9\u5f0f\u88dc\u8db3\u7db1\u76ee\uff0c\u6709\u5176\u512a\u9ede\uff1a \u5728\u89e3\u78bc\u6642\u4e0d\u6703\u53d7\u7db1\u76ee\u5f71\u97ff\uff0c\u53ef\u8f15\u6613\u5141\u8a31\u5411\u5f8c\uff08\u524d\uff09\u7684\u76f8\u5bb9\u3002 \u7db1\u76ee\u56e0\u70ba\u662f\u6587\u4ef6\u5f62\u5f0f\uff0c\u80fd\u8a73\u7d30\u9650\u5236\u8cc7\u6599\u3002\u5982\uff1a\u6578\u5b57\u53ea\u80fd\u5728 0~1 \u4e4b\u9593\u3002 \u7136\u800c\u4e8c\u9032\u4f4d\u7de8\u78bc\u4e5f\u6709\u5176\u597d\u8655\uff1a \u5132\u5b58\u66f4\u7dca\u5bc6\uff0c\u9ad4\u7a4d\u5c0f\u3002 \u56e0\u70ba\u7db1\u76ee\uff08Schema\uff09\u662f\u5fc5\u9808\u7684\uff0c\u4e0d\u6703\u51fa\u73fe\u6587\u4ef6\u548c\u5be6\u969b\u904b\u4f5c\u6709\u843d\u5dee\uff08\u5fd8\u8a18\u88dc\u6587\u4ef6\uff09\u3002 \u5728 compile \u904e\u7a0b\u5c31\u80fd\u6aa2\u67e5\u7a0b\u5f0f\u78bc\u662f\u5426\u7b26\u5408\u7db1\u76ee\u3002 \u900f\u904e\u4e00\u4e9b\u6a5f\u5236\u4ecd\u80fd\u4fdd\u6301\u5411\u524d\uff08\u5f8c\uff09\u7684\u76f8\u5bb9 \u7de8\uff08\u89e3\uff09\u78bc\u7684\u4f7f\u7528\u60c5\u5883 \u8cc7\u6599\u5eab\u540c\u4e00\u500b\u670d\u52d9\u7de8\uff08\u89e3\uff09\u78bc\u3002\u4e5f\u5c31\u662f\uff1a \u8cc7\u6599\u5eab\u7de8\u3001\u89e3\u78bc\uff0c\u6216\u8005 \u8cc7\u6599\u5eab\u9700\u6c42\u8005\u7de8\u3001\u89e3\u78bc RPC/REST/SOAP APIs\uff0c\u5169\u500b\u670d\u52d9\u6216\u4f7f\u7528\u8005\u5f7c\u6b64\u7de8\u89e3\u78bc\u3002\u4e5f\u5c31\u662f\uff1a \u8acb\u6c42\u8005\u628a\u8acb\u6c42\u8cc7\u8a0a\u7de8\u78bc \u670d\u52d9\u8005\u89e3\u78bc \u670d\u52d9\u8005\u628a\u56de\u61c9\u7de8\u78bc \u8acb\u6c42\u8005\u89e3\u78bc RPC \u7684\u7de8\u78bc\u4f7f\u7528 Protocol Buffers - Google gRPC \u4e4b\u524d\u6709\u64b0\u5beb\u904e \u5fc3\u5f97 Thrift - Twitter Finagle JSON - LinkedIn Rest.li \u82e5\u5c0d\u5916\uff0c\u7121\u6cd5\u4fdd\u8b49 client \u4f7f\u7528\u6700\u65b0\u7248\u672c\u7684 Schema\uff0c\u6240\u4ee5\u8f03\u96e3\u7dad\u904b\u3002\u53cd\u4e4b\uff0cRESTful API \u53ef\u4ee5\u5229\u7528\uff1a \u524d\u7db4\u8a5e\u52a0\u4e0a\u7248\u672c HTTP \u6a19\u982d\uff08 Accept \uff09\u5beb\u660e\u4f7f\u7528\u7248\u672c \u8acb\u6c42\u6642\u9700\u651c\u5e36 Token \u5728\u767c\u9001\u8005\u548c\u63a5\u6536\u8005\u9593\u975e\u540c\u6b65\u8a0a\u606f\u50b3\u905e\uff08Asynchronous message passing\uff09\u3002\u4e5f\u5c31\u662f\uff1a \u767c\u9001\u8005\u7de8\u78bc \u63a5\u6536\u8005\u89e3\u78bc \u975e\u540c\u6b65\u8a0a\u606f\u50b3\u905e \u9019\u584a\u8f03\u4e0d\u719f\u6089\uff0c\u56e0\u6b64\u53e6\u5916\u641c\u96c6\u8cc7\u6599\u3002\u975e\u540c\u6b65\u8a0a\u606f\u548c\u540c\u6b65\u8a0a\u606f\u7684\u5dee\u7570\u5728\u65bc \u540c\u6b65\u8a0a\u606f\u9810\u671f\u6536\u5230\u8acb\u6c42\uff0c\u4f8b\u5982 REST API\u3002\u9019\u4ee3\u8868\u7576\u6c92\u6536\u5230\u8acb\u6c42\u6642\uff0c\u9700\u8981\u505a\u932f\u8aa4\u8655\u7406\uff08Error handling\uff09 \u975e\u540c\u6b65\u8a0a\u606f\u5247\u76f8\u53cd\uff0c\u9001\u51fa\u8a0a\u606f\u5f8c\uff0c\u5728\u78ba\u8a8d\u5c0d\u65b9\u6536\u5230\u524d\uff08\u6839\u64da\u8a2d\u5b9a\u53ef\u80fd\u4e0d\u9700\u8981\u78ba\u8a8d\uff09\u53ef\u80fd\u53c8\u518d\u9001\u51fa\u4e00\u5247\u8a0a\u606f \u975e\u540c\u6b65\u8a0a\u606f\u50b3\u905e\u66f8\u4e2d\u4e3b\u8981\u4ecb\u7d39\u5169\u7a2e\u65b9\u5f0f\uff1a \u6d88\u606f\u4ee3\u7406\uff08Message brokers\uff09 Referrer \u6f14\u54e1\u6a21\u578b\uff08Actor model\uff09 \u9664\u6b64\u4e4b\u5916\uff0c\u53e6\u5916\u53ef\u80fd\u9084\u6709\uff1a \u4e8b\u4ef6\u6d41\u5f0f\u67b6\u69cb\uff08Event streaming platforms\uff09 \u50c5\u63d0\u4f9b\u591a\u5c0d\u4e00\uff08pub/sub\uff09\u7684\u670d\u52d9 \u8f03\u9069\u5408\u8655\u7406\u5927\u91cf\u8a0a\u606f Referrer \u4e8b\u4ef6\u67b6\u69cb\u5c0d\u65bc\u8cc7\u6599\u50b3\u905e\u548c\u6574\u500b\u7d44\u7e54\u7684\u8cc7\u6599\u6574\u5408\u4f86\u8aaa\u975e\u5e38\u597d\u7528\uff0c\u672a\u4f86\u6703\u88dc\u500b \u8aaa\u660e \u4f01\u696d\u670d\u52d9\u532f\u6d41\u6392\uff08Enterprise service bus\uff09 \u8f03\u5927\u578b\u7684\u6d88\u606f\u4ee3\u7406\u8005\uff0c\u8655\u7406\u591a\u5c0d\u591a\u7684\u6e9d\u901a\uff0c\u6703\u8ca0\u8cac\u628a\u50b3\u905e\u4e2d\u7684\u8a0a\u606f\u683c\u5f0f\u7d71\u4e00\u3002\u4f8b\u5982 XML \u8f49\u6210 JSON \u6162\u6162\u5f0f\u5fae \uff0c\u56e0\u70ba\u6703\u8d8a\u641e\u8d8a\u8907\u96dc Referrer \u6f14\u54e1\u6a21\u578b\uff08Actor model\uff09 \u6f14\u54e1\u6a21\u578b\u662f\u4e00\u7a2e\u7a0b\u5f0f\u8a2d\u8a08\u7684\u54f2\u5b78\uff0c\u5176\u4e3b\u65e8\u662f\u7368\u7acb\u6bcf\u500b\u904b\u884c\u7684\u908f\u8f2f\u548c\u5176\u72c0\u614b\uff0c\u4e26\u628a\u9019\u7368\u7acb\u7684\u55ae\u4f4d\u7a31\u70ba\u6f14\u54e1\uff08Actor\uff09\u3002 \u4f8b\u5982\u73fe\u5728\u6709\u500b\u6f14\u54e1\u6703\u8ca0\u8cac\u8f38\u51fa\u300cHello World\u300d\uff0c\u6211\u5011\u50b3\u905e\u4e00\u500b\u8a0a\u606f\u7d66\u9019\u500b\u6f14\u54e1\uff0c\u544a\u8a34\u4ed6\u6211\u9019\u88e1\u6709\u500b\u8b8a\u6578 3\uff0c\u4f5c\u51fa\u4efb\u4f55\u4f60\u61c9\u8a72\u8981\u505a\u7684\u4e8b\u60c5\u5427\u3002 \u7136\u5f8c\u9019\u500b\u6f14\u54e1\u5c31\u6703\u958b\u59cb\u8f38\u51fa\u300cHello World\u300d\u4e09\u6b21\u3002 \u4ee5 Java \u7684\u5957\u4ef6 Akka \u70ba\u4f8b\uff0c\u8a72\u5957\u4ef6\u662f\u4ee5\u6f14\u54e1\u6a21\u578b\u70ba\u6838\u5fc3\u601d\u60f3\u53bb\u5be6\u8e10\u4e00\u500b\u6846\u67b6\u7684\uff1a public class HelloWorld extends AbstractBehavior < HelloWorld . Command > { interface Command {} public enum SayHello implements Command { INSTANCE } public static class ChangeMessage implements Command { public final String newMessage ; public ChangeMessage ( String newMessage ) { this . newMessage = newMessage ; } } public static Behavior < Command > create () { return Behavior . setup ( context -> new HelloWorld ( context )); } private String message = \"Hello World\" ; private HelloWorld ( ActorContext < Command > context ) { super ( context ); } @Override public Receive < Command > createReceive () { return newReceiveBuilder () . onMessageEquals ( SayHello . INSTANCE , this :: onSayHello ) . onMessage ( ChangeMessage . class , this :: onMessageChange ) . build (); } private Behavior < Command > onSayHello () { System . out . println ( message ); return this ; } private Behavior < Command > onMessageChange ( ChangeMessage command ) { message = command . newMessage ; return this ; } } \u4e0a\u8ff0\u6f14\u54e1\u5728\u6536\u5230 SayHello.INSTANCE \u5c31\u6703\u57f7\u884c onSayHello \uff0c\u6536\u5230 ChangeMessage \u9019\u4e00\u985e\u5225\u7684\u8a0a\u606f\u6642\u6703\u57f7\u884c onMessageChange \u3002 \u6e96\u5099\u597d\u6f14\u54e1\uff0c\u5c31\u53ef\u4ee5\u958b\u59cb\u57f7\u884c\u5287\u5834\u5de5\u4f5c\u56c9\uff1a ActorSystem < HelloWorld . Command > mySystem = ActorSystem . create ( HelloWorld . create (), \"MySystem\" ); // \u544a\u8a34\u6f14\u54e1 `HelloWorld.SayHello.INSTANCE` \u9019\u5247\u8a0a\u606f mySystem . tell ( HelloWorld . SayHello . INSTANCE ); mySystem . tell ( HelloWorld . SayHello . INSTANCE ); // \u544a\u8a34\u6f14\u54e1 `HelloWorld.ChangeMessage` \u9019\u500b\u578b\u5225\u7684\u8a0a\u606f mySystem . tell ( new HelloWorld . ChangeMessage ( \"Hello Actor World!!\" )); mySystem . tell ( HelloWorld . SayHello . INSTANCE ); mySystem . tell ( HelloWorld . SayHello . INSTANCE ); // \u6700\u5f8c\u8f38\u51fa\uff1a // Hello World // Hello World // Hello Actor World!! // Hello Actor World!! \u6f14\u54e1\u6a21\u578b\u7684\u50f9\u503c\u5728\u65bc\u5b83\u4e0d\u53ea\u5c40\u9650\u65bc\u7a0b\u5f0f\u78bc\u4e4b\u9593\u7684\u8a0a\u606f\u50b3\u905e\uff0c\u4f60\u4e00\u6a23\u53ef\u4ee5\u901a\u904e\u7db2\u969b\u7db2\u8def\u7684\u65b9\u5f0f\u50b3\u905e\uff0c\u5c31\u597d\u50cf API \u4e00\u6a23\uff08\u985e\u4f3c RPC \u60f3\u505a\u7684\u4e8b\uff09\u3002 Referrer","title":"\u7de8\u78bc\u548c\u50b3\u8f38"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_1","text":"\u6211\u5011\u90fd\u6703\u900f\u904e\u7a0b\u5f0f\u8a9e\u8a00\u4f86\u548c\u8a18\u61b6\u9ad4\u6e9d\u901a\uff0c\u4e0d\u540c\u7a0b\u5f0f\u8a9e\u8a00\u9810\u8a2d\u5c31\u6709\u4e9b\u7de8\u78bc\u65b9\u5f0f\uff0cJava\uff1a java.io.Serializable \u3001Ruby\uff1a Marshal \u3001Python\uff1a pickle \uff0c\u7136\u800c \u901a\u5e38\u4e0d\u540c\u8a9e\u8a00\u4e4b\u9593\u662f\u7121\u6cd5\u4e92\u76f8\u63a5\u901a\u7684 \u53ef\u80fd\u6703\u89f8\u767c\u7269\u4ef6\u7684\u5efa\u7f6e\uff0c\u6709\u5b89\u5168\u6027\u7591\u616e \u8f03\u5c11\u8003\u616e\u524d\u5f8c\u76f8\u5bb9 \u6548\u7387\u901a\u5e38\u5f88\u5dee","title":"\u7a0b\u5f0f\u78bc\u5167\u5efa\u7de8\u78bc\u65b9\u5f0f"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_2","text":"JSON\u3001XML\u3001CSV\uff0c\u9019\u4e9b\u683c\u5f0f\u90fd\u5f88\u5e38\u898b\uff0c\u4e0d\u9700\u8981\u7db1\u76ee\u5c31\u80fd\u89e3\u78bc\u3002\u7136\u800c \u7121\u6cd5\u5132\u5b58\u4e8c\u9032\u4f4d\u6587\u5b57\uff0c\u96d6\u7136\u53ef\u4ee5\u4f7f\u7528 Base64 \u628a\u4e8c\u9032\u4f4d\u8f49\u63db\u6210 Unicode \u6587\u5b57\uff0c\u7f3a\u9700\u8981\u984d\u5916\u7684\u6548\u80fd\u548c\u9ad4\u7a4d Base64 \u6bcf 6 \u500b bit \u8f49\u6210\u4e00\u500b ASCII \u5b57\u5143\uff081 \u500b byte\uff09\uff0c\u6240\u4ee5\u9ad4\u7a4d\u6703\u6bd4\u76f4\u63a5\u505a\u4e8c\u9032\u4f4d\u8f49\u63db\u5927 1.3 \u500d \u6c92\u6709\u7db1\u76ee\uff0c\u82b1\u6642\u9593\u7406\u89e3\u548c\u7ba1\u7406 \u5927\u6578\u5b57\u4e0d\u597d\u5132\u5b58\uff0c\u6574\u6578\u3001\u5c0f\u6578\u7684\u5340\u5206 \u7136\u800c\u9019\u4e9b\u4ecd\u662f\u4e3b\u8981\u7684\u7de8\u78bc\u65b9\u5f0f\uff0c\u4e5f\u56e0\u70ba\u5927\u5bb6\u5f88\u7fd2\u6163\u9019\u4e9b\u65b9\u5f0f\u7684\u7de8\u78bc\uff0c\u5c0e\u81f4\u66f4\u6709\u6548\u548c\u66f4\u65b9\u4fbf\u7ba1\u7406\u7684\u7de8\u78bc\u65b9\u5f0f\u5f88\u96e3\u5438\u5f15\u5230\u5927\u5bb6\u7684\u76ee\u5149\u3002","title":"\u65b9\u4fbf\u4eba\u985e\u95b1\u8b80\u7684\u683c\u5f0f"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#json","text":"\u6709\u4e9b\u683c\u5f0f\u662f\u4ee5 JSON \u70ba\u57fa\u790e\u505a\u6f14\u5316\u7684\uff0c\u5176\u5617\u8a66\u89e3\u6c7a\u4e0a\u8ff0\u554f\u984c\uff0c\u4f46\u662f\u6548\u7387\u4ecd\u7121\u6cd5\u8d0f\u904e\u5c08\u9580\u7684\u4e8c\u9032\u4f4d\u7de8\u78bc\uff0c\u4ee5\u4e0b\u5716\u70ba\u7bc4\u4f8b\uff1a \u539f\u59cb JSON \u8cc7\u6599\uff1a { \"userName\" : \"Martin\" , \"favoriteNumber\" : 1337 , \"interests\" : [ \"daydreaming\" , \"hacking\" ] } \u6211\u5011\u53ef\u4ee5\u5f97\u5230 66 Bytes \u7684\u8cc7\u6599\uff0c\u78ba\u5be6\u6bd4\u539f\u672c 88 Bytes \u597d\uff0c\u4f46\u662f\u548c\u5f85\u6703\u6211\u5011\u53ef\u4ee5\u770b\u5230\u6e1b\u5c11\u5230 32 Bytes \u7684\u65b9\u5f0f\u4ecd\u6709\u5dee\u7570\u3002","title":"\u4e8c\u9032\u4f4d JSON"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_3","text":"\u4e8c\u9032\u4f4d\u7de8\u78bc\u4e26\u4e0d\u662f\u65b0\u6771\u897f\uff0c\u65e9\u5728 1984 \u5e74\u5c31\u6709\u5354\u5b9a ASN.1 \u95e1\u8ff0\u5982\u4f55\u9032\u884c\u4e8c\u9032\u4f4d\u7de8\u78bc\uff0c\u4ed6\u548c Thrift \u3001 Protocol Buffer \u4e00\u6a23\u90fd\u4f7f\u7528 tag ID\u3002\u4e14\u5176\u61c9\u7528\uff08DER\uff09\u5982\u4eca\u4ecd\u88ab\u5927\u91cf\u4f7f\u7528\u65bc X.509\u3002 \u4f46\u662f\u4ed6\u537b\u6709\u904e\u65bc\u8907\u96dc\u4e14\u7db1\u76ee\uff08Schema\uff09\u5efa\u7f6e\u56f0\u96e3\u7684\u7f3a\u9ede\uff0c\u7531\u6b64\u767c\u5c55\u51fa\u4ee5\u4e0b\u5e7e\u500b\u8f03\u65b0\u7684\u65b9\u5f0f\u3002 Apache Thrift - \u521d\u59cb\u65bc Facebook Protocol Buffer - Google Apache Avro \u4e0a\u8ff0\u65b9\u5f0f\u53ef\u4ee5\u964d\u4f4e\u78c1\u789f\u7684\u4f7f\u7528\u91cf\u3001\u9ad8\u6548\u80fd\u7de8\uff08\u89e3\uff09\u78bc\u3001\u6709\u6548\u88fd\u4f5c\u6587\u4ef6\u6a94\uff0c\u4f46\u7f3a\u9ede\u5c31\u662f\u9700\u8981\u89e3\u78bc\u624d\u80fd\u8b93\u4eba\u985e\u8b80\u61c2\u8a0a\u606f\u3002","title":"\u4e8c\u9032\u4f4d\u7de8\u78bc"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_4","text":"\u5728\u505a\u7de8\u78bc\u6642\u90fd\u9700\u8981\u53bb\u8003\u616e\u524d\u5f8c\u76f8\u5bb9\uff1a \u5411\u5f8c\u76f8\u5bb9\uff1a\u820a\u7684\u7a0b\u5f0f\u78bc\u8b80\u5230\u7684\u8cc7\u6599\u542b\u6709\u65b0\u7684\u7db1\u76ee\u5b9a\u7fa9\u7684\u6b04\u4f4d\u6642\uff0c\u4ecd\u7136\u53ef\u4ee5\u904b\u884c \u5411\u524d\u76f8\u5bb9\uff1a\u65b0\u7684\u7a0b\u5f0f\u78bc\u8b80\u5230\u7684\u8cc7\u6599\u542b\u6709\u5df2\u7d93\u88ab\u522a\u9664\u7684\u6b04\u4f4d\u6642\uff0c\u4ecd\u7136\u53ef\u4ee5\u904b\u884c \u7531\u6b64\u53ef\u77e5\uff0cJSON \u9019\u985e\u7de8\u78bc\u65b9\u5f0f\u65b0\u820a\u7248\u672c\u90fd\u53ef\u4ee5\u505a\u89e3\u78bc\uff0c\u53ea\u8981\u5728\u7a0b\u5f0f\u908f\u8f2f\u4e0a\u6ce8\u610f\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4fdd\u6301\u524d\u5f8c\u76f8\u5bb9\u3002 \u9664\u6b64\u4e4b\u5916\u9084\u9700\u8981\u6ce8\u610f\u65b0\u7684\u7a0b\u5f0f\u78bc\u64b0\u5beb\u8cc7\u6599\u6642\uff0c\u88ab\u540c\u6642\u5b58\u5728\u7684\u820a\u7a0b\u5f0f\u78bc\u8986\u84cb\u6389\uff1a \u5728\u8cc7\u6599\u6e96\u5099\u8981\u9001\u5230\u8cc7\u6599\u5132\u5009\uff08warehouse\uff09\u6642\uff0c\u4e5f\u9700\u8981\u7de8\u78bc\uff0c\u9019\u6642\u5019\u53ef\u4ee5\u628a\u8cc7\u6599\u8f49\u63db\u6210\u53cb\u5584\u65bc\u5217\u5f0f\u8cc7\u6599\u5eab\uff08column-oriented database\uff09\u7684\u683c\u5f0f\uff0c\u4f8b\u5982 Parquet \u3002","title":"\u524d\u5f8c\u76f8\u5bb9"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#thrift","text":"\u7db1\u76ee\uff1a struct Person { 1: required string userName, 2: optional i64 favoriteNumber, 3: optional list<string> interests }","title":"Thrift"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#binaryprotocol","text":"59 Bytes","title":"BinaryProtocol"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#compactprotocol","text":"34 Bytes","title":"CompactProtocol"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#protocol-buffer","text":"\u7db1\u76ee\uff1a message Person { required string user_name = 1; optional int64 favorite_number = 2; repeated string interests = 3; } 33 Bytes","title":"Protocol Buffer"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_5","text":"required \u548c optional \u5728\u7de8\u78bc\u6642\uff0c\u4e0d\u5f71\u97ff\u7d50\u679c\uff0c\u50c5\u6703\u5728\u505a\u89e3\u78bc\u6642 runtime \u8f38\u51fa\u932f\u8aa4\u3002 \u6bcf\u500b tag ID \u4e0d\u53bb\u66f4\u52d5\u4f86\u4fdd\u6301\u524d\u5f8c\u76f8\u5bb9\u3002\u7576\u4f7f\u7528\u820a\u7684\u7db1\u76ee\u53bb\u8b80\u53d6\u672a\u77e5\u6b04\u4f4d\u6642\uff0c\u7701\u7565\u4e4b\u3002 \u65b0\u589e\u6b04\u4f4d\u6642\u82e5\u8a2d\u5b9a required \u6703\u8b93\u820a\u7a0b\u5f0f\u78bc\u8f38\u51fa\u932f\u8aa4\uff0c\u9700\u8981\u7d66\u5b9a\u9810\u8a2d\u503c\u3002 \u8b8a\u66f4\u6a94\u6848\u683c\u5f0f\u53ef\u80fd\u5c0e\u81f4\u8cc7\u6599\u4e0d\u5b8c\u5168\uff0c\u4f8b\u5982 int8 \u8f49\u5230 int16 ProtocolBuffers \u6c92\u6709 list \u8cc7\u6599\u578b\u614b\uff0c\u8b93\u4ed6\u5f88\u597d\u5f9e repeated \u8f49\u5230 optional \uff0c\u4f46\u5de2\u72c0\u7d50\u69cb\u5c31\u6703\u9700\u8981\u984d\u5916\u529f\u4f86\u9054\u6210\u3002","title":"\u8a3b"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#avro","text":"\u7db1\u76ee\uff1a record Person { string userName; union { null, long } favoriteNumber = null; array < string > interests; } \u9019\u88e1\u591a\u4e86\u4e00\u500b union\uff0c\u5230\u6642\u5019\u5728 encoding \u6642\u9700\u8981\u8a2d\u5b9a\u4ee5\u8aaa\u660e\u8a72\u503c\u5c6c\u65bc\u54ea\u7a2e\u578b\u5225\u3002 32 Bytes","title":"Avro"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_6","text":"Avro \u4e26\u6c92\u6709\u4f7f\u7528 tag ID \u4f86\u8fa8\u8a8d\u6bcf\u500b\u8cc7\u6599\u7684\u4f4d\u7f6e\uff0c\u800c\u662f\u900f\u904e\u7db1\u76ee\u4e0d\u540c\u7248\u672c\u9593\u7684\u8f49\u63db\uff1a \u56e0\u6b64\u8b80\u53d6\u8cc7\u6599\u6642\uff0c\u9700\u8981\u5148\u78ba\u4fdd\u64b0\u5beb\u8cc7\u6599\u6240\u4f7f\u7528\u7684\u7db1\u76ee\u7248\u672c\u3002 Avro \u4e5f\u5229\u7528 union { null, int } \u4f86\u7576\u4f5c\u8cc7\u6599\u7684 required/optional \uff0c\u540c\u6642\u7d66\u4e88\u9810\u8a2d\u503c\u4f86\u6eff\u8db3\u5411\u5f8c\uff08\u524d\uff09\u76f8\u5bb9\u3002 \u9664\u6b64\u4e4b\u5916\uff0cAvro \u9084\u5141\u8a31\u66f4\u6539\u8cc7\u6599\u7684 \u578b\u5225 \u548c \u540d\u7a31 \uff0c\u4f46\u53ea\u80fd\u6eff\u8db3\u5411\u5f8c\u76f8\u5bb9\uff1a \u63d0\u4f9b \u578b\u5225 \u7684\u8f49\u63db\u5668 \u8a2d\u5b9a alias \u4f86\u6eff\u8db3\u540d\u7a31\u7684\u8f49\u63db","title":"\u6bd4\u8f03"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_7","text":"\u6839\u64da\u61c9\u7528\u7a0b\u5f0f\u800c\u6709\u5dee\u7570\uff1a \u82e5\u8cc7\u6599\u5eab\u662f\u5728 Hadoop \u67b6\u69cb\u4e4b\u4e0a\uff0c\u5c31\u53ef\u4ee5\u5728\u6bcf\u4efd\u6a94\u6848\u524d\u9762\u6dfb\u52a0\u7db1\u76ee\u7248\u672c\u3002 \u82e5\u8cc7\u6599\u5eab\u7684\u6bcf\u7b46\u8cc7\u6599\u90fd\u53ef\u80fd\u6703\u6709\u4e0d\u540c\u7684\u7248\u672c\uff0c\u5c31\u9700\u8981\u5728\u6bcf\u7b46\u8cc7\u6599\u524d\u8a2d\u5b9a\u7248\u672c\uff0c\u5982 Espresso \u3002 \u82e5\u662f\u5728\u7db2\u8def\u4e0a\u9032\u884c\u96d9\u5411\u6e9d\u901a\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u53ef\u4ee5\u5354\u5546\u51fa\u5f7c\u6b64\u7684\u7248\u672c\uff0c\u5982 Avro RPC","title":"\u5982\u4f55\u77e5\u9053\u64b0\u5beb\u8005\u7684\u7db1\u76ee\u7248\u672c"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#tag-id","text":"\u8cc7\u6599\u8f38\u51fa\u6210\u6a94\u6848\u6642\uff08Hadoop \u67b6\u69cb\u4e0b\u7684\u8cc7\u6599\u5eab\u5e38\u505a\u7684\u4e8b\uff09\uff0c\u6211\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5f9e\u8cc7\u6599\u5eab\u7684\u7db1\u76ee\u8f49\u63db\u6210 Avro Schema\uff0c\u7136\u5f8c\u628a\u6a94\u6848\u64b0\u5beb\u6210\u4e8c\u4f4d\u5143\u3002\u540c\u6a23\u7684\uff0c\u7576\u8cc7\u6599\u5eab\u7684\u7db1\u76ee\u66f4\u65b0\u6642\uff0c\u5df2\u7d93\u8f38\u51fa\u904e\u7684\u6a94\u6848\u5c31\u4e0d\u518d\u9700\u8981\u8f49\u63db\uff0c\u800c\u662f\u900f\u904e\u4e0a\u8ff0\u7248\u672c\u8f49\u63db\u6a5f\u5236\u3002 \u76f8\u53cd\u7684\uff0c\u7528 Protocol Buffers \u6216 Thrift \u5c31\u9700\u8981\u8b39\u614e\u4f7f\u7528 tag ID \u4f86\u907f\u514d\u4efb\u4f55\u885d\u7a81\u3002 Protocol Buffers\u3001Thrift \u4e26\u4e0d\u662f\u70ba\u4e86\u9019\u985e\u64cd\u4f5c\u800c\u8a2d\u8a08\u7684\u7de8\u78bc\u683c\u5f0f","title":"\u4e0d\u9700\u8981\u4f7f\u7528 tag ID \u6709\u4ec0\u9ebc\u597d\u8655"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_8","text":"Protocol Buffers\u3001Thrift \u5728\u5f37\u578b\u5225\u7684\u8a9e\u8a00\uff08Java\u3001C++\u3001Dart\uff09\u4e0a\u5f88\u597d\u7528\uff0c\u56e0\u7232\u53ef\u4ee5\u900f\u904e\u7db1\u76ee\u53bb\u7522\u751f\u7de8\u78bc\u5f8c\u7684\u7a0b\u5f0f\u78bc\uff0c\u4e26\u57f7\u884c\u4e8c\u4f4d\u5143\u7de8\u78bc\u7684\u89e3\u78bc\u3002\u4f46\u662f\u5728\u5f31\u578b\u5225\u7684\u8a9e\u8a00\uff08JavaScript\u3001Python\u3001Ruby\u3001PHP\uff09\u4e0a\u5c31\u9700\u8981\u505a\u984d\u5916\u7684\u529f\uff0c\u5982 TypeScript\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u52d5\u614b\u7522\u751f\u7684\u7db1\u76ee\uff0c\u5982\u900f\u904e\u8cc7\u6599\u5eab\u7684\u7db1\u76ee\u7522\u751f Avro Schema\uff0c\u5c0d\u65bc\u5f31\u578b\u5225\u7684\u8a9e\u8a00\u5c31\u66f4\u9ebb\u7169\u3002 Avro \u63d0\u4f9b\u4e00\u4e9b\u624b\u6bb5\u6e1b\u5c11\u9019\u985e\u56f0\u64fe\uff0c\u4f8b\u5982\u5728 Hadoop \u67b6\u69cb\u4e4b\u4e0a\u7684\u6a94\u6848\uff0c\u90fd\u5305\u542b\u7db1\u76ee\uff0c\u4e5f\u5c31\u662f\u8b93\u9019\u4efd\u6a94\u6848\u80fd\u5920\u81ea\u63cf\u8ff0\uff08self-describing\uff09\u3002\u4f60\u53ef\u4ee5\u76f4\u63a5\u900f\u904e\u7a0b\u5f0f\u5eab\u6253\u958b\u9019\u4efd\u6a94\u6848\uff0c\u4e26\u4e14\u64cd\u4f5c\u4e0a\u5982\u540c JSON \u683c\u5f0f\u7684\u8cc7\u6599\u3002 \u5206\u6790\u5de5\u5177 Apache Pig \u5c31\u662f\u904b\u7528\u9019\u7279\u6027\uff0c\u8b93\u4f7f\u7528\u8005\u76f4\u63a5\u900f\u904e SQL \u8a9e\u6cd5\u5728 Hadoop \u67b6\u69cb\u4e4b\u4e0a\u7684\u8cc7\u6599\u5eab\u9032\u884c\u5206\u6790\uff0c\u800c\u4e0d\u9700\u8981\u8003\u616e\u4efb\u4f55\u7db1\u76ee\u4e0a\u7684\u554f\u984c\u3002","title":"\u5f31\u578b\u5225\u8a9e\u8a00\u4e0a\u7684\u61c9\u7528"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_9","text":"JSON\uff08Schema-less \u7de8\u78bc\uff09\u53ef\u4ee5\u900f\u904e\u6587\u4ef6\u65b9\u5f0f\u88dc\u8db3\u7db1\u76ee\uff0c\u6709\u5176\u512a\u9ede\uff1a \u5728\u89e3\u78bc\u6642\u4e0d\u6703\u53d7\u7db1\u76ee\u5f71\u97ff\uff0c\u53ef\u8f15\u6613\u5141\u8a31\u5411\u5f8c\uff08\u524d\uff09\u7684\u76f8\u5bb9\u3002 \u7db1\u76ee\u56e0\u70ba\u662f\u6587\u4ef6\u5f62\u5f0f\uff0c\u80fd\u8a73\u7d30\u9650\u5236\u8cc7\u6599\u3002\u5982\uff1a\u6578\u5b57\u53ea\u80fd\u5728 0~1 \u4e4b\u9593\u3002 \u7136\u800c\u4e8c\u9032\u4f4d\u7de8\u78bc\u4e5f\u6709\u5176\u597d\u8655\uff1a \u5132\u5b58\u66f4\u7dca\u5bc6\uff0c\u9ad4\u7a4d\u5c0f\u3002 \u56e0\u70ba\u7db1\u76ee\uff08Schema\uff09\u662f\u5fc5\u9808\u7684\uff0c\u4e0d\u6703\u51fa\u73fe\u6587\u4ef6\u548c\u5be6\u969b\u904b\u4f5c\u6709\u843d\u5dee\uff08\u5fd8\u8a18\u88dc\u6587\u4ef6\uff09\u3002 \u5728 compile \u904e\u7a0b\u5c31\u80fd\u6aa2\u67e5\u7a0b\u5f0f\u78bc\u662f\u5426\u7b26\u5408\u7db1\u76ee\u3002 \u900f\u904e\u4e00\u4e9b\u6a5f\u5236\u4ecd\u80fd\u4fdd\u6301\u5411\u524d\uff08\u5f8c\uff09\u7684\u76f8\u5bb9","title":"\u8907\u7fd2\u5dee\u7570"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_10","text":"\u8cc7\u6599\u5eab\u540c\u4e00\u500b\u670d\u52d9\u7de8\uff08\u89e3\uff09\u78bc\u3002\u4e5f\u5c31\u662f\uff1a \u8cc7\u6599\u5eab\u7de8\u3001\u89e3\u78bc\uff0c\u6216\u8005 \u8cc7\u6599\u5eab\u9700\u6c42\u8005\u7de8\u3001\u89e3\u78bc RPC/REST/SOAP APIs\uff0c\u5169\u500b\u670d\u52d9\u6216\u4f7f\u7528\u8005\u5f7c\u6b64\u7de8\u89e3\u78bc\u3002\u4e5f\u5c31\u662f\uff1a \u8acb\u6c42\u8005\u628a\u8acb\u6c42\u8cc7\u8a0a\u7de8\u78bc \u670d\u52d9\u8005\u89e3\u78bc \u670d\u52d9\u8005\u628a\u56de\u61c9\u7de8\u78bc \u8acb\u6c42\u8005\u89e3\u78bc RPC \u7684\u7de8\u78bc\u4f7f\u7528 Protocol Buffers - Google gRPC \u4e4b\u524d\u6709\u64b0\u5beb\u904e \u5fc3\u5f97 Thrift - Twitter Finagle JSON - LinkedIn Rest.li \u82e5\u5c0d\u5916\uff0c\u7121\u6cd5\u4fdd\u8b49 client \u4f7f\u7528\u6700\u65b0\u7248\u672c\u7684 Schema\uff0c\u6240\u4ee5\u8f03\u96e3\u7dad\u904b\u3002\u53cd\u4e4b\uff0cRESTful API \u53ef\u4ee5\u5229\u7528\uff1a \u524d\u7db4\u8a5e\u52a0\u4e0a\u7248\u672c HTTP \u6a19\u982d\uff08 Accept \uff09\u5beb\u660e\u4f7f\u7528\u7248\u672c \u8acb\u6c42\u6642\u9700\u651c\u5e36 Token \u5728\u767c\u9001\u8005\u548c\u63a5\u6536\u8005\u9593\u975e\u540c\u6b65\u8a0a\u606f\u50b3\u905e\uff08Asynchronous message passing\uff09\u3002\u4e5f\u5c31\u662f\uff1a \u767c\u9001\u8005\u7de8\u78bc \u63a5\u6536\u8005\u89e3\u78bc","title":"\u7de8\uff08\u89e3\uff09\u78bc\u7684\u4f7f\u7528\u60c5\u5883"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#_11","text":"\u9019\u584a\u8f03\u4e0d\u719f\u6089\uff0c\u56e0\u6b64\u53e6\u5916\u641c\u96c6\u8cc7\u6599\u3002\u975e\u540c\u6b65\u8a0a\u606f\u548c\u540c\u6b65\u8a0a\u606f\u7684\u5dee\u7570\u5728\u65bc \u540c\u6b65\u8a0a\u606f\u9810\u671f\u6536\u5230\u8acb\u6c42\uff0c\u4f8b\u5982 REST API\u3002\u9019\u4ee3\u8868\u7576\u6c92\u6536\u5230\u8acb\u6c42\u6642\uff0c\u9700\u8981\u505a\u932f\u8aa4\u8655\u7406\uff08Error handling\uff09 \u975e\u540c\u6b65\u8a0a\u606f\u5247\u76f8\u53cd\uff0c\u9001\u51fa\u8a0a\u606f\u5f8c\uff0c\u5728\u78ba\u8a8d\u5c0d\u65b9\u6536\u5230\u524d\uff08\u6839\u64da\u8a2d\u5b9a\u53ef\u80fd\u4e0d\u9700\u8981\u78ba\u8a8d\uff09\u53ef\u80fd\u53c8\u518d\u9001\u51fa\u4e00\u5247\u8a0a\u606f \u975e\u540c\u6b65\u8a0a\u606f\u50b3\u905e\u66f8\u4e2d\u4e3b\u8981\u4ecb\u7d39\u5169\u7a2e\u65b9\u5f0f\uff1a \u6d88\u606f\u4ee3\u7406\uff08Message brokers\uff09 Referrer \u6f14\u54e1\u6a21\u578b\uff08Actor model\uff09 \u9664\u6b64\u4e4b\u5916\uff0c\u53e6\u5916\u53ef\u80fd\u9084\u6709\uff1a \u4e8b\u4ef6\u6d41\u5f0f\u67b6\u69cb\uff08Event streaming platforms\uff09 \u50c5\u63d0\u4f9b\u591a\u5c0d\u4e00\uff08pub/sub\uff09\u7684\u670d\u52d9 \u8f03\u9069\u5408\u8655\u7406\u5927\u91cf\u8a0a\u606f Referrer \u4e8b\u4ef6\u67b6\u69cb\u5c0d\u65bc\u8cc7\u6599\u50b3\u905e\u548c\u6574\u500b\u7d44\u7e54\u7684\u8cc7\u6599\u6574\u5408\u4f86\u8aaa\u975e\u5e38\u597d\u7528\uff0c\u672a\u4f86\u6703\u88dc\u500b \u8aaa\u660e \u4f01\u696d\u670d\u52d9\u532f\u6d41\u6392\uff08Enterprise service bus\uff09 \u8f03\u5927\u578b\u7684\u6d88\u606f\u4ee3\u7406\u8005\uff0c\u8655\u7406\u591a\u5c0d\u591a\u7684\u6e9d\u901a\uff0c\u6703\u8ca0\u8cac\u628a\u50b3\u905e\u4e2d\u7684\u8a0a\u606f\u683c\u5f0f\u7d71\u4e00\u3002\u4f8b\u5982 XML \u8f49\u6210 JSON \u6162\u6162\u5f0f\u5fae \uff0c\u56e0\u70ba\u6703\u8d8a\u641e\u8d8a\u8907\u96dc Referrer","title":"\u975e\u540c\u6b65\u8a0a\u606f\u50b3\u905e"},{"location":"feedback/designing-data-intensive-applications/encoding-evolution/#actor-model","text":"\u6f14\u54e1\u6a21\u578b\u662f\u4e00\u7a2e\u7a0b\u5f0f\u8a2d\u8a08\u7684\u54f2\u5b78\uff0c\u5176\u4e3b\u65e8\u662f\u7368\u7acb\u6bcf\u500b\u904b\u884c\u7684\u908f\u8f2f\u548c\u5176\u72c0\u614b\uff0c\u4e26\u628a\u9019\u7368\u7acb\u7684\u55ae\u4f4d\u7a31\u70ba\u6f14\u54e1\uff08Actor\uff09\u3002 \u4f8b\u5982\u73fe\u5728\u6709\u500b\u6f14\u54e1\u6703\u8ca0\u8cac\u8f38\u51fa\u300cHello World\u300d\uff0c\u6211\u5011\u50b3\u905e\u4e00\u500b\u8a0a\u606f\u7d66\u9019\u500b\u6f14\u54e1\uff0c\u544a\u8a34\u4ed6\u6211\u9019\u88e1\u6709\u500b\u8b8a\u6578 3\uff0c\u4f5c\u51fa\u4efb\u4f55\u4f60\u61c9\u8a72\u8981\u505a\u7684\u4e8b\u60c5\u5427\u3002 \u7136\u5f8c\u9019\u500b\u6f14\u54e1\u5c31\u6703\u958b\u59cb\u8f38\u51fa\u300cHello World\u300d\u4e09\u6b21\u3002 \u4ee5 Java \u7684\u5957\u4ef6 Akka \u70ba\u4f8b\uff0c\u8a72\u5957\u4ef6\u662f\u4ee5\u6f14\u54e1\u6a21\u578b\u70ba\u6838\u5fc3\u601d\u60f3\u53bb\u5be6\u8e10\u4e00\u500b\u6846\u67b6\u7684\uff1a public class HelloWorld extends AbstractBehavior < HelloWorld . Command > { interface Command {} public enum SayHello implements Command { INSTANCE } public static class ChangeMessage implements Command { public final String newMessage ; public ChangeMessage ( String newMessage ) { this . newMessage = newMessage ; } } public static Behavior < Command > create () { return Behavior . setup ( context -> new HelloWorld ( context )); } private String message = \"Hello World\" ; private HelloWorld ( ActorContext < Command > context ) { super ( context ); } @Override public Receive < Command > createReceive () { return newReceiveBuilder () . onMessageEquals ( SayHello . INSTANCE , this :: onSayHello ) . onMessage ( ChangeMessage . class , this :: onMessageChange ) . build (); } private Behavior < Command > onSayHello () { System . out . println ( message ); return this ; } private Behavior < Command > onMessageChange ( ChangeMessage command ) { message = command . newMessage ; return this ; } } \u4e0a\u8ff0\u6f14\u54e1\u5728\u6536\u5230 SayHello.INSTANCE \u5c31\u6703\u57f7\u884c onSayHello \uff0c\u6536\u5230 ChangeMessage \u9019\u4e00\u985e\u5225\u7684\u8a0a\u606f\u6642\u6703\u57f7\u884c onMessageChange \u3002 \u6e96\u5099\u597d\u6f14\u54e1\uff0c\u5c31\u53ef\u4ee5\u958b\u59cb\u57f7\u884c\u5287\u5834\u5de5\u4f5c\u56c9\uff1a ActorSystem < HelloWorld . Command > mySystem = ActorSystem . create ( HelloWorld . create (), \"MySystem\" ); // \u544a\u8a34\u6f14\u54e1 `HelloWorld.SayHello.INSTANCE` \u9019\u5247\u8a0a\u606f mySystem . tell ( HelloWorld . SayHello . INSTANCE ); mySystem . tell ( HelloWorld . SayHello . INSTANCE ); // \u544a\u8a34\u6f14\u54e1 `HelloWorld.ChangeMessage` \u9019\u500b\u578b\u5225\u7684\u8a0a\u606f mySystem . tell ( new HelloWorld . ChangeMessage ( \"Hello Actor World!!\" )); mySystem . tell ( HelloWorld . SayHello . INSTANCE ); mySystem . tell ( HelloWorld . SayHello . INSTANCE ); // \u6700\u5f8c\u8f38\u51fa\uff1a // Hello World // Hello World // Hello Actor World!! // Hello Actor World!! \u6f14\u54e1\u6a21\u578b\u7684\u50f9\u503c\u5728\u65bc\u5b83\u4e0d\u53ea\u5c40\u9650\u65bc\u7a0b\u5f0f\u78bc\u4e4b\u9593\u7684\u8a0a\u606f\u50b3\u905e\uff0c\u4f60\u4e00\u6a23\u53ef\u4ee5\u901a\u904e\u7db2\u969b\u7db2\u8def\u7684\u65b9\u5f0f\u50b3\u905e\uff0c\u5c31\u597d\u50cf API \u4e00\u6a23\uff08\u985e\u4f3c RPC \u60f3\u505a\u7684\u4e8b\uff09\u3002 Referrer","title":"\u6f14\u54e1\u6a21\u578b\uff08Actor model\uff09"},{"location":"feedback/designing-data-intensive-applications/introduction/","text":"Designing Data-Intensive Applications 2020 5 \u6708\u5df2\u92b7\u552e 100,000 \u672c\uff0c\u4e14\u662f 2019 \u5e74 O\u2019Reilly \u6240\u6709\u4f5c\u54c1\u92b7\u91cf\u7b2c\u4e8c\u540d\u7684\u4f5c\u54c1\uff08 \u7b2c\u4e00\u540d\u662f\u6a5f\u5668\u5b78\u7fd2\u7684 \uff09\u3002 Martin Kleppmann \u5728\u528d\u6a4b\u5927\u5b78\u64d4\u4efb\u8cc7\u6df1\u7814\u7a76\u54e1\uff0c\u4e26\u65bc\u7814\u7a76\u6240\u6559\u6388\u5206\u6563\u5f0f\u7cfb\u7d71\u3002 \u7d93\u71df\u4e00\u500b\u8d85\u8b9a\u7684 \u90e8\u843d\u683c \u3002 \u591a\u9805\u958b\u6e90\u8edf\u9ad4\uff0c\u5305\u62ec Automerge \uff0c Apache Avro \u548c Apache Samza \u7b49\u3002 \u5275\u7acb\u5169\u5bb6\u516c\u53f8\u5206\u5225\u65bc 2009 \u88ab Red Gate Software \u548c 2012 \u88ab LinkedIn \u6536\u8cfc Table of contents Foundation of Data Systems Reliable, Scalable, and Maintainable Applications\u301034\u3011 1 Data Models and Query Languages\u301049\u3011 Storage and Retrieval\u301064\u3011 Encoding and Evolution\u301054\u3011 Distributed Data Replication\u301061\u3011 Partitioning\u301033\u3011 Transactions\u301054\u3011 The Trouble with Distributing Systems\u301095\u3011 Consistency and Consensus\u3010110\u3011 Derived Data Batch Processing\u301081\u3011 Stream Processing\u3010100\u3011 The Future of Data Systems\u3010114\u3011 \u8eab\u70ba\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u958b\u767c\u8005\uff0c\u6211\u8a72\u5982\u4f55\u770b\u5f85\u672c\u66f8 \u5982\u679c\u4f60\u80fd\u5920\u4e86\u89e3\u8cc7\u6599\u5eab\u7684\u5167\u90e8\u904b\u4f5c\u65b9\u5f0f\uff0c\u4f60\u5c31\u80fd\u6709\u4e00\u500b\u8f03\u958b\u95ca\u548c\u6e05\u695a\u7684\u8996\u91ce\u53bb\u770b\u5f85\u54ea\u7a2e\u5de5\u5177\u6216\u662f\u53c3\u6578\u7684\u8abf\u6821\u662f\u6700\u9069\u5408\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u3002\u96d6\u7136\u672c\u66f8\u4e0d\u6703\u6709\u4efb\u4f55\u7522\u54c1\u7684\u7d30\u7bc0\u4ecb\u7d39\uff0c\u537b\u6703\u8b93\u4f60\u5728\u770b\u8cc7\u6599\u5eab\u6587\u4ef6\u6642\uff0c\u66b8\u89e3\u4e0d\u540c\u540d\u8a5e\u5176\u80cc\u5f8c\u53ef\u80fd\u4ee3\u8868\u7684\u512a\u52a3\u52e2\u3002 As an application developer you\u2019re armed with this knowledge about the internals of storage engines, you are in a much better position to know which tool is best suited for your particular application. If you need to adjust a database\u2019s tuning parameters, this understanding allows you to imagine what effect a higher or a lower value may have. Although this chapter couldn\u2019t make you an expert in tuning any one particular storage engine, it has hopefully equipped you with enough vocabulary and ideas that you can make sense of the documentation for the database of your choice. \u8cc7\u6599\u7684\u91cd\u8981\u6027 2021 AWS Summit \u63d0\u5230\uff1a\u7d71\u4e00\u8cc7\u6599\u4ee5\u767c\u63ee\u5176\u50f9\u503c\uff0c\u6210\u70ba\u8cc7\u6599\u9a45\u52d5\u578b\u4f01\u696d\uff0c\u5176\u7279\u8272\uff1a \u77e5\u8b58\u53ca\u529b\u91cf\u3001\u904b\u7528\u8cc7\u6599\u64f4\u5c55\u4f01\u696d\u6d1e\u5bdf\u529b\u548c\u6c7a\u7b56\u6b0a \u5c07\u8cc7\u6599\u5927\u773e\u5316\uff0c\u5efa\u7acb\u5b89\u5168\u7cfb\u7d71\u4f86\u6536\u96c6\u3001\u5132\u5b58\u53ca\u8655\u7406\u8cc7\u6599\uff0c\u63d0\u4f9b\u7d66\u9700\u8981\u7684\u4eba\u54e1\u548c\u61c9\u7528\u7a0b\u5f0f \u4ee5\u5275\u65b0\u65b9\u5f0f\u8b93\u8cc7\u6599\u767c\u63ee\u529f\u7528\uff1a\u8cc7\u6599\u79d1\u5b78\u3001\u6a5f\u5668\u5b78\u7fd2 \u5831\u544a\u9032\u7a0b \u8cc7\u6599\u6a21\u578b\u548c\u8a9e\u6cd5 \u5c0d\u61c9\u66f8\u4e2d\u7684 Data Models and Query Languages \uff0c\u5c55\u793a\u5404\u7a2e\u8cc7\u6599\u6a21\u578b 2 \u548c\u6bd4\u8f03\u3002 \u4eba\u969b\u95dc\u4fc2 \u5047\u8a2d\u6709 \\(N\\) \u500b\u9ede\uff0c\u9ede\u548c\u9ede\u7684\u9023\u7d50\u5c31\u6703\u6709 \\(\\frac{N^2-N}{2}\\) \u500b\u3002 \u8a66\u60f3\u6709\u767e\u842c\u500b\u793e\u4ea4\u5a92\u9ad4\u7684\u7528\u6236\uff0c\u82e5\u8981\u4f7f\u7528 MySQL \u5efa\u7acb\u4e00\u500b\u5f7c\u6b64\u4e4b\u9593\u8a8d\u8b58\u8207\u5426\u7684\u4eba\u969b\u7db2\u7d61\u6703\u9700\u8981\u591a\u5c11 entry\uff1f\u9019\u6642\u5019\u6709\u6c92\u6709\u9664\u4e86 Relational Model \u4e4b\u5916\u7684\u9078\u64c7\uff1f Relational Model v.s. Document Model Graph-like Model and more Query Language \u7d22\u5f15 \u5c0d\u61c9\u66f8\u4e2d Storage and Retrieval \u7684\u524d\u534a\u6bb5\uff0c\u5982\u4f55\u52a0\u901f\u8cc7\u6599\u7684\u8b80\u53d6\u3002 \u96d9\u7d22\u5f15 MySQL \u6bcf\u6b21\u4e0b query \u53ea\u6703\u9075\u5f9e\u5176\u4e2d\u4e00\u500b index\uff0c\u70ba\u4ec0\u9ebc\uff1f\u82e5\u8981\u505a\u591a\u500b\u7d22\u5f15\uff0c\u9700\u8981\u72a7\u7272\u4ec0\u9ebc\uff1f \u6709\u4e9b\u60c5\u6cc1\u5fc5\u9808\u8981\u96d9\u7d22\u5f15\uff0c\u4f8b\u5982\uff1a\u5730\u7406\u4f4d\u7f6e\u4e2d\u7684\u7d93\u7def\u5ea6\uff0c\u53ea\u641c\u5c0b\u7d93\u5ea6\u7684\u8a71\u6548\u80fd\u7684\u63d0\u5347\u6709\u9650\u3002 Hash index Sorted-String Tables(SSTables) and Log-Structured Merge-Trees(LSM-Trees) B-Trees Multi-column Indexes, Full-text search and more \u8cc7\u6599\u5009\u5132 \u5c0d\u61c9\u66f8\u4e2d Storage and Retrieval \u7684\u5f8c\u534a\u6bb5\uff0c\u5982\u4f55\u5340\u5206\u7dda\u4e0a\u548c\u5f8c\u53f0\u7684\u8cc7\u6e90\u3002 \u6578\u64da\u5206\u6790 \u5982\u679c\u6211\u5011\u8981\u5206\u6790\u7dda\u4e0a\u4f7f\u7528\u8005\u7684\u8cc7\u6599\uff0c\u5982\u4f55\u907f\u9762\u548c\u7dda\u4e0a\u4f7f\u7528\u8005\u6436\u6548\u80fd\uff1f OLTP or OLAP Column-Oriented Storage Stars and Snowflakes schema Compression \u7de8\u78bc\u548c\u9032\u7a0b \u5c0d\u61c9\u66f8\u4e2d\u7684 Encoding and Evolution \uff0c\u8cc7\u6599\u5eab\u7684\u7de8\u78bc\u6700\u4f73\u5316\u548c\u524d\u5f8c\u76f8\u5bb9\u3002 \u820a\u7248\u7de8\u78bc\u5982\u4f55\u8b80\u65b0\u7248\u8cc7\u6599 \u8ffd\u6c42\u8cc7\u6599\u9ad4\u7a4d\u7684\u6975\u81f4\u58d3\u7e2e\uff0c\u7ba1\u7406\uff08Maintainable\uff09\u4e5f\u5f88\u91cd\u8981\u3002\u82e5\u8cc7\u6599\u5eab\u540c\u6642\u5b58\u5728\u65b0\u7248\u548c\u820a\u7248\u7684\u8cc7\u6599\uff0c\u5982\u4f55\u907f\u514d\u7de8\u78bc\u5931\u6548\uff1f JSON, XML, Binary Dataflow Databases REST and RPC Message-Passing Message Brokers Actor Model \u7af6\u8cfd\u60c5\u6cc1 \u5c0d\u61c9\u66f8\u4e2d\u7684 Transaction \uff0c\u5982\u4f55\u907f\u514d\u7af6\u8cfd\u60c5\u6cc1\uff08race condition\uff09\u5e36\u4f86\u7684\u932f\u8aa4\u72c0\u614b\u3002 \u8a02\u7968\u554f\u984c \u5169\u500b\u7528\u6236\u540c\u4e00\u6642\u9593\u8a02\u8cfc\u9650\u91cf\u7968\u7a2e\u4e14\u76ee\u524d\u50c5\u5269\u4e00\u5f35\uff0c\u61c9\u7528\u7a0b\u5f0f\u5229\u7528 Read-Decision-Write \u7684\u6a5f\u5236\uff0c\u6703\u8b93\u5169\u4eba\u540c\u6642\u8a02\u8cfc\u6210\u529f\u3002\u8a72\u600e\u9ebc\u907f\u514d\uff1f Isolation Level Read Committed Snapshot Isolation(Repeatable Read) Serializable Race Conditions Dirty Read, Dirty Write\uff08Read Committed \u80fd\u8655\u7406\uff09 Read Skew\uff08Snapshot Isolation \u80fd\u8655\u7406\uff09 Lost Updates\uff08Conflict Resolution \u548c\u5176\u4ed6\u65b9\u5f0f\u80fd\u8655\u7406\uff09 Write Skew, Phantom Reads\uff08Serializable \u80fd\u8655\u7406\uff09 Serializable Actual Serial Execution Two-Phase Locking(2PL) Serializable Snapshot Isolation(SSL) \u5206\u6563\u5f0f\u8cc7\u6599\u5eab\u2014\u8907\u88fd \u5c0d\u61c9\u66f8\u4e2d\u7684 Replication \uff0c\u5982\u4f55\u52d5\u614b\u8907\u88fd\u8cc7\u6599\u5230\u591a\u53f0\u8cc7\u6599\u5eab\u4e2d\uff0c\u4ee5\u9054\u6210\uff1a \u964d\u4f4e\u8ca0\u8f09 \u9ad8\u53ef\u7528\u6027\uff08High Availability\uff09 \u62c9\u8fd1\u548c Server \u8acb\u6c42\u7684\u8ddd\u96e2\uff08Geographically Close\uff09 Replica Lag \u7576\u6a5f\u5668\u5728\u505a\u8907\u88fd\u7684\u6642\u5019\uff0c\u82e5\u662f \u6a5f\u5668A \u5b8c\u6210\u8907\u88fd\u800c \u6a5f\u5668B \u9084\u6c92\uff0c\u4f7f\u7528\u8005\u91cd\u65b0\u8f09\u5165\u9801\u9762\u53ef\u80fd\u6703\u6709\u4e0d\u540c\u7684\u7d50\u679c\u3002 \u751a\u81f3\u5728\u8907\u88fd\u5230 \u6a5f\u5668B \u7684\u6642\u5019\u7db2\u8def\u4e2d\u65b7\uff0c\u8a72\u600e\u9ebc\u9054\u6210\u4e00\u81f4\u6027\uff1f Algorithms Single-leader Multi-leader Leaderless(Dynamo) Trade-offs Synchronous v.s. Asynchronous Handle Failed Replicas\uff08\u8a73\u7d30\u4ecb\u7d39\u65bc \u5bb9\u932f\u7684\u5206\u6563\u5f0f\u670d\u52d9 \uff09 Consistency Read-Your-Writes Monotonic Reads Consistent Prefix Reads \u5206\u6563\u5f0f\u8cc7\u6599\u5eab\u2014\u5206\u5340 \u5c0d\u61c9\u66f8\u4e2d\u7684 Partition \uff0c\u5982\u4f55\u52d5\u614b\u5206\u5340\u8cc7\u6599\u5230\u591a\u53f0\u8cc7\u6599\u5eab\u4e2d\uff0c\u4ee5\u907f\u514d\u55ae\u53f0\u6a5f\u5668\u7121\u6cd5\u8ca0\u8377\u904e\u5927\u7684\u8cc7\u6599\u91cf\uff08\u4e26\u975e\u6d41\u91cf\uff09\u3002 \u5e73\u5747\u5206\u914d \u4ee5 user ID \u4f5c\u70ba\u5206\u5340\u7684\u9375\u503c\u70ba\u4f8b\u3002\u7576\u793e\u4ea4\u8edf\u9ad4\u4e2d\u7684\u4e00\u4f4d\u540d\u4eba\u767c\u6587\u6642\uff0c\u7279\u5b9a\u5206\u5340\u6703\u6709\u4e0d\u5c0d\u7a31\u7684\u5927\u6d41\u91cf\uff0c\u5982\u4f55\u907f\u514d\u3002 Approaches Key Range Hash of Key Secondary Indexes Local Indexes(document-partitioned) Global Indexes(term-partitioned) Re-balance Size of each partition is proportional Number of partitions is proportional The number of partitions proportional to the number of nodes Execute Query \u5206\u6563\u5f0f\u7cfb\u7d71\u9047\u5230\u7684\u72c0\u6cc1 \u5c0d\u61c9\u66f8\u4e2d\u7684 The Trouble with Distributed Systems \uff0c\u5728\u5206\u6563\u5f0f\u8cc7\u6599\u5eab\u4e0b\uff0c\u4f60\u6703\u9762\u81e8\u7684\u72c0\u6cc1 3 \u548c\u61c9\u5982\u4f55\u770b\u5f85\u3002 Debug \u5728\u627e\u5c0b\u932f\u8aa4\u7684\u6642\u5019\uff0c\u6211\u5011\u6703\u5148\u5047\u8a2d\u57fa\u790e\u670d\u52d9\u662f\u6b63\u78ba\u56de\u61c9\u7684\u3002\u4e26\u5728\u6b64\u5047\u8a2d\u4e4b\u4e0a\u958b\u59cb\u627e\u932f\uff0c\u7576\u9019\u500b\u932f\u8aa4\u7528\u4e86\u5169\u5929\uff08\u5f88\u96e3\u91cd\u73fe\uff09\u53bb\u627e\uff0c\u4f60\u53ef\u80fd\u5c31\u9700\u8981\u958b\u59cb\u8cea\u7591\u6700\u4e00\u958b\u59cb\u7684\u5047\u8a2d\u4e86\u3002\u9019\u5c31\u662f\u672c\u7ae0\u5617\u8a66\u8b93\u5927\u5bb6\u53bb\u611f\u53d7\u7684\uff0c\u540c\u6642\u4e5f\u8a66\u8457\u8aaa\u660e \u5171\u8b58 \u7684\u91cd\u8981\u6027\u548c\u50f9\u503c\u3002 Unreliable Networks Existence in practice Detect faults Timeouts and unbounded delays Synchronous(telephone network) v.s. asynchronous(IDC) Detailed in Computer Communication Unreliable Clocks Monotonic(Logical) v.s. Time-of-Day clocks Synchronization and Accuracy \u958f\u79d2 Process Pauses Build things on unreliable assumption \u5bb9\u932f\u7684\u5206\u6563\u5f0f\u670d\u52d9 \u5c0d\u61c9\u66f8\u4e2d\u7684 Consistency and Consensus \uff0c\u5229\u7528\u5171\u8b58\u6f14\u7b97\u6cd5\u9054\u6210\u4e00\u81f4\u6027 4 \u548c\u5bb9\u932f\u7684\u670d\u52d9\u3002 \u89c0\u5ff5 \u5171\u8b58\u6f14\u7b97\u6cd5\u5df2\u7d93\u767c\u5c55\u5e7e\u5341\u5e74\u4e86\uff0c\u4ecd\u7136\u6709\u8a31\u591a\u5f85\u7814\u7a76\u7684\u5730\u65b9\uff0c\u4f46\u662f\u5b83\u7684\u50f9\u503c\u662f\u4ec0\u9ebc\uff1f \u4ee5\u6a5f\u5668\u5b78\u7fd2\u4f86\u8aaa\uff0c\u8b93\u5176\u767c\u5c55\u84ec\u52c3\u7684\u50f9\u503c\u5728\u65bc\u7528\u6a5f\u5668\u505a\u9810\u6e2c\u3001\u5206\u6790\u548c\u9078\u64c7\uff0c\u90a3\u5171\u8b58\u6f14\u7b97\u6cd5\u5462\uff1f \u672c\u66f8\u7684\u91cd\u9ede\u4e00\u76f4\u90fd\u4e0d\u662f\u5c0d\u6f14\u7b97\u6cd5\u548c\u5de5\u5177\u505a\u7d30\u7bc0\u8a0e\u8ad6\uff0c\u4e0d\u7ba1\u662f\u4f7f\u7528 Raft\u3001Paxos \u7b49\u7b49\u7684\u5171\u8b58\u6f14\u7b97\u6cd5\uff0c\u4ed6\u90fd\u662f\u5617\u8a66\u5728 \u5206\u6563\u5f0f\u7cfb\u7d71\u9047\u5230\u7684\u72c0\u6cc1 \u63d0\u5230\u7684\u5404\u7a2e\u554f\u984c\u4e4b\u4e0a\u5efa\u7acb\u4e00\u500b\u64c1\u6709\u548c\u591a\u53f0\u6a5f\u5668\u5354\u5546\u4e26\u9054\u6210\u5bb9\u932f\u80fd\u529b\u9ad8\u7684\u6f14\u7b97\u6cd5\uff0c\u800c\u53c8\u6709\u54ea\u4e9b\u72c0\u6cc1\u662f\u53ef\u4ee5\u505a\u6b0a\u8861\u7684\u3002 Linearizability Lock Leader election Constraint and Uniqueness Cross-channel timing dependencies Ordering Guarantees(Causality) Total order broadcast Consensus 2 Phase Commit(2PC) eXtended Architecture(XA) Fault-Tolerant Consensus Viewstamped Replication(VSR) Paxos Raft Zab Membership and Coordination Services \u524d\u9762\u90fd\u5728\u8b1b\u91dd\u5c0d\u55ae\u4e00\u61c9\u7528\u7a0b\u5f0f\u7684\u8cc7\u6599\u5eab\uff0c\u73fe\u5728\u8a66\u8457\u628a\u628a\u93e1\u982d\u62c9\u9060\u3002\u73fe\u5728\u4f86\u770b\u770b\u4e0d\u540c\u61c9\u7528\u7a0b\u5f0f\u4e4b\u9593\u7684\u4ea4\u6d41\u3001\u884d\u4f38\u548c\u6574\u5408\u3002 \u5feb\u53d6 \u6700\u76f4\u89c0\u7684\u884d\u751f\u8cc7\u6599\uff08Derived Data\uff09\u5c31\u662f\u5feb\u53d6\uff0c\u6211\u5f9e\u8cc7\u6599\u5eab\u88e1\u62c9\u51fa\u4e00\u4e9b\u8cc7\u6599\u653e\u9032\u5feb\u53d6\uff0c\u52a0\u901f\u61c9\u7528\u7a0b\u5f0f\u9032\u7a0b\u3002 \u6279\u6b21\u8655\u7406 \u5c0d\u61c9\u66f8\u4e2d\u7684 Batch Processing \uff0c\u8a0e\u8ad6\u6279\u6b21\u8655\u7406\u7684\u7406\u5ff5\u548c\u50f9\u503c\u3002 \u6392\u7a0b\u5de5\u4f5c \u6279\u6b21\u8655\u7406\uff08batch job\uff09\u548c\u6392\u7a0b\u5de5\u4f5c\uff08cron job\uff09\u662f\u5169\u4ef6\u4e8b\u60c5\u3002 \u6392\u7a0b\u505a search-index\u3001\u63a8\u85a6\u7cfb\u7d71\u548c\u5206\u6790\u7b49\u7b49\uff0c\u7136\u5f8c\u518d\u628a\u7d50\u679c\u7522\u51fa\u5728\u8cc7\u6599\u5eab\u4e2d\u3002\u5982\u679c\u7a0b\u5f0f\u78bc\u5beb\u932f\u4e86\uff0c\u5c0e\u81f4\u7dda\u4e0a\u8cc7\u6599\u5eab\u5d29\u58de\uff0c\u8a72\u600e\u9ebc\u9000\u7248\u5230\u820a\u8cc7\u6599\uff1f \u6982\u5ff5 HDFS \u6982\u5ff5\u5f88\u55ae\u7d14\uff0c\u5206\u6563\u5f0f\u7684\u8cc7\u6599\u7cfb\u7d71\u3002\u4f46\u662f\u70ba\u4ec0\u9ebc\u8fd1\u5341\u5e7e\u5e74\u4f86\u624d\u958b\u59cb\u666e\u904d\uff1f Hadoop \u4e4b\u4e0a\uff0c\u884d\u4f38\u5f88\u591a\u7522\u54c1\uff0c\u70ba\u4ec0\u9ebc\uff1f Unix Tools and Philosophy cat access.log | awk '{print $3}' | sort | uniq -c | sort -r -n | head -n 5 MapReduce and Distributed Filesystem Implementation Output, Transaction or Analytic? v.s. Distributed Databases(MPP) Beyond MapReduce What it cost Materialization of Intermediate State \u2192 Dataflow engine Graphs and Iterative Processing \u2192 Pregel processing model High-level APIs and Languages \u4e32\u6d41\u8655\u7406 \u5c0d\u61c9\u66f8\u4e2d\u7684 Stream Processing \uff0c\u5982\u4f55\u628a\u5373\u6642\u8cc7\u6599\u8f49\u63db\u6210\u4e8b\u4ef6\u4e26\u8655\u7406\u3002 \u6309\u8b9a\u6578 \u81c9\u66f8\u4e2d\uff0c\u6211\u5011\u53ef\u4ee5\u770b\u5230\u6bcf\u500b\u8cbc\u6587\u7684\u6309\u8b9a\u6578\u548c\u90e8\u5206\u6309\u8b9a\u4eba\u7684\u540d\u5b57\u3002 \u5982\u4f55\u5feb\u53d6\u6bcf\u7bc7\u8cbc\u6587\u7684\u7e3d\u6309\u8b9a\u6578\uff1f \u90e8\u5206\u6309\u8b9a\u4eba\u7684\u540d\u5b57\u662f\u91dd\u5c0d\u4f60\u53ef\u80fd\u8a8d\u8b58\u7684\u4eba\u505a\u986f\u793a\uff0c\u4eca\u5929\u6709\u4e00\u500b\u4f60\u8a8d\u8b58\u7684\u670b\u53cb\u6309\u8a72\u8cbc\u6587\u300c\u8b9a\u300d\uff0c\u5982\u4f55\u5feb\u901f\u4e14\u6709\u6548\u7387\u5730\u8b93\u8a8d\u8b58\u8a72\u6309\u8b9a\u4eba\u5728\u986f\u793a\u8a72\u8cbc\u6587\u7684\u6642\u5019\u80fd\u986f\u793a\u5176\u540d\u5b57\uff1f Transmitting Event Streams AMQP/JMS-style message broker Log-based message broker Keeping Systems in Sync Change Data Capture(CDC) Event Sourcing Processing Streams Usage Single Use: cache, email, ... Pipelined: complex event processing(CEP), stream analytics, materialized view... Handling Clocks and Joins Fault Tolerance Microbatch and checkpoint Transactions Idempotent Write \u7e3d\u7d50\u548c\u671f\u8a31 \u5c0d\u61c9\u66f8\u4e2d\u7684 The Future of Data Systems \uff0c\u6574\u5408\u524d\u9762\u7684\u5167\u5bb9\uff0c\u4e26\u505a\u51fa\u4e00\u500b\u5f37\u5065\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 Data Integration One Big Machine Federated Databases: SQL-like interface Unbundling Databases: Unix-like Transaction v.s. Ordered log of events Aiming for Correctness Transaction v.s. Fault tolerance abstractions Verifying Doing the Right Thing Pseudonymization \u8cab\u7a7f\u672c\u66f8\u7684\u76ee\u7684 \u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u9700\u8981\u6eff\u8db3\u8a31\u591a\u9700\u6c42\u624d\u80fd\u63d0\u4f9b\u7279\u5b9a\u670d\u52d9\u3002 \u529f\u80fd\u6027\u9700\u6c42\uff0c\u4f8b\u5982\uff1a\u5141\u8a31\u5b58\u53d6\u8cc7\u6599\u3001\u641c\u5c0b\u7b49\u7b49\u3002 \u975e\u529f\u80fd\u6027\u9700\u6c42\uff0c\u4f8b\u5982\uff1a \u5b89\u5168\u6027\uff08security\uff09 \u53ef\u9760\u6027\uff08reliability\uff09 \u9806\u5f9e\u6027\uff08compliant with a standard or a spec\uff09 \u5ef6\u5c55\u6027\uff08scalability\uff09 \u76f8\u5bb9\u6027\uff08compatible with a piece of hardware or software\uff09 \u7dad\u8b77\u6027\uff08maintainability\uff09 \u53ef\u9760\u6027 \u7576\u670d\u52d9\u767c\u751f\u72c0\u6cc1\u6642\uff0c\u4ecd\u7136\u80fd\u6b63\u78ba\u904b\u884c\u3002\u72c0\u6cc1\u53ef\u80fd\u70ba \u786c\u9ad4\uff0c\u901a\u5e38\u662f\u7121\u76f8\u95dc\u6027\u4e14\u96a8\u6a5f\u7684 \u8edf\u9ad4\uff0c\u901a\u5e38\u662f\u7cfb\u7d71\u6027\u7684\u4e14\u96e3\u4ee5\u89e3\u6c7a \u4eba\u70ba \u5bb9\u932f\u80fd\u529b\uff08Fault-tolerance\uff09\u4ee3\u8868\u4ed6\u80fd\u63a5\u53d7\u7279\u5b9a\u72c0\u6cc1\u7684\u767c\u751f\uff0c\u4e26\u8b93\u4f7f\u7528\u8005\u4e0d\u6703\u53d7\u6b64\u5f71\u97ff\u3002 \u53ef\u5ef6\u5c55\u6027 \u53ef\u5ef6\u5c55\u6027\u4ee3\u8868\u5373\u4f7f\u6d41\u91cf\u589e\u52a0\uff0c\u8868\u73fe\u4ecd\u662f\u6b63\u5e38\u7684\u3002\u5728\u8a0e\u8ad6\u5ef6\u5c55\u6027\u524d\uff0c\u9700\u5b9a\u7fa9 \u6d41\u91cf \uff08load\uff09\u548c \u8868\u73fe\u80fd\u529b \uff08performance quantitatively\uff09\u3002 \u4ee5 Twitter \u7684\u500b\u4eba\u9996\u9801\u70ba\u4f8b\uff0c\u5229\u7528\u56de\u61c9\u6642\u9593\u7684\u767e\u5206\u4f4d\u6578\uff08percentiles\uff09\u4ee3\u8868\u8868\u73fe\u80fd\u529b\uff0c\u6bcf\u500b\u767c\u5e03\u8005\u7684\u5beb\u5165\u548c\u8ffd\u96a8\u8005\u7684\u8b80\u53d6\u9996\u9801\u4f5c\u70ba\u6d41\u91cf\u3002\u5373\u4f7f\u6d41\u91cf\u589e\u52a0\uff0c\u56de\u61c9\u6642\u9593\u7684\u767e\u5206\u4f4d\u6578\u4ecd\u4f4e\u65bc\u7279\u5b9a\u6c34\u5e73\u3002 \u5728\u4e00\u500b\u53ef\u64f4\u5145\u7684\u7cfb\u7d71\uff0c\u6211\u5011\u53ef\u4ee5\u589e\u52a0\u6a5f\u5668\u7684\u91cf\uff08processing capacity\uff09\u4f86\u7dad\u6301\u53ef\u9760\u7684\u8868\u73fe\u80fd\u529b\u3002 \u53ef\u7dad\u8b77\u6027 \u53ef\u7dad\u8b77\u6027\u6709\u5f88\u591a\u9762\u5411\uff0c\u57fa\u672c\u4e0a\u4f86\u8aaa\uff0c\u5c31\u662f\u70ba\u4e86\u8b93\u5de5\u7a0b\u5e2b\u548c\u904b\u7dad\u5de5\u7a0b\u5e2b\u6e96\u6642\u3002\u8b93\u7cfb\u7d71\u4fdd\u6301\u62bd\u8c61\u5316\uff08\u628a\u7dad\u5ea6\u63d0\u9ad8\uff09\u53ef\u4ee5\u964d\u4f4e\u7cfb\u7d71\u7684\u8907\u96dc\u6027\uff0c\u4e26\u4e14\u8b93\u5176\u66f4\u5bb9\u6613\u4fee\u6539\u548c\u9069\u61c9\u65b0\u7684\u529f\u80fd\u3002 \u597d\u7684\u64cd\u4f5c\u6027\uff08operability\uff09\u4ee3\u8868\u80fd\u89c0\u5bdf\u5230\u7cfb\u7d71\u5167\u90e8\u904b\u4f5c\u72c0\u614b\u548c\u5065\u5eb7\u6aa2\u67e5\uff0c\u4e26\u4e14\u64c1\u6709\u9ad8\u6548\u7684\u65b9\u5f0f\u53bb\u7ba1\u7406\u3002 \u7d50\u8ad6 \u901a\u5e38\u4f86\u8aaa\u4e0d\u6703\u6709\u4e00\u500b\u8fa6\u6cd5\u53ef\u4ee5\u7c21\u55ae\u4e14\u5b8c\u6574\u7684\u8b93\u61c9\u7528\u7a0b\u5f0f\u53ef\u9760\u3001\u597d\u5ef6\u5c55\u548c\u7dad\u8b77\u3002\u7136\u800c\uff0c\u90fd\u6703\u6709\u67d0\u7a2e \u6a21\u5f0f \u6216 \u5de5\u5177 \u5e6b\u52a9\u6211\u5011\u4e00\u500b\u4e00\u500b\u89e3\u6c7a\u9019\u4e9b\u554f\u984c\u3002 \u7ae0\u7bc0\u5f15\u7528\u6578\uff0c\u5728\u6211\u8b80\u66f8\u7684\u7d93\u9a57\u4e2d\uff0c\u53ef\u4ee5\u628a\u9019\u500b\u7576\u4f5c\u7ae0\u7bc0\u7684\u96e3\u6613\u5ea6\u4f86\u505a\u5224\u65b7\u3002 \u21a9 \u672c\u66f8\u7684\u4e2d\u6587\u7ffb\u8b6f\u90fd\u4f86\u81ea \u570b\u5bb6\u6559\u80b2\u7814\u7a76\u9662\u2014\u96d9\u8a9e\u8a5e\u5f59\u3001\u5b78\u8853\u540d\u8a5e\u66a8\u8fad\u66f8\u8cc7\u8a0a\u7db2 \u3002 \u21a9 \u5728\u4e0d\u8003\u616e\u62dc\u5360\u5ead\u932f\u8aa4\u4e0b\u3002 \u21a9 \u8981\u6ce8\u610f\u9019\u88e1\u7684\u4e00\u81f4\u6027\u548c \u7af6\u8cfd\u60c5\u6cc1 \u4e2d\u7684 Consistency \u662f\u4e0d\u4e00\u6a23\u7684\u3002\u5171\u8b58\u6f14\u7b97\u6cd5\u4e2d\u7684 Consistency\uff0c\u4ee3\u8868\u5728\u65bc\u5206\u6563\u5f0f\u7cfb\u7d71\u4e0b\u5982\u4f55\u8b93\u591a\u500b\u8907\u88fd\uff08Replication\uff09\u7684\u72c0\u614b\u9054\u6210\u4e00\u81f4\u6027\uff0c\u5f8c\u8005\u5728\u65bc\u7368\u7acb\u4e0d\u540c\u7684\u7570\u52d5\uff08transaction\uff09\u4e26\u907f\u514d\u5176\u4ea4\u4e92\u5f71\u97ff\u800c\u7dad\u6301\u4e00\u81f4\u6027\u3002 \u21a9","title":"\u7c21\u4ecb"},{"location":"feedback/designing-data-intensive-applications/introduction/#designing-data-intensive-applications","text":"2020 5 \u6708\u5df2\u92b7\u552e 100,000 \u672c\uff0c\u4e14\u662f 2019 \u5e74 O\u2019Reilly \u6240\u6709\u4f5c\u54c1\u92b7\u91cf\u7b2c\u4e8c\u540d\u7684\u4f5c\u54c1\uff08 \u7b2c\u4e00\u540d\u662f\u6a5f\u5668\u5b78\u7fd2\u7684 \uff09\u3002 Martin Kleppmann \u5728\u528d\u6a4b\u5927\u5b78\u64d4\u4efb\u8cc7\u6df1\u7814\u7a76\u54e1\uff0c\u4e26\u65bc\u7814\u7a76\u6240\u6559\u6388\u5206\u6563\u5f0f\u7cfb\u7d71\u3002 \u7d93\u71df\u4e00\u500b\u8d85\u8b9a\u7684 \u90e8\u843d\u683c \u3002 \u591a\u9805\u958b\u6e90\u8edf\u9ad4\uff0c\u5305\u62ec Automerge \uff0c Apache Avro \u548c Apache Samza \u7b49\u3002 \u5275\u7acb\u5169\u5bb6\u516c\u53f8\u5206\u5225\u65bc 2009 \u88ab Red Gate Software \u548c 2012 \u88ab LinkedIn \u6536\u8cfc Table of contents Foundation of Data Systems Reliable, Scalable, and Maintainable Applications\u301034\u3011 1 Data Models and Query Languages\u301049\u3011 Storage and Retrieval\u301064\u3011 Encoding and Evolution\u301054\u3011 Distributed Data Replication\u301061\u3011 Partitioning\u301033\u3011 Transactions\u301054\u3011 The Trouble with Distributing Systems\u301095\u3011 Consistency and Consensus\u3010110\u3011 Derived Data Batch Processing\u301081\u3011 Stream Processing\u3010100\u3011 The Future of Data Systems\u3010114\u3011 \u8eab\u70ba\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u958b\u767c\u8005\uff0c\u6211\u8a72\u5982\u4f55\u770b\u5f85\u672c\u66f8 \u5982\u679c\u4f60\u80fd\u5920\u4e86\u89e3\u8cc7\u6599\u5eab\u7684\u5167\u90e8\u904b\u4f5c\u65b9\u5f0f\uff0c\u4f60\u5c31\u80fd\u6709\u4e00\u500b\u8f03\u958b\u95ca\u548c\u6e05\u695a\u7684\u8996\u91ce\u53bb\u770b\u5f85\u54ea\u7a2e\u5de5\u5177\u6216\u662f\u53c3\u6578\u7684\u8abf\u6821\u662f\u6700\u9069\u5408\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u3002\u96d6\u7136\u672c\u66f8\u4e0d\u6703\u6709\u4efb\u4f55\u7522\u54c1\u7684\u7d30\u7bc0\u4ecb\u7d39\uff0c\u537b\u6703\u8b93\u4f60\u5728\u770b\u8cc7\u6599\u5eab\u6587\u4ef6\u6642\uff0c\u66b8\u89e3\u4e0d\u540c\u540d\u8a5e\u5176\u80cc\u5f8c\u53ef\u80fd\u4ee3\u8868\u7684\u512a\u52a3\u52e2\u3002 As an application developer you\u2019re armed with this knowledge about the internals of storage engines, you are in a much better position to know which tool is best suited for your particular application. If you need to adjust a database\u2019s tuning parameters, this understanding allows you to imagine what effect a higher or a lower value may have. Although this chapter couldn\u2019t make you an expert in tuning any one particular storage engine, it has hopefully equipped you with enough vocabulary and ideas that you can make sense of the documentation for the database of your choice. \u8cc7\u6599\u7684\u91cd\u8981\u6027 2021 AWS Summit \u63d0\u5230\uff1a\u7d71\u4e00\u8cc7\u6599\u4ee5\u767c\u63ee\u5176\u50f9\u503c\uff0c\u6210\u70ba\u8cc7\u6599\u9a45\u52d5\u578b\u4f01\u696d\uff0c\u5176\u7279\u8272\uff1a \u77e5\u8b58\u53ca\u529b\u91cf\u3001\u904b\u7528\u8cc7\u6599\u64f4\u5c55\u4f01\u696d\u6d1e\u5bdf\u529b\u548c\u6c7a\u7b56\u6b0a \u5c07\u8cc7\u6599\u5927\u773e\u5316\uff0c\u5efa\u7acb\u5b89\u5168\u7cfb\u7d71\u4f86\u6536\u96c6\u3001\u5132\u5b58\u53ca\u8655\u7406\u8cc7\u6599\uff0c\u63d0\u4f9b\u7d66\u9700\u8981\u7684\u4eba\u54e1\u548c\u61c9\u7528\u7a0b\u5f0f \u4ee5\u5275\u65b0\u65b9\u5f0f\u8b93\u8cc7\u6599\u767c\u63ee\u529f\u7528\uff1a\u8cc7\u6599\u79d1\u5b78\u3001\u6a5f\u5668\u5b78\u7fd2","title":"Designing Data-Intensive Applications"},{"location":"feedback/designing-data-intensive-applications/introduction/#_1","text":"","title":"\u5831\u544a\u9032\u7a0b"},{"location":"feedback/designing-data-intensive-applications/introduction/#_2","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 Data Models and Query Languages \uff0c\u5c55\u793a\u5404\u7a2e\u8cc7\u6599\u6a21\u578b 2 \u548c\u6bd4\u8f03\u3002 \u4eba\u969b\u95dc\u4fc2 \u5047\u8a2d\u6709 \\(N\\) \u500b\u9ede\uff0c\u9ede\u548c\u9ede\u7684\u9023\u7d50\u5c31\u6703\u6709 \\(\\frac{N^2-N}{2}\\) \u500b\u3002 \u8a66\u60f3\u6709\u767e\u842c\u500b\u793e\u4ea4\u5a92\u9ad4\u7684\u7528\u6236\uff0c\u82e5\u8981\u4f7f\u7528 MySQL \u5efa\u7acb\u4e00\u500b\u5f7c\u6b64\u4e4b\u9593\u8a8d\u8b58\u8207\u5426\u7684\u4eba\u969b\u7db2\u7d61\u6703\u9700\u8981\u591a\u5c11 entry\uff1f\u9019\u6642\u5019\u6709\u6c92\u6709\u9664\u4e86 Relational Model \u4e4b\u5916\u7684\u9078\u64c7\uff1f Relational Model v.s. Document Model Graph-like Model and more Query Language","title":"\u8cc7\u6599\u6a21\u578b\u548c\u8a9e\u6cd5"},{"location":"feedback/designing-data-intensive-applications/introduction/#_3","text":"\u5c0d\u61c9\u66f8\u4e2d Storage and Retrieval \u7684\u524d\u534a\u6bb5\uff0c\u5982\u4f55\u52a0\u901f\u8cc7\u6599\u7684\u8b80\u53d6\u3002 \u96d9\u7d22\u5f15 MySQL \u6bcf\u6b21\u4e0b query \u53ea\u6703\u9075\u5f9e\u5176\u4e2d\u4e00\u500b index\uff0c\u70ba\u4ec0\u9ebc\uff1f\u82e5\u8981\u505a\u591a\u500b\u7d22\u5f15\uff0c\u9700\u8981\u72a7\u7272\u4ec0\u9ebc\uff1f \u6709\u4e9b\u60c5\u6cc1\u5fc5\u9808\u8981\u96d9\u7d22\u5f15\uff0c\u4f8b\u5982\uff1a\u5730\u7406\u4f4d\u7f6e\u4e2d\u7684\u7d93\u7def\u5ea6\uff0c\u53ea\u641c\u5c0b\u7d93\u5ea6\u7684\u8a71\u6548\u80fd\u7684\u63d0\u5347\u6709\u9650\u3002 Hash index Sorted-String Tables(SSTables) and Log-Structured Merge-Trees(LSM-Trees) B-Trees Multi-column Indexes, Full-text search and more","title":"\u7d22\u5f15"},{"location":"feedback/designing-data-intensive-applications/introduction/#_4","text":"\u5c0d\u61c9\u66f8\u4e2d Storage and Retrieval \u7684\u5f8c\u534a\u6bb5\uff0c\u5982\u4f55\u5340\u5206\u7dda\u4e0a\u548c\u5f8c\u53f0\u7684\u8cc7\u6e90\u3002 \u6578\u64da\u5206\u6790 \u5982\u679c\u6211\u5011\u8981\u5206\u6790\u7dda\u4e0a\u4f7f\u7528\u8005\u7684\u8cc7\u6599\uff0c\u5982\u4f55\u907f\u9762\u548c\u7dda\u4e0a\u4f7f\u7528\u8005\u6436\u6548\u80fd\uff1f OLTP or OLAP Column-Oriented Storage Stars and Snowflakes schema Compression","title":"\u8cc7\u6599\u5009\u5132"},{"location":"feedback/designing-data-intensive-applications/introduction/#_5","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 Encoding and Evolution \uff0c\u8cc7\u6599\u5eab\u7684\u7de8\u78bc\u6700\u4f73\u5316\u548c\u524d\u5f8c\u76f8\u5bb9\u3002 \u820a\u7248\u7de8\u78bc\u5982\u4f55\u8b80\u65b0\u7248\u8cc7\u6599 \u8ffd\u6c42\u8cc7\u6599\u9ad4\u7a4d\u7684\u6975\u81f4\u58d3\u7e2e\uff0c\u7ba1\u7406\uff08Maintainable\uff09\u4e5f\u5f88\u91cd\u8981\u3002\u82e5\u8cc7\u6599\u5eab\u540c\u6642\u5b58\u5728\u65b0\u7248\u548c\u820a\u7248\u7684\u8cc7\u6599\uff0c\u5982\u4f55\u907f\u514d\u7de8\u78bc\u5931\u6548\uff1f JSON, XML, Binary Dataflow Databases REST and RPC Message-Passing Message Brokers Actor Model","title":"\u7de8\u78bc\u548c\u9032\u7a0b"},{"location":"feedback/designing-data-intensive-applications/introduction/#_6","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 Transaction \uff0c\u5982\u4f55\u907f\u514d\u7af6\u8cfd\u60c5\u6cc1\uff08race condition\uff09\u5e36\u4f86\u7684\u932f\u8aa4\u72c0\u614b\u3002 \u8a02\u7968\u554f\u984c \u5169\u500b\u7528\u6236\u540c\u4e00\u6642\u9593\u8a02\u8cfc\u9650\u91cf\u7968\u7a2e\u4e14\u76ee\u524d\u50c5\u5269\u4e00\u5f35\uff0c\u61c9\u7528\u7a0b\u5f0f\u5229\u7528 Read-Decision-Write \u7684\u6a5f\u5236\uff0c\u6703\u8b93\u5169\u4eba\u540c\u6642\u8a02\u8cfc\u6210\u529f\u3002\u8a72\u600e\u9ebc\u907f\u514d\uff1f Isolation Level Read Committed Snapshot Isolation(Repeatable Read) Serializable Race Conditions Dirty Read, Dirty Write\uff08Read Committed \u80fd\u8655\u7406\uff09 Read Skew\uff08Snapshot Isolation \u80fd\u8655\u7406\uff09 Lost Updates\uff08Conflict Resolution \u548c\u5176\u4ed6\u65b9\u5f0f\u80fd\u8655\u7406\uff09 Write Skew, Phantom Reads\uff08Serializable \u80fd\u8655\u7406\uff09 Serializable Actual Serial Execution Two-Phase Locking(2PL) Serializable Snapshot Isolation(SSL)","title":"\u7af6\u8cfd\u60c5\u6cc1"},{"location":"feedback/designing-data-intensive-applications/introduction/#_7","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 Replication \uff0c\u5982\u4f55\u52d5\u614b\u8907\u88fd\u8cc7\u6599\u5230\u591a\u53f0\u8cc7\u6599\u5eab\u4e2d\uff0c\u4ee5\u9054\u6210\uff1a \u964d\u4f4e\u8ca0\u8f09 \u9ad8\u53ef\u7528\u6027\uff08High Availability\uff09 \u62c9\u8fd1\u548c Server \u8acb\u6c42\u7684\u8ddd\u96e2\uff08Geographically Close\uff09 Replica Lag \u7576\u6a5f\u5668\u5728\u505a\u8907\u88fd\u7684\u6642\u5019\uff0c\u82e5\u662f \u6a5f\u5668A \u5b8c\u6210\u8907\u88fd\u800c \u6a5f\u5668B \u9084\u6c92\uff0c\u4f7f\u7528\u8005\u91cd\u65b0\u8f09\u5165\u9801\u9762\u53ef\u80fd\u6703\u6709\u4e0d\u540c\u7684\u7d50\u679c\u3002 \u751a\u81f3\u5728\u8907\u88fd\u5230 \u6a5f\u5668B \u7684\u6642\u5019\u7db2\u8def\u4e2d\u65b7\uff0c\u8a72\u600e\u9ebc\u9054\u6210\u4e00\u81f4\u6027\uff1f Algorithms Single-leader Multi-leader Leaderless(Dynamo) Trade-offs Synchronous v.s. Asynchronous Handle Failed Replicas\uff08\u8a73\u7d30\u4ecb\u7d39\u65bc \u5bb9\u932f\u7684\u5206\u6563\u5f0f\u670d\u52d9 \uff09 Consistency Read-Your-Writes Monotonic Reads Consistent Prefix Reads","title":"\u5206\u6563\u5f0f\u8cc7\u6599\u5eab\u2014\u8907\u88fd"},{"location":"feedback/designing-data-intensive-applications/introduction/#_8","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 Partition \uff0c\u5982\u4f55\u52d5\u614b\u5206\u5340\u8cc7\u6599\u5230\u591a\u53f0\u8cc7\u6599\u5eab\u4e2d\uff0c\u4ee5\u907f\u514d\u55ae\u53f0\u6a5f\u5668\u7121\u6cd5\u8ca0\u8377\u904e\u5927\u7684\u8cc7\u6599\u91cf\uff08\u4e26\u975e\u6d41\u91cf\uff09\u3002 \u5e73\u5747\u5206\u914d \u4ee5 user ID \u4f5c\u70ba\u5206\u5340\u7684\u9375\u503c\u70ba\u4f8b\u3002\u7576\u793e\u4ea4\u8edf\u9ad4\u4e2d\u7684\u4e00\u4f4d\u540d\u4eba\u767c\u6587\u6642\uff0c\u7279\u5b9a\u5206\u5340\u6703\u6709\u4e0d\u5c0d\u7a31\u7684\u5927\u6d41\u91cf\uff0c\u5982\u4f55\u907f\u514d\u3002 Approaches Key Range Hash of Key Secondary Indexes Local Indexes(document-partitioned) Global Indexes(term-partitioned) Re-balance Size of each partition is proportional Number of partitions is proportional The number of partitions proportional to the number of nodes Execute Query","title":"\u5206\u6563\u5f0f\u8cc7\u6599\u5eab\u2014\u5206\u5340"},{"location":"feedback/designing-data-intensive-applications/introduction/#_9","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 The Trouble with Distributed Systems \uff0c\u5728\u5206\u6563\u5f0f\u8cc7\u6599\u5eab\u4e0b\uff0c\u4f60\u6703\u9762\u81e8\u7684\u72c0\u6cc1 3 \u548c\u61c9\u5982\u4f55\u770b\u5f85\u3002 Debug \u5728\u627e\u5c0b\u932f\u8aa4\u7684\u6642\u5019\uff0c\u6211\u5011\u6703\u5148\u5047\u8a2d\u57fa\u790e\u670d\u52d9\u662f\u6b63\u78ba\u56de\u61c9\u7684\u3002\u4e26\u5728\u6b64\u5047\u8a2d\u4e4b\u4e0a\u958b\u59cb\u627e\u932f\uff0c\u7576\u9019\u500b\u932f\u8aa4\u7528\u4e86\u5169\u5929\uff08\u5f88\u96e3\u91cd\u73fe\uff09\u53bb\u627e\uff0c\u4f60\u53ef\u80fd\u5c31\u9700\u8981\u958b\u59cb\u8cea\u7591\u6700\u4e00\u958b\u59cb\u7684\u5047\u8a2d\u4e86\u3002\u9019\u5c31\u662f\u672c\u7ae0\u5617\u8a66\u8b93\u5927\u5bb6\u53bb\u611f\u53d7\u7684\uff0c\u540c\u6642\u4e5f\u8a66\u8457\u8aaa\u660e \u5171\u8b58 \u7684\u91cd\u8981\u6027\u548c\u50f9\u503c\u3002 Unreliable Networks Existence in practice Detect faults Timeouts and unbounded delays Synchronous(telephone network) v.s. asynchronous(IDC) Detailed in Computer Communication Unreliable Clocks Monotonic(Logical) v.s. Time-of-Day clocks Synchronization and Accuracy \u958f\u79d2 Process Pauses Build things on unreliable assumption","title":"\u5206\u6563\u5f0f\u7cfb\u7d71\u9047\u5230\u7684\u72c0\u6cc1"},{"location":"feedback/designing-data-intensive-applications/introduction/#_10","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 Consistency and Consensus \uff0c\u5229\u7528\u5171\u8b58\u6f14\u7b97\u6cd5\u9054\u6210\u4e00\u81f4\u6027 4 \u548c\u5bb9\u932f\u7684\u670d\u52d9\u3002 \u89c0\u5ff5 \u5171\u8b58\u6f14\u7b97\u6cd5\u5df2\u7d93\u767c\u5c55\u5e7e\u5341\u5e74\u4e86\uff0c\u4ecd\u7136\u6709\u8a31\u591a\u5f85\u7814\u7a76\u7684\u5730\u65b9\uff0c\u4f46\u662f\u5b83\u7684\u50f9\u503c\u662f\u4ec0\u9ebc\uff1f \u4ee5\u6a5f\u5668\u5b78\u7fd2\u4f86\u8aaa\uff0c\u8b93\u5176\u767c\u5c55\u84ec\u52c3\u7684\u50f9\u503c\u5728\u65bc\u7528\u6a5f\u5668\u505a\u9810\u6e2c\u3001\u5206\u6790\u548c\u9078\u64c7\uff0c\u90a3\u5171\u8b58\u6f14\u7b97\u6cd5\u5462\uff1f \u672c\u66f8\u7684\u91cd\u9ede\u4e00\u76f4\u90fd\u4e0d\u662f\u5c0d\u6f14\u7b97\u6cd5\u548c\u5de5\u5177\u505a\u7d30\u7bc0\u8a0e\u8ad6\uff0c\u4e0d\u7ba1\u662f\u4f7f\u7528 Raft\u3001Paxos \u7b49\u7b49\u7684\u5171\u8b58\u6f14\u7b97\u6cd5\uff0c\u4ed6\u90fd\u662f\u5617\u8a66\u5728 \u5206\u6563\u5f0f\u7cfb\u7d71\u9047\u5230\u7684\u72c0\u6cc1 \u63d0\u5230\u7684\u5404\u7a2e\u554f\u984c\u4e4b\u4e0a\u5efa\u7acb\u4e00\u500b\u64c1\u6709\u548c\u591a\u53f0\u6a5f\u5668\u5354\u5546\u4e26\u9054\u6210\u5bb9\u932f\u80fd\u529b\u9ad8\u7684\u6f14\u7b97\u6cd5\uff0c\u800c\u53c8\u6709\u54ea\u4e9b\u72c0\u6cc1\u662f\u53ef\u4ee5\u505a\u6b0a\u8861\u7684\u3002 Linearizability Lock Leader election Constraint and Uniqueness Cross-channel timing dependencies Ordering Guarantees(Causality) Total order broadcast Consensus 2 Phase Commit(2PC) eXtended Architecture(XA) Fault-Tolerant Consensus Viewstamped Replication(VSR) Paxos Raft Zab Membership and Coordination Services \u524d\u9762\u90fd\u5728\u8b1b\u91dd\u5c0d\u55ae\u4e00\u61c9\u7528\u7a0b\u5f0f\u7684\u8cc7\u6599\u5eab\uff0c\u73fe\u5728\u8a66\u8457\u628a\u628a\u93e1\u982d\u62c9\u9060\u3002\u73fe\u5728\u4f86\u770b\u770b\u4e0d\u540c\u61c9\u7528\u7a0b\u5f0f\u4e4b\u9593\u7684\u4ea4\u6d41\u3001\u884d\u4f38\u548c\u6574\u5408\u3002 \u5feb\u53d6 \u6700\u76f4\u89c0\u7684\u884d\u751f\u8cc7\u6599\uff08Derived Data\uff09\u5c31\u662f\u5feb\u53d6\uff0c\u6211\u5f9e\u8cc7\u6599\u5eab\u88e1\u62c9\u51fa\u4e00\u4e9b\u8cc7\u6599\u653e\u9032\u5feb\u53d6\uff0c\u52a0\u901f\u61c9\u7528\u7a0b\u5f0f\u9032\u7a0b\u3002","title":"\u5bb9\u932f\u7684\u5206\u6563\u5f0f\u670d\u52d9"},{"location":"feedback/designing-data-intensive-applications/introduction/#_11","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 Batch Processing \uff0c\u8a0e\u8ad6\u6279\u6b21\u8655\u7406\u7684\u7406\u5ff5\u548c\u50f9\u503c\u3002 \u6392\u7a0b\u5de5\u4f5c \u6279\u6b21\u8655\u7406\uff08batch job\uff09\u548c\u6392\u7a0b\u5de5\u4f5c\uff08cron job\uff09\u662f\u5169\u4ef6\u4e8b\u60c5\u3002 \u6392\u7a0b\u505a search-index\u3001\u63a8\u85a6\u7cfb\u7d71\u548c\u5206\u6790\u7b49\u7b49\uff0c\u7136\u5f8c\u518d\u628a\u7d50\u679c\u7522\u51fa\u5728\u8cc7\u6599\u5eab\u4e2d\u3002\u5982\u679c\u7a0b\u5f0f\u78bc\u5beb\u932f\u4e86\uff0c\u5c0e\u81f4\u7dda\u4e0a\u8cc7\u6599\u5eab\u5d29\u58de\uff0c\u8a72\u600e\u9ebc\u9000\u7248\u5230\u820a\u8cc7\u6599\uff1f \u6982\u5ff5 HDFS \u6982\u5ff5\u5f88\u55ae\u7d14\uff0c\u5206\u6563\u5f0f\u7684\u8cc7\u6599\u7cfb\u7d71\u3002\u4f46\u662f\u70ba\u4ec0\u9ebc\u8fd1\u5341\u5e7e\u5e74\u4f86\u624d\u958b\u59cb\u666e\u904d\uff1f Hadoop \u4e4b\u4e0a\uff0c\u884d\u4f38\u5f88\u591a\u7522\u54c1\uff0c\u70ba\u4ec0\u9ebc\uff1f Unix Tools and Philosophy cat access.log | awk '{print $3}' | sort | uniq -c | sort -r -n | head -n 5 MapReduce and Distributed Filesystem Implementation Output, Transaction or Analytic? v.s. Distributed Databases(MPP) Beyond MapReduce What it cost Materialization of Intermediate State \u2192 Dataflow engine Graphs and Iterative Processing \u2192 Pregel processing model High-level APIs and Languages","title":"\u6279\u6b21\u8655\u7406"},{"location":"feedback/designing-data-intensive-applications/introduction/#_12","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 Stream Processing \uff0c\u5982\u4f55\u628a\u5373\u6642\u8cc7\u6599\u8f49\u63db\u6210\u4e8b\u4ef6\u4e26\u8655\u7406\u3002 \u6309\u8b9a\u6578 \u81c9\u66f8\u4e2d\uff0c\u6211\u5011\u53ef\u4ee5\u770b\u5230\u6bcf\u500b\u8cbc\u6587\u7684\u6309\u8b9a\u6578\u548c\u90e8\u5206\u6309\u8b9a\u4eba\u7684\u540d\u5b57\u3002 \u5982\u4f55\u5feb\u53d6\u6bcf\u7bc7\u8cbc\u6587\u7684\u7e3d\u6309\u8b9a\u6578\uff1f \u90e8\u5206\u6309\u8b9a\u4eba\u7684\u540d\u5b57\u662f\u91dd\u5c0d\u4f60\u53ef\u80fd\u8a8d\u8b58\u7684\u4eba\u505a\u986f\u793a\uff0c\u4eca\u5929\u6709\u4e00\u500b\u4f60\u8a8d\u8b58\u7684\u670b\u53cb\u6309\u8a72\u8cbc\u6587\u300c\u8b9a\u300d\uff0c\u5982\u4f55\u5feb\u901f\u4e14\u6709\u6548\u7387\u5730\u8b93\u8a8d\u8b58\u8a72\u6309\u8b9a\u4eba\u5728\u986f\u793a\u8a72\u8cbc\u6587\u7684\u6642\u5019\u80fd\u986f\u793a\u5176\u540d\u5b57\uff1f Transmitting Event Streams AMQP/JMS-style message broker Log-based message broker Keeping Systems in Sync Change Data Capture(CDC) Event Sourcing Processing Streams Usage Single Use: cache, email, ... Pipelined: complex event processing(CEP), stream analytics, materialized view... Handling Clocks and Joins Fault Tolerance Microbatch and checkpoint Transactions Idempotent Write","title":"\u4e32\u6d41\u8655\u7406"},{"location":"feedback/designing-data-intensive-applications/introduction/#_13","text":"\u5c0d\u61c9\u66f8\u4e2d\u7684 The Future of Data Systems \uff0c\u6574\u5408\u524d\u9762\u7684\u5167\u5bb9\uff0c\u4e26\u505a\u51fa\u4e00\u500b\u5f37\u5065\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 Data Integration One Big Machine Federated Databases: SQL-like interface Unbundling Databases: Unix-like Transaction v.s. Ordered log of events Aiming for Correctness Transaction v.s. Fault tolerance abstractions Verifying Doing the Right Thing Pseudonymization","title":"\u7e3d\u7d50\u548c\u671f\u8a31"},{"location":"feedback/designing-data-intensive-applications/introduction/#_14","text":"\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u9700\u8981\u6eff\u8db3\u8a31\u591a\u9700\u6c42\u624d\u80fd\u63d0\u4f9b\u7279\u5b9a\u670d\u52d9\u3002 \u529f\u80fd\u6027\u9700\u6c42\uff0c\u4f8b\u5982\uff1a\u5141\u8a31\u5b58\u53d6\u8cc7\u6599\u3001\u641c\u5c0b\u7b49\u7b49\u3002 \u975e\u529f\u80fd\u6027\u9700\u6c42\uff0c\u4f8b\u5982\uff1a \u5b89\u5168\u6027\uff08security\uff09 \u53ef\u9760\u6027\uff08reliability\uff09 \u9806\u5f9e\u6027\uff08compliant with a standard or a spec\uff09 \u5ef6\u5c55\u6027\uff08scalability\uff09 \u76f8\u5bb9\u6027\uff08compatible with a piece of hardware or software\uff09 \u7dad\u8b77\u6027\uff08maintainability\uff09","title":"\u8cab\u7a7f\u672c\u66f8\u7684\u76ee\u7684"},{"location":"feedback/designing-data-intensive-applications/introduction/#_15","text":"\u7576\u670d\u52d9\u767c\u751f\u72c0\u6cc1\u6642\uff0c\u4ecd\u7136\u80fd\u6b63\u78ba\u904b\u884c\u3002\u72c0\u6cc1\u53ef\u80fd\u70ba \u786c\u9ad4\uff0c\u901a\u5e38\u662f\u7121\u76f8\u95dc\u6027\u4e14\u96a8\u6a5f\u7684 \u8edf\u9ad4\uff0c\u901a\u5e38\u662f\u7cfb\u7d71\u6027\u7684\u4e14\u96e3\u4ee5\u89e3\u6c7a \u4eba\u70ba \u5bb9\u932f\u80fd\u529b\uff08Fault-tolerance\uff09\u4ee3\u8868\u4ed6\u80fd\u63a5\u53d7\u7279\u5b9a\u72c0\u6cc1\u7684\u767c\u751f\uff0c\u4e26\u8b93\u4f7f\u7528\u8005\u4e0d\u6703\u53d7\u6b64\u5f71\u97ff\u3002","title":"\u53ef\u9760\u6027"},{"location":"feedback/designing-data-intensive-applications/introduction/#_16","text":"\u53ef\u5ef6\u5c55\u6027\u4ee3\u8868\u5373\u4f7f\u6d41\u91cf\u589e\u52a0\uff0c\u8868\u73fe\u4ecd\u662f\u6b63\u5e38\u7684\u3002\u5728\u8a0e\u8ad6\u5ef6\u5c55\u6027\u524d\uff0c\u9700\u5b9a\u7fa9 \u6d41\u91cf \uff08load\uff09\u548c \u8868\u73fe\u80fd\u529b \uff08performance quantitatively\uff09\u3002 \u4ee5 Twitter \u7684\u500b\u4eba\u9996\u9801\u70ba\u4f8b\uff0c\u5229\u7528\u56de\u61c9\u6642\u9593\u7684\u767e\u5206\u4f4d\u6578\uff08percentiles\uff09\u4ee3\u8868\u8868\u73fe\u80fd\u529b\uff0c\u6bcf\u500b\u767c\u5e03\u8005\u7684\u5beb\u5165\u548c\u8ffd\u96a8\u8005\u7684\u8b80\u53d6\u9996\u9801\u4f5c\u70ba\u6d41\u91cf\u3002\u5373\u4f7f\u6d41\u91cf\u589e\u52a0\uff0c\u56de\u61c9\u6642\u9593\u7684\u767e\u5206\u4f4d\u6578\u4ecd\u4f4e\u65bc\u7279\u5b9a\u6c34\u5e73\u3002 \u5728\u4e00\u500b\u53ef\u64f4\u5145\u7684\u7cfb\u7d71\uff0c\u6211\u5011\u53ef\u4ee5\u589e\u52a0\u6a5f\u5668\u7684\u91cf\uff08processing capacity\uff09\u4f86\u7dad\u6301\u53ef\u9760\u7684\u8868\u73fe\u80fd\u529b\u3002","title":"\u53ef\u5ef6\u5c55\u6027"},{"location":"feedback/designing-data-intensive-applications/introduction/#_17","text":"\u53ef\u7dad\u8b77\u6027\u6709\u5f88\u591a\u9762\u5411\uff0c\u57fa\u672c\u4e0a\u4f86\u8aaa\uff0c\u5c31\u662f\u70ba\u4e86\u8b93\u5de5\u7a0b\u5e2b\u548c\u904b\u7dad\u5de5\u7a0b\u5e2b\u6e96\u6642\u3002\u8b93\u7cfb\u7d71\u4fdd\u6301\u62bd\u8c61\u5316\uff08\u628a\u7dad\u5ea6\u63d0\u9ad8\uff09\u53ef\u4ee5\u964d\u4f4e\u7cfb\u7d71\u7684\u8907\u96dc\u6027\uff0c\u4e26\u4e14\u8b93\u5176\u66f4\u5bb9\u6613\u4fee\u6539\u548c\u9069\u61c9\u65b0\u7684\u529f\u80fd\u3002 \u597d\u7684\u64cd\u4f5c\u6027\uff08operability\uff09\u4ee3\u8868\u80fd\u89c0\u5bdf\u5230\u7cfb\u7d71\u5167\u90e8\u904b\u4f5c\u72c0\u614b\u548c\u5065\u5eb7\u6aa2\u67e5\uff0c\u4e26\u4e14\u64c1\u6709\u9ad8\u6548\u7684\u65b9\u5f0f\u53bb\u7ba1\u7406\u3002","title":"\u53ef\u7dad\u8b77\u6027"},{"location":"feedback/designing-data-intensive-applications/introduction/#_18","text":"\u901a\u5e38\u4f86\u8aaa\u4e0d\u6703\u6709\u4e00\u500b\u8fa6\u6cd5\u53ef\u4ee5\u7c21\u55ae\u4e14\u5b8c\u6574\u7684\u8b93\u61c9\u7528\u7a0b\u5f0f\u53ef\u9760\u3001\u597d\u5ef6\u5c55\u548c\u7dad\u8b77\u3002\u7136\u800c\uff0c\u90fd\u6703\u6709\u67d0\u7a2e \u6a21\u5f0f \u6216 \u5de5\u5177 \u5e6b\u52a9\u6211\u5011\u4e00\u500b\u4e00\u500b\u89e3\u6c7a\u9019\u4e9b\u554f\u984c\u3002 \u7ae0\u7bc0\u5f15\u7528\u6578\uff0c\u5728\u6211\u8b80\u66f8\u7684\u7d93\u9a57\u4e2d\uff0c\u53ef\u4ee5\u628a\u9019\u500b\u7576\u4f5c\u7ae0\u7bc0\u7684\u96e3\u6613\u5ea6\u4f86\u505a\u5224\u65b7\u3002 \u21a9 \u672c\u66f8\u7684\u4e2d\u6587\u7ffb\u8b6f\u90fd\u4f86\u81ea \u570b\u5bb6\u6559\u80b2\u7814\u7a76\u9662\u2014\u96d9\u8a9e\u8a5e\u5f59\u3001\u5b78\u8853\u540d\u8a5e\u66a8\u8fad\u66f8\u8cc7\u8a0a\u7db2 \u3002 \u21a9 \u5728\u4e0d\u8003\u616e\u62dc\u5360\u5ead\u932f\u8aa4\u4e0b\u3002 \u21a9 \u8981\u6ce8\u610f\u9019\u88e1\u7684\u4e00\u81f4\u6027\u548c \u7af6\u8cfd\u60c5\u6cc1 \u4e2d\u7684 Consistency \u662f\u4e0d\u4e00\u6a23\u7684\u3002\u5171\u8b58\u6f14\u7b97\u6cd5\u4e2d\u7684 Consistency\uff0c\u4ee3\u8868\u5728\u65bc\u5206\u6563\u5f0f\u7cfb\u7d71\u4e0b\u5982\u4f55\u8b93\u591a\u500b\u8907\u88fd\uff08Replication\uff09\u7684\u72c0\u614b\u9054\u6210\u4e00\u81f4\u6027\uff0c\u5f8c\u8005\u5728\u65bc\u7368\u7acb\u4e0d\u540c\u7684\u7570\u52d5\uff08transaction\uff09\u4e26\u907f\u514d\u5176\u4ea4\u4e92\u5f71\u97ff\u800c\u7dad\u6301\u4e00\u81f4\u6027\u3002 \u21a9","title":"\u7d50\u8ad6"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/","text":"Container Orchestration and Misc. \u4e0a\u4e00\u4efd\u5831\u544a\u8aaa\u660e Container \u7684\u50f9\u503c\u548c\u5efa\u69cb\u908f\u8f2f\u3002\u800c Docker \u4e0d\u50c5\u4f5c\u70ba\u5305\u88dd\u61c9\u7528\u7a0b\u5f0f\u7684\u5de5\u5177\uff0c\u4e5f\u5e6b\u6211\u5011\u7ba1\u7406 Container\u3002 \u4f46\u662f\u4ecd\u6709\u4e00\u4e9b\u72c0\u6cc1\u9700\u8981\u89e3\u6c7a\uff1a \u5982\u4f55\u505a Scaling\uff0c\u55ae\u4e00\u6216\u591a\u53f0\u6a5f\u5668 Load Balance Health Check and Replacement \u591a\u670d\u52d9\u9593\u7684\u6e9d\u901a\uff0cdocker-compose \u50c5\u80fd\u5728\u55ae\u4e00\u53f0\u6a5f\u5668\u4e0b\u5354\u52a9\u6e9d\u901a \u65b0\u7248\u672c\u7684\u61c9\u7528\u7a0b\u5f0f\u5982\u4f55\u7121\u7e2b\u63a5\u8ecc \u9019\u6642\u4fbf\u9700\u8981\u4e00\u500b\u8abf\u5ea6\u5bb9\u5668\uff08Container\uff09\u7684\u5de5\u5177\u3002 Kubernetes Kubernetes \u53ef\u4ee5\u89e3\u6c7a\u4e0a\u8ff0\u63d0\u5230\u7684\u554f\u984c\u3002\u63a5\u4e0b\u4f86\u6703\u5148\u7c21\u55ae\u4ecb\u7d39\u5176\u4e2d\u5404\u540d\u8a5e\u4ee3\u8868\u7684\u610f\u7fa9\uff0c\u7136\u5f8c\u518d\u5be6\u4f5c\uff0c\u9019\u6a23\u5c0d\u65bc\u5be6\u4f5c\u6642\u64cd\u4f5c\u7684\u5404\u500b\u6307\u4ee4\u5c31\u6703\u6bd4\u8f03\u6709\u611f\u3002 \u55ae\u4f4d \u4ee5\u4e0b\u5c07\u9010\u4e00\u4ecb\u7d39 Kubernetes \u7684\u57fa\u672c\u55ae\u4f4d\u3002 Container Volume Pod Node Master Cluster Container \u7ba1\u7406\u5bb9\u5668\u5316\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u9664\u4e86 Docker \u5916\uff0c\u4e0a\u4e00\u4efd\u5831\u544a\u63d0\u5230\u7684 rkt \u4e5f\u662f\u5141\u8a31\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 Volume \u548c Host \u7684 filesystem \u505a\u9023\u63a5\u7684\u670d\u52d9\uff0c\u5c0d Container \u63d0\u4f9b\u8cc7\u6599\u5b58\u53d6\u7684\u5730\u65b9\u3002 Pod \u7528\u4f86\u5305\u88dd Container \u548c Volume \u7684\u55ae\u4f4d\uff0c\u4e00\u500b Pod \u6703\u88ab\u5206\u914d\u5230\u4e00\u500b IP\u3002\u82e5 Pod \u4e2d\u542b\u6709\u591a\u7684 Container \u7684\u8a71\uff0c\u5404\u500b Container \u6703\u5171\u7528\u8a72\u7d44 IP\u3002 \u6709\u4e0a\u8ff0\u4e09\u500b\u55ae\u4f4d\u53ef\u4ee5\u756b\u51fa\u4e00\u500b\u5716\uff1a Node \u5982\u540c Docker \u7ba1\u7406 Container \u4e00\u822c\uff0cNode \u5c31\u662f\u7ba1\u7406 Pod \u7684\u55ae\u4f4d\u3002 \u4e00\u500b Node \u5e95\u4e0b\u9700\u8981\u4e00\u4e9b\u8f14\u52a9\u5de5\u5177\u4f86\u5e6b\u52a9\u7ba1\u7406\u5404\u500b Pod \u548c Container\uff1a Kubernetes Daemon\uff08\u7a31\u4f5c Kubelet\uff09 Container Daemon\uff08\u5982\uff1aDocker\uff09 Network Proxy\uff08\u7a31\u4f5c Kube Proxy\uff09 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 Kubernetes Node \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 Kubernetes \u2502 Kubelet \u2502 \u2502 \u2502 Pod \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Docker \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 Kube proxy \u2502 \u2502 \u2502 Kubernetes \u2502 \u2502 \u2502 \u2502 Pod \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Master \u7528\u4f86\u7ba1\u7406 Node\uff0c\u4e26\u5c0d\u5916\u958b\u653e API\uff0c\u63d0\u4f9b\u9014\u5f91\u53bb\u64cd\u4f5c\u5404\u500b Node\u3002 \u5982\uff1a\u958b\u767c\u8005\u53ef\u4ee5\u901a\u904e kubectl \u900f\u904e Master \u53bb\u64cd\u4f5c\u5404\u500b Node\u3002 \uff08\u985e\u4f3c\u65bc Docker CLI \u900f\u904e Daemon \u53bb\u64cd\u4f5c\u5404\u500b Container \uff09 Cluster \u4e00\u7d44\u7531 Master \u548c\u591a\u500b Node \u7d44\u6210\u7684\u7fa4\u7d44\u3002 \u5b8c\u6574\u6982\u7565\u5716 \u6982\u5ff5 \u6bcf\u6b21\u547c\u53eb Master \u505a\u4e8b\u60c5\uff0c\u4e8b\u5be6\u4e0a\u5c31\u662f\u6307\u5b9a\u4e00\u500b Cluster \u61c9\u8a72\u6709\u7684\u72c0\u614b\uff0c\u5982\uff1a \u6211\u5e0c\u671b\u67d0\u67d0 Node \u88e1\u9762\u6709 10 \u500b\u7248\u672c 2 \u7684 Pod\u3002 \u6b64\u6642 Kubernetes \u5c31\u6703\u91dd\u5c0d\u8a72\u72c0\u614b\u958b\u59cb\u505a\u4e8b\uff0c\u4e0d\u7ba1\u662f\u964d\u4f4e\u3001\u5347\u9ad8\u6578\u91cf\u6216\u5347\u964d\u7248\u672c\u7684\u64cd\u4f5c\u90fd\u662f\u7531 Kubernetes \u53bb\u57f7\u884c\u3002 \u6b64\u8655\u5305\u62ec\u57f7\u884c\u908f\u8f2f\uff0c\u4f8b\u5982\u9810\u671f 10 \u500b Pod\uff0c\u73fe\u6709 4 \u500b\uff0c\u9700\u589e\u52a0 6 \u500b\uff0c\u6b64\u8655\u7684 6 \u500b\u5c31\u662f Kubernetes \u81ea\u884c\u53bb\u8a08\u7b97\u51fa\u7684\u6578\u5b57\u3002 \u63a5\u4e0b\u4f86\u6703\u4ecb\u7d39\u5e7e\u500b\u5728\u672c\u6b21\u5be6\u4f5c\u6703\u61c9\u7528\u5230\u7684\u89c0\u5ff5\u3002 Deployment Selector Label Scheduler Controller ReplicaSet Probe \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502L\u2502 Defined \u2502 \u2502a\u2502 Pod B \u2502 \u2502b\u2502 \u2502 \u2502e\u2502 \u2502 \u2502l\u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502B\u2502 \u2502 kubectl\u2500\u25ba\u2502Deployment\u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502L\u2502 Defined \u2502 \u2502 Selector \u2502a\u2502 Pod A \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502b\u2502 \u2502 \u2502e\u2502 \u2502 \u2502l\u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 ReplicaSet \u2502 \u2502A\u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502Pod A-1\u2502 \u2502 \u2502L\u2502 Defined \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502a\u2502 Pod A \u2502 \u2502 \u2502 \u2502b\u2502 \u2502Scheduler \u250c\u2500\u2500\u2500\u2500\u2500\u2510Controller \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502e\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502Ready\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502 \u2502Pod A-2\u2502 \u2502 \u2502l\u2502 \u2502Pending \u2514\u2500\u2500\u2500\u2500\u2500\u2518Creating \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502A\u2502 \u2502 Probe \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25baPod A-N\u2502 \u2502 Health Checking \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Deployment \u7528\u4f86\u8868\u9054\u90e8\u7f72\u6642\u6b32\u9054\u6210\u7684\u72c0\u614b\uff0c\u901a\u5e38\u662f\u6700\u5e38\u63a5\u89f8\u7684\u5de5\u5177\u3002 \u72c0\u614b\u53ef\u80fd\u5305\u62ec\u6578\u91cf\u3001\u7248\u672c\u7b49\u3002 Selector \u7528\u4f86\u6307\u5b9a\u7279\u5b9a Pod \u7684\u689d\u4ef6\uff0c\u4f8b\u5982\uff1a\u6709\u9ad8\u904b\u7b97\u9700\u6c42\u7684\u5c31\u6703\u8981\u6c42\u6709 machine:physical \u9019\u500b Label \u7684 Pod\u3002 Label \u7528\u4f86\u5e6b Node \u548c Pod \u8cbc\u6a19\u7c64\uff0c\u4ee5 Node.js \u70ba\u4f8b\uff1a platform:node playform-version:v14 machine:physical kernel:3.16 app:web-api app:recipe-api Label \u4e0d\u5fc5\u552f\u4e00\uff0c\u4f60\u53ef\u4ee5\u91cd\u8907\u8a2d\u5b9a\u4e00\u6a23\u7684 key\uff0c\u5982\uff1a platform:node \u3001 platform:alpine \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502L\u2502 Defined \u2502 \u2502a\u2502 Pod B \u2502 \u2502b\u2502 \u2502 \u2502e\u2502 \u2502 \u2502l\u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502B\u2502 \u2502 kubectl\u2500\u25ba\u2502Deployment\u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502L\u2502 Defined \u2502 \u2502 Selector \u2502a\u2502 Pod A \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502b\u2502 \u2502 \u2502e\u2502 \u2502 \u2502l\u2502 \u2502 \u2502 \u2502 \u2502 \u2502A\u2502 \u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Scheduler Kubernetes \u6703\u6e2c\u8a66\u73fe\u6709\u74b0\u5883\uff08\u5982 CPU/Memory\uff09\u662f\u5426\u9069\u5408\u6dfb\u52a0 Pod\u3002\u82e5\u7121\uff0c\u5247\u7b49\u5f85\u3002 \u9810\u8a2d\u505a Scheduling \u7684\u5de5\u5177\u70ba kube-scheduler \u3002 Controller \u7528\u4f86\u63a7\u5236 Kubernetes \u5404\u7a2e\u72c0\u614b\u7684\u63a7\u5236\u5668\uff0c\u901a\u5e38\u958b\u767c\u8005\u4e0d\u6703\u76f4\u63a5\u63a5\u89f8\u3002 ReplicaSet \u9664\u4e86 ReplicaSet \u5916\uff0c\u6839\u64da\u9700\u6c42\u9084\u6709\u5176\u4ed6\u7a2e\u985e\u7684\u7fa4\u7d44\uff0c\u5982\uff1a StatefulSet \u662f\u53ef\u4ee5\u63d0\u4f9b\u72c0\u614b\u5132\u5b58\u7684\u7fa4\u7d44\u3002 Stateful \u7684\u61c9\u7528\u7a0b\u5f0f\u5728\u9019\u5e7e\u6b21\u5831\u544a\u90fd\u4e0d\u6703\u8a0e\u8ad6\uff0c\u56e0\u70ba\u5c0d\u65bc\u9700\u8981\u5132\u5b58\u72c0\u614b\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u5176\u5efa\u69cb\u3001\u90e8\u7f72\u7684\u7b56\u7565\u662f\u53e6\u4e00\u9805\u9818\u57df\u3002 Probe \u7528\u4f86\u505a Health Check\u3002 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 ReplicaSet \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502Pod A-1\u2502 \u2502 \u2502L\u2502 Defined \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502a\u2502 Pod A \u2502 \u2502 \u2502 \u2502b\u2502 \u2502Scheduler \u250c\u2500\u2500\u2500\u2500\u2500\u2510Controller \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502e\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502Ready\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502 \u2502Pod A-2\u2502 \u2502 \u2502l\u2502 \u2502Pending \u2514\u2500\u2500\u2500\u2500\u2500\u2518Creating \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502A\u2502 \u2502 Probe \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25baPod A-N\u2502 \u2502 Health Checking \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Ingress Service \u2502 Request \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Ingress \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u2500\u25ba Service \u2502 \u2502 \u2502 \u2502 Master \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u2502 \u2502 Node \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 Pod1 \u2502 \u2502 \u2502 \u2502 Pod2 \u2502 \u2502 \u2502 \u2502 ... \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Service \u5982\u540c Docker \u6703\u6c7a\u5b9a\u54ea\u4e00\u500b Container \u6709\u5c0d\u5916\u7684 port \u4e00\u6a23\uff0cService \u4e5f\u6703\u5229\u7528 Selector \u6c7a\u5b9a\u54ea\u4e00\u500b Pod \u662f\u53ef\u4ee5\u5c0d\u5916\u7684\u3002 \u985e\u4f3c\u65bc reverse-proxy \u822c\uff0c\u6c7a\u5b9a\u5916\u90e8\u54ea\u4e9b\u8acb\u6c42\u53ef\u4ee5\u9001\u9032 Pod \u88cf\u9762\u3002 \u5728\u524d\u5e7e\u6b21\u5831\u544a\u4e2d\u5e38\u5e38\u63d0\u5230 service\uff0c\u5176\u4ee3\u8868\u7684\u610f\u7fa9\u662f\u670d\u52d9\u6216\u61c9\u7528\u7a0b\u5f0f\uff0c\u6709\u5225\u65bc\u6b64\u8655\u63d0\u5230\u7684 Service Ingress \u7ba1\u7406 Cluster \u5916\u90e8\u7684\u8acb\u6c42\u3002 Alternatives \u7531\u4e0a\u8ff0\u53ef\u77e5\uff0cKubernetes \u64c1\u6709\u975e\u5e38\u8c50\u5bcc\u7684\u529f\u80fd\uff0c\u4e26\u4e14\u53ef\u4ee5\u900f\u904e\u591a\u7a2e\u65b9\u5f0f\u9054\u6210\u540c\u4e00\u500b\u76ee\u7684\uff08\u4f8b\u5982 dev/stg \u7684\u74b0\u5883\u5206\u5272\uff09\u3002\u9019\u88e1\u4e5f\u4e26\u672a\u5b8c\u5168\u6db5\u84cb Kubernetes \u7684\u6982\u5ff5\uff08\u4f8b\u5982\u4ee5 etcd \u505a\u5132\u5b58\u7684\u6f14\u7b97\u6cd5\uff09 Apache Mesos \u548c Apache Marathon \u7684\u7d44\u5408\u80fd\u9054\u5230\u985e\u4f3c Kubernetes \u7684\u529f\u80fd\u3002 Docker Swarm \u662f Docker \u539f\u751f\u7684\u5bb9\u5668\u5316\u8abf\u5ea6\u5de5\u5177\uff0c\u4f46 Docker \u5df2\u7d93\u6368\u68c4\u4e26\u6539\u63a1\u548c Kubernetes \u7684\u517c\u5bb9\u4e86\u3002 minikube \u70ba\u4e86\u7c21\u5316\u5be6\u4f5c\u4e0a\u9700\u8981\u505a\u7684\u8a2d\u5b9a\uff0c\u672c\u6b21\u5be6\u4f5c\u6703\u900f\u904e minikube \u4f86\u64cd\u4f5c\u3002 minikube \u662f\u4e00\u500b\u7c21\u5316\u7248\u7684 Kubernetes\uff0c\u4ed6\u6e1b\u5c11\u5f88\u591a\u529f\u80fd\u7684\u8a2d\u5b9a\uff0c\u8b93\u4f7f\u7528\u8005\u53ef\u4ee5\u5feb\u901f\u958b\u59cb\u5be6\u4f5c\uff0c\u4e26\u4e14\u628a Master/Node \u878d\u5408\u518d\u4e00\u8d77\u3002 \u78ba\u8a8d kubectl \u7684\u5b89\u88dd\uff1a kubectl version --client brew install kubernetes-cli \u78ba\u8a8d minikube \u7684\u5b89\u88dd\uff1a minikube version brew install minikube kubectl \u555f\u52d5 $ minikube start \ud83d\ude04 minikube v1.20.0 on Darwin 11 .4 \ud83c\udf89 minikube 1 .22.0 is available! Download it: https://github.com/kubernetes/minikube/releases/tag/v1.22.0 \u2728 Using the hyperkit driver based on existing profile \ud83d\udca1 To disable this notice, run: 'minikube config set WantUpdateNotification false' \ud83d\udc4d Starting control plane node minikube in cluster minikube \ud83d\udd04 Restarting existing hyperkit VM for \"minikube\" ... \ud83d\udc33 Preparing Kubernetes v1.20.2 on Docker 20 .10.6 ... \ud83d\udd0e Verifying Kubernetes components... \u25aa Using image k8s.gcr.io/ingress-nginx/controller:v0.44.0 \u25aa Using image kubernetesui/dashboard:v2.1.0 \u25aa Using image docker.io/jettech/kube-webhook-certgen:v1.5.1 \u25aa Using image kubernetesui/metrics-scraper:v1.0.4 \u25aa Using image gcr.io/k8s-minikube/storage-provisioner:v5 \u25aa Using image docker.io/jettech/kube-webhook-certgen:v1.5.1 \ud83d\udd0e Verifying ingress addon... \ud83c\udf1f Enabled addons: storage-provisioner, default-storageclass, ingress, dashboard \ud83c\udfc4 Done! kubectl is now configured to use \"minikube\" cluster and \"default\" namespace by default \u67e5\u770b\u73fe\u6709 Pods $ kubectl get pods No resources found in default namespace. \u56e0\u70ba\u9810\u8a2d\u4f7f\u7528 default namespace \u67e5\u770b\u6240\u6709 namespace $ kubectl get namespace NAME STATUS AGE default Active 48d ingress-nginx Active 48d kube-node-lease Active 48d kube-public Active 48d kube-system Active 48d kubernetes-dashboard Active 48d \u67e5\u770b\u7cfb\u7d71\u7684 Pods $ kubectl get pods --namespace = kube-system NAME READY STATUS RESTARTS AGE coredns-74ff55c5b-sq5jt 1 /1 Running 1 48d etcd-minikube 1 /1 Running 1 48d kube-apiserver-minikube 1 /1 Running 1 48d kube-controller-manager-minikube 1 /1 Running 1 48d kube-proxy-vslx5 1 /1 Running 1 48d kube-scheduler-minikube 1 /1 Running 1 48d storage-provisioner 1 /1 Running 2 48d \u67e5\u770b Node $ kubectl get nodes NAME STATUS ROLES AGE VERSION minikube Ready control-plane,master 48d v1.20.2 \u4f7f\u7528 minikube \u7684 Docker graph TD 1[Docker] --> 0[Container] 00[Container] 2[Local \u7aef\u7684 Daemon] --> 1 3[Docker CLI] -..-> 2 4[Kubernetes \u7aef\u7684 Daemon] --> 12[Docker] 12 --> 00 3 --> 4 \u5148\u67e5\u770b\u73fe\u6709 Docker process list\uff1a docker ps \u518d\u5957\u7528 minikube \u7684 Docker daemon eval $(minikube -p minikube docker-env) $ minikube -p minikube docker-env export DOCKER_TLS_VERIFY = \"1\" export DOCKER_HOST = \"tcp://192.168.64.2:2376\" export DOCKER_CERT_PATH = \"/Users/evan.lu/.minikube/certs\" export MINIKUBE_ACTIVE_DOCKERD = \"minikube\" # To point your shell to minikube's docker-daemon, run: # eval $(minikube -p minikube docker-env) \u518d\u4e00\u6b21\u547c\u53eb docker ps $ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c3a17f71f9f9 435df390f367 \"/usr/bin/dumb-init \u2026\" 35 minutes ago Up 35 minutes k8s_controller_ingress-nginx-controller-5d88495688-ljjlx_ingress-nginx_44335178-30e5-4dc5-a481-7980627f281d_1 825f8d008c8f 86262685d9ab \"/metrics-sidecar\" 35 minutes ago Up 35 minutes k8s_dashboard-metrics-scraper_dashboard-metrics-scraper-f6647bd8c-zbbkd_kubernetes-dashboard_13929488-084b-407c-9339-1b6b7b7feb2d_1 8258d336d0d1 6e38f40d628d \"/storage-provisioner\" 35 minutes ago Up 35 minutes k8s_storage-provisioner_storage-provisioner_kube-system_182b3e9c-2cd2-429f-aa0f-3103f916f32a_2 9edd75250040 9a07b5b4bfac \"/dashboard --insecu\u2026\" 35 minutes ago Up 35 minutes k8s_kubernetes-dashboard_kubernetes-dashboard-968bcb79-4l99k_kubernetes-dashboard_5cfcc5ce-7fb2-4304-baa1-6bf491e71469_1 c53e01b79ee7 k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes 0 .0.0.0:80->80/tcp, :::80->80/tcp, 0 .0.0.0:443->443/tcp, :::443->443/tcp k8s_POD_ingress-nginx-controller-5d88495688-ljjlx_ingress-nginx_44335178-30e5-4dc5-a481-7980627f281d_1 72d0bf46751a k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_storage-provisioner_kube-system_182b3e9c-2cd2-429f-aa0f-3103f916f32a_1 b5ef7f9450a2 43154ddb57a8 \"/usr/local/bin/kube\u2026\" 35 minutes ago Up 35 minutes k8s_kube-proxy_kube-proxy-vslx5_kube-system_e9319a11-d048-41ed-8cb1-92a0a17d67b5_1 0cb200215df8 bfe3a36ebd25 \"/coredns -conf /etc\u2026\" 35 minutes ago Up 35 minutes k8s_coredns_coredns-74ff55c5b-sq5jt_kube-system_8f238e64-e20d-4899-8a46-96d783fa8250_1 7ffd1a33f25c k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_dashboard-metrics-scraper-f6647bd8c-zbbkd_kubernetes-dashboard_13929488-084b-407c-9339-1b6b7b7feb2d_1 b589a1d27625 k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kubernetes-dashboard-968bcb79-4l99k_kubernetes-dashboard_5cfcc5ce-7fb2-4304-baa1-6bf491e71469_1 809d46696a2e k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kube-proxy-vslx5_kube-system_e9319a11-d048-41ed-8cb1-92a0a17d67b5_1 a6e5be9a3bb9 k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_coredns-74ff55c5b-sq5jt_kube-system_8f238e64-e20d-4899-8a46-96d783fa8250_1 41d81fb8bbd9 0369cf4303ff \"etcd --advertise-cl\u2026\" 35 minutes ago Up 35 minutes k8s_etcd_etcd-minikube_kube-system_cf26ec9554c6f440822285b6ff9668f3_1 c7a6eca2d3f9 ed2c44fbdd78 \"kube-scheduler --au\u2026\" 35 minutes ago Up 35 minutes k8s_kube-scheduler_kube-scheduler-minikube_kube-system_6b4a0ee8b3d15a1c2e47c15d32e6eb0d_1 3e9a5a9df7da a27166429d98 \"kube-controller-man\u2026\" 35 minutes ago Up 35 minutes k8s_kube-controller-manager_kube-controller-manager-minikube_kube-system_474c55dfb64741cc485e46b6bb9f2dc0_1 dcbf747b8975 a8c2fdb8bf76 \"kube-apiserver --ad\u2026\" 35 minutes ago Up 35 minutes k8s_kube-apiserver_kube-apiserver-minikube_kube-system_0a7845e36bfd593e2ff9a027038089d3_1 ac54b241757d k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kube-scheduler-minikube_kube-system_6b4a0ee8b3d15a1c2e47c15d32e6eb0d_1 6a91f7f8e57c k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kube-controller-manager-minikube_kube-system_474c55dfb64741cc485e46b6bb9f2dc0_1 495996cf491c k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kube-apiserver-minikube_kube-system_0a7845e36bfd593e2ff9a027038089d3_1 6ea9c36a7ff8 k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_etcd-minikube_kube-system_cf26ec9554c6f440822285b6ff9668f3_1 Dashboard \u6709\u4e00\u500b UI \u4ecb\u9762\u6703\u8b93\u4f60\u5c0d Kubernetes \u66f4\u4e86\u89e3 $ minikube dashboard \ud83e\udd14 Verifying dashboard health ... \ud83d\ude80 Launching proxy ... \ud83e\udd14 Verifying proxy health ... \ud83c\udf89 Opening http://127.0.0.1:56616/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser... minikube \u5f88\u9069\u5408\u7528\u4f86\u505a local \u7aef\u6e2c\u8a66\u6216\u6559\u5b78\uff0c\u4f46\u662f\u5c0d\u65bc\u7dda\u4e0a\u74b0\u5883\uff0c\u4ecd\u5efa\u8b70\u76f4\u63a5\u5b89\u88dd Kubernetes\u3002 \u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f \u76ee\u6a19\uff1a \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u25ba Web Pod \u251c\u2500\u2500\u2500\u25ba \u251c\u2500\u2500\u25ba Recipe Pod \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 R \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 \u2502 \u2502 W \u2502 \u2502 c \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 I \u2502 \u2502 e \u2502 \u2502 i \u251c\u2500\u2500\u25ba Recipe Pod \u2502 R \u2502 n \u2502 \u2502 b \u2502 \u2502 p \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 e \u2502 g \u2502 \u2502 \u2502 \u2502 e \u2502 q \u2502 r \u2502 \u2502 S \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 u\u2500\u2500\u2500\u2500\u25ba e \u251c\u2500\u2500\u2500\u25ba e \u251c\u2500\u2500\u2500\u25ba Web Pod \u251c\u2500\u2500\u2500\u25ba S \u251c\u2500\u2500\u25ba Recipe Pod \u2502 e \u2502 s \u2502 \u2502 r \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 e \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 s \u2502 s \u2502 \u2502 v \u2502 \u2502 r \u2502 t \u2502 \u2502 \u2502 i \u2502 \u2502 v \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 c \u2502 \u2502 i \u251c\u2500\u2500\u25ba Recipe Pod \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 c \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u25ba Web Pod \u251c\u2500\u2500\u2500\u25ba \u251c\u2500\u2500\u25ba Recipe Pod \u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u958b\u59cb\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u4e4b\u524d\uff0c\u5148\u628a\u61c9\u7528\u7a0b\u5f0f\u7528 image \u5305\u88dd\u597d\u3002 \u61c9\u7528\u7a0b\u5f0f \u5fc5\u9808\u4f7f\u7528 minikube \u7684 Docker \u5efa\u7f6e image\u3002 $ eval $( minikube -p minikube docker-env ) $ docker build . -t recipe-api:latest \u90e8\u7f72 \u5206\u5225\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u548c Service \u61c9\u7528\u7a0b\u5f0f ****** ****** \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 ****** \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * * *\u2500\u2500\u2500\u25ba Web \u251c\u2500\u2500\u2500\u25ba *\u2500\u2500\u25ba Recipe \u2502 * * * * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 * R * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 * * * * * e * * * * W * * c * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * I * * e * * i *\u2500\u2500\u25ba Recipe \u2502 R * n * * b * * p * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 e * g * * * * e * q * r * * S * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 u\u2500\u2500\u2500\u2500* e *\u2500\u2500\u2500\u25ba e *\u2500\u2500\u2500\u25ba Web \u251c\u2500\u2500\u2500\u25ba S *\u2500\u2500\u25ba Recipe \u2502 e * s * * r * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 * e * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 s * s * * v * * r * t * * * i * * v * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * * c * * i *\u2500\u2500\u25ba Recipe \u2502 * * * e * * c * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 * * * * * e * * * * * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * * *\u2500\u2500\u2500\u25ba Web \u251c\u2500\u2500\u2500\u25ba *\u2500\u2500\u25ba Recipe \u2502 ****** ****** \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 ****** \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u4f7f\u7528\u8a2d\u5b9a\u6a94\u4f86\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u3002 \u9019\u88e1\u4e0d\u7d30\u8b1b\u8a2d\u5b9a\u6a94\u5404\u884c\u610f\u7fa9\uff0c\u50c5\u6982\u8ff0\u3002 web-deployment \u3001 recipe-deployment \u5b9a\u7fa9 Pod \u548c Label \u900f\u904e Selector \u6c7a\u5b9a scaling \u8981\u4f7f\u7528\u54ea\u4e00\u4e9b Pod \u8981\u6c42\u9054\u5230\u7684\u72c0\u614b\u3002\u4ee5\u6b64\u8a2d\u5b9a\u6a94\u70ba\u4f8b\uff1a\u9577\u5230 3/5 \u500b Pods Container \u8a2d\u5b9a\u3002\u7248\u672c\u3001port \u548c health-check \u5957\u7528\u81f3 minikube\uff1a $ kubectl apply -f minikube/recipe-deployment.yml \u9019\u6642\u53ef\u4ee5\u770b\u770b\u662f\u5426\u90fd\u555f\u52d5\u6210\u529f $ kubectl get deployment NAME READY UP-TO-DATE AVAILABLE AGE recipe-api 5 /5 5 5 19h web-api 3 /3 3 3 18h Service \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 *********** \u250c\u2500\u2500\u2500\u2500\u2510 *********** \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u25ba Web *\u2500\u2500\u2500\u25ba \u251c\u2500\u2500\u25ba Recipe * \u2502 \u2502 \u2502 \u2502 *********** \u2502 R \u2502 *********** \u2502 \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 \u2502 \u2502 W \u2502 \u2502 c \u2502 *********** \u2502 I \u2502 \u2502 e \u2502 \u2502 i \u251c\u2500\u2500\u25ba Recipe * R \u2502 n \u2502 \u2502 b \u2502 \u2502 p \u2502 *********** e \u2502 g \u2502 \u2502 \u2502 \u2502 e \u2502 q \u2502 r \u2502 \u2502 S \u2502 *********** \u2502 \u2502 *********** u\u2500\u2500\u2500\u2500\u25ba e \u251c\u2500\u2500\u2500\u25ba e \u251c\u2500\u2500\u2500\u25ba Web *\u2500\u2500\u2500\u25ba S \u251c\u2500\u2500\u25ba Recipe * e \u2502 s \u2502 \u2502 r \u2502 *********** \u2502 e \u2502 *********** s \u2502 s \u2502 \u2502 v \u2502 \u2502 r \u2502 t \u2502 \u2502 \u2502 i \u2502 \u2502 v \u2502 *********** \u2502 \u2502 \u2502 c \u2502 \u2502 i \u251c\u2500\u2500\u25ba Recipe * \u2502 \u2502 \u2502 e \u2502 \u2502 c \u2502 *********** \u2502 \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 \u2502 \u2502 \u2502 *********** \u2502 \u2502 *********** \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u25ba Web *\u2500\u2500\u2500\u25ba \u251c\u2500\u2500\u25ba Recipe * \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 *********** \u2514\u2500\u2500\u2500\u2500\u2518 *********** \u4f7f\u7528\u8a2d\u5b9a\u6a94\u4f86\u90e8\u7f72 Service\u3002 \u5728 web-service \u4e2d\u4e00\u540c\u8a2d\u5b9a Ingress\u3002 web-service \u3001 recipe-service \u5b9a\u7fa9\u61c9\u7528\u7a0b\u5f0f\u5c0d\u5916\u7684 port\uff08Node \u5916\u3001Cluster \u5167\uff09 \u8a2d\u5b9a Ingress \u5c0e\u5f15\u689d\u4ef6\uff0c\u653e\u5982 host1 \u5f15\u5230 Service A \u6216 /api/v1 \u5f15\u5230 Service B \u5957\u7528\u81f3 minikube\uff1a $ kubectl apply -f minikube/recipe-service.yml \u6e2c\u8a66 \u53d6\u5f97 Cluster Ingress address $ kubectl get ingress NAME CLASS HOSTS ADDRESS PORTS AGE web-api-ingress <none> example.org 192.168.64.2 80 96s $ curl -H \"Host: example.org\" http://192.168.64.2 \u6838\u5fc3\u50f9\u503c \u4e0a\u8ff0\u7bc4\u4f8b\u53ef\u4ee5\u900f\u904e docker-compose \u9054\u6210\uff0c\u4f46\u662f Kubernetes \u4e0d\u50c5\u5982\u6b64\u3002 \u7248\u672c \u7576\u6709\u65b0\u7248\u672c\u7684\u61c9\u7528\u7a0b\u5f0f\u9700\u8981\u90e8\u7f72\u6642\uff0cKubernetes \u6703\u5148\u628a\u65b0\u7248\u672c\u7684 Pod \u555f\u8d77\u4f86\uff0c\u7b49\u820a\u7248\u672c\u7684 Pod \u8655\u7406\u5b8c\u8acb\u6c42\u6642\uff0c\u53d6\u4ee3\u4e4b\u3002 \u5148\u628a\u8a2d\u5b9a\u6a94 web-deployment.yml \u5c0d Container \u7684\u7248\u672c\u8abf\u6574\u81f3 v2 \uff0c\u518d\u5957\u7528\u65b0\u7684\u8a2d\u5b9a\u6a94\u5230 minikube\u3002 --record=true \u53ef\u4ee5\u8a18\u9304\u672c\u6b21\u6307\u4ee4\u5230 revision\uff0c\u5e6b\u52a9\u672a\u4f86\u9000\u7248\u78ba\u8a8d\u7248\u672c $ kubectl apply -f minikube/web-deployment.yml --record = true Kubernetes \u8db3\u5920\u8070\u660e\u53bb\u5224\u65b7\u4f60\u6539\u52d5\u4e86\u54ea\u88e1\uff0c\u7136\u5f8c\u4f5c\u51fa\u8abf\u6574\u3002 \u73fe\u5728\u4f86\u770b\u770b\u90e8\u7f72\u7684\u904e\u7a0b\u5427\u3002 -w \u53ef\u4ee5\u7528\u4f86\u76e3\u63a7\u72c0\u6cc1\uff0c -l \u7be9\u9078\u7279\u5b9a label \u7684 Pod $ kubectl get pods -w -l app = web-api NAME READY STATUS RESTARTS AGE web-api-769dc9c8b7-5824q 1 /1 Running 0 19h web-api-769dc9c8b7-6x9bc 1 /1 Terminating 0 19h web-api-769dc9c8b7-hk2dp 1 /1 Running 0 19h web-api-d85b66d56-pkrv5 1 /1 Running 0 3s web-api-d85b66d56-bgw55 1 /1 Running 0 2s web-api-769dc9c8b7-hk2dp 1 /1 Terminating 0 19h web-api-d85b66d56-6qsp4 0 /1 Pending 0 0s web-api-d85b66d56-6qsp4 0 /1 ContainerCreating 0 0s web-api-d85b66d56-6qsp4 1 /1 Running 0 2s web-api-769dc9c8b7-5824q 1 /1 Terminating 0 19h \u6642\u76f8\u5716\u8aaa\u660e\u5be6\u969b\u904b\u4f5c\u7684\u72c0\u6cc1\uff1a \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502v1-a\u2502 \u2502v1-a\u2502 \u2502v2-a\u2502 \u2502v1-a\u2502 \u2502v2-a\u2502 \u2502v2-a\u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502v1-b\u2502 \u2500\u2500\u2500\u25ba \u2502v1-b\u2502 \u2502v2-b\u2502 \u2500\u2500\u2500\u25ba \u2502v1-c\u2502 \u2502v2-b\u2502 \u2500\u2500\u2500\u25ba \u2502v2-b\u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 Terminating \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 Container \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502v1-c\u2502 \u2502v1-c\u2502 Creating \u2502v2-c\u2502 \u2502v2-c\u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 Running Running Running Running \u4f60\u4e5f\u53ef\u4ee5\u770b\u770b\u6709\u904e\u54ea\u4e9b\u8cc7\u6e90\u3002 $ kubectl get rs -l app = web-api NAME DESIRED CURRENT READY AGE web-api-769dc9c8b7 0 0 0 20h web-api-d85b66d56 3 3 3 6m34s \u9000\u7248\u6642\uff0c\u5148\u78ba\u8a8d\u7248\u672c\u865f\u78bc\uff1a $ kubectl rollout history deployment.v1.apps/web-api REVISION CHANGE-CAUSE 1 <none> 2 kubectl apply --filename = web-api-deployment.yml --record = true \u9000\u7248\uff1a $ kubectl rollout undo deployment.v1.apps/web-api \\ --to-revision = 1 Scaling \u624b\u52d5\u589e\u9577\u5230\u5341\u500b $ kubectl scale deployment.apps/recipe-api --replicas = 10 deployment.apps/recipe-api scaled $ kubectl get deployment NAME READY UP-TO-DATE AVAILABLE AGE recipe-api 5 /10 10 5 1m web-api 3 /3 3 3 1m \u9664\u4e86\u900f\u904e\u6307\u4ee4\u589e\u6e1b Pod \u6578\u91cf\uff0c\u4e5f\u53ef\u4ee5\u6539\u52d5 Deployment \u6a94\uff0c\u518d\u5f15\u5165\u3002 \u5728 scaling \u7684\u904e\u7a0b\u4e2d\uff0cKubernetes \u6703\u78ba\u5b9a\u53ef\u4ee5\u88ab\u5f15\u7528\u624d\u5f15\u7528\uff0c\u79fb\u9664\u6642\u4ea6\u540c\u3002 \u9019\u88e1\u7684 scaling \u662f\u52d5\u614b\u8abf\u6574\u7684\uff0c\u800c docker-compose \u662f\u7576\u521d\u8a2d\u5b9a\u7684\u6578\u91cf\u5f8c\u505a\u555f\u52d5\uff0c\u4e26\u975e scaling\u3002 \u9664\u4e86\u624b\u52d5\u589e\u9577\u6e1b\u5c11\uff0cKubernetes \u4e5f\u53ef\u4ee5\u81ea\u52d5\u5316\uff1a Horizontal Autoscaler \u900f\u904e CPU \u6216\u5176\u4ed6\u7cfb\u7d71\u8cc7\u6e90\u53bb\u589e\u6e1b Pod\u3002 Cron Job \u900f\u904e\u6392\u7a0b\u53bb\u589e\u6e1b Pod\u3002 Kubernetes \u9084\u6709\u5f88\u591a\u529f\u80fd\uff0c\u6211\u81ea\u5df1\u4e5f\u624d\u525b\u958b\u59cb\u6478\u7d22\uff0c\u5e0c\u671b\u672a\u4f86\u6709\u4eba\u80fd\u6df1\u5165\u77ad\u89e3\u4e26\u548c\u5927\u5bb6\u5206\u4eab\uff01 Misc. Live migration Retry strategy Chaos resiliency Data atomicity Dependency security Dependency upgrade \u4e0a\u8ff0\u9019\u4e9b\u5728\u672c\u66f8\u4e2d\u90fd\u6709\u8a0e\u8ad6\u5230\uff0c\u500b\u4eba\u89ba\u5f97\u4e5f\u5f88\u6709\u8da3\uff0c\u6709\u8208\u8da3\u7684\u4eba\u90fd\u53ef\u4ee5\u770b\u770b\u3002","title":"Container Orchestration and Misc."},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#container-orchestration-and-misc","text":"\u4e0a\u4e00\u4efd\u5831\u544a\u8aaa\u660e Container \u7684\u50f9\u503c\u548c\u5efa\u69cb\u908f\u8f2f\u3002\u800c Docker \u4e0d\u50c5\u4f5c\u70ba\u5305\u88dd\u61c9\u7528\u7a0b\u5f0f\u7684\u5de5\u5177\uff0c\u4e5f\u5e6b\u6211\u5011\u7ba1\u7406 Container\u3002 \u4f46\u662f\u4ecd\u6709\u4e00\u4e9b\u72c0\u6cc1\u9700\u8981\u89e3\u6c7a\uff1a \u5982\u4f55\u505a Scaling\uff0c\u55ae\u4e00\u6216\u591a\u53f0\u6a5f\u5668 Load Balance Health Check and Replacement \u591a\u670d\u52d9\u9593\u7684\u6e9d\u901a\uff0cdocker-compose \u50c5\u80fd\u5728\u55ae\u4e00\u53f0\u6a5f\u5668\u4e0b\u5354\u52a9\u6e9d\u901a \u65b0\u7248\u672c\u7684\u61c9\u7528\u7a0b\u5f0f\u5982\u4f55\u7121\u7e2b\u63a5\u8ecc \u9019\u6642\u4fbf\u9700\u8981\u4e00\u500b\u8abf\u5ea6\u5bb9\u5668\uff08Container\uff09\u7684\u5de5\u5177\u3002","title":"Container Orchestration and Misc."},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#kubernetes","text":"Kubernetes \u53ef\u4ee5\u89e3\u6c7a\u4e0a\u8ff0\u63d0\u5230\u7684\u554f\u984c\u3002\u63a5\u4e0b\u4f86\u6703\u5148\u7c21\u55ae\u4ecb\u7d39\u5176\u4e2d\u5404\u540d\u8a5e\u4ee3\u8868\u7684\u610f\u7fa9\uff0c\u7136\u5f8c\u518d\u5be6\u4f5c\uff0c\u9019\u6a23\u5c0d\u65bc\u5be6\u4f5c\u6642\u64cd\u4f5c\u7684\u5404\u500b\u6307\u4ee4\u5c31\u6703\u6bd4\u8f03\u6709\u611f\u3002","title":"Kubernetes"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_1","text":"\u4ee5\u4e0b\u5c07\u9010\u4e00\u4ecb\u7d39 Kubernetes \u7684\u57fa\u672c\u55ae\u4f4d\u3002 Container Volume Pod Node Master Cluster","title":"\u55ae\u4f4d"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#container","text":"\u7ba1\u7406\u5bb9\u5668\u5316\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u9664\u4e86 Docker \u5916\uff0c\u4e0a\u4e00\u4efd\u5831\u544a\u63d0\u5230\u7684 rkt \u4e5f\u662f\u5141\u8a31\u7684\u61c9\u7528\u7a0b\u5f0f\u3002","title":"Container"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#volume","text":"\u548c Host \u7684 filesystem \u505a\u9023\u63a5\u7684\u670d\u52d9\uff0c\u5c0d Container \u63d0\u4f9b\u8cc7\u6599\u5b58\u53d6\u7684\u5730\u65b9\u3002","title":"Volume"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#pod","text":"\u7528\u4f86\u5305\u88dd Container \u548c Volume \u7684\u55ae\u4f4d\uff0c\u4e00\u500b Pod \u6703\u88ab\u5206\u914d\u5230\u4e00\u500b IP\u3002\u82e5 Pod \u4e2d\u542b\u6709\u591a\u7684 Container \u7684\u8a71\uff0c\u5404\u500b Container \u6703\u5171\u7528\u8a72\u7d44 IP\u3002 \u6709\u4e0a\u8ff0\u4e09\u500b\u55ae\u4f4d\u53ef\u4ee5\u756b\u51fa\u4e00\u500b\u5716\uff1a","title":"Pod"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#node","text":"\u5982\u540c Docker \u7ba1\u7406 Container \u4e00\u822c\uff0cNode \u5c31\u662f\u7ba1\u7406 Pod \u7684\u55ae\u4f4d\u3002 \u4e00\u500b Node \u5e95\u4e0b\u9700\u8981\u4e00\u4e9b\u8f14\u52a9\u5de5\u5177\u4f86\u5e6b\u52a9\u7ba1\u7406\u5404\u500b Pod \u548c Container\uff1a Kubernetes Daemon\uff08\u7a31\u4f5c Kubelet\uff09 Container Daemon\uff08\u5982\uff1aDocker\uff09 Network Proxy\uff08\u7a31\u4f5c Kube Proxy\uff09 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 Kubernetes Node \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 Kubernetes \u2502 Kubelet \u2502 \u2502 \u2502 Pod \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Docker \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 Kube proxy \u2502 \u2502 \u2502 Kubernetes \u2502 \u2502 \u2502 \u2502 Pod \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"Node"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#master","text":"\u7528\u4f86\u7ba1\u7406 Node\uff0c\u4e26\u5c0d\u5916\u958b\u653e API\uff0c\u63d0\u4f9b\u9014\u5f91\u53bb\u64cd\u4f5c\u5404\u500b Node\u3002 \u5982\uff1a\u958b\u767c\u8005\u53ef\u4ee5\u901a\u904e kubectl \u900f\u904e Master \u53bb\u64cd\u4f5c\u5404\u500b Node\u3002 \uff08\u985e\u4f3c\u65bc Docker CLI \u900f\u904e Daemon \u53bb\u64cd\u4f5c\u5404\u500b Container \uff09","title":"Master"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#cluster","text":"\u4e00\u7d44\u7531 Master \u548c\u591a\u500b Node \u7d44\u6210\u7684\u7fa4\u7d44\u3002","title":"Cluster"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_2","text":"","title":"\u5b8c\u6574\u6982\u7565\u5716"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_3","text":"\u6bcf\u6b21\u547c\u53eb Master \u505a\u4e8b\u60c5\uff0c\u4e8b\u5be6\u4e0a\u5c31\u662f\u6307\u5b9a\u4e00\u500b Cluster \u61c9\u8a72\u6709\u7684\u72c0\u614b\uff0c\u5982\uff1a \u6211\u5e0c\u671b\u67d0\u67d0 Node \u88e1\u9762\u6709 10 \u500b\u7248\u672c 2 \u7684 Pod\u3002 \u6b64\u6642 Kubernetes \u5c31\u6703\u91dd\u5c0d\u8a72\u72c0\u614b\u958b\u59cb\u505a\u4e8b\uff0c\u4e0d\u7ba1\u662f\u964d\u4f4e\u3001\u5347\u9ad8\u6578\u91cf\u6216\u5347\u964d\u7248\u672c\u7684\u64cd\u4f5c\u90fd\u662f\u7531 Kubernetes \u53bb\u57f7\u884c\u3002 \u6b64\u8655\u5305\u62ec\u57f7\u884c\u908f\u8f2f\uff0c\u4f8b\u5982\u9810\u671f 10 \u500b Pod\uff0c\u73fe\u6709 4 \u500b\uff0c\u9700\u589e\u52a0 6 \u500b\uff0c\u6b64\u8655\u7684 6 \u500b\u5c31\u662f Kubernetes \u81ea\u884c\u53bb\u8a08\u7b97\u51fa\u7684\u6578\u5b57\u3002 \u63a5\u4e0b\u4f86\u6703\u4ecb\u7d39\u5e7e\u500b\u5728\u672c\u6b21\u5be6\u4f5c\u6703\u61c9\u7528\u5230\u7684\u89c0\u5ff5\u3002 Deployment Selector Label Scheduler Controller ReplicaSet Probe \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502L\u2502 Defined \u2502 \u2502a\u2502 Pod B \u2502 \u2502b\u2502 \u2502 \u2502e\u2502 \u2502 \u2502l\u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502B\u2502 \u2502 kubectl\u2500\u25ba\u2502Deployment\u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502L\u2502 Defined \u2502 \u2502 Selector \u2502a\u2502 Pod A \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502b\u2502 \u2502 \u2502e\u2502 \u2502 \u2502l\u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 ReplicaSet \u2502 \u2502A\u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502Pod A-1\u2502 \u2502 \u2502L\u2502 Defined \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502a\u2502 Pod A \u2502 \u2502 \u2502 \u2502b\u2502 \u2502Scheduler \u250c\u2500\u2500\u2500\u2500\u2500\u2510Controller \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502e\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502Ready\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502 \u2502Pod A-2\u2502 \u2502 \u2502l\u2502 \u2502Pending \u2514\u2500\u2500\u2500\u2500\u2500\u2518Creating \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502A\u2502 \u2502 Probe \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25baPod A-N\u2502 \u2502 Health Checking \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"\u6982\u5ff5"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#deployment","text":"\u7528\u4f86\u8868\u9054\u90e8\u7f72\u6642\u6b32\u9054\u6210\u7684\u72c0\u614b\uff0c\u901a\u5e38\u662f\u6700\u5e38\u63a5\u89f8\u7684\u5de5\u5177\u3002 \u72c0\u614b\u53ef\u80fd\u5305\u62ec\u6578\u91cf\u3001\u7248\u672c\u7b49\u3002","title":"Deployment"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#selector","text":"\u7528\u4f86\u6307\u5b9a\u7279\u5b9a Pod \u7684\u689d\u4ef6\uff0c\u4f8b\u5982\uff1a\u6709\u9ad8\u904b\u7b97\u9700\u6c42\u7684\u5c31\u6703\u8981\u6c42\u6709 machine:physical \u9019\u500b Label \u7684 Pod\u3002","title":"Selector"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#label","text":"\u7528\u4f86\u5e6b Node \u548c Pod \u8cbc\u6a19\u7c64\uff0c\u4ee5 Node.js \u70ba\u4f8b\uff1a platform:node playform-version:v14 machine:physical kernel:3.16 app:web-api app:recipe-api Label \u4e0d\u5fc5\u552f\u4e00\uff0c\u4f60\u53ef\u4ee5\u91cd\u8907\u8a2d\u5b9a\u4e00\u6a23\u7684 key\uff0c\u5982\uff1a platform:node \u3001 platform:alpine \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502L\u2502 Defined \u2502 \u2502a\u2502 Pod B \u2502 \u2502b\u2502 \u2502 \u2502e\u2502 \u2502 \u2502l\u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502B\u2502 \u2502 kubectl\u2500\u25ba\u2502Deployment\u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502L\u2502 Defined \u2502 \u2502 Selector \u2502a\u2502 Pod A \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502b\u2502 \u2502 \u2502e\u2502 \u2502 \u2502l\u2502 \u2502 \u2502 \u2502 \u2502 \u2502A\u2502 \u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"Label"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#scheduler","text":"Kubernetes \u6703\u6e2c\u8a66\u73fe\u6709\u74b0\u5883\uff08\u5982 CPU/Memory\uff09\u662f\u5426\u9069\u5408\u6dfb\u52a0 Pod\u3002\u82e5\u7121\uff0c\u5247\u7b49\u5f85\u3002 \u9810\u8a2d\u505a Scheduling \u7684\u5de5\u5177\u70ba kube-scheduler \u3002","title":"Scheduler"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#controller","text":"\u7528\u4f86\u63a7\u5236 Kubernetes \u5404\u7a2e\u72c0\u614b\u7684\u63a7\u5236\u5668\uff0c\u901a\u5e38\u958b\u767c\u8005\u4e0d\u6703\u76f4\u63a5\u63a5\u89f8\u3002","title":"Controller"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#replicaset","text":"\u9664\u4e86 ReplicaSet \u5916\uff0c\u6839\u64da\u9700\u6c42\u9084\u6709\u5176\u4ed6\u7a2e\u985e\u7684\u7fa4\u7d44\uff0c\u5982\uff1a StatefulSet \u662f\u53ef\u4ee5\u63d0\u4f9b\u72c0\u614b\u5132\u5b58\u7684\u7fa4\u7d44\u3002 Stateful \u7684\u61c9\u7528\u7a0b\u5f0f\u5728\u9019\u5e7e\u6b21\u5831\u544a\u90fd\u4e0d\u6703\u8a0e\u8ad6\uff0c\u56e0\u70ba\u5c0d\u65bc\u9700\u8981\u5132\u5b58\u72c0\u614b\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u5176\u5efa\u69cb\u3001\u90e8\u7f72\u7684\u7b56\u7565\u662f\u53e6\u4e00\u9805\u9818\u57df\u3002","title":"ReplicaSet"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#probe","text":"\u7528\u4f86\u505a Health Check\u3002 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 ReplicaSet \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502Pod A-1\u2502 \u2502 \u2502L\u2502 Defined \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502a\u2502 Pod A \u2502 \u2502 \u2502 \u2502b\u2502 \u2502Scheduler \u250c\u2500\u2500\u2500\u2500\u2500\u2510Controller \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502e\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502Ready\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502 \u2502Pod A-2\u2502 \u2502 \u2502l\u2502 \u2502Pending \u2514\u2500\u2500\u2500\u2500\u2500\u2518Creating \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502A\u2502 \u2502 Probe \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2514\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25baPod A-N\u2502 \u2502 Health Checking \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Ingress Service \u2502 Request \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Ingress \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u2500\u25ba Service \u2502 \u2502 \u2502 \u2502 Master \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u2502 \u2502 Node \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 Pod1 \u2502 \u2502 \u2502 \u2502 Pod2 \u2502 \u2502 \u2502 \u2502 ... \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"Probe"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#service","text":"\u5982\u540c Docker \u6703\u6c7a\u5b9a\u54ea\u4e00\u500b Container \u6709\u5c0d\u5916\u7684 port \u4e00\u6a23\uff0cService \u4e5f\u6703\u5229\u7528 Selector \u6c7a\u5b9a\u54ea\u4e00\u500b Pod \u662f\u53ef\u4ee5\u5c0d\u5916\u7684\u3002 \u985e\u4f3c\u65bc reverse-proxy \u822c\uff0c\u6c7a\u5b9a\u5916\u90e8\u54ea\u4e9b\u8acb\u6c42\u53ef\u4ee5\u9001\u9032 Pod \u88cf\u9762\u3002 \u5728\u524d\u5e7e\u6b21\u5831\u544a\u4e2d\u5e38\u5e38\u63d0\u5230 service\uff0c\u5176\u4ee3\u8868\u7684\u610f\u7fa9\u662f\u670d\u52d9\u6216\u61c9\u7528\u7a0b\u5f0f\uff0c\u6709\u5225\u65bc\u6b64\u8655\u63d0\u5230\u7684 Service","title":"Service"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#ingress","text":"\u7ba1\u7406 Cluster \u5916\u90e8\u7684\u8acb\u6c42\u3002","title":"Ingress"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#alternatives","text":"\u7531\u4e0a\u8ff0\u53ef\u77e5\uff0cKubernetes \u64c1\u6709\u975e\u5e38\u8c50\u5bcc\u7684\u529f\u80fd\uff0c\u4e26\u4e14\u53ef\u4ee5\u900f\u904e\u591a\u7a2e\u65b9\u5f0f\u9054\u6210\u540c\u4e00\u500b\u76ee\u7684\uff08\u4f8b\u5982 dev/stg \u7684\u74b0\u5883\u5206\u5272\uff09\u3002\u9019\u88e1\u4e5f\u4e26\u672a\u5b8c\u5168\u6db5\u84cb Kubernetes \u7684\u6982\u5ff5\uff08\u4f8b\u5982\u4ee5 etcd \u505a\u5132\u5b58\u7684\u6f14\u7b97\u6cd5\uff09 Apache Mesos \u548c Apache Marathon \u7684\u7d44\u5408\u80fd\u9054\u5230\u985e\u4f3c Kubernetes \u7684\u529f\u80fd\u3002 Docker Swarm \u662f Docker \u539f\u751f\u7684\u5bb9\u5668\u5316\u8abf\u5ea6\u5de5\u5177\uff0c\u4f46 Docker \u5df2\u7d93\u6368\u68c4\u4e26\u6539\u63a1\u548c Kubernetes \u7684\u517c\u5bb9\u4e86\u3002","title":"Alternatives"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#minikube","text":"\u70ba\u4e86\u7c21\u5316\u5be6\u4f5c\u4e0a\u9700\u8981\u505a\u7684\u8a2d\u5b9a\uff0c\u672c\u6b21\u5be6\u4f5c\u6703\u900f\u904e minikube \u4f86\u64cd\u4f5c\u3002 minikube \u662f\u4e00\u500b\u7c21\u5316\u7248\u7684 Kubernetes\uff0c\u4ed6\u6e1b\u5c11\u5f88\u591a\u529f\u80fd\u7684\u8a2d\u5b9a\uff0c\u8b93\u4f7f\u7528\u8005\u53ef\u4ee5\u5feb\u901f\u958b\u59cb\u5be6\u4f5c\uff0c\u4e26\u4e14\u628a Master/Node \u878d\u5408\u518d\u4e00\u8d77\u3002 \u78ba\u8a8d kubectl \u7684\u5b89\u88dd\uff1a kubectl version --client brew install kubernetes-cli \u78ba\u8a8d minikube \u7684\u5b89\u88dd\uff1a minikube version brew install minikube","title":"minikube"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#kubectl","text":"\u555f\u52d5 $ minikube start \ud83d\ude04 minikube v1.20.0 on Darwin 11 .4 \ud83c\udf89 minikube 1 .22.0 is available! Download it: https://github.com/kubernetes/minikube/releases/tag/v1.22.0 \u2728 Using the hyperkit driver based on existing profile \ud83d\udca1 To disable this notice, run: 'minikube config set WantUpdateNotification false' \ud83d\udc4d Starting control plane node minikube in cluster minikube \ud83d\udd04 Restarting existing hyperkit VM for \"minikube\" ... \ud83d\udc33 Preparing Kubernetes v1.20.2 on Docker 20 .10.6 ... \ud83d\udd0e Verifying Kubernetes components... \u25aa Using image k8s.gcr.io/ingress-nginx/controller:v0.44.0 \u25aa Using image kubernetesui/dashboard:v2.1.0 \u25aa Using image docker.io/jettech/kube-webhook-certgen:v1.5.1 \u25aa Using image kubernetesui/metrics-scraper:v1.0.4 \u25aa Using image gcr.io/k8s-minikube/storage-provisioner:v5 \u25aa Using image docker.io/jettech/kube-webhook-certgen:v1.5.1 \ud83d\udd0e Verifying ingress addon... \ud83c\udf1f Enabled addons: storage-provisioner, default-storageclass, ingress, dashboard \ud83c\udfc4 Done! kubectl is now configured to use \"minikube\" cluster and \"default\" namespace by default \u67e5\u770b\u73fe\u6709 Pods $ kubectl get pods No resources found in default namespace. \u56e0\u70ba\u9810\u8a2d\u4f7f\u7528 default namespace \u67e5\u770b\u6240\u6709 namespace $ kubectl get namespace NAME STATUS AGE default Active 48d ingress-nginx Active 48d kube-node-lease Active 48d kube-public Active 48d kube-system Active 48d kubernetes-dashboard Active 48d \u67e5\u770b\u7cfb\u7d71\u7684 Pods $ kubectl get pods --namespace = kube-system NAME READY STATUS RESTARTS AGE coredns-74ff55c5b-sq5jt 1 /1 Running 1 48d etcd-minikube 1 /1 Running 1 48d kube-apiserver-minikube 1 /1 Running 1 48d kube-controller-manager-minikube 1 /1 Running 1 48d kube-proxy-vslx5 1 /1 Running 1 48d kube-scheduler-minikube 1 /1 Running 1 48d storage-provisioner 1 /1 Running 2 48d \u67e5\u770b Node $ kubectl get nodes NAME STATUS ROLES AGE VERSION minikube Ready control-plane,master 48d v1.20.2 \u4f7f\u7528 minikube \u7684 Docker graph TD 1[Docker] --> 0[Container] 00[Container] 2[Local \u7aef\u7684 Daemon] --> 1 3[Docker CLI] -..-> 2 4[Kubernetes \u7aef\u7684 Daemon] --> 12[Docker] 12 --> 00 3 --> 4 \u5148\u67e5\u770b\u73fe\u6709 Docker process list\uff1a docker ps \u518d\u5957\u7528 minikube \u7684 Docker daemon eval $(minikube -p minikube docker-env) $ minikube -p minikube docker-env export DOCKER_TLS_VERIFY = \"1\" export DOCKER_HOST = \"tcp://192.168.64.2:2376\" export DOCKER_CERT_PATH = \"/Users/evan.lu/.minikube/certs\" export MINIKUBE_ACTIVE_DOCKERD = \"minikube\" # To point your shell to minikube's docker-daemon, run: # eval $(minikube -p minikube docker-env) \u518d\u4e00\u6b21\u547c\u53eb docker ps $ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c3a17f71f9f9 435df390f367 \"/usr/bin/dumb-init \u2026\" 35 minutes ago Up 35 minutes k8s_controller_ingress-nginx-controller-5d88495688-ljjlx_ingress-nginx_44335178-30e5-4dc5-a481-7980627f281d_1 825f8d008c8f 86262685d9ab \"/metrics-sidecar\" 35 minutes ago Up 35 minutes k8s_dashboard-metrics-scraper_dashboard-metrics-scraper-f6647bd8c-zbbkd_kubernetes-dashboard_13929488-084b-407c-9339-1b6b7b7feb2d_1 8258d336d0d1 6e38f40d628d \"/storage-provisioner\" 35 minutes ago Up 35 minutes k8s_storage-provisioner_storage-provisioner_kube-system_182b3e9c-2cd2-429f-aa0f-3103f916f32a_2 9edd75250040 9a07b5b4bfac \"/dashboard --insecu\u2026\" 35 minutes ago Up 35 minutes k8s_kubernetes-dashboard_kubernetes-dashboard-968bcb79-4l99k_kubernetes-dashboard_5cfcc5ce-7fb2-4304-baa1-6bf491e71469_1 c53e01b79ee7 k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes 0 .0.0.0:80->80/tcp, :::80->80/tcp, 0 .0.0.0:443->443/tcp, :::443->443/tcp k8s_POD_ingress-nginx-controller-5d88495688-ljjlx_ingress-nginx_44335178-30e5-4dc5-a481-7980627f281d_1 72d0bf46751a k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_storage-provisioner_kube-system_182b3e9c-2cd2-429f-aa0f-3103f916f32a_1 b5ef7f9450a2 43154ddb57a8 \"/usr/local/bin/kube\u2026\" 35 minutes ago Up 35 minutes k8s_kube-proxy_kube-proxy-vslx5_kube-system_e9319a11-d048-41ed-8cb1-92a0a17d67b5_1 0cb200215df8 bfe3a36ebd25 \"/coredns -conf /etc\u2026\" 35 minutes ago Up 35 minutes k8s_coredns_coredns-74ff55c5b-sq5jt_kube-system_8f238e64-e20d-4899-8a46-96d783fa8250_1 7ffd1a33f25c k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_dashboard-metrics-scraper-f6647bd8c-zbbkd_kubernetes-dashboard_13929488-084b-407c-9339-1b6b7b7feb2d_1 b589a1d27625 k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kubernetes-dashboard-968bcb79-4l99k_kubernetes-dashboard_5cfcc5ce-7fb2-4304-baa1-6bf491e71469_1 809d46696a2e k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kube-proxy-vslx5_kube-system_e9319a11-d048-41ed-8cb1-92a0a17d67b5_1 a6e5be9a3bb9 k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_coredns-74ff55c5b-sq5jt_kube-system_8f238e64-e20d-4899-8a46-96d783fa8250_1 41d81fb8bbd9 0369cf4303ff \"etcd --advertise-cl\u2026\" 35 minutes ago Up 35 minutes k8s_etcd_etcd-minikube_kube-system_cf26ec9554c6f440822285b6ff9668f3_1 c7a6eca2d3f9 ed2c44fbdd78 \"kube-scheduler --au\u2026\" 35 minutes ago Up 35 minutes k8s_kube-scheduler_kube-scheduler-minikube_kube-system_6b4a0ee8b3d15a1c2e47c15d32e6eb0d_1 3e9a5a9df7da a27166429d98 \"kube-controller-man\u2026\" 35 minutes ago Up 35 minutes k8s_kube-controller-manager_kube-controller-manager-minikube_kube-system_474c55dfb64741cc485e46b6bb9f2dc0_1 dcbf747b8975 a8c2fdb8bf76 \"kube-apiserver --ad\u2026\" 35 minutes ago Up 35 minutes k8s_kube-apiserver_kube-apiserver-minikube_kube-system_0a7845e36bfd593e2ff9a027038089d3_1 ac54b241757d k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kube-scheduler-minikube_kube-system_6b4a0ee8b3d15a1c2e47c15d32e6eb0d_1 6a91f7f8e57c k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kube-controller-manager-minikube_kube-system_474c55dfb64741cc485e46b6bb9f2dc0_1 495996cf491c k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_kube-apiserver-minikube_kube-system_0a7845e36bfd593e2ff9a027038089d3_1 6ea9c36a7ff8 k8s.gcr.io/pause:3.2 \"/pause\" 35 minutes ago Up 35 minutes k8s_POD_etcd-minikube_kube-system_cf26ec9554c6f440822285b6ff9668f3_1","title":"kubectl"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#dashboard","text":"\u6709\u4e00\u500b UI \u4ecb\u9762\u6703\u8b93\u4f60\u5c0d Kubernetes \u66f4\u4e86\u89e3 $ minikube dashboard \ud83e\udd14 Verifying dashboard health ... \ud83d\ude80 Launching proxy ... \ud83e\udd14 Verifying proxy health ... \ud83c\udf89 Opening http://127.0.0.1:56616/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser... minikube \u5f88\u9069\u5408\u7528\u4f86\u505a local \u7aef\u6e2c\u8a66\u6216\u6559\u5b78\uff0c\u4f46\u662f\u5c0d\u65bc\u7dda\u4e0a\u74b0\u5883\uff0c\u4ecd\u5efa\u8b70\u76f4\u63a5\u5b89\u88dd Kubernetes\u3002","title":"Dashboard"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_4","text":"\u76ee\u6a19\uff1a \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u25ba Web Pod \u251c\u2500\u2500\u2500\u25ba \u251c\u2500\u2500\u25ba Recipe Pod \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 R \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 \u2502 \u2502 W \u2502 \u2502 c \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 I \u2502 \u2502 e \u2502 \u2502 i \u251c\u2500\u2500\u25ba Recipe Pod \u2502 R \u2502 n \u2502 \u2502 b \u2502 \u2502 p \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 e \u2502 g \u2502 \u2502 \u2502 \u2502 e \u2502 q \u2502 r \u2502 \u2502 S \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 u\u2500\u2500\u2500\u2500\u25ba e \u251c\u2500\u2500\u2500\u25ba e \u251c\u2500\u2500\u2500\u25ba Web Pod \u251c\u2500\u2500\u2500\u25ba S \u251c\u2500\u2500\u25ba Recipe Pod \u2502 e \u2502 s \u2502 \u2502 r \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 e \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 s \u2502 s \u2502 \u2502 v \u2502 \u2502 r \u2502 t \u2502 \u2502 \u2502 i \u2502 \u2502 v \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 c \u2502 \u2502 i \u251c\u2500\u2500\u25ba Recipe Pod \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 c \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u25ba Web Pod \u251c\u2500\u2500\u2500\u25ba \u251c\u2500\u2500\u25ba Recipe Pod \u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u958b\u59cb\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u4e4b\u524d\uff0c\u5148\u628a\u61c9\u7528\u7a0b\u5f0f\u7528 image \u5305\u88dd\u597d\u3002","title":"\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_5","text":"\u5fc5\u9808\u4f7f\u7528 minikube \u7684 Docker \u5efa\u7f6e image\u3002 $ eval $( minikube -p minikube docker-env ) $ docker build . -t recipe-api:latest","title":"\u61c9\u7528\u7a0b\u5f0f"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_6","text":"\u5206\u5225\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u548c Service","title":"\u90e8\u7f72"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_7","text":"****** ****** \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 ****** \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * * *\u2500\u2500\u2500\u25ba Web \u251c\u2500\u2500\u2500\u25ba *\u2500\u2500\u25ba Recipe \u2502 * * * * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 * R * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 * * * * * e * * * * W * * c * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * I * * e * * i *\u2500\u2500\u25ba Recipe \u2502 R * n * * b * * p * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 e * g * * * * e * q * r * * S * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 u\u2500\u2500\u2500\u2500* e *\u2500\u2500\u2500\u25ba e *\u2500\u2500\u2500\u25ba Web \u251c\u2500\u2500\u2500\u25ba S *\u2500\u2500\u25ba Recipe \u2502 e * s * * r * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 * e * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 s * s * * v * * r * t * * * i * * v * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * * c * * i *\u2500\u2500\u25ba Recipe \u2502 * * * e * * c * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 * * * * * e * * * * * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 * * * *\u2500\u2500\u2500\u25ba Web \u251c\u2500\u2500\u2500\u25ba *\u2500\u2500\u25ba Recipe \u2502 ****** ****** \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 ****** \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u4f7f\u7528\u8a2d\u5b9a\u6a94\u4f86\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u3002 \u9019\u88e1\u4e0d\u7d30\u8b1b\u8a2d\u5b9a\u6a94\u5404\u884c\u610f\u7fa9\uff0c\u50c5\u6982\u8ff0\u3002 web-deployment \u3001 recipe-deployment \u5b9a\u7fa9 Pod \u548c Label \u900f\u904e Selector \u6c7a\u5b9a scaling \u8981\u4f7f\u7528\u54ea\u4e00\u4e9b Pod \u8981\u6c42\u9054\u5230\u7684\u72c0\u614b\u3002\u4ee5\u6b64\u8a2d\u5b9a\u6a94\u70ba\u4f8b\uff1a\u9577\u5230 3/5 \u500b Pods Container \u8a2d\u5b9a\u3002\u7248\u672c\u3001port \u548c health-check \u5957\u7528\u81f3 minikube\uff1a $ kubectl apply -f minikube/recipe-deployment.yml \u9019\u6642\u53ef\u4ee5\u770b\u770b\u662f\u5426\u90fd\u555f\u52d5\u6210\u529f $ kubectl get deployment NAME READY UP-TO-DATE AVAILABLE AGE recipe-api 5 /5 5 5 19h web-api 3 /3 3 3 18h","title":"\u61c9\u7528\u7a0b\u5f0f"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#service_1","text":"\u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 *********** \u250c\u2500\u2500\u2500\u2500\u2510 *********** \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u25ba Web *\u2500\u2500\u2500\u25ba \u251c\u2500\u2500\u25ba Recipe * \u2502 \u2502 \u2502 \u2502 *********** \u2502 R \u2502 *********** \u2502 \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 \u2502 \u2502 W \u2502 \u2502 c \u2502 *********** \u2502 I \u2502 \u2502 e \u2502 \u2502 i \u251c\u2500\u2500\u25ba Recipe * R \u2502 n \u2502 \u2502 b \u2502 \u2502 p \u2502 *********** e \u2502 g \u2502 \u2502 \u2502 \u2502 e \u2502 q \u2502 r \u2502 \u2502 S \u2502 *********** \u2502 \u2502 *********** u\u2500\u2500\u2500\u2500\u25ba e \u251c\u2500\u2500\u2500\u25ba e \u251c\u2500\u2500\u2500\u25ba Web *\u2500\u2500\u2500\u25ba S \u251c\u2500\u2500\u25ba Recipe * e \u2502 s \u2502 \u2502 r \u2502 *********** \u2502 e \u2502 *********** s \u2502 s \u2502 \u2502 v \u2502 \u2502 r \u2502 t \u2502 \u2502 \u2502 i \u2502 \u2502 v \u2502 *********** \u2502 \u2502 \u2502 c \u2502 \u2502 i \u251c\u2500\u2500\u25ba Recipe * \u2502 \u2502 \u2502 e \u2502 \u2502 c \u2502 *********** \u2502 \u2502 \u2502 \u2502 \u2502 e \u2502 \u2502 \u2502 \u2502 \u2502 *********** \u2502 \u2502 *********** \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u25ba Web *\u2500\u2500\u2500\u25ba \u251c\u2500\u2500\u25ba Recipe * \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 *********** \u2514\u2500\u2500\u2500\u2500\u2518 *********** \u4f7f\u7528\u8a2d\u5b9a\u6a94\u4f86\u90e8\u7f72 Service\u3002 \u5728 web-service \u4e2d\u4e00\u540c\u8a2d\u5b9a Ingress\u3002 web-service \u3001 recipe-service \u5b9a\u7fa9\u61c9\u7528\u7a0b\u5f0f\u5c0d\u5916\u7684 port\uff08Node \u5916\u3001Cluster \u5167\uff09 \u8a2d\u5b9a Ingress \u5c0e\u5f15\u689d\u4ef6\uff0c\u653e\u5982 host1 \u5f15\u5230 Service A \u6216 /api/v1 \u5f15\u5230 Service B \u5957\u7528\u81f3 minikube\uff1a $ kubectl apply -f minikube/recipe-service.yml","title":"Service"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_8","text":"\u53d6\u5f97 Cluster Ingress address $ kubectl get ingress NAME CLASS HOSTS ADDRESS PORTS AGE web-api-ingress <none> example.org 192.168.64.2 80 96s $ curl -H \"Host: example.org\" http://192.168.64.2","title":"\u6e2c\u8a66"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_9","text":"\u4e0a\u8ff0\u7bc4\u4f8b\u53ef\u4ee5\u900f\u904e docker-compose \u9054\u6210\uff0c\u4f46\u662f Kubernetes \u4e0d\u50c5\u5982\u6b64\u3002","title":"\u6838\u5fc3\u50f9\u503c"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#_10","text":"\u7576\u6709\u65b0\u7248\u672c\u7684\u61c9\u7528\u7a0b\u5f0f\u9700\u8981\u90e8\u7f72\u6642\uff0cKubernetes \u6703\u5148\u628a\u65b0\u7248\u672c\u7684 Pod \u555f\u8d77\u4f86\uff0c\u7b49\u820a\u7248\u672c\u7684 Pod \u8655\u7406\u5b8c\u8acb\u6c42\u6642\uff0c\u53d6\u4ee3\u4e4b\u3002 \u5148\u628a\u8a2d\u5b9a\u6a94 web-deployment.yml \u5c0d Container \u7684\u7248\u672c\u8abf\u6574\u81f3 v2 \uff0c\u518d\u5957\u7528\u65b0\u7684\u8a2d\u5b9a\u6a94\u5230 minikube\u3002 --record=true \u53ef\u4ee5\u8a18\u9304\u672c\u6b21\u6307\u4ee4\u5230 revision\uff0c\u5e6b\u52a9\u672a\u4f86\u9000\u7248\u78ba\u8a8d\u7248\u672c $ kubectl apply -f minikube/web-deployment.yml --record = true Kubernetes \u8db3\u5920\u8070\u660e\u53bb\u5224\u65b7\u4f60\u6539\u52d5\u4e86\u54ea\u88e1\uff0c\u7136\u5f8c\u4f5c\u51fa\u8abf\u6574\u3002 \u73fe\u5728\u4f86\u770b\u770b\u90e8\u7f72\u7684\u904e\u7a0b\u5427\u3002 -w \u53ef\u4ee5\u7528\u4f86\u76e3\u63a7\u72c0\u6cc1\uff0c -l \u7be9\u9078\u7279\u5b9a label \u7684 Pod $ kubectl get pods -w -l app = web-api NAME READY STATUS RESTARTS AGE web-api-769dc9c8b7-5824q 1 /1 Running 0 19h web-api-769dc9c8b7-6x9bc 1 /1 Terminating 0 19h web-api-769dc9c8b7-hk2dp 1 /1 Running 0 19h web-api-d85b66d56-pkrv5 1 /1 Running 0 3s web-api-d85b66d56-bgw55 1 /1 Running 0 2s web-api-769dc9c8b7-hk2dp 1 /1 Terminating 0 19h web-api-d85b66d56-6qsp4 0 /1 Pending 0 0s web-api-d85b66d56-6qsp4 0 /1 ContainerCreating 0 0s web-api-d85b66d56-6qsp4 1 /1 Running 0 2s web-api-769dc9c8b7-5824q 1 /1 Terminating 0 19h \u6642\u76f8\u5716\u8aaa\u660e\u5be6\u969b\u904b\u4f5c\u7684\u72c0\u6cc1\uff1a \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502v1-a\u2502 \u2502v1-a\u2502 \u2502v2-a\u2502 \u2502v1-a\u2502 \u2502v2-a\u2502 \u2502v2-a\u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502v1-b\u2502 \u2500\u2500\u2500\u25ba \u2502v1-b\u2502 \u2502v2-b\u2502 \u2500\u2500\u2500\u25ba \u2502v1-c\u2502 \u2502v2-b\u2502 \u2500\u2500\u2500\u25ba \u2502v2-b\u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 Terminating \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 Container \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502v1-c\u2502 \u2502v1-c\u2502 Creating \u2502v2-c\u2502 \u2502v2-c\u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 Running Running Running Running \u4f60\u4e5f\u53ef\u4ee5\u770b\u770b\u6709\u904e\u54ea\u4e9b\u8cc7\u6e90\u3002 $ kubectl get rs -l app = web-api NAME DESIRED CURRENT READY AGE web-api-769dc9c8b7 0 0 0 20h web-api-d85b66d56 3 3 3 6m34s \u9000\u7248\u6642\uff0c\u5148\u78ba\u8a8d\u7248\u672c\u865f\u78bc\uff1a $ kubectl rollout history deployment.v1.apps/web-api REVISION CHANGE-CAUSE 1 <none> 2 kubectl apply --filename = web-api-deployment.yml --record = true \u9000\u7248\uff1a $ kubectl rollout undo deployment.v1.apps/web-api \\ --to-revision = 1","title":"\u7248\u672c"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#scaling","text":"\u624b\u52d5\u589e\u9577\u5230\u5341\u500b $ kubectl scale deployment.apps/recipe-api --replicas = 10 deployment.apps/recipe-api scaled $ kubectl get deployment NAME READY UP-TO-DATE AVAILABLE AGE recipe-api 5 /10 10 5 1m web-api 3 /3 3 3 1m \u9664\u4e86\u900f\u904e\u6307\u4ee4\u589e\u6e1b Pod \u6578\u91cf\uff0c\u4e5f\u53ef\u4ee5\u6539\u52d5 Deployment \u6a94\uff0c\u518d\u5f15\u5165\u3002 \u5728 scaling \u7684\u904e\u7a0b\u4e2d\uff0cKubernetes \u6703\u78ba\u5b9a\u53ef\u4ee5\u88ab\u5f15\u7528\u624d\u5f15\u7528\uff0c\u79fb\u9664\u6642\u4ea6\u540c\u3002 \u9019\u88e1\u7684 scaling \u662f\u52d5\u614b\u8abf\u6574\u7684\uff0c\u800c docker-compose \u662f\u7576\u521d\u8a2d\u5b9a\u7684\u6578\u91cf\u5f8c\u505a\u555f\u52d5\uff0c\u4e26\u975e scaling\u3002 \u9664\u4e86\u624b\u52d5\u589e\u9577\u6e1b\u5c11\uff0cKubernetes \u4e5f\u53ef\u4ee5\u81ea\u52d5\u5316\uff1a Horizontal Autoscaler \u900f\u904e CPU \u6216\u5176\u4ed6\u7cfb\u7d71\u8cc7\u6e90\u53bb\u589e\u6e1b Pod\u3002 Cron Job \u900f\u904e\u6392\u7a0b\u53bb\u589e\u6e1b Pod\u3002 Kubernetes \u9084\u6709\u5f88\u591a\u529f\u80fd\uff0c\u6211\u81ea\u5df1\u4e5f\u624d\u525b\u958b\u59cb\u6478\u7d22\uff0c\u5e0c\u671b\u672a\u4f86\u6709\u4eba\u80fd\u6df1\u5165\u77ad\u89e3\u4e26\u548c\u5927\u5bb6\u5206\u4eab\uff01","title":"Scaling"},{"location":"feedback/distributed-systems-with-node.js/container-orchestration-and-misc/#misc","text":"Live migration Retry strategy Chaos resiliency Data atomicity Dependency security Dependency upgrade \u4e0a\u8ff0\u9019\u4e9b\u5728\u672c\u66f8\u4e2d\u90fd\u6709\u8a0e\u8ad6\u5230\uff0c\u500b\u4eba\u89ba\u5f97\u4e5f\u5f88\u6709\u8da3\uff0c\u6709\u8208\u8da3\u7684\u4eba\u90fd\u53ef\u4ee5\u770b\u770b\u3002","title":"Misc."},{"location":"feedback/distributed-systems-with-node.js/container/","text":"Container \u670d\u52d9\u5f9e\u4e00\u500b\u8b8a\u591a\u500b \u554f\u984c\u5f80\u5f80\u5c31\u767c\u751f\u5728\u7576\u670d\u52d9\u5f9e\u4e00\u500b\u8b8a\u6210\u591a\u500b\u6642\u3002 Protocol JSON - \u7576\u4f60\u53ea\u6709\u4e00\u500b API Endpoint\uff0c\u8db3\u77e3\u3002 \u4f46\u662f\u7576\u4f60\u6709\u8d8a\u4f86\u8d8a\u591a Endpoint \u751a\u81f3\u540c\u4e00\u6642\u9593\u9700\u8981\u5404\u500b Endpoint \u7684\u8cc7\u6e90... GraphQL - \u53ea\u9700\u8981\u5c0d\u61c9\u4e00\u500b\u7aef\u9ede\uff0c\u5c31\u53ef\u4ee5\u7372\u5f97\u591a\u500b API \u7684\u8cc7\u8a0a\u4e14\u53ef\u4ee5\u81ea\u884c\u7d44\u7e54\u67e5\u8a62\u5167\u5bb9 \u4f46\u662f API \u7684\u884c\u70ba\u8d8a\u4f86\u8d8a\u8907\u96dc\uff0c\u727d\u6d89\u5230\u591a\u7a2e\u908f\u8f2f... gRPC - \u53ea\u9700\u8981\u5c08\u5fc3\u64b0\u5beb\u7a0b\u5f0f\u908f\u8f2f\uff0c\u76f8\u95dc\u7684 HTTP client \u7686\u5df2\u7d93\u8655\u7406\u5b8c\u3002 SLA and Load Test \u600e\u9ebc\u78ba\u4fdd\u7522\u54c1\u5728\u7d93\u904e\u591a\u6b21\u50b3\u8f38\u5f8c\u4ecd\u80fd\u7dad\u6301\u53ef\u9810\u671f\u7684\u4fdd\u8b49 SLO Load Test Baseline Observability \u7576\u7522\u54c1\u8d8a\u4f86\u8d8a\u591a\uff0c\u600e\u9ebc\u5feb\u901f\u7cbe\u6e96\u7684\u7372\u53d6\u61c9\u7528\u3001\u670d\u52d9\u3001\u8a2d\u5099\u7684\u8cc7\u8a0a\u3002 Log Metric Tracing Alert Health Check \u90e8\u7f72\u65b9\u5f0f \u6709\u5f88\u591a\u7a2e\u65b9\u6cd5\u53ef\u4ee5\u63d0\u5347\u670d\u52d9\u7684\u6578\u91cf\uff0c\u5404\u7a2e\u65b9\u5f0f\u90fd\u9700\u6b0a\u8861\uff1a \u53ef\u651c\u5e36\u6027 - \u76f8\u4f9d\u5957\u4ef6\u9808\u4e00\u4f75\u651c\u5e36\uff0c\u5305\u62ec Binaries Depending \u6548\u7387 - \u6bcf\u6b21\u90e8\u7f72\u9700\u6d88\u8017\u7684\u6210\u672c \u5b89\u5168\u6027 - \u6a5f\u654f\u8cc7\u8a0a\u7684\u66b4\u9732 \u8106\u5f31\u6027 - \u76f8\u4f9d\u5957\u4ef6\u7248\u672c\u7684\u885d\u7a81\u7b49 \u6bd4\u8f03 \u5be6\u9ad4\u6a5f - \u82e5\u548c\u5176\u4ed6\u670d\u52d9\uff08\u5982 Load Balancer\uff09\u6709\u5957\u4ef6\u7684\u885d\u7a81\uff0c\u6703\u5f88\u9ebb\u7169\u3002 VM - \u9069\u5408 DB \u548c\u5176\u4ed6\u9700\u8981\u5132\u5b58\u7a69\u5b9a\u72c0\u614b\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 Container - \u9069\u5408\u9ad8\u8fed\u4ee3\u3001\u9ad8\u90e8\u7f72\u7387\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 Container \u5305\u62ec Image\u3001Port Mapping\u3001Volume Mappings Volume \u5c31\u662f\u7ba1\u7406 Container \u7aef\u548c Host \u7aef\u7684 filesystem Docker Docker \u662f\u4e00\u500b\u7ba1\u7406\u3001\u5efa\u7f6e Container \u7684\u5de5\u5177\uff0c\u5176\u4e3b\u8981\u6709\u4e09\u500b\u5de5\u5177\uff1a dockerd daemon\uff0c\u5c0d\u5916\u63d0\u4f9b API\uff0c\u9032\u884c Container \u7684\u5efa\u7f6e\u548c\u7ba1\u7406 Docker CLI \u63d0\u4f9b\u8a9e\u6cd5\u5c0d API \u9032\u884c\u547c\u53eb\u548c\u8a2d\u5b9a\u3002 Docker Hub Docker Desktop Docker \u662f\u57f7\u884c\u5728 Linux \u4e4b\u4e0a\u7684\u5de5\u5177\uff0c\u82e5\u6a5f\u5668\u4e0d\u662f Linux\uff0c\u5c31\u6703\u9700\u8981 Docker Desktop \u3002 \u5176\u4e0d\u50c5\u53ef\u4ee5\u5efa\u7acb VM \u4f86\u6a21\u64ec Linux \u74b0\u5883\uff0c\u4e5f\u63d0\u4f9b\u5176\u4ed6\u597d\u7528\u529f\u80fd\uff0c\u5982 UI \u548c Kubernetes \u7684\u6574\u5408\u3002 graph TD subgraph Host OS Filesystem end subgraph Container 0[Image] Volume --> Filesystem Filesystem --> Volume Port end 1[Docker] --> 0 0 --> 1 2[Daemon] -- HTTP --> 1 3[Docker CLI] --> 2 4[Docker Hub] --> 2 2 --> 4 Docker Image \u628a\u61c9\u7528\u7a0b\u5f0f\u5305\u88dd\u6210 Image \u518d\u4f9d\u6b64\u5efa\u7acb Container\u3002 \u61c9\u7528\u7a0b\u5f0f\u5927\u90e8\u5206\u90fd\u9700\u8981\u5efa\u7acb\u5728\u7279\u5b9a\u74b0\u5883\u4e4b\u4e0a\uff0c\u4ee5 Node.js \u7684\u61c9\u7528\u7a0b\u5f0f\u70ba\u4f8b\uff1a graph TB subgraph Linux 0[\"/usr/bin\"] end subgraph Node.js 1[\"/usr/bin/node\"] end subgraph Application 2[\"/srv/server.js\"] end 0 --> 1 1 --> 2 \u6bcf\u500b\u74b0\u5883\u90fd\u7a31\u70ba\u4e00\u7d44 stage\uff0c\u5982 Linux \u3001 Node.js \u548c Application \u3002 \u6bcf\u500b stage \u4e2d\u6703\u6709\u5f88\u591a\u5c64 layer\uff0c\u5206\u5225\u4ee3\u8868\u5efa\u7acb\u904e\u7a0b\u7684\u4e00\u500b\u6b65\u9a5f\u3002 \u4ee5 Node.js \u4e26\u5305\u88dd\u5728 Alpine \u4e4b\u4e0a\u7684 Image \u70ba\u4f8b\uff1a $ docker pull node:lts-alpine c9b1b535fdd9: Pull complete 750cdd924064: Downloading [== > ] 2 .485MB/34.53MB 2078ab7cf9df: Download complete 02f523899354: Download complete # Layer Size 1 ADD file ... in /... 2.69 MB 2 CMD [\\\"/bin/sh\\\"] 0 B 3 ENV NODE_VERSION=14.17.3 0 B 4 /bin/sh -c addgroup -g 1000 ... 34.53 MB 5 ENV YARN_VERSION=1.22.5 0 B 6 /bin/sh -c apk add --no-cache ... 2.14 MB 7 COPY file ... in /usr/... 281 B 8 ENTRYPOINT [\\\"docker-entrypoint.sh\\\"] 0 B 9 CMD [\"node\"] 0 B Image \u5927\u5c0f\u70ba 39.35 MB\uff0c \u9023\u7d50 \u6709\u6539\u8b8a filesystem \u7684\u6b65\u9a5f\uff08\u6703\u6539\u8b8a Image \u5927\u5c0f\uff09\uff0c\u624d\u6703\u5217\u51fa\u4f86\u3002 SHA \u503c\u8a08\u7b97\u65b9\u5f0f\u662f\u4e0a\u4e00\u500b SHA \u503c\u52a0\u4e0a\u73fe\u884c\u7684\u6307\u4ee4\u7d44\u51fa\u4f86\u7684\u3002 \u82e5\u6539\u70ba Debian\uff08\u9810\u8a2d\u503c\uff09\u5247\u70ba\uff1a $ docker pull node:lts 199ebcd83264: Pull complete ddbb155879c0: Pull complete c194bbaa3d8b: Pull complete 6154ac87d7f3: Pull complete 0c283e88ced7: Pull complete dba101298560: Pull complete 1d8bfd4e555f: Downloading [===== > ] 7 .56MB/33.38MB 757e41ffbdcc: Download complete 6e055c4b8721: Download complete # Layer Size 1 ADD file ... in ... 43.28 MB 2 CMD [\"bash\"] 0 B 3 /bin/sh -c set -eux; apt-get ... 10.77 MB 4 /bin/sh -c set -ex; if ... 4.14 MB 5 /bin/sh -c apt-get update && ... 47.46 MB 6 /bin/sh -c set -ex; apt-get ... 204.5 MB 7 /bin/sh -c groupadd --gid 1000 ... 4.09 KB 8 ENV NODE_VERSION=14.17.3 0 B 9 /bin/sh -c ARCH= && dpkgArch=\"$(dpkg ... 33.38 MB 10 ENV YARN_VERSION=1.22.5 0 B 11 /bin/sh -c set -ex ... 2.23 MB 12 COPY file ... in ... 295 B 13 ENTRYPOINT [\\\"docker-entrypoint.sh\\\"] 0 B 14 CMD [\"node\"] 0 B Image \u5927\u5c0f\u70ba 345.75 MB\uff0c \u9023\u7d50 \u3002 Container \u90e8\u7f72\u5be6\u4f5c\u4e0a\u4ecd\u5efa\u8b70\u4ee5\u8f03\u5c0f\u7684 Image \u70ba\u57fa\u5e95\uff0c\u9664\u4e86\u52a0\u901f\u90e8\u7f72\u6d41\u7a0b\u5916\uff0c\u8f03\u5c0f\u7684\u6a94\u6848\u9762\u7a4d\u7406\u8ad6\u4e0a\u4e5f\u80fd\u964d\u4f4e\u88ab\u653b\u64ca\u7684\u6a5f\u6703\u3002 \u5be6\u4f5c \u76f8\u4fe1\u4e86\u89e3 Image \u88fd\u4f5c\u539f\u7406\u5f8c\uff0c\u5c0d\u65bc\u5be6\u4f5c\u5c31\u4e0d\u6703\u6709\u592a\u5927\u554f\u984c\uff0c\u9019\u88e1\u6709\u5be6\u4f5c\u76f8\u95dc\u7684\u6587\u4ef6\uff0c\u6709\u8208\u8da3\u53ef\u4ee5\u53bb\u67e5\u770b \u4ee5 Node.js \u70ba\u57fa\u790e\u7684\u88fd\u4f5c\u7bc4\u4f8b \u5404\u8a9e\u8a00\u7684\u7bc4\u4f8b - \u5b98\u7db2 \u548c Container \u7684\u4e92\u52d5 \u900f\u904e Docker CLI \u53ef\u4ee5\u548c Container \u4e92\u52d5\uff0c\u9664\u4e86\u8b93\u6211\u5011\u4e86\u89e3\u5176\u5167\u90e8\u904b\u4f5c\u904e\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u5e6b\u52a9\u6211\u5011 Debug\u3002 \u9032\u5165 Container $ docker run -it ubuntu /bin/bash -i \u4ee3\u8868\u8981\u4ee5\u4e92\u52d5\u6a21\u5f0f\u9032\u5165 Container -t \u4ee3\u8868\u662f\u4ee5 TTY session \u9032\u5165\uff0c\u548c -i \u6574\u5408\u70ba -it \u4e26\u4f7f\u7528 bash \u9032\u5165\u5f8c\uff0c\u5373\u53ef\u900f\u904e ps -e \u8f38\u51fa\u6240\u6709 process\u3002 PID TTY TIME CMD 1 pts/0 00:00:00 bash 10 pts/0 00:00:00 ps bash \u4f5c\u70ba\u521d\u59cb\u884c\u70ba\uff0c\u5fc5\u9808\u5728 PID 1\u3002 \u7531\u6b64\u53ef\u770b\u51fa\uff0cContainer \u7684\u884c\u70ba\u76f8\u7576\u55ae\u7d14\uff0c\u4e0d\u50cf\u5be6\u969b\u4f7f\u7528\u7684\u96fb\u8166\uff0c\u6703\u6709\u5404\u7a2e\u670d\u52d9\u5728\u80cc\u666f\u904b\u4f5c\u3002 \u5c0d Container \u5167\u90e8\u4e0b\u9054\u6307\u4ee4 docker exec ubuntu /bin/ls /var \u628a\u6a94\u6848\u4e1f\u9032 Container \u4e2d $ curl -o index.html http://example.org $ docker run --rm -p 8080 :80 \\ -v $PWD :/usr/share/nginx/html nginx -p \u5373\u70ba\u524d\u9762\u63d0\u5230\u7684 port-mappings -v \u5373\u70ba volume-mappings\uff08filesystem\uff09 Alternative \u73fe\u5728\u5df2\u7d93\u8f03\u5c11\u5176\u4ed6\u7ba1\u7406 Container \u7684\u7522\u54c1\uff1a RedHat \u6709\u4e00\u500b\u5df2\u7d93 archive \u7684\u5c08\u6848 rkt Open Container Initiative \u5247\u5617\u8a66\u5236\u8a02 container \u6a19\u6e96\u3002 \u5206\u6563\u5f0f\u7cfb\u7d71\u4e0a\u7684\u61c9\u7528 \u591a\u500b\u670d\u52d9\u8981\u600e\u9ebc\u900f\u904e Docker \u5efa\u7acb\uff1f\u6709\u5e7e\u500b\u65b9\u6cd5\uff1a docker run exmaple/server1 docker run exmaple/server2 \u591a\u6b21 docker run exmaple/server \u53bb\u5efa\u7acb\u4e0d\u540c\u7684\u61c9\u7528\u7a0b\u5f0f\u6703\u96e3\u7ba1\u7406\u4e14\u5bb9\u6613\u51fa\u932f\u3002 \u628a\u4e0d\u540c\u670d\u52d9\u5305\u88dd\u6210\u540c\u4e00\u500b Image \u6709\u6642\u76f8\u4f3c\u7684\u61c9\u7528\u7a0b\u5f0f\u53ef\u4ee5\u5305\u88dd\u6210\u540c\u4e00\u500b Image\uff0c\u5982\u4e0a\u4e00\u6b21\u5831\u544a\u63d0\u5230\u7684 ELK \uff0c\u4f46\u662f\u5206\u6563\u5f0f\u7cfb\u7d71\u4e0a\u4e0d\u540c\u7684\u61c9\u7528\u7a0b\u5f0f\u82e5\u5305\u88dd\u6210\u540c\u4e00\u500b Image \u6703\u8b93\u670d\u52d9\u7684\u7368\u7acb\u6027\u6d88\u5931\u3002 docker-compose \u4fbf\u662f\u7528\u4f86\u89e3\u6c7a\u9019\u4e00\u554f\u984c\u7684\u65b9\u6848\u3002 \u4ee5\u4e0a\u4e00\u4efd Tracing \u4e2d\u7684 Zipkin \u70ba\u4f8b\uff1a graph LR 0[Client] 1[Zipkin] subgraph APP 2[web-api] 3[recipe-api] end 0 --> 2 2 --> 3 3 --> 2 2 -- info --> 1 3 -- info --> 1 \u5c31\u53ef\u4ee5\u4f9d\u6b64\u5efa\u7acb docker-compose.yaml\uff1a version : \"3.7\" services : zipkin : image : openzipkin/zipkin-slim:2.19 ports : - 9411:9411 recipe-api : build : context : ./recipe-api dockerfile : Dockerfile-zipkin ports : - 4000:4000 environment : ZIPKIN : zipkin:9411 depends_on : - zipkin web-api : build : context : ./web-api dockerfile : Dockerfile-zipkin ports : - 3000:3000 environment : TARGET : recipe-api:4000 ZIPKIN : zipkin:9411 depends_on : - zipkin - recipe-api Docker Registry Docker Hub \u63d0\u4f9b\u5b58\u653e Image \u7a7a\u9593\uff0c\u4f46\u5c0d\u65bc\u79c1\u4eba\u7a7a\u9593\u7684\u5b58\u653e\u6578\u91cf\u6709\u9650\u5236\u3002 \u53ef\u4ee5\u6839\u64da\u9810\u7b97\uff0c\u8003\u616e\u5176\u4ed6 Docker Registry\uff0c\u4f8b\u5982\uff1a JFrog Artifactory Cloud based \u8a3b \u9019\u6b21\u5206\u4eab\u7701\u7565 \u4e0a\u50b3 Image \u5230 Docker Registry \u81ea\u88fd Docker Registry UI","title":"Container"},{"location":"feedback/distributed-systems-with-node.js/container/#container","text":"","title":"Container"},{"location":"feedback/distributed-systems-with-node.js/container/#_1","text":"\u554f\u984c\u5f80\u5f80\u5c31\u767c\u751f\u5728\u7576\u670d\u52d9\u5f9e\u4e00\u500b\u8b8a\u6210\u591a\u500b\u6642\u3002","title":"\u670d\u52d9\u5f9e\u4e00\u500b\u8b8a\u591a\u500b"},{"location":"feedback/distributed-systems-with-node.js/container/#protocol","text":"JSON - \u7576\u4f60\u53ea\u6709\u4e00\u500b API Endpoint\uff0c\u8db3\u77e3\u3002 \u4f46\u662f\u7576\u4f60\u6709\u8d8a\u4f86\u8d8a\u591a Endpoint \u751a\u81f3\u540c\u4e00\u6642\u9593\u9700\u8981\u5404\u500b Endpoint \u7684\u8cc7\u6e90... GraphQL - \u53ea\u9700\u8981\u5c0d\u61c9\u4e00\u500b\u7aef\u9ede\uff0c\u5c31\u53ef\u4ee5\u7372\u5f97\u591a\u500b API \u7684\u8cc7\u8a0a\u4e14\u53ef\u4ee5\u81ea\u884c\u7d44\u7e54\u67e5\u8a62\u5167\u5bb9 \u4f46\u662f API \u7684\u884c\u70ba\u8d8a\u4f86\u8d8a\u8907\u96dc\uff0c\u727d\u6d89\u5230\u591a\u7a2e\u908f\u8f2f... gRPC - \u53ea\u9700\u8981\u5c08\u5fc3\u64b0\u5beb\u7a0b\u5f0f\u908f\u8f2f\uff0c\u76f8\u95dc\u7684 HTTP client \u7686\u5df2\u7d93\u8655\u7406\u5b8c\u3002","title":"Protocol"},{"location":"feedback/distributed-systems-with-node.js/container/#sla-and-load-test","text":"\u600e\u9ebc\u78ba\u4fdd\u7522\u54c1\u5728\u7d93\u904e\u591a\u6b21\u50b3\u8f38\u5f8c\u4ecd\u80fd\u7dad\u6301\u53ef\u9810\u671f\u7684\u4fdd\u8b49 SLO Load Test Baseline","title":"SLA and Load Test"},{"location":"feedback/distributed-systems-with-node.js/container/#observability","text":"\u7576\u7522\u54c1\u8d8a\u4f86\u8d8a\u591a\uff0c\u600e\u9ebc\u5feb\u901f\u7cbe\u6e96\u7684\u7372\u53d6\u61c9\u7528\u3001\u670d\u52d9\u3001\u8a2d\u5099\u7684\u8cc7\u8a0a\u3002 Log Metric Tracing Alert Health Check","title":"Observability"},{"location":"feedback/distributed-systems-with-node.js/container/#_2","text":"\u6709\u5f88\u591a\u7a2e\u65b9\u6cd5\u53ef\u4ee5\u63d0\u5347\u670d\u52d9\u7684\u6578\u91cf\uff0c\u5404\u7a2e\u65b9\u5f0f\u90fd\u9700\u6b0a\u8861\uff1a \u53ef\u651c\u5e36\u6027 - \u76f8\u4f9d\u5957\u4ef6\u9808\u4e00\u4f75\u651c\u5e36\uff0c\u5305\u62ec Binaries Depending \u6548\u7387 - \u6bcf\u6b21\u90e8\u7f72\u9700\u6d88\u8017\u7684\u6210\u672c \u5b89\u5168\u6027 - \u6a5f\u654f\u8cc7\u8a0a\u7684\u66b4\u9732 \u8106\u5f31\u6027 - \u76f8\u4f9d\u5957\u4ef6\u7248\u672c\u7684\u885d\u7a81\u7b49","title":"\u90e8\u7f72\u65b9\u5f0f"},{"location":"feedback/distributed-systems-with-node.js/container/#_3","text":"\u5be6\u9ad4\u6a5f - \u82e5\u548c\u5176\u4ed6\u670d\u52d9\uff08\u5982 Load Balancer\uff09\u6709\u5957\u4ef6\u7684\u885d\u7a81\uff0c\u6703\u5f88\u9ebb\u7169\u3002 VM - \u9069\u5408 DB \u548c\u5176\u4ed6\u9700\u8981\u5132\u5b58\u7a69\u5b9a\u72c0\u614b\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 Container - \u9069\u5408\u9ad8\u8fed\u4ee3\u3001\u9ad8\u90e8\u7f72\u7387\u7684\u61c9\u7528\u7a0b\u5f0f\u3002 Container \u5305\u62ec Image\u3001Port Mapping\u3001Volume Mappings Volume \u5c31\u662f\u7ba1\u7406 Container \u7aef\u548c Host \u7aef\u7684 filesystem","title":"\u6bd4\u8f03"},{"location":"feedback/distributed-systems-with-node.js/container/#docker","text":"Docker \u662f\u4e00\u500b\u7ba1\u7406\u3001\u5efa\u7f6e Container \u7684\u5de5\u5177\uff0c\u5176\u4e3b\u8981\u6709\u4e09\u500b\u5de5\u5177\uff1a dockerd daemon\uff0c\u5c0d\u5916\u63d0\u4f9b API\uff0c\u9032\u884c Container \u7684\u5efa\u7f6e\u548c\u7ba1\u7406 Docker CLI \u63d0\u4f9b\u8a9e\u6cd5\u5c0d API \u9032\u884c\u547c\u53eb\u548c\u8a2d\u5b9a\u3002 Docker Hub Docker Desktop Docker \u662f\u57f7\u884c\u5728 Linux \u4e4b\u4e0a\u7684\u5de5\u5177\uff0c\u82e5\u6a5f\u5668\u4e0d\u662f Linux\uff0c\u5c31\u6703\u9700\u8981 Docker Desktop \u3002 \u5176\u4e0d\u50c5\u53ef\u4ee5\u5efa\u7acb VM \u4f86\u6a21\u64ec Linux \u74b0\u5883\uff0c\u4e5f\u63d0\u4f9b\u5176\u4ed6\u597d\u7528\u529f\u80fd\uff0c\u5982 UI \u548c Kubernetes \u7684\u6574\u5408\u3002 graph TD subgraph Host OS Filesystem end subgraph Container 0[Image] Volume --> Filesystem Filesystem --> Volume Port end 1[Docker] --> 0 0 --> 1 2[Daemon] -- HTTP --> 1 3[Docker CLI] --> 2 4[Docker Hub] --> 2 2 --> 4","title":"Docker"},{"location":"feedback/distributed-systems-with-node.js/container/#docker-image","text":"\u628a\u61c9\u7528\u7a0b\u5f0f\u5305\u88dd\u6210 Image \u518d\u4f9d\u6b64\u5efa\u7acb Container\u3002 \u61c9\u7528\u7a0b\u5f0f\u5927\u90e8\u5206\u90fd\u9700\u8981\u5efa\u7acb\u5728\u7279\u5b9a\u74b0\u5883\u4e4b\u4e0a\uff0c\u4ee5 Node.js \u7684\u61c9\u7528\u7a0b\u5f0f\u70ba\u4f8b\uff1a graph TB subgraph Linux 0[\"/usr/bin\"] end subgraph Node.js 1[\"/usr/bin/node\"] end subgraph Application 2[\"/srv/server.js\"] end 0 --> 1 1 --> 2 \u6bcf\u500b\u74b0\u5883\u90fd\u7a31\u70ba\u4e00\u7d44 stage\uff0c\u5982 Linux \u3001 Node.js \u548c Application \u3002 \u6bcf\u500b stage \u4e2d\u6703\u6709\u5f88\u591a\u5c64 layer\uff0c\u5206\u5225\u4ee3\u8868\u5efa\u7acb\u904e\u7a0b\u7684\u4e00\u500b\u6b65\u9a5f\u3002 \u4ee5 Node.js \u4e26\u5305\u88dd\u5728 Alpine \u4e4b\u4e0a\u7684 Image \u70ba\u4f8b\uff1a $ docker pull node:lts-alpine c9b1b535fdd9: Pull complete 750cdd924064: Downloading [== > ] 2 .485MB/34.53MB 2078ab7cf9df: Download complete 02f523899354: Download complete # Layer Size 1 ADD file ... in /... 2.69 MB 2 CMD [\\\"/bin/sh\\\"] 0 B 3 ENV NODE_VERSION=14.17.3 0 B 4 /bin/sh -c addgroup -g 1000 ... 34.53 MB 5 ENV YARN_VERSION=1.22.5 0 B 6 /bin/sh -c apk add --no-cache ... 2.14 MB 7 COPY file ... in /usr/... 281 B 8 ENTRYPOINT [\\\"docker-entrypoint.sh\\\"] 0 B 9 CMD [\"node\"] 0 B Image \u5927\u5c0f\u70ba 39.35 MB\uff0c \u9023\u7d50 \u6709\u6539\u8b8a filesystem \u7684\u6b65\u9a5f\uff08\u6703\u6539\u8b8a Image \u5927\u5c0f\uff09\uff0c\u624d\u6703\u5217\u51fa\u4f86\u3002 SHA \u503c\u8a08\u7b97\u65b9\u5f0f\u662f\u4e0a\u4e00\u500b SHA \u503c\u52a0\u4e0a\u73fe\u884c\u7684\u6307\u4ee4\u7d44\u51fa\u4f86\u7684\u3002 \u82e5\u6539\u70ba Debian\uff08\u9810\u8a2d\u503c\uff09\u5247\u70ba\uff1a $ docker pull node:lts 199ebcd83264: Pull complete ddbb155879c0: Pull complete c194bbaa3d8b: Pull complete 6154ac87d7f3: Pull complete 0c283e88ced7: Pull complete dba101298560: Pull complete 1d8bfd4e555f: Downloading [===== > ] 7 .56MB/33.38MB 757e41ffbdcc: Download complete 6e055c4b8721: Download complete # Layer Size 1 ADD file ... in ... 43.28 MB 2 CMD [\"bash\"] 0 B 3 /bin/sh -c set -eux; apt-get ... 10.77 MB 4 /bin/sh -c set -ex; if ... 4.14 MB 5 /bin/sh -c apt-get update && ... 47.46 MB 6 /bin/sh -c set -ex; apt-get ... 204.5 MB 7 /bin/sh -c groupadd --gid 1000 ... 4.09 KB 8 ENV NODE_VERSION=14.17.3 0 B 9 /bin/sh -c ARCH= && dpkgArch=\"$(dpkg ... 33.38 MB 10 ENV YARN_VERSION=1.22.5 0 B 11 /bin/sh -c set -ex ... 2.23 MB 12 COPY file ... in ... 295 B 13 ENTRYPOINT [\\\"docker-entrypoint.sh\\\"] 0 B 14 CMD [\"node\"] 0 B Image \u5927\u5c0f\u70ba 345.75 MB\uff0c \u9023\u7d50 \u3002 Container \u90e8\u7f72\u5be6\u4f5c\u4e0a\u4ecd\u5efa\u8b70\u4ee5\u8f03\u5c0f\u7684 Image \u70ba\u57fa\u5e95\uff0c\u9664\u4e86\u52a0\u901f\u90e8\u7f72\u6d41\u7a0b\u5916\uff0c\u8f03\u5c0f\u7684\u6a94\u6848\u9762\u7a4d\u7406\u8ad6\u4e0a\u4e5f\u80fd\u964d\u4f4e\u88ab\u653b\u64ca\u7684\u6a5f\u6703\u3002","title":"Docker Image"},{"location":"feedback/distributed-systems-with-node.js/container/#_4","text":"\u76f8\u4fe1\u4e86\u89e3 Image \u88fd\u4f5c\u539f\u7406\u5f8c\uff0c\u5c0d\u65bc\u5be6\u4f5c\u5c31\u4e0d\u6703\u6709\u592a\u5927\u554f\u984c\uff0c\u9019\u88e1\u6709\u5be6\u4f5c\u76f8\u95dc\u7684\u6587\u4ef6\uff0c\u6709\u8208\u8da3\u53ef\u4ee5\u53bb\u67e5\u770b \u4ee5 Node.js \u70ba\u57fa\u790e\u7684\u88fd\u4f5c\u7bc4\u4f8b \u5404\u8a9e\u8a00\u7684\u7bc4\u4f8b - \u5b98\u7db2","title":"\u5be6\u4f5c"},{"location":"feedback/distributed-systems-with-node.js/container/#container_1","text":"\u900f\u904e Docker CLI \u53ef\u4ee5\u548c Container \u4e92\u52d5\uff0c\u9664\u4e86\u8b93\u6211\u5011\u4e86\u89e3\u5176\u5167\u90e8\u904b\u4f5c\u904e\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u5e6b\u52a9\u6211\u5011 Debug\u3002","title":"\u548c Container \u7684\u4e92\u52d5"},{"location":"feedback/distributed-systems-with-node.js/container/#container_2","text":"$ docker run -it ubuntu /bin/bash -i \u4ee3\u8868\u8981\u4ee5\u4e92\u52d5\u6a21\u5f0f\u9032\u5165 Container -t \u4ee3\u8868\u662f\u4ee5 TTY session \u9032\u5165\uff0c\u548c -i \u6574\u5408\u70ba -it \u4e26\u4f7f\u7528 bash \u9032\u5165\u5f8c\uff0c\u5373\u53ef\u900f\u904e ps -e \u8f38\u51fa\u6240\u6709 process\u3002 PID TTY TIME CMD 1 pts/0 00:00:00 bash 10 pts/0 00:00:00 ps bash \u4f5c\u70ba\u521d\u59cb\u884c\u70ba\uff0c\u5fc5\u9808\u5728 PID 1\u3002 \u7531\u6b64\u53ef\u770b\u51fa\uff0cContainer \u7684\u884c\u70ba\u76f8\u7576\u55ae\u7d14\uff0c\u4e0d\u50cf\u5be6\u969b\u4f7f\u7528\u7684\u96fb\u8166\uff0c\u6703\u6709\u5404\u7a2e\u670d\u52d9\u5728\u80cc\u666f\u904b\u4f5c\u3002","title":"\u9032\u5165 Container"},{"location":"feedback/distributed-systems-with-node.js/container/#container_3","text":"docker exec ubuntu /bin/ls /var","title":"\u5c0d Container \u5167\u90e8\u4e0b\u9054\u6307\u4ee4"},{"location":"feedback/distributed-systems-with-node.js/container/#container_4","text":"$ curl -o index.html http://example.org $ docker run --rm -p 8080 :80 \\ -v $PWD :/usr/share/nginx/html nginx -p \u5373\u70ba\u524d\u9762\u63d0\u5230\u7684 port-mappings -v \u5373\u70ba volume-mappings\uff08filesystem\uff09","title":"\u628a\u6a94\u6848\u4e1f\u9032 Container \u4e2d"},{"location":"feedback/distributed-systems-with-node.js/container/#alternative","text":"\u73fe\u5728\u5df2\u7d93\u8f03\u5c11\u5176\u4ed6\u7ba1\u7406 Container \u7684\u7522\u54c1\uff1a RedHat \u6709\u4e00\u500b\u5df2\u7d93 archive \u7684\u5c08\u6848 rkt Open Container Initiative \u5247\u5617\u8a66\u5236\u8a02 container \u6a19\u6e96\u3002","title":"Alternative"},{"location":"feedback/distributed-systems-with-node.js/container/#_5","text":"\u591a\u500b\u670d\u52d9\u8981\u600e\u9ebc\u900f\u904e Docker \u5efa\u7acb\uff1f\u6709\u5e7e\u500b\u65b9\u6cd5\uff1a docker run exmaple/server1 docker run exmaple/server2 \u591a\u6b21 docker run exmaple/server \u53bb\u5efa\u7acb\u4e0d\u540c\u7684\u61c9\u7528\u7a0b\u5f0f\u6703\u96e3\u7ba1\u7406\u4e14\u5bb9\u6613\u51fa\u932f\u3002 \u628a\u4e0d\u540c\u670d\u52d9\u5305\u88dd\u6210\u540c\u4e00\u500b Image \u6709\u6642\u76f8\u4f3c\u7684\u61c9\u7528\u7a0b\u5f0f\u53ef\u4ee5\u5305\u88dd\u6210\u540c\u4e00\u500b Image\uff0c\u5982\u4e0a\u4e00\u6b21\u5831\u544a\u63d0\u5230\u7684 ELK \uff0c\u4f46\u662f\u5206\u6563\u5f0f\u7cfb\u7d71\u4e0a\u4e0d\u540c\u7684\u61c9\u7528\u7a0b\u5f0f\u82e5\u5305\u88dd\u6210\u540c\u4e00\u500b Image \u6703\u8b93\u670d\u52d9\u7684\u7368\u7acb\u6027\u6d88\u5931\u3002 docker-compose \u4fbf\u662f\u7528\u4f86\u89e3\u6c7a\u9019\u4e00\u554f\u984c\u7684\u65b9\u6848\u3002 \u4ee5\u4e0a\u4e00\u4efd Tracing \u4e2d\u7684 Zipkin \u70ba\u4f8b\uff1a graph LR 0[Client] 1[Zipkin] subgraph APP 2[web-api] 3[recipe-api] end 0 --> 2 2 --> 3 3 --> 2 2 -- info --> 1 3 -- info --> 1 \u5c31\u53ef\u4ee5\u4f9d\u6b64\u5efa\u7acb docker-compose.yaml\uff1a version : \"3.7\" services : zipkin : image : openzipkin/zipkin-slim:2.19 ports : - 9411:9411 recipe-api : build : context : ./recipe-api dockerfile : Dockerfile-zipkin ports : - 4000:4000 environment : ZIPKIN : zipkin:9411 depends_on : - zipkin web-api : build : context : ./web-api dockerfile : Dockerfile-zipkin ports : - 3000:3000 environment : TARGET : recipe-api:4000 ZIPKIN : zipkin:9411 depends_on : - zipkin - recipe-api","title":"\u5206\u6563\u5f0f\u7cfb\u7d71\u4e0a\u7684\u61c9\u7528"},{"location":"feedback/distributed-systems-with-node.js/container/#docker-registry","text":"Docker Hub \u63d0\u4f9b\u5b58\u653e Image \u7a7a\u9593\uff0c\u4f46\u5c0d\u65bc\u79c1\u4eba\u7a7a\u9593\u7684\u5b58\u653e\u6578\u91cf\u6709\u9650\u5236\u3002 \u53ef\u4ee5\u6839\u64da\u9810\u7b97\uff0c\u8003\u616e\u5176\u4ed6 Docker Registry\uff0c\u4f8b\u5982\uff1a JFrog Artifactory Cloud based","title":"Docker Registry"},{"location":"feedback/distributed-systems-with-node.js/container/#_6","text":"\u9019\u6b21\u5206\u4eab\u7701\u7565 \u4e0a\u50b3 Image \u5230 Docker Registry \u81ea\u88fd Docker Registry UI","title":"\u8a3b"},{"location":"feedback/distributed-systems-with-node.js/introduction/","text":"\u8b80\u66f8\u5fc3\u5f97\uff1aDistributed Systems with Node.js \u53c3\u8003\u66f8\u7c4d \u4f7f\u7528 Repo Distributed-Systems-with-Node.js evan361425/distributed-node \u8aaa\u660e \u50b3\u7d71\u4e0a\uff0c\u61c9\u7528\u7a0b\u5f0f\u7686\u70ba\u540c\u4e00\u5305\u7a0b\u5f0f\u78bc\u4e2d\uff0c\u9019\u6642\u6703\u9020\u6210\u4ec0\u9ebc\u554f\u984c\uff1f \u4fee\u6539\u7a0b\u5f0f\u78bc\u6642\uff0c\u53ef\u80fd\u7121\u610f\u9593\u7834\u58de\u6389\u5176\u4e2d\u5404\u500b\u95dc\u4fc2\u7684\u5354\u4f5c\uff0cDebug \u4ee3\u50f9\u5f88\u9ad8 \u6bcf\u6b21\u4ea4\u4ed8\u3001\u90e8\u7f72\u90fd\u6703\u82b1\u5f88\u9577\u6642\u9593 \u65b0\u9032\u54e1\u5de5\uff0c\u6216\u60f3\u9032\u5165\u9019\u500b\u5c08\u6848\u7684\u9580\u6abb\uff08\u7406\u89e3\u5c08\u6848\u7684\u6642\u9593\uff09\u63d0\u9ad8 \u6574\u9ad4\u4f86\u8aaa\uff0c\u9019\u6a23\u7684\u505a\u6cd5\u6210\u672c\u592a\u9ad8\u4e86\u3002 \u5206\u6563\u5f0f\u7cfb\u7d71\uff0c\u5373\u662f\u628a\u4e00\u500b\u5927\u578b\u61c9\u7528\u7a0b\u5f0f\uff0c\u62c6\u6210\u5e7e\u500b\u5c0f\u7684\u670d\u52d9\u3002 \u9019\u6642\u4ecd\u6703\u9047\u5230\u50b3\u7d71\u505a\u6cd5\u4e0d\u6703\u9047\u5230\u7684\u554f\u984c\uff1a \u98a8\u96aa\u63d0\u9ad8\uff0c\u56e0\u670d\u52d9\u5f7c\u6b64\u4e4b\u9593\u6709\u9023\u7d50\uff0c\u82e5 A \u670d\u52d9\u58de\u4e86\uff0cB \u670d\u52d9\u4e5f\u6703\u58de\u6389\u3002\u591a\u4e00\u53f0\u6a5f\u5668\uff0c\u5c31\u591a\u4e00\u4efd\u6a5f\u5668\u58de\u6389\u7684\u98a8\u96aa \u589e\u52a0\u6e9d\u901a\u9700\u8981\u7684\u6642\u9593\u3001\u98a8\u96aa\u548c\u6d41\u91cf \u672c\u4f86\u540c\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\uff0c\u53ef\u4ee5\u5171\u7528\u4e00\u4efd\u8a2d\u5b9a\u6a94\u3001\u7a0b\u5f0f\u78bc\u548c\u6a5f\u654f\u8cc7\u6599\uff0c\u82e5\u670d\u52d9\u8b8a\u591a\u4e86\uff0c\u8a72\u600e\u9ebc\u540c\u6b65\u9019\u4e9b\u5171\u7528\u7684\u6a94\u6848 \u8981\u600e\u9ebc\u77e5\u9053\u7279\u5b9a Request \u70ba\u4ec0\u9ebc\u6703\u56de 500\uff0c\u54ea\u53f0\u58de\u4e86\uff1f \u9650\u5236\u7279\u5b9a\u670d\u52d9\u50c5\u80fd\u5728\u670d\u52d9\u9593\u6e9d\u901a\uff0c\u800c\u4e0d\u80fd\u5c0d\u5916\uff08VPC\uff09 \u4e4b\u5f8c\u6703\u4f7f\u7528\u7684\u7bc4\u4f8b\u67b6\u69cb\u82e5\u7121\u8aaa\u660e\u5247\u70ba\uff1a \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Application \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502web-api\u25c4\u2500\u2500\u25barecipe-api\u25c4\u2500\u2500\u253c\u2500\u2500\u25baUser\u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u8b1b\u89e3\u9806\u5e8f\uff1a \uff08\u5f8c\u9762\u7684\u300c\u554f\u984c x\u300d\u4ee3\u8868\u5617\u8a66\u89e3\u6c7a\u7684\u554f\u984c\uff09 Protocol - \u4e0d\u540c\u7684\u670d\u52d9\u9593\uff0c\u8a72\u7528\u4ec0\u9ebc\u65b9\u5f0f\u6e9d\u901a\uff0c\u554f\u984c 2 SLA and Load Testing - \u5982\u4f55\u8b49\u660e\u6548\u7387\u5728\u63a5\u53d7\u7bc4\u570d\u5167\uff0c\u554f\u984c 2 Observability - Log\u3001Metric \u548c Tracing\uff0c\u554f\u984c 4 Container - \u670d\u52d9\u8b8a\u591a\u4e86\uff0c\u90e8\u7f72\u4e0a\u8a72\u4f7f\u7528\u4ec0\u9ebc\u65b9\u5f0f\uff0c\u554f\u984c 1 Container Orchestration and Misc. - \u5bb9\u5668\u8abf\u5ea6\u5de5\u5177\uff0c\u554f\u984c 1~5","title":"\u7c21\u4ecb"},{"location":"feedback/distributed-systems-with-node.js/introduction/#distributed-systems-with-nodejs","text":"\u53c3\u8003\u66f8\u7c4d \u4f7f\u7528 Repo Distributed-Systems-with-Node.js evan361425/distributed-node","title":"\u8b80\u66f8\u5fc3\u5f97\uff1aDistributed Systems with Node.js"},{"location":"feedback/distributed-systems-with-node.js/introduction/#_1","text":"\u50b3\u7d71\u4e0a\uff0c\u61c9\u7528\u7a0b\u5f0f\u7686\u70ba\u540c\u4e00\u5305\u7a0b\u5f0f\u78bc\u4e2d\uff0c\u9019\u6642\u6703\u9020\u6210\u4ec0\u9ebc\u554f\u984c\uff1f \u4fee\u6539\u7a0b\u5f0f\u78bc\u6642\uff0c\u53ef\u80fd\u7121\u610f\u9593\u7834\u58de\u6389\u5176\u4e2d\u5404\u500b\u95dc\u4fc2\u7684\u5354\u4f5c\uff0cDebug \u4ee3\u50f9\u5f88\u9ad8 \u6bcf\u6b21\u4ea4\u4ed8\u3001\u90e8\u7f72\u90fd\u6703\u82b1\u5f88\u9577\u6642\u9593 \u65b0\u9032\u54e1\u5de5\uff0c\u6216\u60f3\u9032\u5165\u9019\u500b\u5c08\u6848\u7684\u9580\u6abb\uff08\u7406\u89e3\u5c08\u6848\u7684\u6642\u9593\uff09\u63d0\u9ad8 \u6574\u9ad4\u4f86\u8aaa\uff0c\u9019\u6a23\u7684\u505a\u6cd5\u6210\u672c\u592a\u9ad8\u4e86\u3002 \u5206\u6563\u5f0f\u7cfb\u7d71\uff0c\u5373\u662f\u628a\u4e00\u500b\u5927\u578b\u61c9\u7528\u7a0b\u5f0f\uff0c\u62c6\u6210\u5e7e\u500b\u5c0f\u7684\u670d\u52d9\u3002 \u9019\u6642\u4ecd\u6703\u9047\u5230\u50b3\u7d71\u505a\u6cd5\u4e0d\u6703\u9047\u5230\u7684\u554f\u984c\uff1a \u98a8\u96aa\u63d0\u9ad8\uff0c\u56e0\u670d\u52d9\u5f7c\u6b64\u4e4b\u9593\u6709\u9023\u7d50\uff0c\u82e5 A \u670d\u52d9\u58de\u4e86\uff0cB \u670d\u52d9\u4e5f\u6703\u58de\u6389\u3002\u591a\u4e00\u53f0\u6a5f\u5668\uff0c\u5c31\u591a\u4e00\u4efd\u6a5f\u5668\u58de\u6389\u7684\u98a8\u96aa \u589e\u52a0\u6e9d\u901a\u9700\u8981\u7684\u6642\u9593\u3001\u98a8\u96aa\u548c\u6d41\u91cf \u672c\u4f86\u540c\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\uff0c\u53ef\u4ee5\u5171\u7528\u4e00\u4efd\u8a2d\u5b9a\u6a94\u3001\u7a0b\u5f0f\u78bc\u548c\u6a5f\u654f\u8cc7\u6599\uff0c\u82e5\u670d\u52d9\u8b8a\u591a\u4e86\uff0c\u8a72\u600e\u9ebc\u540c\u6b65\u9019\u4e9b\u5171\u7528\u7684\u6a94\u6848 \u8981\u600e\u9ebc\u77e5\u9053\u7279\u5b9a Request \u70ba\u4ec0\u9ebc\u6703\u56de 500\uff0c\u54ea\u53f0\u58de\u4e86\uff1f \u9650\u5236\u7279\u5b9a\u670d\u52d9\u50c5\u80fd\u5728\u670d\u52d9\u9593\u6e9d\u901a\uff0c\u800c\u4e0d\u80fd\u5c0d\u5916\uff08VPC\uff09 \u4e4b\u5f8c\u6703\u4f7f\u7528\u7684\u7bc4\u4f8b\u67b6\u69cb\u82e5\u7121\u8aaa\u660e\u5247\u70ba\uff1a \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Application \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502web-api\u25c4\u2500\u2500\u25barecipe-api\u25c4\u2500\u2500\u253c\u2500\u2500\u25baUser\u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u8b1b\u89e3\u9806\u5e8f\uff1a \uff08\u5f8c\u9762\u7684\u300c\u554f\u984c x\u300d\u4ee3\u8868\u5617\u8a66\u89e3\u6c7a\u7684\u554f\u984c\uff09 Protocol - \u4e0d\u540c\u7684\u670d\u52d9\u9593\uff0c\u8a72\u7528\u4ec0\u9ebc\u65b9\u5f0f\u6e9d\u901a\uff0c\u554f\u984c 2 SLA and Load Testing - \u5982\u4f55\u8b49\u660e\u6548\u7387\u5728\u63a5\u53d7\u7bc4\u570d\u5167\uff0c\u554f\u984c 2 Observability - Log\u3001Metric \u548c Tracing\uff0c\u554f\u984c 4 Container - \u670d\u52d9\u8b8a\u591a\u4e86\uff0c\u90e8\u7f72\u4e0a\u8a72\u4f7f\u7528\u4ec0\u9ebc\u65b9\u5f0f\uff0c\u554f\u984c 1 Container Orchestration and Misc. - \u5bb9\u5668\u8abf\u5ea6\u5de5\u5177\uff0c\u554f\u984c 1~5","title":"\u8aaa\u660e"},{"location":"feedback/distributed-systems-with-node.js/observability/","text":"Observability \u8aaa\u660e \u61c9\u7528\u7a0b\u5f0f\u662f\u9700\u8981\u7dad\u904b\u7684\uff0c\u5206\u6563\u5f0f\u7cfb\u7d71\u7684\u7dad\u904b\u548c\u50b3\u7d71\u4e0a\u6709\u4ec0\u9ebc\u5dee\u7570\u5462\uff1f \u672c\u7ae0\u6703\u4f9d\u5e8f\u4ecb\u7d39 Log\u3001Tracing\u3001Metric\u3001Alert \u548c Health Check\u3002 Log \u5728\u672c\u5730\u7aef\u6e2c\u8a66\u6642\uff0c\u6642\u5e38\u7528 console.log \u6216 print \u9019\u985e\u51fd\u793a\u4f86\u78ba\u8a8d\u8acb\u6c42\u5728\u57f7\u884c\u904e\u7a0b\u4e2d\u6c92\u6709\u767c\u751f\u4ec0\u9ebc\u610f\u6599\u4e4b\u5916\u7684\u4e8b\u3002 \u82e5\u5728\u7dda\u4e0a\u90e8\u7f72\u5f8c\uff0c\u6211\u8981\u600e\u9ebc\u5f9e\u9060\u5728\u4ed6\u65b9\u7684 server \u4e2d\u53d6\u5f97\u76f8\u95dc\u8a0a\u606f\uff1f \u4e0b\u9762\u6703\u4ecb\u7d39 ELK \uff08 Elasticsearch , Logstash , and Kibana \uff09\u600e\u9ebc\u8b93\u4f60\u62ff\u5230 server \u7684 log \u8cc7\u8a0a\u3002 Tracing \u82e5\u4e00\u500b\u8acb\u6c42\u6b77\u7a0b\u6703\u7d93\u904e\u591a\u9805\u670d\u52d9\uff0c\u6211\u8981\u600e\u9ebc\u5340\u5206\u4e0d\u540c\u7684\u8acb\u6c42\uff1f \u4f8b\u5982\uff1a\u767c\u73fe A \u670d\u52d9\u5728\u548c B \u670d\u52d9\u8acb\u6c42\u8cc7\u6599\u6642\uff0c\u5f97\u5230\u932f\u8aa4\u8cc7\u6599\u3002 \u65bc\u662f\u63a5\u8457\u67e5\u770b B \u670d\u52d9\u7684 log\uff0c\u7136\u800c\u540c\u4e00\u6642\u9593\u537b\u6709\u5f88\u591a\u8acb\u6c42\uff0c\u832b\u832b\u5927\u6d77\u5982\u4f55\u5c0b\uff1f \u6b64\u6642\u5c31\u53ef\u4ee5\u4f7f\u7528 Tracing \u7684\u6a5f\u5236\uff0c\u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528 Zipkin \u3002 \u250c\u2500\u2500\u2500\u2500\u2510 Request\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 Request\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502user\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25baweb-api\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25barecipe-api\u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 request ID \u4ee3\u8868\u5404\u500b\u8acb\u6c42\u7684 ID\uff0c\u5fc5\u9808\u662f\u4e0d\u80fd\u91cd\u8907\u7684\u5b57\u4e32\u3002 Metric \u9664\u4e86\u91dd\u5c0d\u55ae\u4e00\u8acb\u6c42\u7684\u6d41\u7a0b\u6aa2\u95b1\uff0c\u82e5\u6211\u8981\u505a\u7d71\u8a08\u5462\uff1f \u4f8b\u5982\uff1a\u6a5f\u5668\u7684 CPU \u4f7f\u7528\u7387\u3001\u56de\u61c9 4xx/5xx \u7684\u6bd4\u7387\u3001API \u4f7f\u7528\u5206\u4f48 \u9019\u4e00\u985e\u9700\u8981\u7d2f\u7a4d\u7684\u8cc7\u6599\uff0c\u6211\u5011\u4fbf\u7a31\u5176\u70ba Metric\uff0c\u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528 Graphite \uff0c StatsD \u548c Grafana \u3002 Alert \u6709\u4e86 Metric\uff0c\u6211\u5011\u4fbf\u53ef\u4ee5\u8a2d\u5b9a\u4e9b\u95a5\u503c\uff0c\u4f86\u901a\u77e5\u958b\u767c\u4eba\u54e1\u4ee5\u53ca\u65e9\u5f97\u77e5\u670d\u52d9\u7684\u72c0\u614b\u3002 \u4f8b\u5982 5xx \u6bd4\u7387\u8d85\u904e 3% \u6642\uff0c\u63d0\u51fa\u8b66\u544a\u901a\u77e5 \u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528 Grafana \u3002 Health Check \u82e5\u670d\u52d9\u7684\u4f9d\u8cf4\uff08\u4f8b\u5982 DB\uff09\u9023\u7dda\u65b7\u6389\u6216\u751a\u81f3\u670d\u52d9\u672c\u8eab\u65b7\u7dda\u6642\uff0c\u6211\u5011\u80fd\u5426\u53ca\u65e9\u77e5\u9053\uff1f\u540c\u6642\u81ea\u52d5\u91cd\u65b0\u5efa\u7acb\u9023\u7dda\uff0c\u6216\u751a\u81f3\u91cd\u65b0\u555f\u52d5\u8a72\u670d\u52d9\u3002 \u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528 HAProxy \u6bd4\u8f03 \u7a2e\u985e \u591a\u670d\u52d9\u624d\u6709\u610f\u7fa9 \u529f\u80fd \u6240\u5c6c\uff08\u6982\u7565\uff09 Log X Debug Dev Tracing O Debug Dev-Ops Metric X \u7d71\u8a08 Ops Alert X \u5206\u6790 Dev-Ops SE \u5be6\u4f5c \u63a5\u4e0b\u4f86\u9032\u5165\u4e00\u7cfb\u5217\u5be6\u4f5c\u3002 Log ELK \u662f Elastic \u958b\u767c\u7684\u958b\u6e90\u7522\u54c1\uff0c\u5176\u958b\u767c\u7684\u4e0d\u50c5\u50c5\u662f ELK \u9019\u4e09\u9805\u7522\u54c1\u3002 \u672c\u7bc4\u4f8b\u50c5\u6703\u8a0e\u8ad6 ELK \u4ee3\u8868\u7684 Elasticsearch\u3001Logstash\u3001Kibana \u9019\u4e09\u500b\uff0c\u5176\u4e2d\u5404\u7522\u54c1\u5b9a\u4f4d\u548c\u529f\u80fd\u5982\u4e0b\u3002 Elasticsearch \u4e00\u7a2e\u8cc7\u6599\u5eab\uff0c\u4e26\u5c0d\u5916\u63d0\u4f9b API\uff0c\u6703\u9ad8\u6548\u7684\u641c\u5c0b\u76f8\u95dc\u8cc7\u8a0a\u3002\u4e26\u4e14\u6709\u5176\u6a19\u6e96\u7684 query \u8a9e\u6cd5\u3002 Elasticsearch is fast. Really, really fast. Elasticsearch \u64c1\u6709\u5f88\u591a\u529f\u80fd\uff0c\u672c\u6b21\u50c5\u6703\u793a\u7bc4\u5e7e\u7a2e\uff0c\u82e5\u9700\u8981\u66f4\u591a\u8cc7\u8a0a\uff0c \u8a73\u898b \u3002 Logstash Elasticsearch \u662f\u4e00\u7a2e\u8cc7\u6599\u5eab\uff0c\u4f46\u662f\u5132\u5b58\u7684\u8cc7\u6599\u9700\u8981\u6709\u4eba\u7d66\u4ed6\uff0c\u9019\u4fbf\u662f Logstash \u7684\u529f\u80fd\u3002\u8ca0\u8cac\u628a\u6536\u5230\u7684\u8cc7\u6599\u6574\u5408\u9001\u7d66 Elasticsearch\u3002 \u9001\u4ec0\u9ebc\u8cc7\u6599\u662f\u7531\u61c9\u7528\u7a0b\u5f0f\u65b9\u6c7a\u5b9a\u7684\uff0c\u53ef\u4ee5\u662f log file\u3001HTTP \u7b49\u3002 \u672c\u7bc4\u4f8b\u662f\u900f\u904e HTTP on UDP \u4f86\u50b3\u9001\u3002 Kibana Elasticsearch \u662f\u4e00\u7a2e\u8cc7\u6599\u5eab\uff0c\u4f46\u662f\u4e26\u672a\u63d0\u4f9b UI \u4ecb\u9762\uff0c\u9019\u6642 Kibana \u5c31\u662f\u628a API \u8f49\u6210\u53ef\u8b93\u4eba\u900f\u904e\u7db2\u9801\u7684\u65b9\u5f0f\u4f86\u64cd\u4f5c\u3002 \u67b6\u69cb\u5716 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 ELK \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 Browser \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba Kibana \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502Elasticsearch\u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 UDP \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 APP \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba Logstash \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u7bc4\u4f8b\u7a0b\u5f0f\u78bc web-api \u5c0d\u4f7f\u7528\u4f86\u8aaa\uff0c\u4e0d\u9700\u8981\u53bb\u8003\u616e\u50b3\u9001\u5230 Logstash \u7684\u908f\u8f2f logger . info ( { path : req . url , method : req . method , ip : req . ip , ua : req . headers [ \"user-agent\" ] || null , }, \"request-incoming\" ); \u7121\u8ad6\u7528\u4ec0\u9ebc\u683c\u5f0f\u64b0\u5beb log\uff0c\u7d71\u4e00\u5c31\u597d\u3002 \u521d\u59cb\u5316 logger const client = dgram . createSocket ( \"udp4\" ); const stream = { write : ( msg : string ) => { client . send ( msg , LS_PORT , LS_HOST ); }, }; const logger = pino ({ level : \"trace\" }, stream ); Alternative Datadog Sumo Logic Splunk Cloud (AWS, GCP, ELK) Metrics \u5176\u67b6\u69cb\u6703\u548c Log \u5f88\u50cf\uff0cElasticsearch \u4e5f\u5305\u542b\u9019\u985e\u7684 query \u8a9e\u6cd5\u3002 \u5176\u91cd\u9ede\u5dee\u7570\u4fbf\u662f\u5728 log \u8655\u7406\u5c0d\u8c61\u70ba\u55ae\u4e00\u8acb\u6c42\uff0c\u800c metrics \u8655\u7406\u7684\u662f\u670d\u52d9\u5728\u7d2f\u7a4d\u6d41\u91cf\u6216\u6642\u9593\u5f8c\u7684\u72c0\u614b\uff0c\u5982 \u4e0a \u6240\u8ff0\u3002 \u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528\u7684\u662f Grafana \u3001 Graphite \u548c StatsD \u3002 \u67b6\u69cb \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Metrics \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 Browser \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba Grafana \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 Graphite \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 UDP \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 Service \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba StatDs \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 graph LR 0[Browser] 1[Service] subgraph Metrics 2[Grafana] 3[Graphite] 4[StatsD] end 0 --> 2 2 --> 3 3 --> 2 1 -- UDP -->4 4 --> 3 \u548c log \u975e\u5e38\u76f8\u4f3c\uff0c\u9019\u88e1\u5c31\u4e0d\u8d05\u8ff0\u5176\u610f\u7fa9\u3002 \u7a0b\u5f0f\u78bc web-api \u521d\u59cb\u5316 client const client = new StatsDClient ({ host : \"localhost\" , port : 8125 , prefix : \"web-api\" , }); \u7d71\u8a08\u8acb\u6c42\u6642\u9593\u548c\u6b21\u6578 const begin = new Date (); await got ( `http:// ${ TARGET } /recipes/42` ); client . timing ( \"outbound.recipe-api.request-time\" , begin ); client . increment ( \"outbound.recipe-api.request-count\" ); \u7d71\u8a08\u7cfb\u7d71\u8cc7\u6e90 setInterval (() => { client . gauge ( \"server.conn\" , server . connections ); const m = process . memoryUsage (); client . gauge ( \"server.memory.used\" , m . heapUsed ); client . gauge ( \"server.memory.total\" , m . heapTotal ); const h = v8 . getHeapStatistics (); client . gauge ( \"server.heap.size\" , h . used_heap_size ); client . gauge ( \"server.heap.limit\" , h . heap_size_limit ); // try to mock memory heap fs . readdir ( __dirname , ( err , list ) => { if ( err ) return ; client . gauge ( \"server.descriptors\" , list . length ); }); }, 10 _000 ); \u7bc4\u4f8b\u4e2d\uff0c\u628a\u8a18\u61b6\u9ad4\u7b49\u76f8\u95dc\u8cc7\u8a0a\u653e\u5728\u61c9\u7528\u7a0b\u5f0f\u4e2d\u3002 \u5be6\u969b\u4e0a\uff0c\u70ba\u4e86\u907f\u514d\u61c9\u7528\u7a0b\u5f0f\u65b7\u7dda\uff0c\u5c0e\u81f4\u6536\u96c6\u4e0d\u5230\u670d\u52d9\u7684\u8cc7\u8a0a\uff0c\u9019\u985e\u7684\u8cc7\u6599\u6536\u96c6\u61c9\u5728\u670d\u52d9\u5916\u4f7f\u7528\u3002 Alternative Graphite -> Prometheus, InfluxDB StatsD -> cAdvisor, MetricBeat Tracing \u5728\u5206\u6563\u5f0f\u7cfb\u7d71\u4e2d\uff0c\u591a\u500b\u670d\u52d9\u9593\u7684\u6e9d\u901a\u6216\u8acb\u6c42\u90fd\u53ef\u80fd\u5728\u904e\u7a0b\u4e2d\u5f97\u5230\u975e\u9810\u671f\u7684\u7d50\u679c\uff0c\u70ba\u4e86\u80fd\u5feb\u901f\u627e\u5230\u554f\u984c\u9ede\uff0c\u9700\u8981\u8fa8\u5225\u540c\u4e00\u652f\u8acb\u6c42\u5728\u5404\u500b\u670d\u52d9\u4e2d\u7684\u4f4d\u7f6e\u3002 \u900f\u904e\u5efa\u7acb request ID \u4f86\u8fa8\u5225\u540c\u4e00\u652f\u8acb\u6c42\u5728\u591a\u500b\u670d\u52d9\u4e2d\u7684\u4f4d\u7f6e\u3002 \u67b6\u69cb \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 APP \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 info \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Client \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u25ba web-api \u251c\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u25b2\u2500\u2500\u2500\u2500\u252c\u2500\u2518 \u2502 \u2502 \u2502 Response \u2502 \u2502Request ID \u2502 Zipkin \u2502 \u2502 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 recipe-api \u251c\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 info \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u7522\u51fa\u7bc4\u4f8b\uff1a gantt dateFormat m:s axisFormat %S todayMarker off title Request 1 task1 :des1, 10:1, 5s fetch :des2, 10:7, 10s recipe :des4, 10:8, 8s task2 :des3, 10:18, 3s web-api \u6703\u50b3\u9001 task1 \u3001 fetch \u548c task2 recipe-api \u6703\u50b3\u9001 recipe \u7a0b\u5f0f\u78bc web-api const tracer = new Tracer ({ ctxImpl , recorder , localServiceName : \"web-api\" , sampler : new sampler . CountingSampler ( 1 ), }); \u7d00\u9304\u8acb\u6c42\u958b\u59cb\u6642\u548c\u7d50\u675f\u6642 app . use ( expressMiddleware ({ tracer })); \u7d00\u9304\u9700\u8981\u57f7\u884c 100ms \u7684\u4efb\u52d9 await tracer . local < Promise < void >> ( 'do_some_task' , () => new Promise (( resolve ) => setTimeout ( resolve , 100 )), ); \u4f7f\u7528\u5305\u88dd\u5f8c\u7684 got \u4f86\u53bb\u8acb\u6c42\uff0c\u5728\u4f7f\u7528\u6642\u4e0d\u9700\u8981\u8003\u616e\u5176 tracing \u908f\u8f2f\u3002 await instance ( `http:// ${ TARGET } /recipes/42` ). json (); const instance = got . extend ({ hooks : { init : [( opts ) => ( opts . _zipkin . parentId = tracer . id )], beforeRequest : [ ( opts ) => { // ... }, ], afterResponse : [ ( res ) => { // ... }, ], beforeError : [ ( err ) => { // ... return err ; }, ], }, }); recipe-api Alert Demo in production Health Check \u9019\u5927\u90e8\u5206\u6703\u548c Alert \u4e00\u8d77\u5be6\u4f5c\uff0c\u76ee\u7684\u662f\u6301\u7e8c\u6253\u7279\u5b9a route \u53bb\u5f97\u77e5\u670d\u52d9\u73fe\u6709\u72c0\u6cc1\u3002 \u4f46\u73fe\u6709\u72c0\u6cc1\u6703\u6709\u4e9b\u6a21\u7cca\u5730\u5e36\uff0c\u4f8b\u5982\uff1a \u6709\u7522\u54c1\u4f7f\u7528 cache \u53bb\u9054\u5230 SLA\u3002\u7576 cache \u5931\u53bb\u904b\u4f5c\uff0c\u5c0d\u61c9\u7528\u7a0b\u5f0f\u4f86\u8aaa\u4ecd\u80fd\u904b\u884c\u3002\u4f46\u6574\u9ad4\u6548\u7387\u6703\u964d\u4f4e\uff0c\u9032\u800c\u63d0\u9ad8 Latency\uff0c\u9019\u6642\u670d\u52d9\u7684\u72c0\u614b\u7b97\u662f\u5065\u5eb7\u9084\u662f\u4e0d\u5065\u5eb7\uff1f \u9019\u7a2e\u6a21\u7cca\u5730\u5e36\u88ab\u7a31\u4f5c degraded \uff0c\u81f3\u65bc\u8a72\u600e\u9ebc\u8655\u7406\uff0c\u5c31\u548c\u5546\u52d9\u908f\u8f2f\u7684\u5be6\u4f5c\u6709\u95dc\u4e86\u3002 \u7bc4\u4f8b \u7bc4\u4f8b\u4e2d\uff0c\u6703\u7528 r-proxy \u505a health check \u4e14\u61c9\u7528\u7a0b\u5f0f\u7d81\u5728\u4e00\u8d77\u3002 \u4f46\u5be6\u4f5c\u4e0a\uff0c\u4ecd\u5efa\u8b70\u8b93\u61c9\u7528\u7a0b\u5f0f\u5916\u7684\u7522\u54c1\u6216\u751a\u81f3\u5916\u55ae\u4f4d\u7684\u7522\u54c1\u53bb\u505a health check\u3002 \u4f8b\u5982\uff1a PagerDuty \u3001 Nagios \u3001 Pingdom \u3002 \u9664\u4e86 r-proxy\uff0c\u5c08\u505a health check \u7684\u958b\u6e90\u8edf\u9ad4\u6709\uff1a Cabot \u3002 HAProxy \u7684\u8a2d\u5b9a\u9ee8 # ... backend web-api option httpchk GET /health server web-api-1 localhost:3001 check server web-api-2 localhost:3002 check web-api app . get ( \"/health\" , ( _req , res ) => { return res . send ( \"OK\" ); });","title":"Observability"},{"location":"feedback/distributed-systems-with-node.js/observability/#observability","text":"","title":"Observability"},{"location":"feedback/distributed-systems-with-node.js/observability/#_1","text":"\u61c9\u7528\u7a0b\u5f0f\u662f\u9700\u8981\u7dad\u904b\u7684\uff0c\u5206\u6563\u5f0f\u7cfb\u7d71\u7684\u7dad\u904b\u548c\u50b3\u7d71\u4e0a\u6709\u4ec0\u9ebc\u5dee\u7570\u5462\uff1f \u672c\u7ae0\u6703\u4f9d\u5e8f\u4ecb\u7d39 Log\u3001Tracing\u3001Metric\u3001Alert \u548c Health Check\u3002","title":"\u8aaa\u660e"},{"location":"feedback/distributed-systems-with-node.js/observability/#log","text":"\u5728\u672c\u5730\u7aef\u6e2c\u8a66\u6642\uff0c\u6642\u5e38\u7528 console.log \u6216 print \u9019\u985e\u51fd\u793a\u4f86\u78ba\u8a8d\u8acb\u6c42\u5728\u57f7\u884c\u904e\u7a0b\u4e2d\u6c92\u6709\u767c\u751f\u4ec0\u9ebc\u610f\u6599\u4e4b\u5916\u7684\u4e8b\u3002 \u82e5\u5728\u7dda\u4e0a\u90e8\u7f72\u5f8c\uff0c\u6211\u8981\u600e\u9ebc\u5f9e\u9060\u5728\u4ed6\u65b9\u7684 server \u4e2d\u53d6\u5f97\u76f8\u95dc\u8a0a\u606f\uff1f \u4e0b\u9762\u6703\u4ecb\u7d39 ELK \uff08 Elasticsearch , Logstash , and Kibana \uff09\u600e\u9ebc\u8b93\u4f60\u62ff\u5230 server \u7684 log \u8cc7\u8a0a\u3002","title":"Log"},{"location":"feedback/distributed-systems-with-node.js/observability/#tracing","text":"\u82e5\u4e00\u500b\u8acb\u6c42\u6b77\u7a0b\u6703\u7d93\u904e\u591a\u9805\u670d\u52d9\uff0c\u6211\u8981\u600e\u9ebc\u5340\u5206\u4e0d\u540c\u7684\u8acb\u6c42\uff1f \u4f8b\u5982\uff1a\u767c\u73fe A \u670d\u52d9\u5728\u548c B \u670d\u52d9\u8acb\u6c42\u8cc7\u6599\u6642\uff0c\u5f97\u5230\u932f\u8aa4\u8cc7\u6599\u3002 \u65bc\u662f\u63a5\u8457\u67e5\u770b B \u670d\u52d9\u7684 log\uff0c\u7136\u800c\u540c\u4e00\u6642\u9593\u537b\u6709\u5f88\u591a\u8acb\u6c42\uff0c\u832b\u832b\u5927\u6d77\u5982\u4f55\u5c0b\uff1f \u6b64\u6642\u5c31\u53ef\u4ee5\u4f7f\u7528 Tracing \u7684\u6a5f\u5236\uff0c\u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528 Zipkin \u3002 \u250c\u2500\u2500\u2500\u2500\u2510 Request\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 Request\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502user\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25baweb-api\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25barecipe-api\u2502 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 request ID \u4ee3\u8868\u5404\u500b\u8acb\u6c42\u7684 ID\uff0c\u5fc5\u9808\u662f\u4e0d\u80fd\u91cd\u8907\u7684\u5b57\u4e32\u3002","title":"Tracing"},{"location":"feedback/distributed-systems-with-node.js/observability/#metric","text":"\u9664\u4e86\u91dd\u5c0d\u55ae\u4e00\u8acb\u6c42\u7684\u6d41\u7a0b\u6aa2\u95b1\uff0c\u82e5\u6211\u8981\u505a\u7d71\u8a08\u5462\uff1f \u4f8b\u5982\uff1a\u6a5f\u5668\u7684 CPU \u4f7f\u7528\u7387\u3001\u56de\u61c9 4xx/5xx \u7684\u6bd4\u7387\u3001API \u4f7f\u7528\u5206\u4f48 \u9019\u4e00\u985e\u9700\u8981\u7d2f\u7a4d\u7684\u8cc7\u6599\uff0c\u6211\u5011\u4fbf\u7a31\u5176\u70ba Metric\uff0c\u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528 Graphite \uff0c StatsD \u548c Grafana \u3002","title":"Metric"},{"location":"feedback/distributed-systems-with-node.js/observability/#alert","text":"\u6709\u4e86 Metric\uff0c\u6211\u5011\u4fbf\u53ef\u4ee5\u8a2d\u5b9a\u4e9b\u95a5\u503c\uff0c\u4f86\u901a\u77e5\u958b\u767c\u4eba\u54e1\u4ee5\u53ca\u65e9\u5f97\u77e5\u670d\u52d9\u7684\u72c0\u614b\u3002 \u4f8b\u5982 5xx \u6bd4\u7387\u8d85\u904e 3% \u6642\uff0c\u63d0\u51fa\u8b66\u544a\u901a\u77e5 \u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528 Grafana \u3002","title":"Alert"},{"location":"feedback/distributed-systems-with-node.js/observability/#health-check","text":"\u82e5\u670d\u52d9\u7684\u4f9d\u8cf4\uff08\u4f8b\u5982 DB\uff09\u9023\u7dda\u65b7\u6389\u6216\u751a\u81f3\u670d\u52d9\u672c\u8eab\u65b7\u7dda\u6642\uff0c\u6211\u5011\u80fd\u5426\u53ca\u65e9\u77e5\u9053\uff1f\u540c\u6642\u81ea\u52d5\u91cd\u65b0\u5efa\u7acb\u9023\u7dda\uff0c\u6216\u751a\u81f3\u91cd\u65b0\u555f\u52d5\u8a72\u670d\u52d9\u3002 \u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528 HAProxy","title":"Health Check"},{"location":"feedback/distributed-systems-with-node.js/observability/#_2","text":"\u7a2e\u985e \u591a\u670d\u52d9\u624d\u6709\u610f\u7fa9 \u529f\u80fd \u6240\u5c6c\uff08\u6982\u7565\uff09 Log X Debug Dev Tracing O Debug Dev-Ops Metric X \u7d71\u8a08 Ops Alert X \u5206\u6790 Dev-Ops SE","title":"\u6bd4\u8f03"},{"location":"feedback/distributed-systems-with-node.js/observability/#_3","text":"\u63a5\u4e0b\u4f86\u9032\u5165\u4e00\u7cfb\u5217\u5be6\u4f5c\u3002","title":"\u5be6\u4f5c"},{"location":"feedback/distributed-systems-with-node.js/observability/#log_1","text":"ELK \u662f Elastic \u958b\u767c\u7684\u958b\u6e90\u7522\u54c1\uff0c\u5176\u958b\u767c\u7684\u4e0d\u50c5\u50c5\u662f ELK \u9019\u4e09\u9805\u7522\u54c1\u3002 \u672c\u7bc4\u4f8b\u50c5\u6703\u8a0e\u8ad6 ELK \u4ee3\u8868\u7684 Elasticsearch\u3001Logstash\u3001Kibana \u9019\u4e09\u500b\uff0c\u5176\u4e2d\u5404\u7522\u54c1\u5b9a\u4f4d\u548c\u529f\u80fd\u5982\u4e0b\u3002","title":"Log"},{"location":"feedback/distributed-systems-with-node.js/observability/#elasticsearch","text":"\u4e00\u7a2e\u8cc7\u6599\u5eab\uff0c\u4e26\u5c0d\u5916\u63d0\u4f9b API\uff0c\u6703\u9ad8\u6548\u7684\u641c\u5c0b\u76f8\u95dc\u8cc7\u8a0a\u3002\u4e26\u4e14\u6709\u5176\u6a19\u6e96\u7684 query \u8a9e\u6cd5\u3002 Elasticsearch is fast. Really, really fast. Elasticsearch \u64c1\u6709\u5f88\u591a\u529f\u80fd\uff0c\u672c\u6b21\u50c5\u6703\u793a\u7bc4\u5e7e\u7a2e\uff0c\u82e5\u9700\u8981\u66f4\u591a\u8cc7\u8a0a\uff0c \u8a73\u898b \u3002","title":"Elasticsearch"},{"location":"feedback/distributed-systems-with-node.js/observability/#logstash","text":"Elasticsearch \u662f\u4e00\u7a2e\u8cc7\u6599\u5eab\uff0c\u4f46\u662f\u5132\u5b58\u7684\u8cc7\u6599\u9700\u8981\u6709\u4eba\u7d66\u4ed6\uff0c\u9019\u4fbf\u662f Logstash \u7684\u529f\u80fd\u3002\u8ca0\u8cac\u628a\u6536\u5230\u7684\u8cc7\u6599\u6574\u5408\u9001\u7d66 Elasticsearch\u3002 \u9001\u4ec0\u9ebc\u8cc7\u6599\u662f\u7531\u61c9\u7528\u7a0b\u5f0f\u65b9\u6c7a\u5b9a\u7684\uff0c\u53ef\u4ee5\u662f log file\u3001HTTP \u7b49\u3002 \u672c\u7bc4\u4f8b\u662f\u900f\u904e HTTP on UDP \u4f86\u50b3\u9001\u3002","title":"Logstash"},{"location":"feedback/distributed-systems-with-node.js/observability/#kibana","text":"Elasticsearch \u662f\u4e00\u7a2e\u8cc7\u6599\u5eab\uff0c\u4f46\u662f\u4e26\u672a\u63d0\u4f9b UI \u4ecb\u9762\uff0c\u9019\u6642 Kibana \u5c31\u662f\u628a API \u8f49\u6210\u53ef\u8b93\u4eba\u900f\u904e\u7db2\u9801\u7684\u65b9\u5f0f\u4f86\u64cd\u4f5c\u3002","title":"Kibana"},{"location":"feedback/distributed-systems-with-node.js/observability/#_4","text":"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 ELK \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 Browser \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba Kibana \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502Elasticsearch\u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 UDP \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 APP \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba Logstash \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"\u67b6\u69cb\u5716"},{"location":"feedback/distributed-systems-with-node.js/observability/#_5","text":"web-api \u5c0d\u4f7f\u7528\u4f86\u8aaa\uff0c\u4e0d\u9700\u8981\u53bb\u8003\u616e\u50b3\u9001\u5230 Logstash \u7684\u908f\u8f2f logger . info ( { path : req . url , method : req . method , ip : req . ip , ua : req . headers [ \"user-agent\" ] || null , }, \"request-incoming\" ); \u7121\u8ad6\u7528\u4ec0\u9ebc\u683c\u5f0f\u64b0\u5beb log\uff0c\u7d71\u4e00\u5c31\u597d\u3002 \u521d\u59cb\u5316 logger const client = dgram . createSocket ( \"udp4\" ); const stream = { write : ( msg : string ) => { client . send ( msg , LS_PORT , LS_HOST ); }, }; const logger = pino ({ level : \"trace\" }, stream );","title":"\u7bc4\u4f8b\u7a0b\u5f0f\u78bc"},{"location":"feedback/distributed-systems-with-node.js/observability/#alternative","text":"Datadog Sumo Logic Splunk Cloud (AWS, GCP, ELK)","title":"Alternative"},{"location":"feedback/distributed-systems-with-node.js/observability/#metrics","text":"\u5176\u67b6\u69cb\u6703\u548c Log \u5f88\u50cf\uff0cElasticsearch \u4e5f\u5305\u542b\u9019\u985e\u7684 query \u8a9e\u6cd5\u3002 \u5176\u91cd\u9ede\u5dee\u7570\u4fbf\u662f\u5728 log \u8655\u7406\u5c0d\u8c61\u70ba\u55ae\u4e00\u8acb\u6c42\uff0c\u800c metrics \u8655\u7406\u7684\u662f\u670d\u52d9\u5728\u7d2f\u7a4d\u6d41\u91cf\u6216\u6642\u9593\u5f8c\u7684\u72c0\u614b\uff0c\u5982 \u4e0a \u6240\u8ff0\u3002 \u7bc4\u4f8b\u4e2d\u6703\u4f7f\u7528\u7684\u662f Grafana \u3001 Graphite \u548c StatsD \u3002","title":"Metrics"},{"location":"feedback/distributed-systems-with-node.js/observability/#_6","text":"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Metrics \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 Browser \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba Grafana \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 Graphite \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 UDP \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 Service \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25ba StatDs \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 graph LR 0[Browser] 1[Service] subgraph Metrics 2[Grafana] 3[Graphite] 4[StatsD] end 0 --> 2 2 --> 3 3 --> 2 1 -- UDP -->4 4 --> 3 \u548c log \u975e\u5e38\u76f8\u4f3c\uff0c\u9019\u88e1\u5c31\u4e0d\u8d05\u8ff0\u5176\u610f\u7fa9\u3002","title":"\u67b6\u69cb"},{"location":"feedback/distributed-systems-with-node.js/observability/#_7","text":"web-api \u521d\u59cb\u5316 client const client = new StatsDClient ({ host : \"localhost\" , port : 8125 , prefix : \"web-api\" , }); \u7d71\u8a08\u8acb\u6c42\u6642\u9593\u548c\u6b21\u6578 const begin = new Date (); await got ( `http:// ${ TARGET } /recipes/42` ); client . timing ( \"outbound.recipe-api.request-time\" , begin ); client . increment ( \"outbound.recipe-api.request-count\" ); \u7d71\u8a08\u7cfb\u7d71\u8cc7\u6e90 setInterval (() => { client . gauge ( \"server.conn\" , server . connections ); const m = process . memoryUsage (); client . gauge ( \"server.memory.used\" , m . heapUsed ); client . gauge ( \"server.memory.total\" , m . heapTotal ); const h = v8 . getHeapStatistics (); client . gauge ( \"server.heap.size\" , h . used_heap_size ); client . gauge ( \"server.heap.limit\" , h . heap_size_limit ); // try to mock memory heap fs . readdir ( __dirname , ( err , list ) => { if ( err ) return ; client . gauge ( \"server.descriptors\" , list . length ); }); }, 10 _000 ); \u7bc4\u4f8b\u4e2d\uff0c\u628a\u8a18\u61b6\u9ad4\u7b49\u76f8\u95dc\u8cc7\u8a0a\u653e\u5728\u61c9\u7528\u7a0b\u5f0f\u4e2d\u3002 \u5be6\u969b\u4e0a\uff0c\u70ba\u4e86\u907f\u514d\u61c9\u7528\u7a0b\u5f0f\u65b7\u7dda\uff0c\u5c0e\u81f4\u6536\u96c6\u4e0d\u5230\u670d\u52d9\u7684\u8cc7\u8a0a\uff0c\u9019\u985e\u7684\u8cc7\u6599\u6536\u96c6\u61c9\u5728\u670d\u52d9\u5916\u4f7f\u7528\u3002","title":"\u7a0b\u5f0f\u78bc"},{"location":"feedback/distributed-systems-with-node.js/observability/#alternative_1","text":"Graphite -> Prometheus, InfluxDB StatsD -> cAdvisor, MetricBeat","title":"Alternative"},{"location":"feedback/distributed-systems-with-node.js/observability/#tracing_1","text":"\u5728\u5206\u6563\u5f0f\u7cfb\u7d71\u4e2d\uff0c\u591a\u500b\u670d\u52d9\u9593\u7684\u6e9d\u901a\u6216\u8acb\u6c42\u90fd\u53ef\u80fd\u5728\u904e\u7a0b\u4e2d\u5f97\u5230\u975e\u9810\u671f\u7684\u7d50\u679c\uff0c\u70ba\u4e86\u80fd\u5feb\u901f\u627e\u5230\u554f\u984c\u9ede\uff0c\u9700\u8981\u8fa8\u5225\u540c\u4e00\u652f\u8acb\u6c42\u5728\u5404\u500b\u670d\u52d9\u4e2d\u7684\u4f4d\u7f6e\u3002 \u900f\u904e\u5efa\u7acb request ID \u4f86\u8fa8\u5225\u540c\u4e00\u652f\u8acb\u6c42\u5728\u591a\u500b\u670d\u52d9\u4e2d\u7684\u4f4d\u7f6e\u3002","title":"Tracing"},{"location":"feedback/distributed-systems-with-node.js/observability/#_8","text":"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 APP \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 info \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Client \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u25ba web-api \u251c\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u25b2\u2500\u2500\u2500\u2500\u252c\u2500\u2518 \u2502 \u2502 \u2502 Response \u2502 \u2502Request ID \u2502 Zipkin \u2502 \u2502 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 recipe-api \u251c\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 info \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u7522\u51fa\u7bc4\u4f8b\uff1a gantt dateFormat m:s axisFormat %S todayMarker off title Request 1 task1 :des1, 10:1, 5s fetch :des2, 10:7, 10s recipe :des4, 10:8, 8s task2 :des3, 10:18, 3s web-api \u6703\u50b3\u9001 task1 \u3001 fetch \u548c task2 recipe-api \u6703\u50b3\u9001 recipe","title":"\u67b6\u69cb"},{"location":"feedback/distributed-systems-with-node.js/observability/#_9","text":"web-api const tracer = new Tracer ({ ctxImpl , recorder , localServiceName : \"web-api\" , sampler : new sampler . CountingSampler ( 1 ), }); \u7d00\u9304\u8acb\u6c42\u958b\u59cb\u6642\u548c\u7d50\u675f\u6642 app . use ( expressMiddleware ({ tracer })); \u7d00\u9304\u9700\u8981\u57f7\u884c 100ms \u7684\u4efb\u52d9 await tracer . local < Promise < void >> ( 'do_some_task' , () => new Promise (( resolve ) => setTimeout ( resolve , 100 )), ); \u4f7f\u7528\u5305\u88dd\u5f8c\u7684 got \u4f86\u53bb\u8acb\u6c42\uff0c\u5728\u4f7f\u7528\u6642\u4e0d\u9700\u8981\u8003\u616e\u5176 tracing \u908f\u8f2f\u3002 await instance ( `http:// ${ TARGET } /recipes/42` ). json (); const instance = got . extend ({ hooks : { init : [( opts ) => ( opts . _zipkin . parentId = tracer . id )], beforeRequest : [ ( opts ) => { // ... }, ], afterResponse : [ ( res ) => { // ... }, ], beforeError : [ ( err ) => { // ... return err ; }, ], }, }); recipe-api","title":"\u7a0b\u5f0f\u78bc"},{"location":"feedback/distributed-systems-with-node.js/observability/#alert_1","text":"Demo in production","title":"Alert"},{"location":"feedback/distributed-systems-with-node.js/observability/#health-check_1","text":"\u9019\u5927\u90e8\u5206\u6703\u548c Alert \u4e00\u8d77\u5be6\u4f5c\uff0c\u76ee\u7684\u662f\u6301\u7e8c\u6253\u7279\u5b9a route \u53bb\u5f97\u77e5\u670d\u52d9\u73fe\u6709\u72c0\u6cc1\u3002 \u4f46\u73fe\u6709\u72c0\u6cc1\u6703\u6709\u4e9b\u6a21\u7cca\u5730\u5e36\uff0c\u4f8b\u5982\uff1a \u6709\u7522\u54c1\u4f7f\u7528 cache \u53bb\u9054\u5230 SLA\u3002\u7576 cache \u5931\u53bb\u904b\u4f5c\uff0c\u5c0d\u61c9\u7528\u7a0b\u5f0f\u4f86\u8aaa\u4ecd\u80fd\u904b\u884c\u3002\u4f46\u6574\u9ad4\u6548\u7387\u6703\u964d\u4f4e\uff0c\u9032\u800c\u63d0\u9ad8 Latency\uff0c\u9019\u6642\u670d\u52d9\u7684\u72c0\u614b\u7b97\u662f\u5065\u5eb7\u9084\u662f\u4e0d\u5065\u5eb7\uff1f \u9019\u7a2e\u6a21\u7cca\u5730\u5e36\u88ab\u7a31\u4f5c degraded \uff0c\u81f3\u65bc\u8a72\u600e\u9ebc\u8655\u7406\uff0c\u5c31\u548c\u5546\u52d9\u908f\u8f2f\u7684\u5be6\u4f5c\u6709\u95dc\u4e86\u3002","title":"Health Check"},{"location":"feedback/distributed-systems-with-node.js/observability/#_10","text":"\u7bc4\u4f8b\u4e2d\uff0c\u6703\u7528 r-proxy \u505a health check \u4e14\u61c9\u7528\u7a0b\u5f0f\u7d81\u5728\u4e00\u8d77\u3002 \u4f46\u5be6\u4f5c\u4e0a\uff0c\u4ecd\u5efa\u8b70\u8b93\u61c9\u7528\u7a0b\u5f0f\u5916\u7684\u7522\u54c1\u6216\u751a\u81f3\u5916\u55ae\u4f4d\u7684\u7522\u54c1\u53bb\u505a health check\u3002 \u4f8b\u5982\uff1a PagerDuty \u3001 Nagios \u3001 Pingdom \u3002 \u9664\u4e86 r-proxy\uff0c\u5c08\u505a health check \u7684\u958b\u6e90\u8edf\u9ad4\u6709\uff1a Cabot \u3002 HAProxy \u7684\u8a2d\u5b9a\u9ee8 # ... backend web-api option httpchk GET /health server web-api-1 localhost:3001 check server web-api-2 localhost:3002 check web-api app . get ( \"/health\" , ( _req , res ) => { return res . send ( \"OK\" ); });","title":"\u7bc4\u4f8b"},{"location":"feedback/distributed-systems-with-node.js/protocol/","text":"Protocol \u5206\u6563\u5f0f\u7cfb\u7d71\u4e2d\uff0c\u5f88\u91cd\u8981\u7684\u4e00\u584a\u662f\u300c\u4e0d\u540c\u7684\u670d\u52d9\u9593\uff0c\u5f7c\u6b64\u7684\u6e9d\u901a\u65b9\u5f0f\u662f\u4ec0\u9ebc\uff1f\u300d \u6bd4\u8d77\u64b0\u5beb\u5b8c\u6574\u53c8\u6e05\u695a\u7684 API \u6587\u4ef6\uff0c\u6709\u6c92\u6709\u4ec0\u9ebc\u597d\u65b9\u6cd5\u53ef\u4ee5\u8b93\u670d\u52d9\u548c\u670d\u52d9\u4e4b\u9593\u540c\u6b65 API\uff1f \u4ee5\u4e0b\u8a0e\u8ad6\u7686\u5047\u8a2d\uff1a\u6e9d\u901a\u662f\u900f\u904e\u7db2\u8def\uff0c\u4e14\u4ee5 HTTP \u5354\u5b9a\u70ba\u57fa\u790e\u3002 OSI (Open Systems Interconnection) \u61c9\u7528\u5c64\uff08Application Layer\uff09 \u8868\u9054\u5c64\uff08Presentation Layer\uff09 \u6703\u8b70\u5c64\uff08Session Layer\uff09 \u50b3\u8f38\u5c64\uff08Transport Layer\uff09 \u7db2\u8def\u5c64\uff08Network Layer\uff09 \u8cc7\u6599\u9023\u7d50\u5c64\uff08Data Link Layer\uff09 \u5be6\u9ad4\u5c64\uff08Physical Layer\uff09 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Data Frame \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 DLH \u2502 H3 \u2502 H4 \u2502 H5 \u2502 H6 \u2502 H7 \u2502 DATA \u2502 DLT \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 chunk 1 \u2502Sync\u2502 chunk 2 \u2502Sync\u2502 chunk N \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Data Link \u2502 Network \u2502 Transport \u2502 Session \u2502 Presentation \u2502 Application \u2502 Data Link \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u2502 Uncurrent \u2502 Uncurrent \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Error Detection \u2502 IP \u2502 TCP \u2502 HTTP \u2502 Wi\u2500Fi \u2502 \u2502 Error Tolerance \u2502 \u2502 UDP \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 Ethernet \u2502 \u2502 \u2502 \u2502 \u2502 Socket \u2502 ASCII \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 UTF\u25008 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 FTP \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 TLS \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 HTTP POST / HTTP/1.1 Host: www.example.com Content-Type: application/json Content-Length: 15 {\"name\":\"evan.lu\"} \u7a7a\u884c\u5f8c\u7684\u4e0b\u4e00\u884c\u5373\u70ba\u4ee3\u8868\u672c\u6b21 \u8acb\u6c42 \u7684 body \uff0c\u7bc4\u4f8b\u4e2d\u7684 body \u662f\u5e38\u898b\u7684 JSON \u683c\u5f0f\u3002 \u7531\u6b64\uff0c\u53ef\u4ee5\u60f3\u50cf JSON \u683c\u5f0f\u662f\u5728 \u61c9\u7528\u5c64 \u4e4b\u4e0a\u7684 \u7b2c\u516b\u5c64 \u3002 JSON \u55ae\u7d14\u900f\u904e JSON \u50b3\u905e\u6709\u4ec0\u9ebc\u7f3a\u9ede\uff1f \u6b63\u78ba\u7684\u8cc7\u6599\u683c\u5f0f\u61c9\u8a72\u8981\u9577\u4ec0\u9ebc\u6a23\u5b50\uff1f \u4f7f\u7528\u8005\u9700\u8981\u95b1\u8b80\u76f8\u95dc\u6587\u4ef6\uff0c\u6709\u8fa6\u6cd5\u8b93\u6a5f\u5668\u81ea\u52d5\u8655\u7406\u55ce\uff1f \u70ba\u4e86\u89e3\u6c7a\u4e0a\u8ff0\u554f\u984c\uff0c\u5c31\u6703\u6709\u5176\u4ed6 protocol \u9700\u8981\u88ab\u5f15\u5165\u3002 \u4e0d\u904e\u9664\u4e86\u7528\u5176\u4ed6\u5354\u5b9a\uff0c\u4e5f\u6709\u4e00\u4e9b\u65b9\u5f0f\u53ef\u4ee5\u8212\u7de9\uff08\u964d\u4f4e\uff09\u4e0a\u8ff0\u767c\u751f\u7684\u554f\u984c\uff0c\u5982\uff1a JSON API JSON Schema OpenAPI (Swagger) \u4e0a\u8ff0\u50c5\u662f\u5236\u5b9a\u4e00\u4e9b\u898f\u7bc4\uff0c\u8b93\u4f7f\u7528\u8005\u5728\u95b1\u8b80\u76f8\u95dc API \u6587\u4ef6\u6642\uff0c\u80fd\u8f03\u5feb\u9032\u5165\u72c0\u6cc1\u3002 GraphQL GraphQL \u8b93 \u4f7f\u7528\u8005 \u5728\u8ddf \u670d\u52d9 \u8981\u53d6\u8cc7\u6599\u7684\u6642\u5019\u80fd\u6307\u5b9a\u7279\u5b9a\u8cc7\u6599\uff0c\u9019\u6709\u5e7e\u500b\u597d\u8655\uff1a \u53ef\u4ee5\u62ff\u5230\u6700\u6e96\u78ba\u7684\u8cc7\u6599\uff0c\u6e1b\u5c11\u7db2\u8def\u50b3\u8f38 \u628a\u591a\u7a2e\u670d\u52d9\u7684\u8cc7\u6599\u5728\u4e00\u6b21\u8acb\u6c42\u4e2d\u8981\u9f4a \u9019\u4e5f\u8b93 GraphQL \u901a\u5e38\u6210\u70ba facade services \uff0c\u4e5f\u5c31\u662f\u5728\u773e\u591a\u670d\u52d9\u4e2d\u7684\u9996\u500b\u63a5\u89f8\u9ede\uff0c\u4e26\u4f5c\u70ba\u5c0d\u5916\u6e9d\u901a\u7684\u552f\u4e00\u6e20\u9053\u3002 GraphQL \u4e26\u4e0d\u9650\u5b9a\u5728\u8981 HTTP \u4e0a\u57f7\u884c\uff0c\u4e5f\u80fd\u57f7\u884c\u5982 TCP \u7b49\u5354\u5b9a\u4e4b\u4e0a\u3002 \u96d6\u7136\u8acb\u6c42\u6642\u9001\u51fa\u7684\u662f\u985e\u4f3c Query \u7684\u8a9e\u6cd5\uff0c\u4f46 Response \u4e26\u7121\u6307\u5b9a\uff0c\u53ea\u8981\u80fd\u4ee3\u8868\u5176\u968e\u5c64\u5f0f\u7684\u7d50\u679c\u5c31\u884c\uff0c\u5982 JSON \u3002 \u898f\u7bc4 type RecipeRoot { recipe(id: ID): Recipe pid: Int } type Recipe { id: ID! name: String! steps: String ingredients: [Ingredient]! } type Ingredient { id: ID! name: String! quantity: String } \u9019\u4efd\u6a94\u6848\u662f\u53ef\u4ee5\u5c0d\u5916\u516c\u958b\u7684\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u4f9d\u6b64\u64b0\u5beb\u7a0b\u5f0f\uff0c\u985e\u4f3c\u4e0a\u8ff0\u63d0\u5230\u7684 OpenAPI\u3002 \u8acb\u6c42 \u9019\u6642\uff0c\u6211\u5011\u53ef\u4ee5\u4f9d\u7167\u4e0a\u8ff0\u7684\u898f\u7bc4\u9001\u51fa\u8acb\u6c42\uff1a { pid } { \"data\" : { \"pid\" : 9372 } } { recipe(id: 42) { name ingredients { name quantity } } } { \"data\" : { \"recipe\" : { \"name\" : \"Chicken Tikka Masala\" , \"ingredients\" : [ { \"name\" : \"Chicken\" , \"quantity\" : \"1 lb\" }, { \"name\" : \"Sauce\" , \"quantity\" : \"2 cups\" } ] } } } Code Demo \u4e0b\u5217\u5247\u662f\u4ee5 Node.js \u70ba\u57fa\u790e\u7684\u7bc4\u4f8b\uff1a web-api \u539f\u59cb\u78bc // \u50c5\u5c55\u793a\u8acb\u6c42\u7684\u7bc4\u4f8b\uff0c\u9019\u88e1\u7684 `kitchenSink` \u662f\u81ea\u5b9a\u7fa9\u540d\u7a31\uff0c\u65b9\u4fbf debug \u7528\u7684 const query = `query kitchenSink ($id:ID) { recipe(id: $id) { id name ingredients { name quantity } } pid }` ; const variables = { id : \"42\" }; return got ( `http:// ${ TARGET } /graphql` , { method : \"POST\" , json : { query , variables }, }); recipe-api \u539f\u59cb\u78bc import { GraphQLID , GraphQLInt , GraphQLObjectType , GraphQLSchema , } from \"graphql\" ; // \u50c5\u5c55\u793a RecipeRoot \u7684\u5efa\u7f6e\u65b9\u5f0f const recipeRoot = new GraphQLObjectType ({ name : \"RecipeRoot\" , fields : { pid : { type : GraphQLInt , resolve : resolvers.RecipeRoot.pid , }, recipe : { type : recipeQuery , args : { id : { type : GraphQLID } }, resolve : resolvers.RecipeRoot.recipe , }, }, }); return new GraphQLSchema ({ query : rootQuery }); Live Demo http://localhost:4000/graphql gRPC \u50cf\u662f REST \u6216 GraphQL \u90fd\u662f\u5efa\u7acb\u5728\u8cc7\u6599\u4e4b\u4e0a\uff0c\u800c\u900f\u904e CRUD \u7684\u65b9\u5f0f\u53bb\u57f7\u884c\u884c\u70ba\uff0c\u9019\u88e1\u5c31\u53ef\u4ee5\u6ce8\u610f\u5230\u5176\u9650\u5236\uff1a \u5927\u91cf\u7684\u540d\u8a5e\uff0c\u800c\u50c5\u6709\u5c11\u91cf\u7684\u52d5\u8a5e \u8209\u4f8b\uff1a \u82e5\u6709\u4e00\u500b API endpoint \u662f\u7528\u4f86\u5efa\u7acb\u767c\u7968\uff0c\u4eca\u6b32\u65b0\u589e\u4e00\u9644\u5e36\u689d\u4ef6\uff1a \u662f\u5426\u540c\u6642\u5bc4\u9001\u4fe1\u7bb1\u901a\u77e5 \u3002 \u6709\u4ec0\u9ebc\u6a23\u7684\u65b9\u5f0f\uff1f \u518d\u5efa\u7acb\u4e00\u500b endpoint \u5c08\u9580\u505a\u9019\u4ef6\u4e8b\uff1a \u904e\u591a API\uff0c\u96e3\u7ba1\u7406\u548c\u7406\u89e3 \u5728\u8a72 endpoint \u65b0\u589e\u8b8a\u6578\uff1a need_send_email \uff1a \u8b93\u8a72 endpoint \u8d8a\u4f86\u8d8a\u8907\u96dc Remote Procedure Call \u5c31\u662f\u4f86\u89e3\u6c7a\u6b64\u4e8b\u7684\uff01 gRPC \u70ba Google \u5efa\u7acb\u7684 RPC \u6a19\u6e96 gRPC \u9810\u8a2d\u5373\u975e\u4f7f\u7528 JSON \u683c\u5f0f\u9032\u884c\u8cc7\u8a0a\u7684\u50b3\u905e\uff0c\u800c\u662f\u4ee5 Protocol Buffers \uff08ProtoBufs\uff09\u7684\u65b9\u5f0f\u9032\u884c\u50b3\u905e\u3002 \u6709\u5e7e\u500b\u689d\u4ef6\uff1a \u6240\u6709\u683c\u5f0f\u7686\u9808\u9810\u5148\u8a2d\u5b9a\u597d\uff0c\u526f\u6a94\u540d\u70ba .proto \uff0c\u4e14\u9700\u8981\u8b93 client \u64c1\u6709\u3002 \u5404\u503c\u9700\u7d66\u5b9a\u9806\u5e8f\uff0c\u4e14\u4e4b\u5f8c\u4e0d\u5efa\u8b70\u4fee\u6539\u3002 \u6578\u5b57\u6709\u591a\u578b\u5225\uff1a int32 \uff0c int64 \uff0c float \uff0c double \u7b49\u7b49\u3002 \u9019\u4e9b\u689d\u4ef6\u6709\u5e7e\u500b\u597d\u8655\uff1a \u6548\u80fd\u3001\u9ad4\u7a4d\u7684\u6700\u512a\u5316\uff0cbinary serialize/deserialize {\"id\":42} v.s. 42 \u5411\u5f8c\u76f8\u5bb9 v1 \u9700\u8981 arg1 arg2 v2 \u9700\u8981 arg1 arg2 arg3 \u82e5 client \u50c5\u62ff\u5230 v1 \u7684 proto\uff0c\u7a0b\u5f0f\u4e0a\u6703\u81ea\u52d5\u5ffd\u7565 arg2 \u5f8c\u7684\u53c3\u6578 Code Demo gRPC proto syntax = \"proto3\" ; package recipe ; service RecipeService { rpc GetRecipe ( RecipeRequest ) returns ( Recipe ) {} rpc GetMetaData ( Empty ) returns ( Meta ) {} } message Recipe { int32 id = 1 ; string name = 2 ; string steps = 3 ; repeated Ingredient ingredients = 4 ; } message Ingredient { int32 id = 1 ; string name = 2 ; string quantity = 3 ; } message RecipeRequest { int32 id = 1 ; } message Meta { int32 pid = 2 ; } message Empty {} \u5efa\u7acb service\uff0c \u539f\u59cb\u78bc import { loadPackageDefinition , Server } from \"@grpc/grpc-js\" ; import { loadSync } from \"@grpc/proto-loader\" ; // \u8b80\u53d6 proto \u6a94 const def = loadSync ( __dirname + \"/grpc.proto\" ); const proto = loadPackageDefinition ( def ); // \u5efa\u7acb\u8655\u7406\u908f\u8f2f // handlers = ...; const server = new Server (); server . addService ( proto . recipe . RecipeService . service , handlers ); // \u5efa\u7acb\u5c0d\u5916\u9023\u7dda // credentials = ...; for https const cb = () => server . start (); server . bindAsync ( ` ${ HOST } : ${ PORT } ` , credentials , cb ); // \u5efa\u7acb handlers const handlers = { GetMetaData : ( _call , cb ) => { cb ( null , { // error = null pid : process . pid , }); }, GetRecipe : ( call , cb ) => ({}), // if (call.request.id === 42) }; \u5efa\u7acb client\uff0c \u539f\u59cb\u78bc import { loadPackageDefinition } from \"@grpc/grpc-js\" ; import { loadSync } from \"@grpc/proto-loader\" ; // \u8b80\u53d6 proto \u6a94 const def = loadSync ( __dirname + \"/grpc.proto\" ); const proto = loadPackageDefinition ( def ); // credentials = ...; for https const client = new proto . recipe . RecipeService ( TARGET , credentials ); client . getMetaData ({}, cb ); client . getRecipe ({ id : 42 }, cb ); Live Demo http://localhost:3001 Alternatives \u9664\u4e86 gRPC \u9084\u6709\u4ec0\u9ebc\u985e\u4f3c\u7684\u6771\u897f\uff1f ProtoBufs MessagePack \u96d6\u7136\u540c\u70ba binary representation of hierarchical object data\uff0c\u4f46 \u6709 field \u4e0d\u9700\u8981\u984d\u5916\u6a94\u6848\uff08\u5982 .proto \uff09\u53bb\u63cf\u8ff0 gRPC Apache Thrift JSON RPC \u95dc\u65bc gRPC \u63a8\u85a6\u7684\u6587\u7ae0\uff1a \u6bd4\u8f03 gRPC \u670d\u52d9\u8207 HTTP API \u7d50\u8ad6 JSON \u4f60\u9700\u8981\u4e00\u500b http client \u4f86\u547c\u53eb\u773e\u591a API Endpoint\uff0c\u8a0a\u606f\u683c\u5f0f\u4e5f\u9700\u8981\u6709\u984d\u5916\u7684 Schema \u5b9a\u7fa9 GraphQL \u4f60\u9084\u662f\u9700\u8981\u4e00\u500b http client\uff0c\u4f46\u662f\u9019\u6b21\u53ea\u9700\u8981\u5c0d\u61c9\u4e00\u500b\u7aef\u9ede\uff0c\u800c\u4e14\u53ef\u4ee5\u81ea\u5df1\u7d44\u7e54\u67e5\u8a62\u5167\u5bb9 gRPC \u4f60\u9023 http client \u90fd\u4e0d\u7528\uff0c\u5957\u4ef6\u6703\u5e6b\u4f60\u7522\u51fa\u9019\u4e9b\u547c\u53eb\u7684\u7a0b\u5f0f\u908f\u8f2f\uff0c\u800c\u4f60\u53ea\u9700\u8981\u50cf\u5beb\u4e00\u822c function \u4e00\u6a23\u547c\u53eb\u5373\u53ef","title":"Protocol"},{"location":"feedback/distributed-systems-with-node.js/protocol/#protocol","text":"\u5206\u6563\u5f0f\u7cfb\u7d71\u4e2d\uff0c\u5f88\u91cd\u8981\u7684\u4e00\u584a\u662f\u300c\u4e0d\u540c\u7684\u670d\u52d9\u9593\uff0c\u5f7c\u6b64\u7684\u6e9d\u901a\u65b9\u5f0f\u662f\u4ec0\u9ebc\uff1f\u300d \u6bd4\u8d77\u64b0\u5beb\u5b8c\u6574\u53c8\u6e05\u695a\u7684 API \u6587\u4ef6\uff0c\u6709\u6c92\u6709\u4ec0\u9ebc\u597d\u65b9\u6cd5\u53ef\u4ee5\u8b93\u670d\u52d9\u548c\u670d\u52d9\u4e4b\u9593\u540c\u6b65 API\uff1f \u4ee5\u4e0b\u8a0e\u8ad6\u7686\u5047\u8a2d\uff1a\u6e9d\u901a\u662f\u900f\u904e\u7db2\u8def\uff0c\u4e14\u4ee5 HTTP \u5354\u5b9a\u70ba\u57fa\u790e\u3002","title":"Protocol"},{"location":"feedback/distributed-systems-with-node.js/protocol/#osi-open-systems-interconnection","text":"\u61c9\u7528\u5c64\uff08Application Layer\uff09 \u8868\u9054\u5c64\uff08Presentation Layer\uff09 \u6703\u8b70\u5c64\uff08Session Layer\uff09 \u50b3\u8f38\u5c64\uff08Transport Layer\uff09 \u7db2\u8def\u5c64\uff08Network Layer\uff09 \u8cc7\u6599\u9023\u7d50\u5c64\uff08Data Link Layer\uff09 \u5be6\u9ad4\u5c64\uff08Physical Layer\uff09 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Data Frame \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 DLH \u2502 H3 \u2502 H4 \u2502 H5 \u2502 H6 \u2502 H7 \u2502 DATA \u2502 DLT \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 chunk 1 \u2502Sync\u2502 chunk 2 \u2502Sync\u2502 chunk N \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Data Link \u2502 Network \u2502 Transport \u2502 Session \u2502 Presentation \u2502 Application \u2502 Data Link \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 \u2502 Uncurrent \u2502 Uncurrent \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Error Detection \u2502 IP \u2502 TCP \u2502 HTTP \u2502 Wi\u2500Fi \u2502 \u2502 Error Tolerance \u2502 \u2502 UDP \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 Ethernet \u2502 \u2502 \u2502 \u2502 \u2502 Socket \u2502 ASCII \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 UTF\u25008 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 FTP \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \u2502 \u2502 TLS \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"OSI (Open Systems Interconnection)"},{"location":"feedback/distributed-systems-with-node.js/protocol/#http","text":"POST / HTTP/1.1 Host: www.example.com Content-Type: application/json Content-Length: 15 {\"name\":\"evan.lu\"} \u7a7a\u884c\u5f8c\u7684\u4e0b\u4e00\u884c\u5373\u70ba\u4ee3\u8868\u672c\u6b21 \u8acb\u6c42 \u7684 body \uff0c\u7bc4\u4f8b\u4e2d\u7684 body \u662f\u5e38\u898b\u7684 JSON \u683c\u5f0f\u3002 \u7531\u6b64\uff0c\u53ef\u4ee5\u60f3\u50cf JSON \u683c\u5f0f\u662f\u5728 \u61c9\u7528\u5c64 \u4e4b\u4e0a\u7684 \u7b2c\u516b\u5c64 \u3002","title":"HTTP"},{"location":"feedback/distributed-systems-with-node.js/protocol/#json","text":"\u55ae\u7d14\u900f\u904e JSON \u50b3\u905e\u6709\u4ec0\u9ebc\u7f3a\u9ede\uff1f \u6b63\u78ba\u7684\u8cc7\u6599\u683c\u5f0f\u61c9\u8a72\u8981\u9577\u4ec0\u9ebc\u6a23\u5b50\uff1f \u4f7f\u7528\u8005\u9700\u8981\u95b1\u8b80\u76f8\u95dc\u6587\u4ef6\uff0c\u6709\u8fa6\u6cd5\u8b93\u6a5f\u5668\u81ea\u52d5\u8655\u7406\u55ce\uff1f \u70ba\u4e86\u89e3\u6c7a\u4e0a\u8ff0\u554f\u984c\uff0c\u5c31\u6703\u6709\u5176\u4ed6 protocol \u9700\u8981\u88ab\u5f15\u5165\u3002 \u4e0d\u904e\u9664\u4e86\u7528\u5176\u4ed6\u5354\u5b9a\uff0c\u4e5f\u6709\u4e00\u4e9b\u65b9\u5f0f\u53ef\u4ee5\u8212\u7de9\uff08\u964d\u4f4e\uff09\u4e0a\u8ff0\u767c\u751f\u7684\u554f\u984c\uff0c\u5982\uff1a JSON API JSON Schema OpenAPI (Swagger) \u4e0a\u8ff0\u50c5\u662f\u5236\u5b9a\u4e00\u4e9b\u898f\u7bc4\uff0c\u8b93\u4f7f\u7528\u8005\u5728\u95b1\u8b80\u76f8\u95dc API \u6587\u4ef6\u6642\uff0c\u80fd\u8f03\u5feb\u9032\u5165\u72c0\u6cc1\u3002","title":"JSON"},{"location":"feedback/distributed-systems-with-node.js/protocol/#graphql","text":"GraphQL \u8b93 \u4f7f\u7528\u8005 \u5728\u8ddf \u670d\u52d9 \u8981\u53d6\u8cc7\u6599\u7684\u6642\u5019\u80fd\u6307\u5b9a\u7279\u5b9a\u8cc7\u6599\uff0c\u9019\u6709\u5e7e\u500b\u597d\u8655\uff1a \u53ef\u4ee5\u62ff\u5230\u6700\u6e96\u78ba\u7684\u8cc7\u6599\uff0c\u6e1b\u5c11\u7db2\u8def\u50b3\u8f38 \u628a\u591a\u7a2e\u670d\u52d9\u7684\u8cc7\u6599\u5728\u4e00\u6b21\u8acb\u6c42\u4e2d\u8981\u9f4a \u9019\u4e5f\u8b93 GraphQL \u901a\u5e38\u6210\u70ba facade services \uff0c\u4e5f\u5c31\u662f\u5728\u773e\u591a\u670d\u52d9\u4e2d\u7684\u9996\u500b\u63a5\u89f8\u9ede\uff0c\u4e26\u4f5c\u70ba\u5c0d\u5916\u6e9d\u901a\u7684\u552f\u4e00\u6e20\u9053\u3002 GraphQL \u4e26\u4e0d\u9650\u5b9a\u5728\u8981 HTTP \u4e0a\u57f7\u884c\uff0c\u4e5f\u80fd\u57f7\u884c\u5982 TCP \u7b49\u5354\u5b9a\u4e4b\u4e0a\u3002 \u96d6\u7136\u8acb\u6c42\u6642\u9001\u51fa\u7684\u662f\u985e\u4f3c Query \u7684\u8a9e\u6cd5\uff0c\u4f46 Response \u4e26\u7121\u6307\u5b9a\uff0c\u53ea\u8981\u80fd\u4ee3\u8868\u5176\u968e\u5c64\u5f0f\u7684\u7d50\u679c\u5c31\u884c\uff0c\u5982 JSON \u3002","title":"GraphQL"},{"location":"feedback/distributed-systems-with-node.js/protocol/#_1","text":"type RecipeRoot { recipe(id: ID): Recipe pid: Int } type Recipe { id: ID! name: String! steps: String ingredients: [Ingredient]! } type Ingredient { id: ID! name: String! quantity: String } \u9019\u4efd\u6a94\u6848\u662f\u53ef\u4ee5\u5c0d\u5916\u516c\u958b\u7684\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u4f9d\u6b64\u64b0\u5beb\u7a0b\u5f0f\uff0c\u985e\u4f3c\u4e0a\u8ff0\u63d0\u5230\u7684 OpenAPI\u3002","title":"\u898f\u7bc4"},{"location":"feedback/distributed-systems-with-node.js/protocol/#_2","text":"\u9019\u6642\uff0c\u6211\u5011\u53ef\u4ee5\u4f9d\u7167\u4e0a\u8ff0\u7684\u898f\u7bc4\u9001\u51fa\u8acb\u6c42\uff1a { pid } { \"data\" : { \"pid\" : 9372 } } { recipe(id: 42) { name ingredients { name quantity } } } { \"data\" : { \"recipe\" : { \"name\" : \"Chicken Tikka Masala\" , \"ingredients\" : [ { \"name\" : \"Chicken\" , \"quantity\" : \"1 lb\" }, { \"name\" : \"Sauce\" , \"quantity\" : \"2 cups\" } ] } } }","title":"\u8acb\u6c42"},{"location":"feedback/distributed-systems-with-node.js/protocol/#code-demo","text":"\u4e0b\u5217\u5247\u662f\u4ee5 Node.js \u70ba\u57fa\u790e\u7684\u7bc4\u4f8b\uff1a web-api \u539f\u59cb\u78bc // \u50c5\u5c55\u793a\u8acb\u6c42\u7684\u7bc4\u4f8b\uff0c\u9019\u88e1\u7684 `kitchenSink` \u662f\u81ea\u5b9a\u7fa9\u540d\u7a31\uff0c\u65b9\u4fbf debug \u7528\u7684 const query = `query kitchenSink ($id:ID) { recipe(id: $id) { id name ingredients { name quantity } } pid }` ; const variables = { id : \"42\" }; return got ( `http:// ${ TARGET } /graphql` , { method : \"POST\" , json : { query , variables }, }); recipe-api \u539f\u59cb\u78bc import { GraphQLID , GraphQLInt , GraphQLObjectType , GraphQLSchema , } from \"graphql\" ; // \u50c5\u5c55\u793a RecipeRoot \u7684\u5efa\u7f6e\u65b9\u5f0f const recipeRoot = new GraphQLObjectType ({ name : \"RecipeRoot\" , fields : { pid : { type : GraphQLInt , resolve : resolvers.RecipeRoot.pid , }, recipe : { type : recipeQuery , args : { id : { type : GraphQLID } }, resolve : resolvers.RecipeRoot.recipe , }, }, }); return new GraphQLSchema ({ query : rootQuery });","title":"Code Demo"},{"location":"feedback/distributed-systems-with-node.js/protocol/#live-demo","text":"http://localhost:4000/graphql","title":"Live Demo"},{"location":"feedback/distributed-systems-with-node.js/protocol/#grpc","text":"\u50cf\u662f REST \u6216 GraphQL \u90fd\u662f\u5efa\u7acb\u5728\u8cc7\u6599\u4e4b\u4e0a\uff0c\u800c\u900f\u904e CRUD \u7684\u65b9\u5f0f\u53bb\u57f7\u884c\u884c\u70ba\uff0c\u9019\u88e1\u5c31\u53ef\u4ee5\u6ce8\u610f\u5230\u5176\u9650\u5236\uff1a \u5927\u91cf\u7684\u540d\u8a5e\uff0c\u800c\u50c5\u6709\u5c11\u91cf\u7684\u52d5\u8a5e \u8209\u4f8b\uff1a \u82e5\u6709\u4e00\u500b API endpoint \u662f\u7528\u4f86\u5efa\u7acb\u767c\u7968\uff0c\u4eca\u6b32\u65b0\u589e\u4e00\u9644\u5e36\u689d\u4ef6\uff1a \u662f\u5426\u540c\u6642\u5bc4\u9001\u4fe1\u7bb1\u901a\u77e5 \u3002 \u6709\u4ec0\u9ebc\u6a23\u7684\u65b9\u5f0f\uff1f \u518d\u5efa\u7acb\u4e00\u500b endpoint \u5c08\u9580\u505a\u9019\u4ef6\u4e8b\uff1a \u904e\u591a API\uff0c\u96e3\u7ba1\u7406\u548c\u7406\u89e3 \u5728\u8a72 endpoint \u65b0\u589e\u8b8a\u6578\uff1a need_send_email \uff1a \u8b93\u8a72 endpoint \u8d8a\u4f86\u8d8a\u8907\u96dc Remote Procedure Call \u5c31\u662f\u4f86\u89e3\u6c7a\u6b64\u4e8b\u7684\uff01 gRPC \u70ba Google \u5efa\u7acb\u7684 RPC \u6a19\u6e96 gRPC \u9810\u8a2d\u5373\u975e\u4f7f\u7528 JSON \u683c\u5f0f\u9032\u884c\u8cc7\u8a0a\u7684\u50b3\u905e\uff0c\u800c\u662f\u4ee5 Protocol Buffers \uff08ProtoBufs\uff09\u7684\u65b9\u5f0f\u9032\u884c\u50b3\u905e\u3002 \u6709\u5e7e\u500b\u689d\u4ef6\uff1a \u6240\u6709\u683c\u5f0f\u7686\u9808\u9810\u5148\u8a2d\u5b9a\u597d\uff0c\u526f\u6a94\u540d\u70ba .proto \uff0c\u4e14\u9700\u8981\u8b93 client \u64c1\u6709\u3002 \u5404\u503c\u9700\u7d66\u5b9a\u9806\u5e8f\uff0c\u4e14\u4e4b\u5f8c\u4e0d\u5efa\u8b70\u4fee\u6539\u3002 \u6578\u5b57\u6709\u591a\u578b\u5225\uff1a int32 \uff0c int64 \uff0c float \uff0c double \u7b49\u7b49\u3002 \u9019\u4e9b\u689d\u4ef6\u6709\u5e7e\u500b\u597d\u8655\uff1a \u6548\u80fd\u3001\u9ad4\u7a4d\u7684\u6700\u512a\u5316\uff0cbinary serialize/deserialize {\"id\":42} v.s. 42 \u5411\u5f8c\u76f8\u5bb9 v1 \u9700\u8981 arg1 arg2 v2 \u9700\u8981 arg1 arg2 arg3 \u82e5 client \u50c5\u62ff\u5230 v1 \u7684 proto\uff0c\u7a0b\u5f0f\u4e0a\u6703\u81ea\u52d5\u5ffd\u7565 arg2 \u5f8c\u7684\u53c3\u6578","title":"gRPC"},{"location":"feedback/distributed-systems-with-node.js/protocol/#code-demo_1","text":"gRPC proto syntax = \"proto3\" ; package recipe ; service RecipeService { rpc GetRecipe ( RecipeRequest ) returns ( Recipe ) {} rpc GetMetaData ( Empty ) returns ( Meta ) {} } message Recipe { int32 id = 1 ; string name = 2 ; string steps = 3 ; repeated Ingredient ingredients = 4 ; } message Ingredient { int32 id = 1 ; string name = 2 ; string quantity = 3 ; } message RecipeRequest { int32 id = 1 ; } message Meta { int32 pid = 2 ; } message Empty {} \u5efa\u7acb service\uff0c \u539f\u59cb\u78bc import { loadPackageDefinition , Server } from \"@grpc/grpc-js\" ; import { loadSync } from \"@grpc/proto-loader\" ; // \u8b80\u53d6 proto \u6a94 const def = loadSync ( __dirname + \"/grpc.proto\" ); const proto = loadPackageDefinition ( def ); // \u5efa\u7acb\u8655\u7406\u908f\u8f2f // handlers = ...; const server = new Server (); server . addService ( proto . recipe . RecipeService . service , handlers ); // \u5efa\u7acb\u5c0d\u5916\u9023\u7dda // credentials = ...; for https const cb = () => server . start (); server . bindAsync ( ` ${ HOST } : ${ PORT } ` , credentials , cb ); // \u5efa\u7acb handlers const handlers = { GetMetaData : ( _call , cb ) => { cb ( null , { // error = null pid : process . pid , }); }, GetRecipe : ( call , cb ) => ({}), // if (call.request.id === 42) }; \u5efa\u7acb client\uff0c \u539f\u59cb\u78bc import { loadPackageDefinition } from \"@grpc/grpc-js\" ; import { loadSync } from \"@grpc/proto-loader\" ; // \u8b80\u53d6 proto \u6a94 const def = loadSync ( __dirname + \"/grpc.proto\" ); const proto = loadPackageDefinition ( def ); // credentials = ...; for https const client = new proto . recipe . RecipeService ( TARGET , credentials ); client . getMetaData ({}, cb ); client . getRecipe ({ id : 42 }, cb );","title":"Code Demo"},{"location":"feedback/distributed-systems-with-node.js/protocol/#live-demo_1","text":"http://localhost:3001","title":"Live Demo"},{"location":"feedback/distributed-systems-with-node.js/protocol/#alternatives","text":"\u9664\u4e86 gRPC \u9084\u6709\u4ec0\u9ebc\u985e\u4f3c\u7684\u6771\u897f\uff1f ProtoBufs MessagePack \u96d6\u7136\u540c\u70ba binary representation of hierarchical object data\uff0c\u4f46 \u6709 field \u4e0d\u9700\u8981\u984d\u5916\u6a94\u6848\uff08\u5982 .proto \uff09\u53bb\u63cf\u8ff0 gRPC Apache Thrift JSON RPC \u95dc\u65bc gRPC \u63a8\u85a6\u7684\u6587\u7ae0\uff1a \u6bd4\u8f03 gRPC \u670d\u52d9\u8207 HTTP API","title":"Alternatives"},{"location":"feedback/distributed-systems-with-node.js/protocol/#_3","text":"JSON \u4f60\u9700\u8981\u4e00\u500b http client \u4f86\u547c\u53eb\u773e\u591a API Endpoint\uff0c\u8a0a\u606f\u683c\u5f0f\u4e5f\u9700\u8981\u6709\u984d\u5916\u7684 Schema \u5b9a\u7fa9 GraphQL \u4f60\u9084\u662f\u9700\u8981\u4e00\u500b http client\uff0c\u4f46\u662f\u9019\u6b21\u53ea\u9700\u8981\u5c0d\u61c9\u4e00\u500b\u7aef\u9ede\uff0c\u800c\u4e14\u53ef\u4ee5\u81ea\u5df1\u7d44\u7e54\u67e5\u8a62\u5167\u5bb9 gRPC \u4f60\u9023 http client \u90fd\u4e0d\u7528\uff0c\u5957\u4ef6\u6703\u5e6b\u4f60\u7522\u51fa\u9019\u4e9b\u547c\u53eb\u7684\u7a0b\u5f0f\u908f\u8f2f\uff0c\u800c\u4f60\u53ea\u9700\u8981\u50cf\u5beb\u4e00\u822c function \u4e00\u6a23\u547c\u53eb\u5373\u53ef","title":"\u7d50\u8ad6"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/","text":"SLA and Load Testing \u8aaa\u660e \u7522\u54c1\u90fd\u9700\u8981\u5411\u4f7f\u7528\u8005\u5c55\u793a\u90e8\u5206\u7684 \u627f\u8afe \uff0c\u4f8b\u5982\uff1a \u8981\u6c42\u5728 100ms \u5167\u56de\u61c9\uff08Latency\uff09 1 \u5e74\u7576\u4e2d\u50c5\u6709 1 \u5c0f\u6642\u4ee5\u5167\u7684\u6642\u9593\u670d\u52d9\u53ef\u80fd\u7121\u6cd5\u4f7f\u7528 \u4efb\u4f55\u8b8a\u52d5\u90fd\u6703\u4fdd\u8b49\u4e00\u5e74\u5167\u7684\u5411\u5f8c\u76f8\u5bb9 \u9019\u985e\u4fdd\u8b49\uff0c\u7a31\u70ba SLA\uff08Service Level Agreement\uff09\u3002 SLA \u901a\u5e38\u7531\u591a\u500b SLO\uff08Service Level Objective\uff09\u7d44\u6210\uff0c\u4f8b\u5982\uff1a \u4e00\u4efd SLA \u63d0\u4f9b \u5feb\u901f\u4e14\u5b89\u5168\u7684\u652f\u4ed8\u91d1\u9322 \uff0c\u5176\u4e2d\u7684 \u4fdd\u8b49\u4e0d\u6703\u91cd\u8907\u6263\u6b3e \u5373\u70ba SLO SLI\uff08Service Level Indicator\uff09\u5373\u662f SLO \u7684\u6307\u6a19\uff0c\u4f8b\u5982 \u76ee\u6a19\u5728 100ms \u5167\u56de\u61c9\uff0c\u5be6\u969b\u6e2c\u8a66\u70ba\u5e73\u5747\u65bc 80ms \u5167\u56de\u61c9 \u597d\u7684\u670d\u52d9 SLO / SLI \u9700\u5927\u65bc\u7b49\u65bc 1 \u3002 \u5206\u6563\u5f0f\u7cfb\u7d71\u4e2d\u7684\u610f\u7fa9 \u82e5\u8981\u6c42\u5728\u4e00\u500b\u670d\u52d9\u6709\u7279\u5b9a\u7684 SLO\uff0c\u5c31\u5fc5\u9808\u540c\u6642\u8a08\u7b97\u8a72\u670d\u52d9\u4e2d\u6240\u6709\u6703\u4f7f\u7528\u7684\u5b50\u670d\u52d9\u7684 SLO\u3002 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Application \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 Service \u251c\u2500\u2500\u2500\u2534\u2500\u2500\u25baUser\u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u25b2\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b2\u2500\u2500\u2500\u2518100ms \u2514\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 30ms\u2502 40ms\u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2510 \u2502 \u2502 \u2502 API1 \u2502 \u2502 API2 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u6709\u6642\u5019\uff0c\u7522\u54c1\u904e\u65bc\u8907\u96dc\u6c92\u8fa6\u6cd5\u7522\u51fa\u5b8c\u6574\u7684\u6d41\u7a0b\u5716\uff0c\u4e8b\u5be6\u7684\u7c21\u5316\u6216\u589e\u52a0 Tracing \u90fd\u53ef\u4ee5\u5e6b\u52a9\u7522\u51fa\u3002 Load Test Load Test \u76ee\u7684\u5373\u662f\u8a08\u7b97\u51fa SLI\u3002 Load Test \u548c Stress Test \u5dee\u5728\u54ea\u88e1\uff1f Latency \u4ee3\u8868\u5f9e \u4e8b\u4ef6\u89f8\u767c \u5230 \u4e8b\u4ef6\u56de\u61c9 \u7684\u6642\u9593\u5dee\uff0c\u6b64\u8655\u4e26\u4e0d\u5305\u542b\u932f\u8aa4\u56de\u61c9\u7684\u72c0\u6cc1\u3002 \u4ee5\u4e0b\u7bc4\u4f8b\uff0c\u90fd\u5c07\u4ee5 Latency \u70ba SLO\uff0c\u4e26\u8a08\u7b97\u4e4b\u3002 Baseline \u6e2c\u8a66\u91cd\u8981\u7684\u4e00\u9ede\u662f\u8981\u6709\u4e00\u500b\u57fa\u6e96\u9ede\uff0c\u4e00\u500b\u7522\u54c1\u53ef\u4ee5\u6709\u591a\u7a2e Baseline \u4f8b\u5982\uff1a \u5728\u4e0d\u505a\u4efb\u4f55\u5916\u90e8\u8acb\u6c42\u4e4b\u4e0b\u7684 Latency \u4f7f\u7528\u7684\u6846\u67b6\u6240\u9650\u5236\u7684 Latency \u4e0d\u540c\u7684 Baseline \u6703\u6709\u81ea\u5df1\u7684\u610f\u7fa9\uff0c\u6839\u64da\u9700\u6c42\u5236\u5b9a\u51fa\u7406\u60f3\u7684 Baseline\u3002 \u7bc4\u4f8b \u4ee5 Node.js \u9019\u8a9e\u8a00\u6240\u80fd\u505a\u51fa\u6700\u55ae\u7d14\u7684 server \u70ba Baseline\uff1a require ( \"http\" ) . createServer (( req , res ) => res . end ( \"ok\" )) . listen ( 80 , () => null ); \u4f9d\u6b64\u89c0\u5bdf\u51fa\uff0c\u5728\u7d71\u4e00\u6a5f\u5668\u898f\u683c\u4e0b\u4efb\u4f55\u8981\u6c42\u5728 Node.js \u9019\u8a9e\u8a00\u6709\u8d85\u8d8a\u5176 Latency \u90fd\u662f\u6c92\u610f\u7fa9\u7684\u3002 \u5728\u8ffd\u6c42\u66f4\u597d\u7684 Latency \u6642\uff0c\u6216\u8a31\u8a72\u8003\u616e\u5176\u4ed6\u8a9e\u8a00\uff0c\u5982 C++ \u6216 Rust\u3002 \u4f46\u6b64\u6642\u4fbf\u9700\u8981\u6b0a\u8861\u5176\u4ed6\u8003\u91cf\uff0c\u5982\uff1a\u6703\u4f7f\u7528\u8a72\u8a9e\u8a00\u7684\u4eba\u6578\uff0c\u793e\u7fa4\u767c\u5c55\u7a0b\u5ea6\u7b49\u7b49\u3002 Latency Stat 2.5% 50% 97.5% 99% Avg Stdev Max Latency 0ms 0ms 0ms 0ms 0.01ms 0.08ms 9.45ms Req/Sec 42,751 39,039 36,703 29,487 38,884.14 1,748.17 29,477 \u5176\u4e2d\u7684 29487 \u500b\u6bcf\u79d2\u8acb\u6c42\u91cf \u5373\u662f TP99\uff08Top Percentile\uff09\u4e0b\u7684\u57fa\u6e96\u9ede\u3002 \u6709\u6642\u6703\u8a8d\u70ba 1% \u662f\u6975\u7aef\u503c\uff0c\u61c9\u8a72\u5ffd\u7565\u3002\u7136\u800c\u5728\u7db2\u8def\u4e16\u754c\u4e2d\uff0c\u4e00\u500b\u4f7f\u7528\u8005\u5e38\u5e38\u6703\u9700\u8981\u91dd\u5c0d\u4e00\u500b\u7db2\u9801\u505a\u51fa\u5f88\u591a\u8acb\u6c42\u3002\u82e5\u4ee5\u4e00\u500b\u9801\u9762\u9700\u8981 40 \u500b\u8cc7\u6e90\u4f86\u8a08\u7b97\uff0c\u5728\u8dd1\u7b2c\u4e94\u500b\u9801\u9762\u4e4b\u5f8c\uff0c\u6709\u8fd1\u4e4e 0.003 % \u7684\u6a5f\u7387\u4f7f\u7528\u8005 \u4e0d\u6703 \u89f8\u767c\u5230 95% \u7684\u72c0\u6cc1\u3002 How NOT to Measure Latency \u4f7f\u7528 Reverse Proxy - HAProxy Percentile With Proxy Without 99.9% 1ms 1ms 99.99% 2ms 2ms 99.999% 5ms 3ms \u5f97\u5230 19967 \u500b\u6bcf\u79d2\u8acb\u6c42\u91cf \uff0c\u76f8\u6bd4\u65bc\u57fa\u6e96\u9ede 29487 \uff0c\u770b\u5f97\u51fa\u5728\u6700\u55ae\u7d14\u7684\u61c9\u7528\u7a0b\u5f0f\u4e0b\u589e\u52a0 r-proxy \u6703\u8b93\u61c9\u7528\u7a0b\u5f0f\u8b8a\u6162\u3002 \u4f46\u82e5\u8003\u616e\u771f\u6b63\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u5047\u5982\u56de\u61c9\u6642\u9593\u70ba 100ms\uff0c\u4f7f\u7528 r-proxy \u96d6\u6703\u589e\u52a0\u56de\u61c9\u6642\u9593\uff0c\u537b\u50c5\u50c5\u589e\u52a0 1~2ms\uff0c\u6574\u9ad4\u6548\u76ca\u9084\u662f\u5927\u65bc\u5176\u6d88\u8017\u7684\u6548\u80fd\u3002 \u82e5\u8003\u616e HTTP Compression \u4e0a\u8ff0\u4f8b\u5b50\u50c5\u8003\u616e\u6700\u57fa\u790e\u7684\u6846\u67b6\u6548\u80fd\uff0c\u82e5\u70ba\u4e86\u58d3\u7e2e\u7db2\u8def\u6d41\u91cf \u5957\u7528 compression\uff0c\u5c0d\u65bc\u6548\u80fd\u6703\u6709\u4ec0\u9ebc\u5f71\u97ff\uff1f \u518d\u52a0\u4e0a r-prxoy \u53c8\u6703\u6709\u4ec0\u9ebc\u5f71\u97ff\uff1f Latency Percentile With Proxy Without 99% 47ms 53ms 99.9% 50ms 57ms 99.99% 52ms 62ms 99.999% 53ms 64ms Protocol \u4e0a\u4e00\u4efd\u5831\u544a\u8a0e\u8ad6\u5404\u7a2e\u670d\u52d9\u9593\u7684\u6e9d\u901a\u65b9\u5f0f\uff1a JSON over HTTP GraphQL gRPC \u7a76\u7adf\u54ea\u4e00\u9805\u662f\u771f\u6b63\u6709\u6548\u7387\u7684\uff1f \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 VPS client \u2502 \u2502 VPS server \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502Load Test\u251c\u2500\u2500\u25baweb-api\u251c\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25barecipe-api\u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 protocol \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u7d50\u679c Percentile JSON GraphQL gRPC 99% 10ms 13ms 24ms 99.9% 18ms 22ms 32ms 99.99% 26ms 36ms 82ms 99.999% 48ms 67ms 82ms \u8a0e\u8ad6 \u6211\u5011\u77e5\u9053 GraphQL \u7684\u50f9\u503c\u5728\u65bc\u53ef\u4ee5\u5728\u4e00\u500b request \u4e2d\u53d6\u5f97\u6240\u6709\u8a0a\u606f\uff0c\u4e14\u4e0d\u9700\u8981\u91dd\u5c0d\u6bcf\u500b\u5834\u666f\u5c0d\u5916\u958b\u51fa\u4e00\u500b endpoint\u3002 \u6709\u6642\u70ba\u4e86\u8ffd\u6c42\u958b\u767c\u6548\u7387\uff0c\u800c\u6703\u6368\u68c4\u90e8\u5206\u7522\u54c1\u6548\u7387\uff0c\u9019\u6642\u4fbf\u8981\u6b0a\u8861\u7522\u54c1\u7684\u7279\u6027\u8f03\u504f\u5411\u65bc\u54ea\u908a\u3002 \u9664\u6b64\u4e4b\u5916 JSON \u7684\u89e3\u6790\u5728 v8 engine \u4e2d\uff0c\u6548\u7387\u5df2\u7d93\u88ab\u6975\u81f4\u7684\u58d3\u7e2e\u4e86\uff0c\u6240\u4ee5\u76f8\u5c0d\u800c\u8a00\uff0c\u5229\u7528 Buffer \u505a binary \u89e3\u6790\u7684 gRPC \u5728\u6548\u80fd\u4e0a\u5c31\u77ee\u4e86\u4e00\u622a\u3002\u7531\u65bc\u5176\u7279\u6027\uff0c\u8b93\u4ed6\u5728 C++ \u9019\u985e\u7de8\u8b6f\u904e\u7684\u7a0b\u5f0f\u78bc\u4e2d\u6709\u8f03\u9ad8\u7684\u6548\u80fd\uff0c\u800c\u4e0d\u984d\u5916\u8655\u7406 GC \u9019\u985e\u4e8b\u4ef6\u3002 \u7d50\u8ad6 SLA \u662f\u9762\u5411\u5f88\u591a\u7684\u6307\u6a19\uff0c\u6709\u6642\u5fc5\u9808\u6b0a\u8861 \u6b63\u78ba\u7684\u8a55\u4f30\u7b26\u5408\u81ea\u5df1\u7684\u6307\u6a19\uff0c\u4f8b\u5982\uff1a\u81ea\u52d5\u586b\u5beb vs \u9280\u884c\u958b\u6236 \u5728\u505a load testing \u6642\uff0c\u9700\u8981\u6ce8\u610f\u7522\u54c1\u53ef\u80fd\u7684\u6d41\u91cf\u9ad8\u4f4e\u5cf0 \u8981\u76e1\u91cf\u6e1b\u5c11\u96dc\u97f3\uff08noisy neighbor\uff09\uff0c\u76e1\u91cf\u5728\u985e\u4f3c\u7dda\u4e0a\u7684\u74b0\u5883\u4e2d\u6e2c\u8a66 \u4e00\u500b\u7522\u54c1\u7a76\u7adf\u8a72\u958b\u5e7e\u500b\uff08\u591a\u5c11 CPU/Memory\uff09\u6a5f\u5668\u4f86\u6eff\u8db3\u7dda\u4e0a\u6d41\u91cf\uff1f \u65b9\u5411 \u89c0\u5bdf\u7dda\u4e0a\u74b0\u5883\u73fe\u6709\u7684\u6d41\u91cf\u9ad8\u5cf0\uff0c\u4e26\u5236\u5b9a\u51fa\u7b26\u5408\u5546\u52d9\u908f\u8f2f\u7684 Latency\uff08SLO\uff09\u3002 \u5236\u5b9a\u55ae\u4f4d\uff1a\u4e00\u500b Docker container\u3001\u4e00\u53f0\u6a5f\u5668\u3001EC2 \u627e\u51fa\u5728\u6eff\u8db3 TP99 \u4e0b\u7684\u8acb\u6c42\u6578 \u589e\u52a0\u55ae\u4f4d\uff0c\u53cd\u8986\u6e2c\u8a66\u76f4\u5230\u9054\u5230\u80fd\u5bb9\u7d0d\u7dda\u4e0a\u74b0\u5883\u7684\u6578\u91cf \u7bc4\u4f8b \u82e5\u5e0c\u671b\u7522\u54c1\u80fd\u5728 50ms \u5167\u56de\u61c9\u8acb\u6c42\uff0c\u4e26\u5f97\u51fa\u7dda\u4e0a\u74b0\u5883\u9ad8\u5cf0\u7d04\u6bcf\u79d2 20 \uff08\u6216\u6bcf\u5206 1200 \u6216\u6bcf\u6642 72000\uff09\u500b\u8acb\u6c42\u3002 \u555f\u7528\u4e00\u500b Docker container \u6642\uff0c\u5982\u8981\u5728 TP99 \u5167\u56de\u61c9 50ms \u4ee5\u4e0b\uff0c\u50c5\u80fd\u63a5\u53d7\u6bcf\u79d2 6 \u500b\u8acb\u6c42\u3002 \u518d\u589e\u52a0\u4e00\u500b Docker container\uff0c\u6b64\u6642\u80fd\u63a5\u53d7\u6bcf\u79d2 10 \u500b\uff0c\u4f9d\u5e8f\u5f80\u4e0b\u52a0\u3002 \u6700\u7d42\u5f97\u5230 4 \u500b container \u70ba\u5408\u7406\u6578\u91cf\u3002 \u5de5\u5177 \u4e0a\u8ff0\u6240\u6709\u6e2c\u8a66\uff0c\u7686\u662f\u4f7f\u7528 autocannon \u9019\u8edf\u9ad4\u6e2c\u8a66\uff0c\u76f8\u95dc\u4ee3\u78bc\u6a21\u5f0f\u7686\u70ba\uff1a $ autocannon -d 60 -c 10 -l http://localhost:3000 \u5176\u610f\u7fa9\u5728\u65bc\uff1a\u5efa\u7acb 10 \u500b\u9023\u7dda\uff08 -c \uff09\uff0c\u4e26\u6301\u7e8c\uff08 -d \uff0960 \u79d2\uff0c\u4e26\u5c55\u793a\u8a73\u76e1\u7684\u7d50\u679c\uff08 -l \uff09\uff0c\u9810\u8a2d\u6bcf\u500b\u9023\u7dda\u6bcf\u79d2\u6253 1 \u6b21\u8acb\u6c42\uff08 -p \uff09 \u5c0d\u65bc\u8a72\u4f7f\u7528\u4f55\u7a2e\u5de5\u5177\uff0c\u5176\u5be6\u4e0d\u7121\u7279\u5225\u8981\u6c42\uff0c\u4f46\u662f\u5c0d\u65bc\u5982\u4f55\u89e3\u8b80\u7d50\u679c\uff0c\u4ecd\u63a8\u85a6 How NOT to Measure Latency \u9019\u90e8\u5f71\u7247 \u82e5\u662f\u591a\u9805\u670d\u52d9\u5408\u8a08\u7684 latency\uff08\u6216\u751a\u81f3\u5168\u516c\u53f8\uff09\uff0c\u9019\u6642\u4f7f\u7528\u540c\u4e00\u7a2e\u5de5\u5177\u5c31\u986f\u5f97\u91cd\u8981\u4e86\u3002 \u5fae\u5be6\u4f5c auth","title":"SLA and Load Testing"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#sla-and-load-testing","text":"","title":"SLA and Load Testing"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_1","text":"\u7522\u54c1\u90fd\u9700\u8981\u5411\u4f7f\u7528\u8005\u5c55\u793a\u90e8\u5206\u7684 \u627f\u8afe \uff0c\u4f8b\u5982\uff1a \u8981\u6c42\u5728 100ms \u5167\u56de\u61c9\uff08Latency\uff09 1 \u5e74\u7576\u4e2d\u50c5\u6709 1 \u5c0f\u6642\u4ee5\u5167\u7684\u6642\u9593\u670d\u52d9\u53ef\u80fd\u7121\u6cd5\u4f7f\u7528 \u4efb\u4f55\u8b8a\u52d5\u90fd\u6703\u4fdd\u8b49\u4e00\u5e74\u5167\u7684\u5411\u5f8c\u76f8\u5bb9 \u9019\u985e\u4fdd\u8b49\uff0c\u7a31\u70ba SLA\uff08Service Level Agreement\uff09\u3002 SLA \u901a\u5e38\u7531\u591a\u500b SLO\uff08Service Level Objective\uff09\u7d44\u6210\uff0c\u4f8b\u5982\uff1a \u4e00\u4efd SLA \u63d0\u4f9b \u5feb\u901f\u4e14\u5b89\u5168\u7684\u652f\u4ed8\u91d1\u9322 \uff0c\u5176\u4e2d\u7684 \u4fdd\u8b49\u4e0d\u6703\u91cd\u8907\u6263\u6b3e \u5373\u70ba SLO SLI\uff08Service Level Indicator\uff09\u5373\u662f SLO \u7684\u6307\u6a19\uff0c\u4f8b\u5982 \u76ee\u6a19\u5728 100ms \u5167\u56de\u61c9\uff0c\u5be6\u969b\u6e2c\u8a66\u70ba\u5e73\u5747\u65bc 80ms \u5167\u56de\u61c9 \u597d\u7684\u670d\u52d9 SLO / SLI \u9700\u5927\u65bc\u7b49\u65bc 1 \u3002","title":"\u8aaa\u660e"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_2","text":"\u82e5\u8981\u6c42\u5728\u4e00\u500b\u670d\u52d9\u6709\u7279\u5b9a\u7684 SLO\uff0c\u5c31\u5fc5\u9808\u540c\u6642\u8a08\u7b97\u8a72\u670d\u52d9\u4e2d\u6240\u6709\u6703\u4f7f\u7528\u7684\u5b50\u670d\u52d9\u7684 SLO\u3002 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Application \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u250c\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 Service \u251c\u2500\u2500\u2500\u2534\u2500\u2500\u25baUser\u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u25b2\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b2\u2500\u2500\u2500\u2518100ms \u2514\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 30ms\u2502 40ms\u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2510 \u2502 \u2502 \u2502 API1 \u2502 \u2502 API2 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u6709\u6642\u5019\uff0c\u7522\u54c1\u904e\u65bc\u8907\u96dc\u6c92\u8fa6\u6cd5\u7522\u51fa\u5b8c\u6574\u7684\u6d41\u7a0b\u5716\uff0c\u4e8b\u5be6\u7684\u7c21\u5316\u6216\u589e\u52a0 Tracing \u90fd\u53ef\u4ee5\u5e6b\u52a9\u7522\u51fa\u3002","title":"\u5206\u6563\u5f0f\u7cfb\u7d71\u4e2d\u7684\u610f\u7fa9"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#load-test","text":"Load Test \u76ee\u7684\u5373\u662f\u8a08\u7b97\u51fa SLI\u3002 Load Test \u548c Stress Test \u5dee\u5728\u54ea\u88e1\uff1f Latency \u4ee3\u8868\u5f9e \u4e8b\u4ef6\u89f8\u767c \u5230 \u4e8b\u4ef6\u56de\u61c9 \u7684\u6642\u9593\u5dee\uff0c\u6b64\u8655\u4e26\u4e0d\u5305\u542b\u932f\u8aa4\u56de\u61c9\u7684\u72c0\u6cc1\u3002 \u4ee5\u4e0b\u7bc4\u4f8b\uff0c\u90fd\u5c07\u4ee5 Latency \u70ba SLO\uff0c\u4e26\u8a08\u7b97\u4e4b\u3002","title":"Load Test"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#baseline","text":"\u6e2c\u8a66\u91cd\u8981\u7684\u4e00\u9ede\u662f\u8981\u6709\u4e00\u500b\u57fa\u6e96\u9ede\uff0c\u4e00\u500b\u7522\u54c1\u53ef\u4ee5\u6709\u591a\u7a2e Baseline \u4f8b\u5982\uff1a \u5728\u4e0d\u505a\u4efb\u4f55\u5916\u90e8\u8acb\u6c42\u4e4b\u4e0b\u7684 Latency \u4f7f\u7528\u7684\u6846\u67b6\u6240\u9650\u5236\u7684 Latency \u4e0d\u540c\u7684 Baseline \u6703\u6709\u81ea\u5df1\u7684\u610f\u7fa9\uff0c\u6839\u64da\u9700\u6c42\u5236\u5b9a\u51fa\u7406\u60f3\u7684 Baseline\u3002","title":"Baseline"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_3","text":"\u4ee5 Node.js \u9019\u8a9e\u8a00\u6240\u80fd\u505a\u51fa\u6700\u55ae\u7d14\u7684 server \u70ba Baseline\uff1a require ( \"http\" ) . createServer (( req , res ) => res . end ( \"ok\" )) . listen ( 80 , () => null ); \u4f9d\u6b64\u89c0\u5bdf\u51fa\uff0c\u5728\u7d71\u4e00\u6a5f\u5668\u898f\u683c\u4e0b\u4efb\u4f55\u8981\u6c42\u5728 Node.js \u9019\u8a9e\u8a00\u6709\u8d85\u8d8a\u5176 Latency \u90fd\u662f\u6c92\u610f\u7fa9\u7684\u3002 \u5728\u8ffd\u6c42\u66f4\u597d\u7684 Latency \u6642\uff0c\u6216\u8a31\u8a72\u8003\u616e\u5176\u4ed6\u8a9e\u8a00\uff0c\u5982 C++ \u6216 Rust\u3002 \u4f46\u6b64\u6642\u4fbf\u9700\u8981\u6b0a\u8861\u5176\u4ed6\u8003\u91cf\uff0c\u5982\uff1a\u6703\u4f7f\u7528\u8a72\u8a9e\u8a00\u7684\u4eba\u6578\uff0c\u793e\u7fa4\u767c\u5c55\u7a0b\u5ea6\u7b49\u7b49\u3002","title":"\u7bc4\u4f8b"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#latency","text":"Stat 2.5% 50% 97.5% 99% Avg Stdev Max Latency 0ms 0ms 0ms 0ms 0.01ms 0.08ms 9.45ms Req/Sec 42,751 39,039 36,703 29,487 38,884.14 1,748.17 29,477 \u5176\u4e2d\u7684 29487 \u500b\u6bcf\u79d2\u8acb\u6c42\u91cf \u5373\u662f TP99\uff08Top Percentile\uff09\u4e0b\u7684\u57fa\u6e96\u9ede\u3002 \u6709\u6642\u6703\u8a8d\u70ba 1% \u662f\u6975\u7aef\u503c\uff0c\u61c9\u8a72\u5ffd\u7565\u3002\u7136\u800c\u5728\u7db2\u8def\u4e16\u754c\u4e2d\uff0c\u4e00\u500b\u4f7f\u7528\u8005\u5e38\u5e38\u6703\u9700\u8981\u91dd\u5c0d\u4e00\u500b\u7db2\u9801\u505a\u51fa\u5f88\u591a\u8acb\u6c42\u3002\u82e5\u4ee5\u4e00\u500b\u9801\u9762\u9700\u8981 40 \u500b\u8cc7\u6e90\u4f86\u8a08\u7b97\uff0c\u5728\u8dd1\u7b2c\u4e94\u500b\u9801\u9762\u4e4b\u5f8c\uff0c\u6709\u8fd1\u4e4e 0.003 % \u7684\u6a5f\u7387\u4f7f\u7528\u8005 \u4e0d\u6703 \u89f8\u767c\u5230 95% \u7684\u72c0\u6cc1\u3002 How NOT to Measure Latency","title":"Latency"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#reverse-proxy-haproxy","text":"Percentile With Proxy Without 99.9% 1ms 1ms 99.99% 2ms 2ms 99.999% 5ms 3ms \u5f97\u5230 19967 \u500b\u6bcf\u79d2\u8acb\u6c42\u91cf \uff0c\u76f8\u6bd4\u65bc\u57fa\u6e96\u9ede 29487 \uff0c\u770b\u5f97\u51fa\u5728\u6700\u55ae\u7d14\u7684\u61c9\u7528\u7a0b\u5f0f\u4e0b\u589e\u52a0 r-proxy \u6703\u8b93\u61c9\u7528\u7a0b\u5f0f\u8b8a\u6162\u3002 \u4f46\u82e5\u8003\u616e\u771f\u6b63\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u5047\u5982\u56de\u61c9\u6642\u9593\u70ba 100ms\uff0c\u4f7f\u7528 r-proxy \u96d6\u6703\u589e\u52a0\u56de\u61c9\u6642\u9593\uff0c\u537b\u50c5\u50c5\u589e\u52a0 1~2ms\uff0c\u6574\u9ad4\u6548\u76ca\u9084\u662f\u5927\u65bc\u5176\u6d88\u8017\u7684\u6548\u80fd\u3002","title":"\u4f7f\u7528 Reverse Proxy - HAProxy"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#http-compression","text":"\u4e0a\u8ff0\u4f8b\u5b50\u50c5\u8003\u616e\u6700\u57fa\u790e\u7684\u6846\u67b6\u6548\u80fd\uff0c\u82e5\u70ba\u4e86\u58d3\u7e2e\u7db2\u8def\u6d41\u91cf \u5957\u7528 compression\uff0c\u5c0d\u65bc\u6548\u80fd\u6703\u6709\u4ec0\u9ebc\u5f71\u97ff\uff1f \u518d\u52a0\u4e0a r-prxoy \u53c8\u6703\u6709\u4ec0\u9ebc\u5f71\u97ff\uff1f","title":"\u82e5\u8003\u616e HTTP Compression"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#latency_1","text":"Percentile With Proxy Without 99% 47ms 53ms 99.9% 50ms 57ms 99.99% 52ms 62ms 99.999% 53ms 64ms","title":"Latency"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#protocol","text":"\u4e0a\u4e00\u4efd\u5831\u544a\u8a0e\u8ad6\u5404\u7a2e\u670d\u52d9\u9593\u7684\u6e9d\u901a\u65b9\u5f0f\uff1a JSON over HTTP GraphQL gRPC \u7a76\u7adf\u54ea\u4e00\u9805\u662f\u771f\u6b63\u6709\u6548\u7387\u7684\uff1f \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 VPS client \u2502 \u2502 VPS server \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502Load Test\u251c\u2500\u2500\u25baweb-api\u251c\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u25barecipe-api\u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 protocol \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"Protocol"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_4","text":"Percentile JSON GraphQL gRPC 99% 10ms 13ms 24ms 99.9% 18ms 22ms 32ms 99.99% 26ms 36ms 82ms 99.999% 48ms 67ms 82ms","title":"\u7d50\u679c"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_5","text":"\u6211\u5011\u77e5\u9053 GraphQL \u7684\u50f9\u503c\u5728\u65bc\u53ef\u4ee5\u5728\u4e00\u500b request \u4e2d\u53d6\u5f97\u6240\u6709\u8a0a\u606f\uff0c\u4e14\u4e0d\u9700\u8981\u91dd\u5c0d\u6bcf\u500b\u5834\u666f\u5c0d\u5916\u958b\u51fa\u4e00\u500b endpoint\u3002 \u6709\u6642\u70ba\u4e86\u8ffd\u6c42\u958b\u767c\u6548\u7387\uff0c\u800c\u6703\u6368\u68c4\u90e8\u5206\u7522\u54c1\u6548\u7387\uff0c\u9019\u6642\u4fbf\u8981\u6b0a\u8861\u7522\u54c1\u7684\u7279\u6027\u8f03\u504f\u5411\u65bc\u54ea\u908a\u3002 \u9664\u6b64\u4e4b\u5916 JSON \u7684\u89e3\u6790\u5728 v8 engine \u4e2d\uff0c\u6548\u7387\u5df2\u7d93\u88ab\u6975\u81f4\u7684\u58d3\u7e2e\u4e86\uff0c\u6240\u4ee5\u76f8\u5c0d\u800c\u8a00\uff0c\u5229\u7528 Buffer \u505a binary \u89e3\u6790\u7684 gRPC \u5728\u6548\u80fd\u4e0a\u5c31\u77ee\u4e86\u4e00\u622a\u3002\u7531\u65bc\u5176\u7279\u6027\uff0c\u8b93\u4ed6\u5728 C++ \u9019\u985e\u7de8\u8b6f\u904e\u7684\u7a0b\u5f0f\u78bc\u4e2d\u6709\u8f03\u9ad8\u7684\u6548\u80fd\uff0c\u800c\u4e0d\u984d\u5916\u8655\u7406 GC \u9019\u985e\u4e8b\u4ef6\u3002","title":"\u8a0e\u8ad6"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_6","text":"SLA \u662f\u9762\u5411\u5f88\u591a\u7684\u6307\u6a19\uff0c\u6709\u6642\u5fc5\u9808\u6b0a\u8861 \u6b63\u78ba\u7684\u8a55\u4f30\u7b26\u5408\u81ea\u5df1\u7684\u6307\u6a19\uff0c\u4f8b\u5982\uff1a\u81ea\u52d5\u586b\u5beb vs \u9280\u884c\u958b\u6236 \u5728\u505a load testing \u6642\uff0c\u9700\u8981\u6ce8\u610f\u7522\u54c1\u53ef\u80fd\u7684\u6d41\u91cf\u9ad8\u4f4e\u5cf0 \u8981\u76e1\u91cf\u6e1b\u5c11\u96dc\u97f3\uff08noisy neighbor\uff09\uff0c\u76e1\u91cf\u5728\u985e\u4f3c\u7dda\u4e0a\u7684\u74b0\u5883\u4e2d\u6e2c\u8a66 \u4e00\u500b\u7522\u54c1\u7a76\u7adf\u8a72\u958b\u5e7e\u500b\uff08\u591a\u5c11 CPU/Memory\uff09\u6a5f\u5668\u4f86\u6eff\u8db3\u7dda\u4e0a\u6d41\u91cf\uff1f","title":"\u7d50\u8ad6"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_7","text":"\u89c0\u5bdf\u7dda\u4e0a\u74b0\u5883\u73fe\u6709\u7684\u6d41\u91cf\u9ad8\u5cf0\uff0c\u4e26\u5236\u5b9a\u51fa\u7b26\u5408\u5546\u52d9\u908f\u8f2f\u7684 Latency\uff08SLO\uff09\u3002 \u5236\u5b9a\u55ae\u4f4d\uff1a\u4e00\u500b Docker container\u3001\u4e00\u53f0\u6a5f\u5668\u3001EC2 \u627e\u51fa\u5728\u6eff\u8db3 TP99 \u4e0b\u7684\u8acb\u6c42\u6578 \u589e\u52a0\u55ae\u4f4d\uff0c\u53cd\u8986\u6e2c\u8a66\u76f4\u5230\u9054\u5230\u80fd\u5bb9\u7d0d\u7dda\u4e0a\u74b0\u5883\u7684\u6578\u91cf","title":"\u65b9\u5411"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_8","text":"\u82e5\u5e0c\u671b\u7522\u54c1\u80fd\u5728 50ms \u5167\u56de\u61c9\u8acb\u6c42\uff0c\u4e26\u5f97\u51fa\u7dda\u4e0a\u74b0\u5883\u9ad8\u5cf0\u7d04\u6bcf\u79d2 20 \uff08\u6216\u6bcf\u5206 1200 \u6216\u6bcf\u6642 72000\uff09\u500b\u8acb\u6c42\u3002 \u555f\u7528\u4e00\u500b Docker container \u6642\uff0c\u5982\u8981\u5728 TP99 \u5167\u56de\u61c9 50ms \u4ee5\u4e0b\uff0c\u50c5\u80fd\u63a5\u53d7\u6bcf\u79d2 6 \u500b\u8acb\u6c42\u3002 \u518d\u589e\u52a0\u4e00\u500b Docker container\uff0c\u6b64\u6642\u80fd\u63a5\u53d7\u6bcf\u79d2 10 \u500b\uff0c\u4f9d\u5e8f\u5f80\u4e0b\u52a0\u3002 \u6700\u7d42\u5f97\u5230 4 \u500b container \u70ba\u5408\u7406\u6578\u91cf\u3002","title":"\u7bc4\u4f8b"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_9","text":"\u4e0a\u8ff0\u6240\u6709\u6e2c\u8a66\uff0c\u7686\u662f\u4f7f\u7528 autocannon \u9019\u8edf\u9ad4\u6e2c\u8a66\uff0c\u76f8\u95dc\u4ee3\u78bc\u6a21\u5f0f\u7686\u70ba\uff1a $ autocannon -d 60 -c 10 -l http://localhost:3000 \u5176\u610f\u7fa9\u5728\u65bc\uff1a\u5efa\u7acb 10 \u500b\u9023\u7dda\uff08 -c \uff09\uff0c\u4e26\u6301\u7e8c\uff08 -d \uff0960 \u79d2\uff0c\u4e26\u5c55\u793a\u8a73\u76e1\u7684\u7d50\u679c\uff08 -l \uff09\uff0c\u9810\u8a2d\u6bcf\u500b\u9023\u7dda\u6bcf\u79d2\u6253 1 \u6b21\u8acb\u6c42\uff08 -p \uff09 \u5c0d\u65bc\u8a72\u4f7f\u7528\u4f55\u7a2e\u5de5\u5177\uff0c\u5176\u5be6\u4e0d\u7121\u7279\u5225\u8981\u6c42\uff0c\u4f46\u662f\u5c0d\u65bc\u5982\u4f55\u89e3\u8b80\u7d50\u679c\uff0c\u4ecd\u63a8\u85a6 How NOT to Measure Latency \u9019\u90e8\u5f71\u7247 \u82e5\u662f\u591a\u9805\u670d\u52d9\u5408\u8a08\u7684 latency\uff08\u6216\u751a\u81f3\u5168\u516c\u53f8\uff09\uff0c\u9019\u6642\u4f7f\u7528\u540c\u4e00\u7a2e\u5de5\u5177\u5c31\u986f\u5f97\u91cd\u8981\u4e86\u3002","title":"\u5de5\u5177"},{"location":"feedback/distributed-systems-with-node.js/sla-and-load-testing/#_10","text":"auth","title":"\u5fae\u5be6\u4f5c"},{"location":"projects/","text":"\u4ee5\u4e0b\u662f\u6211\u5efa\u7acb\u7684\u958b\u6e90\u5c08\u6848 Flutter \u540d\u7a31 Repo \u7248\u672c \u6700\u5f8c\u7248\u672c\u65e5\u671f POS \u7cfb\u7d71 POS System \u63d0\u793a\u5de5\u5177 Simple Tip Node.js \u540d\u7a31 Repo \u7248\u672c \u6700\u5f8c\u7248\u672c\u65e5\u671f \u7528 TypeScript \u5305\u88dd JOSE JOSE","title":"\u958b\u6e90\u5c08\u6848"},{"location":"projects/#flutter","text":"\u540d\u7a31 Repo \u7248\u672c \u6700\u5f8c\u7248\u672c\u65e5\u671f POS \u7cfb\u7d71 POS System \u63d0\u793a\u5de5\u5177 Simple Tip","title":"Flutter"},{"location":"projects/#nodejs","text":"\u540d\u7a31 Repo \u7248\u672c \u6700\u5f8c\u7248\u672c\u65e5\u671f \u7528 TypeScript \u5305\u88dd JOSE JOSE","title":"Node.js"}]}