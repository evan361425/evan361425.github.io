
<!DOCTYPE html>

<html class="no-js" lang="zh-TW">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="連線會在一段時間後關閉，發生什麼事了？" name="description"/>
<link href="https://evan361425.github.io/essay/architecture/tcp-socket-loss-after-dhcp/" rel="canonical"/>
<link href="../tomcat-max-packet-size/" rel="prev"/>
<link href="../../code/node.js-best-practice/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.48" name="generator"/>
<meta content="COb7MqeOYLfRXXUOsXWaQvnr1_Xb33a0aP_Y8UC3U5Y" name="google-site-verification"/>
<meta content="https://i.imgur.com/fRevWCC.png" property="og:image"/>
<meta content="連線會在一段時間後關閉，發生什麼事了？" property="og:description"/>
<meta content="TCP socket 連線被清除的錯誤排查" property="og:title"/>
<title>TCP socket 連線被清除的錯誤排查 - 心得與記錄</title>
<link href="../../../assets/stylesheets/main.6f8fc17f.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<style>
  /**
    * Center the table
    */
  .md-typeset__table {
    margin-left: auto;
    margin-right: auto;
    display: table;
  }

  /**
    * Center the image
    */
  figure img {
    margin-left: auto;
    margin-right: auto;
  }

  .md-typeset :is(.admonition, details) {
    font-size: .8rem;
  }

  /**
    * It will wider than mjx-math and cause screen broken.
    * This element is for screen-reader, see detailed in
    * https://docs.mathjax.org/en/latest/basic/accessibility.html#screen-reader-support
    */
  .MathJax mjx-assistive-mml {
    display: none !important;
  }

  /**
    * Keep zoomed-in image on the top of palette
    */
  .medium-zoom-image--opened {
    z-index: 10;
  }
</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=-apple-system,+BlinkMacSystemFont,+" rel="stylesheet" segoe+ui",+"helvetica+neue",+helvetica,+roboto,+arial,+"pingfang+tc",+"microsoft+jhenghei",+"微軟正黑",+sans-serif,+"apple+color+emoji",+"segoe+ui+emoji",+"segoe+ui+symbol":300,300i,400,400i,700,700i%7croboto+mono:400,400i,700,700i&display='fallback"'/>
<style>:root{--md-text-font:"-apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Helvetica, Roboto, Arial, "PingFang TC", "Microsoft JhengHei", "微軟正黑", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"";--md-code-font:"Roboto Mono"}</style>
<link href="../../../stylesheets/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-P67FD9XP83"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-P67FD9XP83",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-P67FD9XP83",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="light-blue" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#怎麼確認連線狀況">
          跳轉到
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="頁首" class="md-header__inner md-grid">
<a aria-label="心得與記錄" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="心得與記錄">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            心得與記錄
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              TCP socket 連線被清除的錯誤排查
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="黑夜降臨" class="md-option" data-md-color-accent="light-blue" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="黑夜降臨">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="白日昇起" class="md-option" data-md-color-accent="deep-orange" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="白日昇起">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜尋" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜尋" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="搜尋" class="md-search__options">
<button aria-label="清除" class="md-search__icon md-icon" tabindex="-1" title="清除" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/evan361425/evan361425.github.io" title="前往倉庫">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="標籤" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
    
  
  自我介紹

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../feedback/">
          
  
    
  
  心得

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../review/">
          
  
    
  
  年度回顧

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
    
  
  隨筆

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="導覽列" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="心得與記錄" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="心得與記錄">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    心得與記錄
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/evan361425/evan361425.github.io" title="前往倉庫">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    自我介紹
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../feedback/">
<span class="md-ellipsis">
    心得
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            心得
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/">
<span class="md-ellipsis">
    Designing Data-intensive Applications
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            Designing Data-intensive Applications
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/foundation-model/">
<span class="md-ellipsis">
    基礎—模型和語法
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/foundation-index/">
<span class="md-ellipsis">
    基礎—索引
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/foundation-dw/">
<span class="md-ellipsis">
    基礎—資料倉儲
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/foundation-encode/">
<span class="md-ellipsis">
    基礎—編碼和進程
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/foundation-ft/">
<span class="md-ellipsis">
    基礎—容錯
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/distributed-replication/">
<span class="md-ellipsis">
    分散式—複製
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/distributed-partition/">
<span class="md-ellipsis">
    分散式—分區
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/distributed-env/">
<span class="md-ellipsis">
    分散式—環境
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/distributed-ft/">
<span class="md-ellipsis">
    分散式—容錯
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/derived-batch/">
<span class="md-ellipsis">
    衍生—批次處理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/derived-stream/">
<span class="md-ellipsis">
    衍生—串流處理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/farewell/">
<span class="md-ellipsis">
    總結和整合
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/designing-data-intensive-applications/glossary/">
<span class="md-ellipsis">
    詞彙表
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../feedback/distributed-systems-with-node.js/">
<span class="md-ellipsis">
    Distributed Systems with Node.js
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Distributed Systems with Node.js
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/distributed-systems-with-node.js/protocol/">
<span class="md-ellipsis">
    協定
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/distributed-systems-with-node.js/sla-and-load-testing/">
<span class="md-ellipsis">
    SLA 和負載測試
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/distributed-systems-with-node.js/observability/">
<span class="md-ellipsis">
    可觀測性
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/distributed-systems-with-node.js/container/">
<span class="md-ellipsis">
    容器化
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/distributed-systems-with-node.js/container-orchestration-and-misc/">
<span class="md-ellipsis">
    容器調度工具和其他
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../feedback/future-of-fusion-energy/">
<span class="md-ellipsis">
    （WIP）Future Of Fusion Energy
  </span>
</a>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            （WIP）Future Of Fusion Energy
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/future-of-fusion-energy/energy/">
<span class="md-ellipsis">
    能源
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/future-of-fusion-energy/fusion/">
<span class="md-ellipsis">
    核融合
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/">
<span class="md-ellipsis">
    （WIP）SRE Workbook
  </span>
</a>
<label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
            （WIP）SRE Workbook
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/toil/">
<span class="md-ellipsis">
    勞動力
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/simplicity/">
<span class="md-ellipsis">
    簡化系統
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/on-call/">
<span class="md-ellipsis">
    待命小組
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/incident-response/">
<span class="md-ellipsis">
    災難管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/postmortem-culture/">
<span class="md-ellipsis">
    事後析誤文化
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/managing-load/">
<span class="md-ellipsis">
    負載管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/nalsd/">
<span class="md-ellipsis">
    非抽象大型系統設計
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/data-pipelines/">
<span class="md-ellipsis">
    資料管線設計
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/configuration-best-practice/">
<span class="md-ellipsis">
    設定檔的最佳實踐
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/site-reliability-workbook/canary-release/">
<span class="md-ellipsis">
    金絲雀部署
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/release-it/">
<span class="md-ellipsis">
    Release It!
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/adaptive-concurrency/">
<span class="md-ellipsis">
    Adaptive Concurrency
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../feedback/physics/">
<span class="md-ellipsis">
    Physics
  </span>
</a>
<label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
            Physics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/physics/astronomy/">
<span class="md-ellipsis">
    天文學
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../feedback/physics/special-relativity/">
<span class="md-ellipsis">
    （WIP）狹義相對論
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../review/">
<span class="md-ellipsis">
    年度回顧
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            年度回顧
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../review/2022-ai/">
<span class="md-ellipsis">
    2022 AI 回顧
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../review/2023/">
<span class="md-ellipsis">
    2023 回顧
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    隨筆
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            隨筆
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-ellipsis">
    系統架構類
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            系統架構類
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../made-container/">
<span class="md-ellipsis">
    如何製作 Docker Container
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pki-checklist/">
<span class="md-ellipsis">
    建置 PKI 注意事項
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../replace-docker-desktop/">
<span class="md-ellipsis">
    取代 Docker Desktop
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tomcat-max-packet-size/">
<span class="md-ellipsis">
    Tomcat 的 max_packet_size
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    TCP socket 連線被清除的錯誤排查
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    TCP socket 連線被清除的錯誤排查
  </span>
</a>
<nav aria-label="目錄" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目錄
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#怎麼確認連線狀況">
<span class="md-ellipsis">
      怎麼確認連線狀況
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#行為表現">
<span class="md-ellipsis">
      行為表現
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smoking-gun-1---system-network">
<span class="md-ellipsis">
      Smoking gun 1 - system-network
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#重新思考行為表現">
<span class="md-ellipsis">
      重新思考行為表現
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smoking-gun-2---conntrack">
<span class="md-ellipsis">
      Smoking gun 2 - conntrack
    </span>
</a>
<nav aria-label="Smoking gun 2 - conntrack" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#連線表被塞滿會發生什麼事">
<span class="md-ellipsis">
      連線表被塞滿會發生什麼事
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#連線表被重置後會發生什麼事">
<span class="md-ellipsis">
      連線表被重置後會發生什麼事
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#哪裡可以加速">
<span class="md-ellipsis">
      哪裡可以加速
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
<span class="md-ellipsis">
    程式語言類
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            程式語言類
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../code/node.js-best-practice/">
<span class="md-ellipsis">
    Node.js 最佳實作
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../code/node.js-error/">
<span class="md-ellipsis">
    Node.js 的錯誤有哪些
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../code/object-oriented-terms/">
<span class="md-ellipsis">
    物件導向名詞
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../code/handle-legacy-system/">
<span class="md-ellipsis">
    處理舊有系統
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
<span class="md-ellipsis">
    網路相關
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            網路相關
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/network-routing/">
<span class="md-ellipsis">
    網路怎麼傳
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/network-details/">
<span class="md-ellipsis">
    網路傳了什麼
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/network-books/">
<span class="md-ellipsis">
    網路推薦書籍
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/tcp/">
<span class="md-ellipsis">
    TCP
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/ntp/">
<span class="md-ellipsis">
    NTP
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/http/">
<span class="md-ellipsis">
    HTTP
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/retry-strategy/">
<span class="md-ellipsis">
    Retry 的策略
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/certificate-transparency/">
<span class="md-ellipsis">
    Certificate Transparency
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/url-structure/">
<span class="md-ellipsis">
    URL 長什麼樣子
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/maglev/">
<span class="md-ellipsis">
    Maglev
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
<span class="md-ellipsis">
    網路安全
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
            網路安全
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../web-security/cross-origin-resources-sharing/">
<span class="md-ellipsis">
    CORS
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web-security/mixed-content/">
<span class="md-ellipsis">
    Mixed Content
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web-security/owasp-api-top10/">
<span class="md-ellipsis">
    OWASP API Top 10
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web-security/owasp-authentication-best-practice/">
<span class="md-ellipsis">
    OWASP 驗證機制最佳指南
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web-security/owasp-mobile-risk-top10/">
<span class="md-ellipsis">
    OWASP 行動裝置風險
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
<span class="md-ellipsis">
    其他
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            其他
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../gpl-check/">
<span class="md-ellipsis">
    GPL 的檢查
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../nginx-changelog/">
<span class="md-ellipsis">
    Nginx 1.18 到 1.22 的差異
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../node-changelog-14-18/">
<span class="md-ellipsis">
    Node.js 14 到 18 的差異
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../questionnaire-principal/">
<span class="md-ellipsis">
    問卷設計指南
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../devex-in-action/">
<span class="md-ellipsis">
    開發體驗的改進
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../interview-questions/">
<span class="md-ellipsis">
    面試時的殺手級問題
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pls-sem/">
<span class="md-ellipsis">
    PLS-SEM
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../confidential-computing/">
<span class="md-ellipsis">
    機密運算
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目錄" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目錄
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#怎麼確認連線狀況">
<span class="md-ellipsis">
      怎麼確認連線狀況
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#行為表現">
<span class="md-ellipsis">
      行為表現
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smoking-gun-1---system-network">
<span class="md-ellipsis">
      Smoking gun 1 - system-network
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#重新思考行為表現">
<span class="md-ellipsis">
      重新思考行為表現
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smoking-gun-2---conntrack">
<span class="md-ellipsis">
      Smoking gun 2 - conntrack
    </span>
</a>
<nav aria-label="Smoking gun 2 - conntrack" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#連線表被塞滿會發生什麼事">
<span class="md-ellipsis">
      連線表被塞滿會發生什麼事
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#連線表被重置後會發生什麼事">
<span class="md-ellipsis">
      連線表被重置後會發生什麼事
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#哪裡可以加速">
<span class="md-ellipsis">
      哪裡可以加速
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/evan361425/evan361425.github.io/blob/master/src/essay/architecture/tcp-socket-loss-after-dhcp.md" title="編輯此頁">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5m-7.86-1.75L8.85 19l.29-.74C10.43 15.06 13.5 13 17 13c1.05 0 2.06.21 3 .56V8l-6-6H6c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h4.5c-.55-.66-1-1.42-1.36-2.25M13 3.5 18.5 9H13z"></path></svg>
</a>
<h1>TCP socket 連線被清除的錯誤排查</h1>
<p>服務是放在 Ubuntu 18 的 Docker 之中，它會在啟動之初和 Redis 進行連線，
但是這連線會在一段時間之後，莫名失效：對服務來說連線還在，但是對 Redis 來說卻不在。</p>
<p>本文將是撰寫這個狀況的排查過程。</p>
<h2 id="怎麼確認連線狀況">怎麼確認連線狀況<a class="headerlink" href="#怎麼確認連線狀況" title="Permanent link">¶</a></h2>
<p>我們在三個地方進行連線狀況的檢查，分別是 Redis、Ubuntu（Host）和承載服務的容器（Container）。</p>
<p><figure><img alt="列出狀態連線" src="https://i.imgur.com/2Wo5cac.png"/><figcaption>列出狀態連線</figcaption></figure></p>
<blockquote>
<p>我們使用 <a href="https://man7.org/linux/man-pages/man8/netstat.8.html">netstat</a>，
但也可以使用更現代的 <a href="https://man7.org/linux/man-pages/man8/ss.8.html">ss</a>。</p>
</blockquote>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>netstat<span class="w"> </span>-tn<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ESTABLISHED
tcp<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">172</span>.0.0.1:53558<span class="w"> </span><span class="m">172</span>.0.0.2:6379<span class="w"> </span>ESTABLISHED
tcp<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">172</span>.0.0.1:37672<span class="w"> </span><span class="m">172</span>.0.0.2:6379<span class="w"> </span>ESTABLISHED
</code></pre></div>
<p>上述範例是列出在 Host 上和 Redis（port 6379）建立的連線。
同樣的指令可以在容器內部和 Redis 上看到，只是 Redis 的 <code>grep</code> 就會改成 <code>LISTEN</code></p>
<h2 id="行為表現">行為表現<a class="headerlink" href="#行為表現" title="Permanent link">¶</a></h2>
<p>當連線建立之後的一段時間後（約五到三十分鐘，不固定，但不會超過三十分鐘），
Redis 就會收到 TCP <code>RST</code>，然後把連線關掉：</p>
<p><figure><img alt="TCP 封包截圖" src="https://i.imgur.com/52vv4vK.png"/><figcaption>TCP 封包截圖</figcaption></figure></p>
<p>在時間 <em>14:28:29.395914</em>（封包編號 2886）時，client 和 Redis 建立完成連線，
在 <em>14:28:29.443402</em>（封包編號 2919）時，完成一系列 Redis 商務邏輯的使用。
過了約五分鐘，Redis 回應 TCP Keep-Alive（僅有標頭的封包，編號 3855），
但這是預期的封包，因為我們在 Redis 設定了 300 秒的
<a href="https://redis.io/docs/reference/clients/#tcp-keepalive">TCP Keep-Alive</a>。</p>
<p>但令人疑惑的是，client 卻在下一個封包（編號 3856）回應 TCP <code>RST</code>。</p>
<p>當我們透過上述方法確認連線狀況時，
不管從 Host 還是 Container 的角度來看，連線都還在。
所以，這個 TCP <code>RST</code>，究竟是誰發的？</p>
<h2 id="smoking-gun-1---system-network">Smoking gun 1 - system-network<a class="headerlink" href="#smoking-gun-1---system-network" title="Permanent link">¶</a></h2>
<p>就結論來說，這個是錯誤方向，不過在這裡記錄一下。</p>
<p>Ubuntu 基本都會裝上 systemd 去管理很多系統服務，其中一個就是 system-network。
相關的 issue（<a href="https://github.com/moby/moby/issues/40217#issuecomment-708276691">docker0 interface keeps losing IPv4 ipaddress</a>）
表現了很類似的特徵，故而開始朝著方向追。
但是在機器上透過 <code>networkctl list</code> 列出的資料卻不符合 issue 上的說明：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>networkctl<span class="w"> </span>list
IDX<span class="w"> </span>LINK<span class="w">            </span>TYPE<span class="w">     </span>OPERATIONAL<span class="w"> </span>SETUP
<span class="w">  </span><span class="m">1</span><span class="w"> </span>lo<span class="w">              </span>loopback<span class="w"> </span>carrier<span class="w">    </span>unmanaged
<span class="w">  </span><span class="m">2</span><span class="w"> </span>ens3<span class="w">            </span>ether<span class="w">    </span>routable<span class="w">   </span>configured
<span class="w">  </span><span class="m">3</span><span class="w"> </span>ens4<span class="w">            </span>ether<span class="w">    </span>off<span class="w">        </span>unmanaged
<span class="w">  </span><span class="m">4</span><span class="w"> </span>docker0<span class="w">         </span>ether<span class="w">    </span>no-carrier<span class="w"> </span>unmanaged
<span class="m">942</span><span class="w"> </span>br-788fecf403ed<span class="w"> </span>ether<span class="w">    </span>routable<span class="w">   </span>unmanaged
<span class="m">944</span><span class="w"> </span>veth6af5546<span class="w">     </span>ether<span class="w">    </span>degraded<span class="w">   </span>unmanaged

<span class="m">6</span><span class="w"> </span>links<span class="w"> </span>listed.
</code></pre></div>
<p>由上可知，docker 相關的 link（<code>docker0</code>、<code>br-*</code> 和 <code>veth*</code>）都不是透過 system-network 去管理了。</p>
<blockquote>
<p>其中的 degraded 代表該 link 沒有 public IP，因為是虛擬介面，所以這樣是正常的。</p>
</blockquote>
<h2 id="重新思考行為表現">重新思考行為表現<a class="headerlink" href="#重新思考行為表現" title="Permanent link">¶</a></h2>
<p>我們知道 Host 認為他的的連線還在，所以有個應用在 netstat 感知到變化之前就拒絕掉封包了，
所以我們必須去了解 netstat 的運作流程。</p>
<details class="note">
<summary>推薦使用 ss</summary>
<p><a href="https://man7.org/linux/man-pages/man8/ss.8.html"><code>ss</code></a> 是被認為<a href="https://training.linuxfoundation.org/resources/tutorials/an-introduction-to-the-ss-command/">應該取代
netstat 的工具</a>。</p>
<blockquote>
<p>the netstat command has been deprecated in favor of the faster,
more human-readable ss command.</p>
</blockquote>
<p>事實上，很多工具已經被認為是過時的，以 Linux foundation 中推薦的
<a href="https://wiki.linuxfoundation.org/networking/net-tools">networking 工具</a>為例：</p>
<table>
<thead>
<tr>
<th>program</th>
<th>obsoleted by</th>
</tr>
</thead>
<tbody>
<tr>
<td>arp</td>
<td>ip neigh</td>
</tr>
<tr>
<td>ifconfig</td>
<td>ip addr</td>
</tr>
<tr>
<td>ipmaddr</td>
<td>ip maddr</td>
</tr>
<tr>
<td>iptunnel</td>
<td>ip tunnel</td>
</tr>
<tr>
<td>route</td>
<td>ip route</td>
</tr>
<tr>
<td>nameif</td>
<td>ifrename</td>
</tr>
<tr>
<td>mii-tool</td>
<td>ethtool</td>
</tr>
</tbody>
</table>
<p><code>ss</code> 是透過 <a href="https://man7.org/linux/man-pages/man7/sock_diag.7.html">socket_diag</a>
去取得 OS's kernel 的連線資訊，包括：</p>
<ul>
<li><a href="https://www.tutorialspoint.com/unix_sockets/socket_structures.htm">socket</a></li>
<li><a href="https://www.halolinux.us/kernel-reference/routing-data-structures.html">routing table</a></li>
<li><a href="https://arthurchiao.art/blog/conntrack-design-and-implementation/">connection tracking</a></li>
</ul>
</details>
<p>netstat 是透過 <code>/proc</code> 的資料夾來取得現有的連線資訊，
換句話說，對 netstat 來說，連線資訊其實是 user-space 而非 kernel space：</p>
<p><figure><img alt="Kernel routing 的簡易流程圖" src="https://i.imgur.com/CcKOuXx.png"/><figcaption>Kernel routing 的簡易流程圖</figcaption></figure></p>
<p>上面這張圖很複雜，但是既然徵狀是 TCP <code>RST</code> 那我們就專注於 layer3 的流程。
在進到 user-space 之前，會有三大塊：</p>
<ul>
<li>pre-routing，紀錄（conntrack）、修正（mangle）、轉址對應（NAT）</li>
<li>routing decision，判斷是否送給 user-space</li>
<li>input，修正（mangle）、篩選（filter）</li>
</ul>
<p>mangle 和 filter 都是 iptables 等防火牆服務會跟 OS 註冊 Hooks 來達成，
在 Linux 中，實踐這個 Hook 的就是 <a href="https://en.wikipedia.org/wiki/Netfilter">Netfilter</a>。
在雲原生環境的 <a href="https://cilium.io/">Cilium</a> 則是透過 Linux 中的 <a href="https://ebpf.io/">eBPF</a> 實踐。</p>
<p>NAT 則是用來修正 IP 來達到溝通，經典的用法就是把
<a href="https://arthurchiao.art/blog/conntrack-design-and-implementation-zh/#151-网络地址转换nat">本地 IP 轉成外部 IP</a>。</p>
<p>那 pre-routing 的 conntrack 是什麼呢？</p>
<h2 id="smoking-gun-2---conntrack">Smoking gun 2 - conntrack<a class="headerlink" href="#smoking-gun-2---conntrack" title="Permanent link">¶</a></h2>
<p>conntrack（connection tracking）被設計來<a href="https://blog.cloudflare.com/conntrack-tales-one-thousand-and-one-flows/">追蹤協定的流程狀態</a>，
這裡的流程也可稱為連線狀態，但要注意這個「連線」並不是 L4 意義上的連線，
最明顯的特徵就是 conntrack 仍會去追蹤 UDP、ICMP 這類非「連線」的協定。</p>
<p>什麼是流程狀態？舉個例子，當你收到 TCP <code>ACK</code>，你可以知道目前這個封包目的是什麼嗎？</p>
<ul>
<li>完整收到上一個資料的「確認通知」？</li>
<li>Keep-Alive 通知？</li>
<li>三次交握完成通知？</li>
<li>四次揮手的階段或完成通知？</li>
</ul>
<p>在不知道現在流程的狀態下，你怎麼辨別這個 <code>ACK</code> 是帶有惡意的 <code>ACK</code> 還是正常的 <code>ACK</code>？</p>
<details class="example">
<summary>TCP ACK Scan</summary>
<p>透過在所有 port 上面發送 ACK 我可以確保目前該節點開通了哪些 port（包含那些 client port），
如果 port 被開通，我就會收到 TCP RST，反之則會沒有任何回應。</p>
<p>如果我想要讓這類的封包都不給任何回應，我就需要讓 conntrack 有能力辨別哪個 ACK 是正確的 ACK。</p>
</details>
<p>為了記錄這些流程，你可以想像 conntrack 會追蹤至少六種的資料：</p>
<ul>
<li><a href="https://elixir.bootlin.com/linux/v5.19.17/source/include/net/netfilter/nf_conntrack.h#L32">協定種類</a></li>
<li>source IP, port</li>
<li>destination IP, port</li>
<li>connection state</li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>conntrack<span class="w"> </span>-L
udp<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="nv">src</span><span class="o">=</span><span class="m">172</span>.0.0.1<span class="w"> </span><span class="nv">dst</span><span class="o">=</span><span class="m">172</span>.0.0.3<span class="w"> </span><span class="nv">sport</span><span class="o">=</span><span class="m">138</span><span class="w"> </span><span class="nv">dport</span><span class="o">=</span><span class="m">138</span><span class="w"> </span><span class="o">[</span>UNREPLIED<span class="o">]</span><span class="w"> </span><span class="nv">src</span><span class="o">=</span><span class="m">172</span>.0.0.3<span class="w"> </span><span class="nv">dst</span><span class="o">=</span><span class="m">172</span>.0.0.1<span class="w"> </span><span class="nv">sport</span><span class="o">=</span><span class="m">138</span><span class="w"> </span><span class="nv">dport</span><span class="o">=</span><span class="m">138</span><span class="w"> </span><span class="nv">mark</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">use</span><span class="o">=</span><span class="m">1</span>
tcp<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">110</span><span class="w"> </span>TIME_WAIT<span class="w"> </span><span class="nv">src</span><span class="o">=</span><span class="m">172</span>.0.0.1<span class="w"> </span><span class="nv">dst</span><span class="o">=</span><span class="m">172</span>.0.0.4<span class="w"> </span><span class="nv">sport</span><span class="o">=</span><span class="m">40286</span><span class="w"> </span><span class="nv">dport</span><span class="o">=</span><span class="m">80</span><span class="w"> </span><span class="nv">src</span><span class="o">=</span><span class="m">172</span>.0.0.4<span class="w"> </span><span class="nv">dst</span><span class="o">=</span><span class="m">172</span>.0.0.1<span class="w"> </span><span class="nv">sport</span><span class="o">=</span><span class="m">80</span><span class="w"> </span><span class="nv">dport</span><span class="o">=</span><span class="m">40286</span><span class="w"> </span><span class="o">[</span>ASSURED<span class="o">]</span><span class="w"> </span><span class="nv">mark</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">use</span><span class="o">=</span><span class="m">1</span>
</code></pre></div>
<p>分析一下輸出：</p>
<ul>
<li>conntrack 收到一個 UDP 封包；</li>
<li><a href="https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml">協定編號 17</a>；</li>
<li>29 秒後這個資料將會被清除，根據協定的不同，達到特定狀態後這個值將會被重置；</li>
<li><code>UNREPLIED</code> 代表這個 UDP「連線」沒有收到回覆，這是 <a href="https://elixir.bootlin.com/linux/v5.19.17/source/include/net/netns/conntrack.h#L37">UDP 特有的狀態</a>；</li>
<li>IP 和 Port</li>
<li>mark，根據商務邏輯標記這個連線，例如 iptables 的阻擋等等；</li>
<li><a href="https://elixir.bootlin.com/linux/v5.19.17/source/include/net/netfilter/nf_conntrack.h#L60">use</a> 是 counter 用來記錄 GC 狀態。</li>
</ul>
<p>在第二行中，TCP 連線最後進入 <a href="https://thermalcircle.de/doku.php?id=blog:linux:connection_tracking_3_state_and_examples#nfconnstatus_detail"><code>ASSURED</code></a> 狀態，
代表這個連線已經建立起來不會被因為倒數計時而被回收，但是它仍會在 TCP 結束連線後被回收。</p>
<blockquote>
<p>預設可以記錄 256K 個流程資訊，你可以透過 <code>cat /proc/sys/net/nf_conntrack_max</code> 來確認。</p>
<p>如果你想知道不同協定得到的狀態有哪些，可以參考這篇
<a href="https://www.cnblogs.com/huenchao/p/6225770.html">blog</a>。</p>
</blockquote>
<details class="success">
<summary>conntrack 的教學資源</summary>
<p>conntrack 很複雜，光是理解這個套件存在目的就需要一些時間，底層實作更是複雜。
網路上有找到一些教程：</p>
<ol>
<li><a href="https://thermalcircle.de/doku.php?id=blog:linux:connection_tracking_1_modules_and_hooks">Connection tracking (conntrack) - Part 1: Modules and Hooks</a></li>
<li><a href="https://thermalcircle.de/doku.php?id=blog:linux:connection_tracking_2_core_implementation">Connection tracking (conntrack) - Part 2: Core Implementation</a></li>
<li><a href="https://thermalcircle.de/doku.php?id=blog:linux:connection_tracking_3_state_and_examples">Connection tracking (conntrack) - Part 3: State and Examples</a></li>
</ol>
<p>Fedora Magazine 關於 conntrack 的介紹：</p>
<ol>
<li><a href="https://fedoramagazine.org/network-address-translation-part-1-packet-tracing/">Network address translation part 1 – packet tracing</a></li>
<li><a href="https://fedoramagazine.org/network-address-translation-part-2-the-conntrack-tool/">Network address translation part 2 – the conntrack tool</a></li>
<li><a href="https://fedoramagazine.org/conntrack-event-framework/">Network address translation part 3 – the conntrack event framework</a></li>
<li><a href="https://fedoramagazine.org/network-address-translation-part-4-conntrack-troubleshooting/">Network address translation part 4 – Conntrack troubleshooting</a></li>
</ol>
</details>
<h3 id="連線表被塞滿會發生什麼事">連線表被塞滿會發生什麼事<a class="headerlink" href="#連線表被塞滿會發生什麼事" title="Permanent link">¶</a></h3>
<p>有個 <a href="https://blog.cloudflare.com/conntrack-tales-one-thousand-and-one-flows/#canconntracktablefillup">cloudflare blog</a>
說明這件事，簡單來說，可能會把新的封包丟棄並捨棄 conntrack 表格中那些非 <code>ASSURED</code> 的連線。</p>
<h3 id="連線表被重置後會發生什麼事">連線表被重置後會發生什麼事<a class="headerlink" href="#連線表被重置後會發生什麼事" title="Permanent link">¶</a></h3>
<p>如同前面提到的「TCP ACK Scan」，
如果 conntrack 收到沒有註冊的 TCP <code>ACK</code>，預設會回應 TCP <code>RST</code>。</p>
<p>這和我們觀察到的行爲表現一樣，但我們的連線表被重置了嗎？</p>
<h4 id="連線表被重置了嗎">連線表被重置了嗎<a class="headerlink" href="#連線表被重置了嗎" title="Permanent link">¶</a></h4>
<p>因為表徵是一樣的，服務感知不到 TCP Keep-Alive，但是卻透過 tcpdump 觀察到 TCP <code>RST</code>，
所以我們開始懷疑是不是 conntrack 的問題，順著這樣的思維，嘗試尋找證據。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>conntrack<span class="w"> </span>-L<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">6379</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-n<span class="w"> </span>ESTABLISHED<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
conntrack<span class="w"> </span>v1.4.4<span class="w"> </span><span class="o">(</span>conntrack-tools<span class="o">)</span>:<span class="w"> </span><span class="m">171</span><span class="w"> </span>flow<span class="w"> </span>entries<span class="w"> </span>have<span class="w"> </span>been<span class="w"> </span>shown.
<span class="m">25</span>
</code></pre></div>
<p>這個指令告訴我們，現在和 Redis（port 6379）的連線有 25 條，
接著定期去檢查這個指令的結果，就會發現一段時間之後，它被清空了：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>watch<span class="w"> </span>-c<span class="w"> </span><span class="s1">'conntrack -L | grep 6379 | grep -n ESTABLISHED | wc -l'</span>
conntrack<span class="w"> </span>v1.4.4<span class="w"> </span><span class="o">(</span>conntrack-tools<span class="o">)</span>:<span class="w"> </span><span class="m">90</span><span class="w"> </span>flow<span class="w"> </span>entries<span class="w"> </span>have<span class="w"> </span>been<span class="w"> </span>shown.
<span class="m">0</span>
</code></pre></div>
<p>透過 syslog 也可以追查到當 conntrack 顯示為 0 的時候，有這樣相關的紀錄：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/syslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>DHCP
Jul<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">10</span>:52:38<span class="w"> </span>my-host<span class="w"> </span>systemd-networkd<span class="o">[</span><span class="m">913</span><span class="o">]</span>:<span class="w"> </span>ens3:<span class="w"> </span>DHCP<span class="w"> </span>lease<span class="w"> </span>lost
Jul<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">10</span>:52:38<span class="w"> </span>my-host<span class="w"> </span>systemd-networkd<span class="o">[</span><span class="m">913</span><span class="o">]</span>:<span class="w"> </span>ens3:<span class="w"> </span>DHCPv4<span class="w"> </span>address<span class="w"> </span><span class="m">172</span>.1.0.1/20<span class="w"> </span>via<span class="w"> </span><span class="m">172</span>.1.0.2
</code></pre></div>
<p>可以看到當 conntrack 被清空時（<code>conntrack -L</code> 為零），DHCP Server 的請求被了送進來，
這種巧合，足以讓我們繼續深入追蹤。也進一步發現一些相關 issue：</p>
<ul>
<li><a href="https://github.com/systemd/systemd/issues/16071">systemd-networkd removes IPv4 address during DHCP renewal</a></li>
<li><a href="https://github.com/systemd/systemd/issues/15421">DHCP Renew Causing Interface To Restart</a></li>
</ul>
<p>也注意到 systemd.networkd 在管理連線的時候，可能會尊重 DHCP 的請求並重新綁定本地位置：</p>
<blockquote>
<p><a href="https://systemd.network/systemd.network.html#KeepConfiguration=">KeepConfiguration</a></p>
<p>Takes a boolean or one of "static", "dhcp-on-stop", "dhcp". When "static",
systemd-networkd will not drop static addresses and routes on starting up process.
When set to "dhcp-on-stop", systemd-networkd will not drop addresses and routes on
stopping the daemon. When "dhcp", the addresses and routes provided by a DHCP server
will never be dropped even if the DHCP lease expires. This is contrary to the DHCP
specification, but may be the best choice if, e.g., the root filesystem relies on this
connection. The setting "dhcp" implies "dhcp-on-stop", and "yes" implies "dhcp" and
"static". Defaults to "dhcp-on-stop" when systemd-networkd is running in initrd, "yes"
when the root filesystem is a network filesystem, and "no" otherwise.</p>
</blockquote>
<p>不過不管原因是什麼，最終我們的解法是在 DHCP Server 中綁定靜態 IP，
避免每隔三十分鐘重新設定一次 IP。</p>
<h2 id="哪裡可以加速">哪裡可以加速<a class="headerlink" href="#哪裡可以加速" title="Permanent link">¶</a></h2>
<p>在處理這問題的時候其實花了很多時間，主要是因為對 Linux 底層處理連線的不清楚。
重新順一下排查的脈絡：</p>
<ul>
<li>在 Client、Server（Redis）、Firewall 三端執行 TCP Dump，看到連線被正常建立。</li>
<li>Server 預設會每五分鐘做一次 TCP Keep-Alive，當它送出 Keep-Alive <code>ACK</code> 封包：<ul>
<li>Firewall 有看到 <code>ACK</code> 封包；</li>
<li>Client 有看到 <code>ACK</code> 封包，並且接著回應 <code>RST</code> 封包；</li>
<li>Firewall、Server 都收到 <code>RST</code>，並且釋放相關資源。</li>
</ul>
</li>
<li>此時透過 netstat 在 Client 上得知對應用程式來說，連線仍然存在；</li>
<li>懷疑 TCP Keep-Alive 的某種封包錯誤，並嘗試把頻率從 5 分鐘降到 30 分鐘；</li>
<li>檢查封包其中的格式和各個設定；</li>
<li>懷疑 Linux 底層實作，網路上查各種可能；</li>
<li>最終推測 conntrack 的表重置，並透過 syslog 得到 DHCP 的說明。</li>
</ul>
<p>其實排查過程很重要的一點是 log，但卻常常被忽略，
我們應該在 TCP Dump 的過程，一起去監聽 Log 的輸出。</p>
<p>既然排查出是 client 的問題，我們也可以試著在相同環境的其他節點看看是否有連線錯誤問題。
最後就是雖然非系統管理者平常不應該在線上環境中操作相關節點，但是當進入排查的流程時，
需要盡快讓相關人員有權限可以進到節點進行各種實驗，否則每次做操作都需要大家約時間，簡直曠日費時。</p>
<p>最後，這段的排查很大程度是同事 Angus 做的，在這邊僅作簡單紀錄，
若未來有任何人因為這篇文章得到幫助，僅以此表達對 Angus 的感謝。</p>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="最後更新">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年5月7日</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="建立日期">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2023年8月22日</span>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到頂端
</button>
</main>
<footer class="md-footer">
<nav aria-label="頁腳" class="md-footer__inner md-grid">
<a aria-label="上一頁: Tomcat 的 max_packet_size" class="md-footer__link md-footer__link--prev" href="../tomcat-max-packet-size/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                上一頁
              </span>
<div class="md-ellipsis">
                Tomcat 的 max_packet_size
              </div>
</div>
</a>
<a aria-label="下一頁: Node.js 最佳實作" class="md-footer__link md-footer__link--next" href="../../code/node.js-best-practice/">
<div class="md-footer__title">
<span class="md-footer__direction">
                下一頁
              </span>
<div class="md-ellipsis">
                Node.js 最佳實作
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.top", "navigation.tabs", "navigation.indexes", "navigation.footer", "content.code.annotate", "content.code.copy", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
<script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
<script src="../../../javascripts/custom.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js"></script>
</body>
</html>